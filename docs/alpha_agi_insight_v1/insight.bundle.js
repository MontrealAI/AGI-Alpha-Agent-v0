var zB=Object.create;var xd=Object.defineProperty;var NB=Object.getOwnPropertyDescriptor;var LB=Object.getOwnPropertyNames;var DB=Object.getPrototypeOf,MB=Object.prototype.hasOwnProperty;var PB=(e,t,r)=>t in e?xd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Bo=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var tg=(e,t)=>()=>(e&&(t=e(e=0)),t);var UB=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),I2=(e,t)=>{for(var r in t)xd(e,r,{get:t[r],enumerable:!0})},FB=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of LB(t))!MB.call(e,i)&&i!==r&&xd(e,i,{get:()=>t[i],enumerable:!(n=NB(t,i))||n.enumerable});return e};var GB=(e,t,r)=>(r=e!=null?zB(DB(e)):{},FB(t||!e||!e.__esModule?xd(r,"default",{value:e,enumerable:!0}):r,e));var An=(e,t,r)=>PB(e,typeof t!="symbol"?t+"":t,r);var D$=UB((M0,P0)=>{(function(e,t){typeof M0=="object"&&typeof P0<"u"?P0.exports=t():typeof define=="function"&&define.amd?define(t):e.createREGL=t()})(M0,function(){"use strict";var e=function(_){return _ instanceof Uint8Array||_ instanceof Uint16Array||_ instanceof Uint32Array||_ instanceof Int8Array||_ instanceof Int16Array||_ instanceof Int32Array||_ instanceof Float32Array||_ instanceof Float64Array||_ instanceof Uint8ClampedArray},t=function(_,z){for(var F=Object.keys(z),se=0;se<F.length;++se)_[F[se]]=z[F[se]];return _},r=`
`;function n(_){return typeof atob<"u"?atob(_):"base64:"+_}function i(_){var z=new Error("(regl) "+_);throw console.error(z),z}function a(_,z){_||i(z)}function o(_){return _?": "+_:""}function s(_,z,F){_ in z||i("unknown parameter ("+_+")"+o(F)+". possible values: "+Object.keys(z).join())}function u(_,z){e(_)||i("invalid parameter type"+o(z)+". must be a typed array")}function l(_,z){switch(z){case"number":return typeof _=="number";case"object":return typeof _=="object";case"string":return typeof _=="string";case"boolean":return typeof _=="boolean";case"function":return typeof _=="function";case"undefined":return typeof _>"u";case"symbol":return typeof _=="symbol"}}function c(_,z,F){l(_,z)||i("invalid parameter type"+o(F)+". expected "+z+", got "+typeof _)}function f(_,z){_>=0&&(_|0)===_||i("invalid parameter type, ("+_+")"+o(z)+". must be a nonnegative integer")}function p(_,z,F){z.indexOf(_)<0&&i("invalid value"+o(F)+". must be one of: "+z)}var d=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function m(_){Object.keys(_).forEach(function(z){d.indexOf(z)<0&&i('invalid regl constructor argument "'+z+'". must be one of '+d)})}function g(_,z){for(_=_+"";_.length<z;)_=" "+_;return _}function x(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function b(_,z){this.number=_,this.line=z,this.errors=[]}function y(_,z,F){this.file=_,this.line=z,this.message=F}function E(){var _=new Error,z=(_.stack||_).toString(),F=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(z);if(F)return F[1];var se=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(z);return se?se[1]:"unknown"}function $(){var _=new Error,z=(_.stack||_).toString(),F=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(z);if(F)return F[1];var se=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(z);return se?se[1]:"unknown"}function k(_,z){var F=_.split(`
`),se=1,be=0,oe={unknown:new x,0:new x};oe.unknown.name=oe[0].name=z||E(),oe.unknown.lines.push(new b(0,""));for(var de=0;de<F.length;++de){var Te=F[de],Se=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Te);if(Se)switch(Se[1]){case"line":var Ne=/(\d+)(\s+\d+)?/.exec(Se[2]);Ne&&(se=Ne[1]|0,Ne[2]&&(be=Ne[2]|0,be in oe||(oe[be]=new x)));break;case"define":var De=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Se[2]);De&&(oe[be].name=De[1]?n(De[2]):De[2]);break}oe[be].lines.push(new b(se++,Te))}return Object.keys(oe).forEach(function(Le){var je=oe[Le];je.lines.forEach(function(Ae){je.index[Ae.number]=Ae})}),oe}function R(_){var z=[];return _.split(`
`).forEach(function(F){if(!(F.length<5)){var se=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(F);se?z.push(new y(se[1]|0,se[2]|0,se[3].trim())):F.length>0&&z.push(new y("unknown",0,F))}}),z}function C(_,z){z.forEach(function(F){var se=_[F.file];if(se){var be=se.index[F.line];if(be){be.errors.push(F),se.hasErrors=!0;return}}_.unknown.hasErrors=!0,_.unknown.lines[0].errors.push(F)})}function P(_,z,F,se,be){if(!_.getShaderParameter(z,_.COMPILE_STATUS)){var oe=_.getShaderInfoLog(z),de=se===_.FRAGMENT_SHADER?"fragment":"vertex";Me(F,"string",de+" shader source must be a string",be);var Te=k(F,be),Se=R(oe);C(Te,Se),Object.keys(Te).forEach(function(Ne){var De=Te[Ne];if(!De.hasErrors)return;var Le=[""],je=[""];function Ae(Be,Z){Le.push(Be),je.push(Z||"")}Ae("file number "+Ne+": "+De.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),De.lines.forEach(function(Be){if(Be.errors.length>0){Ae(g(Be.number,4)+"|  ","background-color:yellow; font-weight:bold"),Ae(Be.line+r,"color:red; background-color:yellow; font-weight:bold");var Z=0;Be.errors.forEach(function(le){var Oe=le.message,tt=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Oe);if(tt){var Ee=tt[1];switch(Oe=tt[2],Ee){case"assign":Ee="=";break}Z=Math.max(Be.line.indexOf(Ee,Z),0)}else Z=0;Ae(g("| ",6)),Ae(g("^^^",Z+3)+r,"font-weight:bold"),Ae(g("| ",6)),Ae(Oe+r,"font-weight:bold")}),Ae(g("| ",6)+r)}else Ae(g(Be.number,4)+"|  "),Ae(Be.line+r,"color:red")}),typeof document<"u"&&!window.chrome?(je[0]=Le.join("%c"),console.log.apply(console,je)):console.log(Le.join(""))}),a.raise("Error compiling "+de+" shader, "+Te[0].name)}}function W(_,z,F,se,be){if(!_.getProgramParameter(z,_.LINK_STATUS)){var oe=_.getProgramInfoLog(z),de=k(F,be),Te=k(se,be),Se='Error linking program with vertex shader, "'+Te[0].name+'", and fragment shader "'+de[0].name+'"';typeof document<"u"?console.log("%c"+Se+r+"%c"+oe,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Se+r+oe),a.raise(Se)}}function te(_){_._commandRef=E()}function ce(_,z,F,se){te(_);function be(Se){return Se?se.id(Se):0}_._fragId=be(_.static.frag),_._vertId=be(_.static.vert);function oe(Se,Ne){Object.keys(Ne).forEach(function(De){Se[se.id(De)]=!0})}var de=_._uniformSet={};oe(de,z.static),oe(de,z.dynamic);var Te=_._attributeSet={};oe(Te,F.static),oe(Te,F.dynamic),_._hasCount="count"in _.static||"count"in _.dynamic||"elements"in _.static||"elements"in _.dynamic}function pe(_,z){var F=$();i(_+" in command "+(z||E())+(F==="unknown"?"":" called from "+F))}function ge(_,z,F){_||pe(z,F||E())}function fe(_,z,F,se){_ in z||pe("unknown parameter ("+_+")"+o(F)+". possible values: "+Object.keys(z).join(),se||E())}function Me(_,z,F,se){l(_,z)||pe("invalid parameter type"+o(F)+". expected "+z+", got "+typeof _,se||E())}function Ge(_){_()}function He(_,z,F){_.texture?p(_.texture._texture.internalformat,z,"unsupported texture format for attachment"):p(_.renderbuffer._renderbuffer.format,F,"unsupported renderbuffer format for attachment")}var dt=33071,he=9728,qe=9984,ae=9985,we=9986,Re=9987,ne=5120,at=5121,kt=5122,pt=5123,mt=5124,gt=5125,Dt=5126,Bt=32819,er=32820,yr=33635,Kt=34042,br=36193,w={};w[ne]=w[at]=1,w[kt]=w[pt]=w[br]=w[yr]=w[Bt]=w[er]=2,w[mt]=w[gt]=w[Dt]=w[Kt]=4;function T(_,z){return _===er||_===Bt||_===yr?2:_===Kt?4:w[_]*z}function O(_){return!(_&_-1)&&!!_}function q(_,z,F){var se,be=z.width,oe=z.height,de=z.channels;a(be>0&&be<=F.maxTextureSize&&oe>0&&oe<=F.maxTextureSize,"invalid texture shape"),(_.wrapS!==dt||_.wrapT!==dt)&&a(O(be)&&O(oe),"incompatible wrap mode for texture, both width and height must be power of 2"),z.mipmask===1?be!==1&&oe!==1&&a(_.minFilter!==qe&&_.minFilter!==we&&_.minFilter!==ae&&_.minFilter!==Re,"min filter requires mipmap"):(a(O(be)&&O(oe),"texture must be a square power of 2 to support mipmapping"),a(z.mipmask===(be<<1)-1,"missing or incomplete mipmap data")),z.type===Dt&&(F.extensions.indexOf("oes_texture_float_linear")<0&&a(_.minFilter===he&&_.magFilter===he,"filter not supported, must enable oes_texture_float_linear"),a(!_.genMipmaps,"mipmap generation not supported with float textures"));var Te=z.images;for(se=0;se<16;++se)if(Te[se]){var Se=be>>se,Ne=oe>>se;a(z.mipmask&1<<se,"missing mipmap data");var De=Te[se];if(a(De.width===Se&&De.height===Ne,"invalid shape for mip images"),a(De.format===z.format&&De.internalformat===z.internalformat&&De.type===z.type,"incompatible type for mip image"),!De.compressed)if(De.data){var Le=Math.ceil(T(De.type,de)*Se/De.unpackAlignment)*De.unpackAlignment;a(De.data.byteLength===Le*Ne,"invalid data for image, buffer size is inconsistent with image format")}else De.element||De.copy}else _.genMipmaps||a((z.mipmask&1<<se)===0,"extra mipmap data");z.compressed&&a(!_.genMipmaps,"mipmap generation for compressed images not supported")}function ie(_,z,F,se){var be=_.width,oe=_.height,de=_.channels;a(be>0&&be<=se.maxTextureSize&&oe>0&&oe<=se.maxTextureSize,"invalid texture shape"),a(be===oe,"cube map must be square"),a(z.wrapS===dt&&z.wrapT===dt,"wrap mode not supported by cube map");for(var Te=0;Te<F.length;++Te){var Se=F[Te];a(Se.width===be&&Se.height===oe,"inconsistent cube map face shape"),z.genMipmaps&&(a(!Se.compressed,"can not generate mipmap for compressed textures"),a(Se.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Ne=Se.images,De=0;De<16;++De){var Le=Ne[De];if(Le){var je=be>>De,Ae=oe>>De;a(Se.mipmask&1<<De,"missing mipmap data"),a(Le.width===je&&Le.height===Ae,"invalid shape for mip images"),a(Le.format===_.format&&Le.internalformat===_.internalformat&&Le.type===_.type,"incompatible type for mip image"),Le.compressed||(Le.data?a(Le.data.byteLength===je*Ae*Math.max(T(Le.type,de),Le.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Le.element||Le.copy)}}}}var S=t(a,{optional:Ge,raise:i,commandRaise:pe,command:ge,parameter:s,commandParameter:fe,constructor:m,type:c,commandType:Me,isTypedArray:u,nni:f,oneOf:p,shaderError:P,linkError:W,callSite:$,saveCommandRef:te,saveDrawInfo:ce,framebufferFormat:He,guessCommand:E,texture2D:q,textureCube:ie}),ze=0,Mt=0,qt=5,fr=6;function Lt(_,z){this.id=ze++,this.type=_,this.data=z}function Rt(_){return _.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function cn(_){if(_.length===0)return[];var z=_.charAt(0),F=_.charAt(_.length-1);if(_.length>1&&z===F&&(z==='"'||z==="'"))return['"'+Rt(_.substr(1,_.length-2))+'"'];var se=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(_);if(se)return cn(_.substr(0,se.index)).concat(cn(se[1])).concat(cn(_.substr(se.index+se[0].length)));var be=_.split(".");if(be.length===1)return['"'+Rt(_)+'"'];for(var oe=[],de=0;de<be.length;++de)oe=oe.concat(cn(be[de]));return oe}function Ea(_){return"["+cn(_).join("][")+"]"}function Pn(_,z){return new Lt(_,Ea(z+""))}function Un(_){return typeof _=="function"&&!_._reglType||_ instanceof Lt}function ki(_,z){if(typeof _=="function")return new Lt(Mt,_);if(typeof _=="number"||typeof _=="boolean")return new Lt(qt,_);if(Array.isArray(_))return new Lt(fr,_.map(function(F,se){return ki(F,z+"["+se+"]")}));if(_ instanceof Lt)return _;S(!1,"invalid option type in uniform "+z)}var Mr={DynamicVariable:Lt,define:Pn,isDynamic:Un,unbox:ki,accessor:Ea},Br={next:typeof requestAnimationFrame=="function"?function(_){return requestAnimationFrame(_)}:function(_){return setTimeout(_,16)},cancel:typeof cancelAnimationFrame=="function"?function(_){return cancelAnimationFrame(_)}:clearTimeout},yn=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function vs(){var _={"":0},z=[""];return{id:function(F){var se=_[F];return se||(se=_[F]=z.length,z.push(F),se)},str:function(F){return z[F]}}}function of(_,z,F){var se=document.createElement("canvas");t(se.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),_.appendChild(se),_===document.body&&(se.style.position="absolute",t(_.style,{margin:0,padding:0}));function be(){var Te=window.innerWidth,Se=window.innerHeight;if(_!==document.body){var Ne=se.getBoundingClientRect();Te=Ne.right-Ne.left,Se=Ne.bottom-Ne.top}se.width=F*Te,se.height=F*Se}var oe;_!==document.body&&typeof ResizeObserver=="function"?(oe=new ResizeObserver(function(){setTimeout(be)}),oe.observe(_)):window.addEventListener("resize",be,!1);function de(){oe?oe.disconnect():window.removeEventListener("resize",be),_.removeChild(se)}return be(),{canvas:se,onDestroy:de}}function sf(_,z){function F(se){try{return _.getContext(se,z)}catch{return null}}return F("webgl")||F("experimental-webgl")||F("webgl-experimental")}function Xh(_){return typeof _.nodeName=="string"&&typeof _.appendChild=="function"&&typeof _.getBoundingClientRect=="function"}function Kh(_){return typeof _.drawArrays=="function"||typeof _.drawElements=="function"}function uf(_){return typeof _=="string"?_.split():(S(Array.isArray(_),"invalid extension array"),_)}function lf(_){return typeof _=="string"?(S(typeof document<"u","not supported outside of DOM"),document.querySelector(_)):_}function cf(_){var z=_||{},F,se,be,oe,de={},Te=[],Se=[],Ne=typeof window>"u"?1:window.devicePixelRatio,De=!1,Le=function(Be){Be&&S.raise(Be)},je=function(){};if(typeof z=="string"?(S(typeof document<"u","selector queries only supported in DOM environments"),F=document.querySelector(z),S(F,"invalid query string for element")):typeof z=="object"?Xh(z)?F=z:Kh(z)?(oe=z,be=oe.canvas):(S.constructor(z),"gl"in z?oe=z.gl:"canvas"in z?be=lf(z.canvas):"container"in z&&(se=lf(z.container)),"attributes"in z&&(de=z.attributes,S.type(de,"object","invalid context attributes")),"extensions"in z&&(Te=uf(z.extensions)),"optionalExtensions"in z&&(Se=uf(z.optionalExtensions)),"onDone"in z&&(S.type(z.onDone,"function","invalid or missing onDone callback"),Le=z.onDone),"profile"in z&&(De=!!z.profile),"pixelRatio"in z&&(Ne=+z.pixelRatio,S(Ne>0,"invalid pixel ratio"))):S.raise("invalid arguments to regl"),F&&(F.nodeName.toLowerCase()==="canvas"?be=F:se=F),!oe){if(!be){S(typeof document<"u","must manually specify webgl context outside of DOM environments");var Ae=of(se||document.body,Le,Ne);if(!Ae)return null;be=Ae.canvas,je=Ae.onDestroy}de.premultipliedAlpha===void 0&&(de.premultipliedAlpha=!0),oe=sf(be,de)}return oe?{gl:oe,canvas:be,container:se,extensions:Te,optionalExtensions:Se,pixelRatio:Ne,profile:De,onDone:Le,onDestroy:je}:(je(),Le("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function ff(_,z){var F={};function se(de){S.type(de,"string","extension name must be string");var Te=de.toLowerCase(),Se;try{Se=F[Te]=_.getExtension(Te)}catch{}return!!Se}for(var be=0;be<z.extensions.length;++be){var oe=z.extensions[be];if(!se(oe))return z.onDestroy(),z.onDone('"'+oe+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return z.optionalExtensions.forEach(se),{extensions:F,restore:function(){Object.keys(F).forEach(function(de){if(F[de]&&!se(de))throw new Error("(regl): error restoring extension "+de)})}}}function fn(_,z){for(var F=Array(_),se=0;se<_;++se)F[se]=z(se);return F}var df=5120,Ar=5121,pf=5122,hf=5123,mf=5124,Sa=5125,gf=5126;function yf(_){for(var z=16;z<=1<<28;z*=16)if(_<=z)return z;return 0}function Yu(_){var z,F;return z=(_>65535)<<4,_>>>=z,F=(_>255)<<3,_>>>=F,z|=F,F=(_>15)<<2,_>>>=F,z|=F,F=(_>3)<<1,_>>>=F,z|=F,z|_>>1}function Zu(){var _=fn(8,function(){return[]});function z(oe){var de=yf(oe),Te=_[Yu(de)>>2];return Te.length>0?Te.pop():new ArrayBuffer(de)}function F(oe){_[Yu(oe.byteLength)>>2].push(oe)}function se(oe,de){var Te=null;switch(oe){case df:Te=new Int8Array(z(de),0,de);break;case Ar:Te=new Uint8Array(z(de),0,de);break;case pf:Te=new Int16Array(z(2*de),0,de);break;case hf:Te=new Uint16Array(z(2*de),0,de);break;case mf:Te=new Int32Array(z(4*de),0,de);break;case Sa:Te=new Uint32Array(z(4*de),0,de);break;case gf:Te=new Float32Array(z(4*de),0,de);break;default:return null}return Te.length!==de?Te.subarray(0,de):Te}function be(oe){F(oe.buffer)}return{alloc:z,free:F,allocType:se,freeType:be}}var xr=Zu();xr.zero=Zu();var bf=3408,wf=3410,vf=3411,_f=3412,xf=3413,$f=3414,Ef=3415,Ii=33901,Yh=33902,Fn=3379,Qu=3386,Ju=34921,Zh=36347,ai=36348,Sf=35661,Qh=35660,Ci=34930,Jh=36349,el=34076,oi=34024,tl=7936,an=7937,Sn=7938,rl=35724,em=34047,tm=36063,rm=34852,_s=3553,Tf=34067,nm=34069,im=33984,Ta=6408,nl=5126,Af=5121,il=36160,am=36053,om=36064,sm=16384,um=function(_,z){var F=1;z.ext_texture_filter_anisotropic&&(F=_.getParameter(em));var se=1,be=1;z.webgl_draw_buffers&&(se=_.getParameter(rm),be=_.getParameter(tm));var oe=!!z.oes_texture_float;if(oe){var de=_.createTexture();_.bindTexture(_s,de),_.texImage2D(_s,0,Ta,1,1,0,Ta,nl,null);var Te=_.createFramebuffer();if(_.bindFramebuffer(il,Te),_.framebufferTexture2D(il,om,_s,de,0),_.bindTexture(_s,null),_.checkFramebufferStatus(il)!==am)oe=!1;else{_.viewport(0,0,1,1),_.clearColor(1,0,0,1),_.clear(sm);var Se=xr.allocType(nl,4);_.readPixels(0,0,1,1,Ta,nl,Se),_.getError()?oe=!1:(_.deleteFramebuffer(Te),_.deleteTexture(de),oe=Se[0]===1),xr.freeType(Se)}}var Ne=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),De=!0;if(!Ne){var Le=_.createTexture(),je=xr.allocType(Af,36);_.activeTexture(im),_.bindTexture(Tf,Le),_.texImage2D(nm,0,Ta,3,3,0,Ta,Af,je),xr.freeType(je),_.bindTexture(Tf,null),_.deleteTexture(Le),De=!_.getError()}return{colorBits:[_.getParameter(wf),_.getParameter(vf),_.getParameter(_f),_.getParameter(xf)],depthBits:_.getParameter($f),stencilBits:_.getParameter(Ef),subpixelBits:_.getParameter(bf),extensions:Object.keys(z).filter(function(Ae){return!!z[Ae]}),maxAnisotropic:F,maxDrawbuffers:se,maxColorAttachments:be,pointSizeDims:_.getParameter(Ii),lineWidthDims:_.getParameter(Yh),maxViewportDims:_.getParameter(Qu),maxCombinedTextureUnits:_.getParameter(Sf),maxCubeMapSize:_.getParameter(el),maxRenderbufferSize:_.getParameter(oi),maxTextureUnits:_.getParameter(Ci),maxTextureSize:_.getParameter(Fn),maxAttributes:_.getParameter(Ju),maxVertexUniforms:_.getParameter(Zh),maxVertexTextureUnits:_.getParameter(Qh),maxVaryingVectors:_.getParameter(ai),maxFragmentUniforms:_.getParameter(Jh),glsl:_.getParameter(rl),renderer:_.getParameter(an),vendor:_.getParameter(tl),version:_.getParameter(Sn),readFloat:oe,npotTextureCube:De}};function On(_){return!!_&&typeof _=="object"&&Array.isArray(_.shape)&&Array.isArray(_.stride)&&typeof _.offset=="number"&&_.shape.length===_.stride.length&&(Array.isArray(_.data)||e(_.data))}var bn=function(_){return Object.keys(_).map(function(z){return _[z]})},Aa={shape:cm,flatten:lm};function al(_,z,F){for(var se=0;se<z;++se)F[se]=_[se]}function xs(_,z,F,se){for(var be=0,oe=0;oe<z;++oe)for(var de=_[oe],Te=0;Te<F;++Te)se[be++]=de[Te]}function kf(_,z,F,se,be,oe){for(var de=oe,Te=0;Te<z;++Te)for(var Se=_[Te],Ne=0;Ne<F;++Ne)for(var De=Se[Ne],Le=0;Le<se;++Le)be[de++]=De[Le]}function $s(_,z,F,se,be){for(var oe=1,de=F+1;de<z.length;++de)oe*=z[de];var Te=z[F];if(z.length-F===4){var Se=z[F+1],Ne=z[F+2],De=z[F+3];for(de=0;de<Te;++de)kf(_[de],Se,Ne,De,se,be),be+=oe}else for(de=0;de<Te;++de)$s(_[de],z,F+1,se,be),be+=oe}function lm(_,z,F,se){var be=1;if(z.length)for(var oe=0;oe<z.length;++oe)be*=z[oe];else be=0;var de=se||xr.allocType(F,be);switch(z.length){case 0:break;case 1:al(_,z[0],de);break;case 2:xs(_,z[0],z[1],de);break;case 3:kf(_,z[0],z[1],z[2],de,0);break;default:$s(_,z,0,de,0)}return de}function cm(_){for(var z=[],F=_;F.length;F=F[0])z.push(F.length);return z}var ol={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},fm=5120,Es=5122,If=5124,dm=5121,pm=5123,Ss=5125,Oi=5126,Gn=5126,Bi={int8:fm,int16:Es,int32:If,uint8:dm,uint16:pm,uint32:Ss,float:Oi,float32:Gn},Ts=35048,Cf=35040,lo={dynamic:Ts,stream:Cf,static:35044},sl=Aa.flatten,As=Aa.shape,Of=35044,Bf=35040,ul=5121,ka=5126,Ri=[];Ri[5120]=1,Ri[5122]=2,Ri[5124]=4,Ri[5121]=1,Ri[5123]=2,Ri[5125]=4,Ri[5126]=4;function ks(_){return ol[Object.prototype.toString.call(_)]|0}function co(_,z){for(var F=0;F<z.length;++F)_[F]=z[F]}function Rf(_,z,F,se,be,oe,de){for(var Te=0,Se=0;Se<F;++Se)for(var Ne=0;Ne<se;++Ne)_[Te++]=z[be*Se+oe*Ne+de]}function hm(_,z,F,se){var be=0,oe={};function de(Z){this.id=be++,this.buffer=_.createBuffer(),this.type=Z,this.usage=Of,this.byteLength=0,this.dimension=1,this.dtype=ul,this.persistentData=null,F.profile&&(this.stats={size:0})}de.prototype.bind=function(){_.bindBuffer(this.type,this.buffer)},de.prototype.destroy=function(){je(this)};var Te=[];function Se(Z,le){var Oe=Te.pop();return Oe||(Oe=new de(Z)),Oe.bind(),Le(Oe,le,Bf,0,1,!1),Oe}function Ne(Z){Te.push(Z)}function De(Z,le,Oe){Z.byteLength=le.byteLength,_.bufferData(Z.type,le,Oe)}function Le(Z,le,Oe,tt,Ee,Je){var Ye;if(Z.usage=Oe,Array.isArray(le)){if(Z.dtype=tt||ka,le.length>0){var bt;if(Array.isArray(le[0])){Ye=As(le);for(var ve=1,ye=1;ye<Ye.length;++ye)ve*=Ye[ye];Z.dimension=ve,bt=sl(le,Ye,Z.dtype),De(Z,bt,Oe),Je?Z.persistentData=bt:xr.freeType(bt)}else if(typeof le[0]=="number"){Z.dimension=Ee;var st=xr.allocType(Z.dtype,le.length);co(st,le),De(Z,st,Oe),Je?Z.persistentData=st:xr.freeType(st)}else e(le[0])?(Z.dimension=le[0].length,Z.dtype=tt||ks(le[0])||ka,bt=sl(le,[le.length,le[0].length],Z.dtype),De(Z,bt,Oe),Je?Z.persistentData=bt:xr.freeType(bt)):S.raise("invalid buffer data")}}else if(e(le))Z.dtype=tt||ks(le),Z.dimension=Ee,De(Z,le,Oe),Je&&(Z.persistentData=new Uint8Array(new Uint8Array(le.buffer)));else if(On(le)){Ye=le.shape;var Ve=le.stride,Ie=le.offset,Xe=0,Ke=0,Ot=0,At=0;Ye.length===1?(Xe=Ye[0],Ke=1,Ot=Ve[0],At=0):Ye.length===2?(Xe=Ye[0],Ke=Ye[1],Ot=Ve[0],At=Ve[1]):S.raise("invalid shape"),Z.dtype=tt||ks(le.data)||ka,Z.dimension=Ke;var Ze=xr.allocType(Z.dtype,Xe*Ke);Rf(Ze,le.data,Xe,Ke,Ot,At,Ie),De(Z,Ze,Oe),Je?Z.persistentData=Ze:xr.freeType(Ze)}else le instanceof ArrayBuffer?(Z.dtype=ul,Z.dimension=Ee,De(Z,le,Oe),Je&&(Z.persistentData=new Uint8Array(new Uint8Array(le)))):S.raise("invalid buffer data")}function je(Z){z.bufferCount--,se(Z);var le=Z.buffer;S(le,"buffer must not be deleted already"),_.deleteBuffer(le),Z.buffer=null,delete oe[Z.id]}function Ae(Z,le,Oe,tt){z.bufferCount++;var Ee=new de(le);oe[Ee.id]=Ee;function Je(ve){var ye=Of,st=null,Ve=0,Ie=0,Xe=1;return Array.isArray(ve)||e(ve)||On(ve)||ve instanceof ArrayBuffer?st=ve:typeof ve=="number"?Ve=ve|0:ve&&(S.type(ve,"object","buffer arguments must be an object, a number or an array"),"data"in ve&&(S(st===null||Array.isArray(st)||e(st)||On(st),"invalid data for buffer"),st=ve.data),"usage"in ve&&(S.parameter(ve.usage,lo,"invalid buffer usage"),ye=lo[ve.usage]),"type"in ve&&(S.parameter(ve.type,Bi,"invalid buffer type"),Ie=Bi[ve.type]),"dimension"in ve&&(S.type(ve.dimension,"number","invalid dimension"),Xe=ve.dimension|0),"length"in ve&&(S.nni(Ve,"buffer length must be a nonnegative integer"),Ve=ve.length|0)),Ee.bind(),st?Le(Ee,st,ye,Ie,Xe,tt):(Ve&&_.bufferData(Ee.type,Ve,ye),Ee.dtype=Ie||ul,Ee.usage=ye,Ee.dimension=Xe,Ee.byteLength=Ve),F.profile&&(Ee.stats.size=Ee.byteLength*Ri[Ee.dtype]),Je}function Ye(ve,ye){S(ye+ve.byteLength<=Ee.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+ve.byteLength+" starting from offset "+ye+" to a buffer of size "+Ee.byteLength),_.bufferSubData(Ee.type,ye,ve)}function bt(ve,ye){var st=(ye||0)|0,Ve;if(Ee.bind(),e(ve)||ve instanceof ArrayBuffer)Ye(ve,st);else if(Array.isArray(ve)){if(ve.length>0)if(typeof ve[0]=="number"){var Ie=xr.allocType(Ee.dtype,ve.length);co(Ie,ve),Ye(Ie,st),xr.freeType(Ie)}else if(Array.isArray(ve[0])||e(ve[0])){Ve=As(ve);var Xe=sl(ve,Ve,Ee.dtype);Ye(Xe,st),xr.freeType(Xe)}else S.raise("invalid buffer data")}else if(On(ve)){Ve=ve.shape;var Ke=ve.stride,Ot=0,At=0,Ze=0,et=0;Ve.length===1?(Ot=Ve[0],At=1,Ze=Ke[0],et=0):Ve.length===2?(Ot=Ve[0],At=Ve[1],Ze=Ke[0],et=Ke[1]):S.raise("invalid shape");var Et=Array.isArray(ve.data)?Ee.dtype:ks(ve.data),It=xr.allocType(Et,Ot*At);Rf(It,ve.data,Ot,At,Ze,et,ve.offset),Ye(It,st),xr.freeType(It)}else S.raise("invalid data for buffer subdata");return Je}return Oe||Je(Z),Je._reglType="buffer",Je._buffer=Ee,Je.subdata=bt,F.profile&&(Je.stats=Ee.stats),Je.destroy=function(){je(Ee)},Je}function Be(){bn(oe).forEach(function(Z){Z.buffer=_.createBuffer(),_.bindBuffer(Z.type,Z.buffer),_.bufferData(Z.type,Z.persistentData||Z.byteLength,Z.usage)})}return F.profile&&(z.getTotalBufferSize=function(){var Z=0;return Object.keys(oe).forEach(function(le){Z+=oe[le].stats.size}),Z}),{create:Ae,createStream:Se,destroyStream:Ne,clear:function(){bn(oe).forEach(je),Te.forEach(je)},getBuffer:function(Z){return Z&&Z._buffer instanceof de?Z._buffer:null},restore:Be,_initBuffer:Le}}var zf=0,mm=0,gm=1,ym=1,Nf=4,bm=4,zi={points:zf,point:mm,lines:gm,line:ym,triangles:Nf,triangle:bm,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},wm=0,vm=1,fo=4,_m=5120,Ia=5121,Lf=5122,Ca=5123,Df=5124,Qi=5125,ll=34963,Mf=35040,Pf=35044;function Uf(_,z,F,se){var be={},oe=0,de={uint8:Ia,uint16:Ca};z.oes_element_index_uint&&(de.uint32=Qi);function Te(Be){this.id=oe++,be[this.id]=this,this.buffer=Be,this.primType=fo,this.vertCount=0,this.type=0}Te.prototype.bind=function(){this.buffer.bind()};var Se=[];function Ne(Be){var Z=Se.pop();return Z||(Z=new Te(F.create(null,ll,!0,!1)._buffer)),Le(Z,Be,Mf,-1,-1,0,0),Z}function De(Be){Se.push(Be)}function Le(Be,Z,le,Oe,tt,Ee,Je){Be.buffer.bind();var Ye;if(Z){var bt=Je;!Je&&(!e(Z)||On(Z)&&!e(Z.data))&&(bt=z.oes_element_index_uint?Qi:Ca),F._initBuffer(Be.buffer,Z,le,bt,3)}else _.bufferData(ll,Ee,le),Be.buffer.dtype=Ye||Ia,Be.buffer.usage=le,Be.buffer.dimension=3,Be.buffer.byteLength=Ee;if(Ye=Je,!Je){switch(Be.buffer.dtype){case Ia:case _m:Ye=Ia;break;case Ca:case Lf:Ye=Ca;break;case Qi:case Df:Ye=Qi;break;default:S.raise("unsupported type for element array")}Be.buffer.dtype=Ye}Be.type=Ye,S(Ye!==Qi||!!z.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var ve=tt;ve<0&&(ve=Be.buffer.byteLength,Ye===Ca?ve>>=1:Ye===Qi&&(ve>>=2)),Be.vertCount=ve;var ye=Oe;if(Oe<0){ye=fo;var st=Be.buffer.dimension;st===1&&(ye=wm),st===2&&(ye=vm),st===3&&(ye=fo)}Be.primType=ye}function je(Be){se.elementsCount--,S(Be.buffer!==null,"must not double destroy elements"),delete be[Be.id],Be.buffer.destroy(),Be.buffer=null}function Ae(Be,Z){var le=F.create(null,ll,!0),Oe=new Te(le._buffer);se.elementsCount++;function tt(Ee){if(!Ee)le(),Oe.primType=fo,Oe.vertCount=0,Oe.type=Ia;else if(typeof Ee=="number")le(Ee),Oe.primType=fo,Oe.vertCount=Ee|0,Oe.type=Ia;else{var Je=null,Ye=Pf,bt=-1,ve=-1,ye=0,st=0;Array.isArray(Ee)||e(Ee)||On(Ee)?Je=Ee:(S.type(Ee,"object","invalid arguments for elements"),"data"in Ee&&(Je=Ee.data,S(Array.isArray(Je)||e(Je)||On(Je),"invalid data for element buffer")),"usage"in Ee&&(S.parameter(Ee.usage,lo,"invalid element buffer usage"),Ye=lo[Ee.usage]),"primitive"in Ee&&(S.parameter(Ee.primitive,zi,"invalid element buffer primitive"),bt=zi[Ee.primitive]),"count"in Ee&&(S(typeof Ee.count=="number"&&Ee.count>=0,"invalid vertex count for elements"),ve=Ee.count|0),"type"in Ee&&(S.parameter(Ee.type,de,"invalid buffer type"),st=de[Ee.type]),"length"in Ee?ye=Ee.length|0:(ye=ve,st===Ca||st===Lf?ye*=2:(st===Qi||st===Df)&&(ye*=4))),Le(Oe,Je,Ye,bt,ve,ye,st)}return tt}return tt(Be),tt._reglType="elements",tt._elements=Oe,tt.subdata=function(Ee,Je){return le.subdata(Ee,Je),tt},tt.destroy=function(){je(Oe)},tt}return{create:Ae,createStream:Ne,destroyStream:De,getElements:function(Be){return typeof Be=="function"&&Be._elements instanceof Te?Be._elements:null},clear:function(){bn(be).forEach(je)}}}var Ff=new Float32Array(1),xm=new Uint32Array(Ff.buffer),Gf=5123;function cl(_){for(var z=xr.allocType(Gf,_.length),F=0;F<_.length;++F)if(isNaN(_[F]))z[F]=65535;else if(_[F]===1/0)z[F]=31744;else if(_[F]===-1/0)z[F]=64512;else{Ff[0]=_[F];var se=xm[0],be=se>>>31<<15,oe=(se<<1>>>24)-127,de=se>>13&1023;if(oe<-24)z[F]=be;else if(oe<-14){var Te=-14-oe;z[F]=be+(de+1024>>Te)}else oe>15?z[F]=be+31744:z[F]=be+(oe+15<<10)+de}return z}function cr(_){return Array.isArray(_)||e(_)}var jf=function(_){return!(_&_-1)&&!!_},Vf=34467,jn=3553,fl=34067,Is=34069,Ji=6408,po=6406,ho=6407,mo=6409,Cs=6410,Wf=32854,dl=32855,Hf=36194,$m=32819,Em=32820,Sm=33635,Tm=34042,Oa=6402,si=34041,Os=35904,pl=35906,Ba=36193,go=33776,yo=33777,Bs=33778,Rs=33779,hl=35986,ml=35987,gl=34798,yl=35840,qf=35841,bl=35842,wl=35843,bo=36196,vt=5121,vl=5123,zs=5125,Ra=5126,Ns=10242,Vn=10243,Ls=10497,wo=33071,Xf=33648,Kf=10240,Yf=10241,vo=9728,Zf=9729,Ds=9984,_l=9985,_o=9986,xo=9987,xl=33170,$o=4352,Qf=4353,Jf=4354,ed=34046,td=3317,h=37440,v=37441,A=37443,I=37444,L=33984,K=[Ds,_o,_l,xo],_e=[0,mo,Cs,ho,Ji],Ce={};Ce[mo]=Ce[po]=Ce[Oa]=1,Ce[si]=Ce[Cs]=2,Ce[ho]=Ce[Os]=3,Ce[Ji]=Ce[pl]=4;function rt(_){return"[object "+_+"]"}var yt=rt("HTMLCanvasElement"),Pt=rt("OffscreenCanvas"),Zt=rt("CanvasRenderingContext2D"),or=rt("ImageBitmap"),Hr=rt("HTMLImageElement"),ea=rt("HTMLVideoElement"),Am=Object.keys(ol).concat([yt,Pt,Zt,or,Hr,ea]),Ms=[];Ms[vt]=1,Ms[Ra]=4,Ms[Ba]=2,Ms[vl]=2,Ms[zs]=4;var Zr=[];Zr[Wf]=2,Zr[dl]=2,Zr[Hf]=2,Zr[si]=4,Zr[go]=.5,Zr[yo]=.5,Zr[Bs]=1,Zr[Rs]=1,Zr[hl]=.5,Zr[ml]=1,Zr[gl]=1,Zr[yl]=.5,Zr[qf]=.25,Zr[bl]=.5,Zr[wl]=.25,Zr[bo]=.5;function yw(_){return Array.isArray(_)&&(_.length===0||typeof _[0]=="number")}function bw(_){if(!Array.isArray(_))return!1;var z=_.length;return!(z===0||!cr(_[0]))}function Eo(_){return Object.prototype.toString.call(_)}function ww(_){return Eo(_)===yt}function vw(_){return Eo(_)===Pt}function bO(_){return Eo(_)===Zt}function wO(_){return Eo(_)===or}function vO(_){return Eo(_)===Hr}function _O(_){return Eo(_)===ea}function km(_){if(!_)return!1;var z=Eo(_);return Am.indexOf(z)>=0?!0:yw(_)||bw(_)||On(_)}function _w(_){return ol[Object.prototype.toString.call(_)]|0}function xO(_,z){var F=z.length;switch(_.type){case vt:case vl:case zs:case Ra:var se=xr.allocType(_.type,F);se.set(z),_.data=se;break;case Ba:_.data=cl(z);break;default:S.raise("unsupported texture type, must specify a typed array")}}function xw(_,z){return xr.allocType(_.type===Ba?Ra:_.type,z)}function $w(_,z){_.type===Ba?(_.data=cl(z),xr.freeType(z)):_.data=z}function $O(_,z,F,se,be,oe){for(var de=_.width,Te=_.height,Se=_.channels,Ne=de*Te*Se,De=xw(_,Ne),Le=0,je=0;je<Te;++je)for(var Ae=0;Ae<de;++Ae)for(var Be=0;Be<Se;++Be)De[Le++]=z[F*Ae+se*je+be*Be+oe];$w(_,De)}function rd(_,z,F,se,be,oe){var de;if(typeof Zr[_]<"u"?de=Zr[_]:de=Ce[_]*Ms[z],oe&&(de*=6),be){for(var Te=0,Se=F;Se>=1;)Te+=de*Se*Se,Se/=2;return Te}else return de*F*se}function EO(_,z,F,se,be,oe,de){var Te={"don't care":$o,"dont care":$o,nice:Jf,fast:Qf},Se={repeat:Ls,clamp:wo,mirror:Xf},Ne={nearest:vo,linear:Zf},De=t({mipmap:xo,"nearest mipmap nearest":Ds,"linear mipmap nearest":_l,"nearest mipmap linear":_o,"linear mipmap linear":xo},Ne),Le={none:0,browser:I},je={uint8:vt,rgba4:$m,rgb565:Sm,"rgb5 a1":Em},Ae={alpha:po,luminance:mo,"luminance alpha":Cs,rgb:ho,rgba:Ji,rgba4:Wf,"rgb5 a1":dl,rgb565:Hf},Be={};z.ext_srgb&&(Ae.srgb=Os,Ae.srgba=pl),z.oes_texture_float&&(je.float32=je.float=Ra),z.oes_texture_half_float&&(je.float16=je["half float"]=Ba),z.webgl_depth_texture&&(t(Ae,{depth:Oa,"depth stencil":si}),t(je,{uint16:vl,uint32:zs,"depth stencil":Tm})),z.webgl_compressed_texture_s3tc&&t(Be,{"rgb s3tc dxt1":go,"rgba s3tc dxt1":yo,"rgba s3tc dxt3":Bs,"rgba s3tc dxt5":Rs}),z.webgl_compressed_texture_atc&&t(Be,{"rgb atc":hl,"rgba atc explicit alpha":ml,"rgba atc interpolated alpha":gl}),z.webgl_compressed_texture_pvrtc&&t(Be,{"rgb pvrtc 4bppv1":yl,"rgb pvrtc 2bppv1":qf,"rgba pvrtc 4bppv1":bl,"rgba pvrtc 2bppv1":wl}),z.webgl_compressed_texture_etc1&&(Be["rgb etc1"]=bo);var Z=Array.prototype.slice.call(_.getParameter(Vf));Object.keys(Be).forEach(function(U){var ue=Be[U];Z.indexOf(ue)>=0&&(Ae[U]=ue)});var le=Object.keys(Ae);F.textureFormats=le;var Oe=[];Object.keys(Ae).forEach(function(U){var ue=Ae[U];Oe[ue]=U});var tt=[];Object.keys(je).forEach(function(U){var ue=je[U];tt[ue]=U});var Ee=[];Object.keys(Ne).forEach(function(U){var ue=Ne[U];Ee[ue]=U});var Je=[];Object.keys(De).forEach(function(U){var ue=De[U];Je[ue]=U});var Ye=[];Object.keys(Se).forEach(function(U){var ue=Se[U];Ye[ue]=U});var bt=le.reduce(function(U,ue){var re=Ae[ue];return re===mo||re===po||re===mo||re===Cs||re===Oa||re===si||z.ext_srgb&&(re===Os||re===pl)?U[re]=re:re===dl||ue.indexOf("rgba")>=0?U[re]=Ji:U[re]=ho,U},{});function ve(){this.internalformat=Ji,this.format=Ji,this.type=vt,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=I,this.width=0,this.height=0,this.channels=0}function ye(U,ue){U.internalformat=ue.internalformat,U.format=ue.format,U.type=ue.type,U.compressed=ue.compressed,U.premultiplyAlpha=ue.premultiplyAlpha,U.flipY=ue.flipY,U.unpackAlignment=ue.unpackAlignment,U.colorSpace=ue.colorSpace,U.width=ue.width,U.height=ue.height,U.channels=ue.channels}function st(U,ue){if(!(typeof ue!="object"||!ue)){if("premultiplyAlpha"in ue&&(S.type(ue.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),U.premultiplyAlpha=ue.premultiplyAlpha),"flipY"in ue&&(S.type(ue.flipY,"boolean","invalid texture flip"),U.flipY=ue.flipY),"alignment"in ue&&(S.oneOf(ue.alignment,[1,2,4,8],"invalid texture unpack alignment"),U.unpackAlignment=ue.alignment),"colorSpace"in ue&&(S.parameter(ue.colorSpace,Le,"invalid colorSpace"),U.colorSpace=Le[ue.colorSpace]),"type"in ue){var re=ue.type;S(z.oes_texture_float||!(re==="float"||re==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),S(z.oes_texture_half_float||!(re==="half float"||re==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),S(z.webgl_depth_texture||!(re==="uint16"||re==="uint32"||re==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),S.parameter(re,je,"invalid texture type"),U.type=je[re]}var ot=U.width,Gt=U.height,D=U.channels,B=!1;"shape"in ue?(S(Array.isArray(ue.shape)&&ue.shape.length>=2,"shape must be an array"),ot=ue.shape[0],Gt=ue.shape[1],ue.shape.length===3&&(D=ue.shape[2],S(D>0&&D<=4,"invalid number of channels"),B=!0),S(ot>=0&&ot<=F.maxTextureSize,"invalid width"),S(Gt>=0&&Gt<=F.maxTextureSize,"invalid height")):("radius"in ue&&(ot=Gt=ue.radius,S(ot>=0&&ot<=F.maxTextureSize,"invalid radius")),"width"in ue&&(ot=ue.width,S(ot>=0&&ot<=F.maxTextureSize,"invalid width")),"height"in ue&&(Gt=ue.height,S(Gt>=0&&Gt<=F.maxTextureSize,"invalid height")),"channels"in ue&&(D=ue.channels,S(D>0&&D<=4,"invalid number of channels"),B=!0)),U.width=ot|0,U.height=Gt|0,U.channels=D|0;var j=!1;if("format"in ue){var Y=ue.format;S(z.webgl_depth_texture||!(Y==="depth"||Y==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),S.parameter(Y,Ae,"invalid texture format");var Q=U.internalformat=Ae[Y];U.format=bt[Q],Y in je&&("type"in ue||(U.type=je[Y])),Y in Be&&(U.compressed=!0),j=!0}!B&&j?U.channels=Ce[U.format]:B&&!j?U.channels!==_e[U.format]&&(U.format=U.internalformat=_e[U.channels]):j&&B&&S(U.channels===Ce[U.format],"number of channels inconsistent with specified format")}}function Ve(U){_.pixelStorei(h,U.flipY),_.pixelStorei(v,U.premultiplyAlpha),_.pixelStorei(A,U.colorSpace),_.pixelStorei(td,U.unpackAlignment)}function Ie(){ve.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Xe(U,ue){var re=null;if(km(ue)?re=ue:ue&&(S.type(ue,"object","invalid pixel data type"),st(U,ue),"x"in ue&&(U.xOffset=ue.x|0),"y"in ue&&(U.yOffset=ue.y|0),km(ue.data)&&(re=ue.data)),S(!U.compressed||re instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),ue.copy){S(!re,"can not specify copy and data field for the same texture");var ot=be.viewportWidth,Gt=be.viewportHeight;U.width=U.width||ot-U.xOffset,U.height=U.height||Gt-U.yOffset,U.needsCopy=!0,S(U.xOffset>=0&&U.xOffset<ot&&U.yOffset>=0&&U.yOffset<Gt&&U.width>0&&U.width<=ot&&U.height>0&&U.height<=Gt,"copy texture read out of bounds")}else if(!re)U.width=U.width||1,U.height=U.height||1,U.channels=U.channels||4;else if(e(re))U.channels=U.channels||4,U.data=re,!("type"in ue)&&U.type===vt&&(U.type=_w(re));else if(yw(re))U.channels=U.channels||4,xO(U,re),U.alignment=1,U.needsFree=!0;else if(On(re)){var D=re.data;!Array.isArray(D)&&U.type===vt&&(U.type=_w(D));var B=re.shape,j=re.stride,Y,Q,H,V,X,N;B.length===3?(H=B[2],N=j[2]):(S(B.length===2,"invalid ndarray pixel data, must be 2 or 3D"),H=1,N=1),Y=B[0],Q=B[1],V=j[0],X=j[1],U.alignment=1,U.width=Y,U.height=Q,U.channels=H,U.format=U.internalformat=_e[H],U.needsFree=!0,$O(U,D,V,X,N,re.offset)}else if(ww(re)||vw(re)||bO(re))ww(re)||vw(re)?U.element=re:U.element=re.canvas,U.width=U.element.width,U.height=U.element.height,U.channels=4;else if(wO(re))U.element=re,U.width=re.width,U.height=re.height,U.channels=4;else if(vO(re))U.element=re,U.width=re.naturalWidth,U.height=re.naturalHeight,U.channels=4;else if(_O(re))U.element=re,U.width=re.videoWidth,U.height=re.videoHeight,U.channels=4;else if(bw(re)){var G=U.width||re[0].length,M=U.height||re.length,J=U.channels;cr(re[0][0])?J=J||re[0][0].length:J=J||1;for(var ee=Aa.shape(re),xe=1,Ue=0;Ue<ee.length;++Ue)xe*=ee[Ue];var Fe=xw(U,xe);Aa.flatten(re,ee,"",Fe),$w(U,Fe),U.alignment=1,U.width=G,U.height=M,U.channels=J,U.format=U.internalformat=_e[J],U.needsFree=!0}U.type===Ra?S(F.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):U.type===Ba&&S(F.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Ke(U,ue,re){var ot=U.element,Gt=U.data,D=U.internalformat,B=U.format,j=U.type,Y=U.width,Q=U.height;Ve(U),ot?_.texImage2D(ue,re,B,B,j,ot):U.compressed?_.compressedTexImage2D(ue,re,D,Y,Q,0,Gt):U.needsCopy?(se(),_.copyTexImage2D(ue,re,B,U.xOffset,U.yOffset,Y,Q,0)):_.texImage2D(ue,re,B,Y,Q,0,B,j,Gt||null)}function Ot(U,ue,re,ot,Gt){var D=U.element,B=U.data,j=U.internalformat,Y=U.format,Q=U.type,H=U.width,V=U.height;Ve(U),D?_.texSubImage2D(ue,Gt,re,ot,Y,Q,D):U.compressed?_.compressedTexSubImage2D(ue,Gt,re,ot,j,H,V,B):U.needsCopy?(se(),_.copyTexSubImage2D(ue,Gt,re,ot,U.xOffset,U.yOffset,H,V)):_.texSubImage2D(ue,Gt,re,ot,H,V,Y,Q,B)}var At=[];function Ze(){return At.pop()||new Ie}function et(U){U.needsFree&&xr.freeType(U.data),Ie.call(U),At.push(U)}function Et(){ve.call(this),this.genMipmaps=!1,this.mipmapHint=$o,this.mipmask=0,this.images=Array(16)}function It(U,ue,re){var ot=U.images[0]=Ze();U.mipmask=1,ot.width=U.width=ue,ot.height=U.height=re,ot.channels=U.channels=4}function Vt(U,ue){var re=null;if(km(ue))re=U.images[0]=Ze(),ye(re,U),Xe(re,ue),U.mipmask=1;else if(st(U,ue),Array.isArray(ue.mipmap))for(var ot=ue.mipmap,Gt=0;Gt<ot.length;++Gt)re=U.images[Gt]=Ze(),ye(re,U),re.width>>=Gt,re.height>>=Gt,Xe(re,ot[Gt]),U.mipmask|=1<<Gt;else re=U.images[0]=Ze(),ye(re,U),Xe(re,ue),U.mipmask=1;ye(U,U.images[0]),U.compressed&&(U.internalformat===go||U.internalformat===yo||U.internalformat===Bs||U.internalformat===Rs)&&S(U.width%4===0&&U.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function _r(U,ue){for(var re=U.images,ot=0;ot<re.length;++ot){if(!re[ot])return;Ke(re[ot],ue,ot)}}var $r=[];function Ht(){var U=$r.pop()||new Et;ve.call(U),U.mipmask=0;for(var ue=0;ue<16;++ue)U.images[ue]=null;return U}function Pr(U){for(var ue=U.images,re=0;re<ue.length;++re)ue[re]&&et(ue[re]),ue[re]=null;$r.push(U)}function dr(){this.minFilter=vo,this.magFilter=vo,this.wrapS=wo,this.wrapT=wo,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=$o}function zr(U,ue){if("min"in ue){var re=ue.min;S.parameter(re,De),U.minFilter=De[re],K.indexOf(U.minFilter)>=0&&!("faces"in ue)&&(U.genMipmaps=!0)}if("mag"in ue){var ot=ue.mag;S.parameter(ot,Ne),U.magFilter=Ne[ot]}var Gt=U.wrapS,D=U.wrapT;if("wrap"in ue){var B=ue.wrap;typeof B=="string"?(S.parameter(B,Se),Gt=D=Se[B]):Array.isArray(B)&&(S.parameter(B[0],Se),S.parameter(B[1],Se),Gt=Se[B[0]],D=Se[B[1]])}else{if("wrapS"in ue){var j=ue.wrapS;S.parameter(j,Se),Gt=Se[j]}if("wrapT"in ue){var Y=ue.wrapT;S.parameter(Y,Se),D=Se[Y]}}if(U.wrapS=Gt,U.wrapT=D,"anisotropic"in ue){var Q=ue.anisotropic;S(typeof Q=="number"&&Q>=1&&Q<=F.maxAnisotropic,"aniso samples must be between 1 and "),U.anisotropic=ue.anisotropic}if("mipmap"in ue){var H=!1;switch(typeof ue.mipmap){case"string":S.parameter(ue.mipmap,Te,"invalid mipmap hint"),U.mipmapHint=Te[ue.mipmap],U.genMipmaps=!0,H=!0;break;case"boolean":H=U.genMipmaps=ue.mipmap;break;case"object":S(Array.isArray(ue.mipmap),"invalid mipmap type"),U.genMipmaps=!1,H=!0;break;default:S.raise("invalid mipmap type")}H&&!("min"in ue)&&(U.minFilter=Ds)}}function Ur(U,ue){_.texParameteri(ue,Yf,U.minFilter),_.texParameteri(ue,Kf,U.magFilter),_.texParameteri(ue,Ns,U.wrapS),_.texParameteri(ue,Vn,U.wrapT),z.ext_texture_filter_anisotropic&&_.texParameteri(ue,ed,U.anisotropic),U.genMipmaps&&(_.hint(xl,U.mipmapHint),_.generateMipmap(ue))}var Fr=0,Xr={},Qr=F.maxTextureUnits,kr=Array(Qr).map(function(){return null});function zt(U){ve.call(this),this.mipmask=0,this.internalformat=Ji,this.id=Fr++,this.refCount=1,this.target=U,this.texture=_.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new dr,de.profile&&(this.stats={size:0})}function Jr(U){_.activeTexture(L),_.bindTexture(U.target,U.texture)}function Jt(){var U=kr[0];U?_.bindTexture(U.target,U.texture):_.bindTexture(jn,null)}function xt(U){var ue=U.texture;S(ue,"must not double destroy texture");var re=U.unit,ot=U.target;re>=0&&(_.activeTexture(L+re),_.bindTexture(ot,null),kr[re]=null),_.deleteTexture(ue),U.texture=null,U.params=null,U.pixels=null,U.refCount=0,delete Xr[U.id],oe.textureCount--}t(zt.prototype,{bind:function(){var U=this;U.bindCount+=1;var ue=U.unit;if(ue<0){for(var re=0;re<Qr;++re){var ot=kr[re];if(ot){if(ot.bindCount>0)continue;ot.unit=-1}kr[re]=U,ue=re;break}ue>=Qr&&S.raise("insufficient number of texture units"),de.profile&&oe.maxTextureUnits<ue+1&&(oe.maxTextureUnits=ue+1),U.unit=ue,_.activeTexture(L+ue),_.bindTexture(U.target,U.texture)}return ue},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&xt(this)}});function Wt(U,ue){var re=new zt(jn);Xr[re.id]=re,oe.textureCount++;function ot(B,j){var Y=re.texInfo;dr.call(Y);var Q=Ht();return typeof B=="number"?typeof j=="number"?It(Q,B|0,j|0):It(Q,B|0,B|0):B?(S.type(B,"object","invalid arguments to regl.texture"),zr(Y,B),Vt(Q,B)):It(Q,1,1),Y.genMipmaps&&(Q.mipmask=(Q.width<<1)-1),re.mipmask=Q.mipmask,ye(re,Q),S.texture2D(Y,Q,F),re.internalformat=Q.internalformat,ot.width=Q.width,ot.height=Q.height,Jr(re),_r(Q,jn),Ur(Y,jn),Jt(),Pr(Q),de.profile&&(re.stats.size=rd(re.internalformat,re.type,Q.width,Q.height,Y.genMipmaps,!1)),ot.format=Oe[re.internalformat],ot.type=tt[re.type],ot.mag=Ee[Y.magFilter],ot.min=Je[Y.minFilter],ot.wrapS=Ye[Y.wrapS],ot.wrapT=Ye[Y.wrapT],ot}function Gt(B,j,Y,Q){S(!!B,"must specify image data");var H=j|0,V=Y|0,X=Q|0,N=Ze();return ye(N,re),N.width=0,N.height=0,Xe(N,B),N.width=N.width||(re.width>>X)-H,N.height=N.height||(re.height>>X)-V,S(re.type===N.type&&re.format===N.format&&re.internalformat===N.internalformat,"incompatible format for texture.subimage"),S(H>=0&&V>=0&&H+N.width<=re.width&&V+N.height<=re.height,"texture.subimage write out of bounds"),S(re.mipmask&1<<X,"missing mipmap data"),S(N.data||N.element||N.needsCopy,"missing image data"),Jr(re),Ot(N,jn,H,V,X),Jt(),et(N),ot}function D(B,j){var Y=B|0,Q=j|0||Y;if(Y===re.width&&Q===re.height)return ot;ot.width=re.width=Y,ot.height=re.height=Q,Jr(re);for(var H=0;re.mipmask>>H;++H){var V=Y>>H,X=Q>>H;if(!V||!X)break;_.texImage2D(jn,H,re.format,V,X,0,re.format,re.type,null)}return Jt(),de.profile&&(re.stats.size=rd(re.internalformat,re.type,Y,Q,!1,!1)),ot}return ot(U,ue),ot.subimage=Gt,ot.resize=D,ot._reglType="texture2d",ot._texture=re,de.profile&&(ot.stats=re.stats),ot.destroy=function(){re.decRef()},ot}function Yt(U,ue,re,ot,Gt,D){var B=new zt(fl);Xr[B.id]=B,oe.cubeCount++;var j=new Array(6);function Y(V,X,N,G,M,J){var ee,xe=B.texInfo;for(dr.call(xe),ee=0;ee<6;++ee)j[ee]=Ht();if(typeof V=="number"||!V){var Ue=V|0||1;for(ee=0;ee<6;++ee)It(j[ee],Ue,Ue)}else if(typeof V=="object")if(X)Vt(j[0],V),Vt(j[1],X),Vt(j[2],N),Vt(j[3],G),Vt(j[4],M),Vt(j[5],J);else if(zr(xe,V),st(B,V),"faces"in V){var Fe=V.faces;for(S(Array.isArray(Fe)&&Fe.length===6,"cube faces must be a length 6 array"),ee=0;ee<6;++ee)S(typeof Fe[ee]=="object"&&!!Fe[ee],"invalid input for cube map face"),ye(j[ee],B),Vt(j[ee],Fe[ee])}else for(ee=0;ee<6;++ee)Vt(j[ee],V);else S.raise("invalid arguments to cube map");for(ye(B,j[0]),S.optional(function(){F.npotTextureCube||S(jf(B.width)&&jf(B.height),"your browser does not support non power or two texture dimensions")}),xe.genMipmaps?B.mipmask=(j[0].width<<1)-1:B.mipmask=j[0].mipmask,S.textureCube(B,xe,j,F),B.internalformat=j[0].internalformat,Y.width=j[0].width,Y.height=j[0].height,Jr(B),ee=0;ee<6;++ee)_r(j[ee],Is+ee);for(Ur(xe,fl),Jt(),de.profile&&(B.stats.size=rd(B.internalformat,B.type,Y.width,Y.height,xe.genMipmaps,!0)),Y.format=Oe[B.internalformat],Y.type=tt[B.type],Y.mag=Ee[xe.magFilter],Y.min=Je[xe.minFilter],Y.wrapS=Ye[xe.wrapS],Y.wrapT=Ye[xe.wrapT],ee=0;ee<6;++ee)Pr(j[ee]);return Y}function Q(V,X,N,G,M){S(!!X,"must specify image data"),S(typeof V=="number"&&V===(V|0)&&V>=0&&V<6,"invalid face");var J=N|0,ee=G|0,xe=M|0,Ue=Ze();return ye(Ue,B),Ue.width=0,Ue.height=0,Xe(Ue,X),Ue.width=Ue.width||(B.width>>xe)-J,Ue.height=Ue.height||(B.height>>xe)-ee,S(B.type===Ue.type&&B.format===Ue.format&&B.internalformat===Ue.internalformat,"incompatible format for texture.subimage"),S(J>=0&&ee>=0&&J+Ue.width<=B.width&&ee+Ue.height<=B.height,"texture.subimage write out of bounds"),S(B.mipmask&1<<xe,"missing mipmap data"),S(Ue.data||Ue.element||Ue.needsCopy,"missing image data"),Jr(B),Ot(Ue,Is+V,J,ee,xe),Jt(),et(Ue),Y}function H(V){var X=V|0;if(X!==B.width){Y.width=B.width=X,Y.height=B.height=X,Jr(B);for(var N=0;N<6;++N)for(var G=0;B.mipmask>>G;++G)_.texImage2D(Is+N,G,B.format,X>>G,X>>G,0,B.format,B.type,null);return Jt(),de.profile&&(B.stats.size=rd(B.internalformat,B.type,Y.width,Y.height,!1,!0)),Y}}return Y(U,ue,re,ot,Gt,D),Y.subimage=Q,Y.resize=H,Y._reglType="textureCube",Y._texture=B,de.profile&&(Y.stats=B.stats),Y.destroy=function(){B.decRef()},Y}function Ir(){for(var U=0;U<Qr;++U)_.activeTexture(L+U),_.bindTexture(jn,null),kr[U]=null;bn(Xr).forEach(xt),oe.cubeCount=0,oe.textureCount=0}de.profile&&(oe.getTotalTextureSize=function(){var U=0;return Object.keys(Xr).forEach(function(ue){U+=Xr[ue].stats.size}),U});function Li(){for(var U=0;U<Qr;++U){var ue=kr[U];ue&&(ue.bindCount=0,ue.unit=-1,kr[U]=null)}bn(Xr).forEach(function(re){re.texture=_.createTexture(),_.bindTexture(re.target,re.texture);for(var ot=0;ot<32;++ot)if((re.mipmask&1<<ot)!==0)if(re.target===jn)_.texImage2D(jn,ot,re.internalformat,re.width>>ot,re.height>>ot,0,re.internalformat,re.type,null);else for(var Gt=0;Gt<6;++Gt)_.texImage2D(Is+Gt,ot,re.internalformat,re.width>>ot,re.height>>ot,0,re.internalformat,re.type,null);Ur(re.texInfo,re.target)})}function Oo(){for(var U=0;U<Qr;++U){var ue=kr[U];ue&&(ue.bindCount=0,ue.unit=-1,kr[U]=null),_.activeTexture(L+U),_.bindTexture(jn,null),_.bindTexture(fl,null)}}return{create2D:Wt,createCube:Yt,clear:Ir,getTexture:function(U){return null},restore:Li,refresh:Oo}}var za=36161,nd=32854,Ew=32855,Sw=36194,Tw=33189,Aw=36168,kw=34041,Iw=35907,Cw=34836,Ow=34842,Bw=34843,ui=[];ui[nd]=2,ui[Ew]=2,ui[Sw]=2,ui[Tw]=2,ui[Aw]=1,ui[kw]=4,ui[Iw]=4,ui[Cw]=16,ui[Ow]=8,ui[Bw]=6;function Rw(_,z,F){return ui[_]*z*F}var SO=function(_,z,F,se,be){var oe={rgba4:nd,rgb565:Sw,"rgb5 a1":Ew,depth:Tw,stencil:Aw,"depth stencil":kw};z.ext_srgb&&(oe.srgba=Iw),z.ext_color_buffer_half_float&&(oe.rgba16f=Ow,oe.rgb16f=Bw),z.webgl_color_buffer_float&&(oe.rgba32f=Cw);var de=[];Object.keys(oe).forEach(function(Ae){var Be=oe[Ae];de[Be]=Ae});var Te=0,Se={};function Ne(Ae){this.id=Te++,this.refCount=1,this.renderbuffer=Ae,this.format=nd,this.width=0,this.height=0,be.profile&&(this.stats={size:0})}Ne.prototype.decRef=function(){--this.refCount<=0&&De(this)};function De(Ae){var Be=Ae.renderbuffer;S(Be,"must not double destroy renderbuffer"),_.bindRenderbuffer(za,null),_.deleteRenderbuffer(Be),Ae.renderbuffer=null,Ae.refCount=0,delete Se[Ae.id],se.renderbufferCount--}function Le(Ae,Be){var Z=new Ne(_.createRenderbuffer());Se[Z.id]=Z,se.renderbufferCount++;function le(tt,Ee){var Je=0,Ye=0,bt=nd;if(typeof tt=="object"&&tt){var ve=tt;if("shape"in ve){var ye=ve.shape;S(Array.isArray(ye)&&ye.length>=2,"invalid renderbuffer shape"),Je=ye[0]|0,Ye=ye[1]|0}else"radius"in ve&&(Je=Ye=ve.radius|0),"width"in ve&&(Je=ve.width|0),"height"in ve&&(Ye=ve.height|0);"format"in ve&&(S.parameter(ve.format,oe,"invalid renderbuffer format"),bt=oe[ve.format])}else typeof tt=="number"?(Je=tt|0,typeof Ee=="number"?Ye=Ee|0:Ye=Je):tt?S.raise("invalid arguments to renderbuffer constructor"):Je=Ye=1;if(S(Je>0&&Ye>0&&Je<=F.maxRenderbufferSize&&Ye<=F.maxRenderbufferSize,"invalid renderbuffer size"),!(Je===Z.width&&Ye===Z.height&&bt===Z.format))return le.width=Z.width=Je,le.height=Z.height=Ye,Z.format=bt,_.bindRenderbuffer(za,Z.renderbuffer),_.renderbufferStorage(za,bt,Je,Ye),S(_.getError()===0,"invalid render buffer format"),be.profile&&(Z.stats.size=Rw(Z.format,Z.width,Z.height)),le.format=de[Z.format],le}function Oe(tt,Ee){var Je=tt|0,Ye=Ee|0||Je;return Je===Z.width&&Ye===Z.height||(S(Je>0&&Ye>0&&Je<=F.maxRenderbufferSize&&Ye<=F.maxRenderbufferSize,"invalid renderbuffer size"),le.width=Z.width=Je,le.height=Z.height=Ye,_.bindRenderbuffer(za,Z.renderbuffer),_.renderbufferStorage(za,Z.format,Je,Ye),S(_.getError()===0,"invalid render buffer format"),be.profile&&(Z.stats.size=Rw(Z.format,Z.width,Z.height))),le}return le(Ae,Be),le.resize=Oe,le._reglType="renderbuffer",le._renderbuffer=Z,be.profile&&(le.stats=Z.stats),le.destroy=function(){Z.decRef()},le}be.profile&&(se.getTotalRenderbufferSize=function(){var Ae=0;return Object.keys(Se).forEach(function(Be){Ae+=Se[Be].stats.size}),Ae});function je(){bn(Se).forEach(function(Ae){Ae.renderbuffer=_.createRenderbuffer(),_.bindRenderbuffer(za,Ae.renderbuffer),_.renderbufferStorage(za,Ae.format,Ae.width,Ae.height)}),_.bindRenderbuffer(za,null)}return{create:Le,clear:function(){bn(Se).forEach(De)},restore:je}},ta=36160,Im=36161,So=3553,id=34069,zw=36064,Nw=36096,Lw=36128,Dw=33306,Mw=36053,TO=36054,AO=36055,kO=36057,IO=36061,CO=36193,OO=5121,BO=5126,Pw=6407,Uw=6408,RO=6402,zO=[Pw,Uw],Cm=[];Cm[Uw]=4,Cm[Pw]=3;var ad=[];ad[OO]=1,ad[BO]=4,ad[CO]=2;var NO=32854,LO=32855,DO=36194,MO=33189,PO=36168,Fw=34041,UO=35907,FO=34836,GO=34842,jO=34843,VO=[NO,LO,DO,UO,GO,jO,FO],Ps={};Ps[Mw]="complete",Ps[TO]="incomplete attachment",Ps[kO]="incomplete dimensions",Ps[AO]="incomplete, missing attachment",Ps[IO]="unsupported";function WO(_,z,F,se,be,oe){var de={cur:null,next:null,dirty:!1,setFBO:null},Te=["rgba"],Se=["rgba4","rgb565","rgb5 a1"];z.ext_srgb&&Se.push("srgba"),z.ext_color_buffer_half_float&&Se.push("rgba16f","rgb16f"),z.webgl_color_buffer_float&&Se.push("rgba32f");var Ne=["uint8"];z.oes_texture_half_float&&Ne.push("half float","float16"),z.oes_texture_float&&Ne.push("float","float32");function De(Ie,Xe,Ke){this.target=Ie,this.texture=Xe,this.renderbuffer=Ke;var Ot=0,At=0;Xe?(Ot=Xe.width,At=Xe.height):Ke&&(Ot=Ke.width,At=Ke.height),this.width=Ot,this.height=At}function Le(Ie){Ie&&(Ie.texture&&Ie.texture._texture.decRef(),Ie.renderbuffer&&Ie.renderbuffer._renderbuffer.decRef())}function je(Ie,Xe,Ke){if(Ie)if(Ie.texture){var Ot=Ie.texture._texture,At=Math.max(1,Ot.width),Ze=Math.max(1,Ot.height);S(At===Xe&&Ze===Ke,"inconsistent width/height for supplied texture"),Ot.refCount+=1}else{var et=Ie.renderbuffer._renderbuffer;S(et.width===Xe&&et.height===Ke,"inconsistent width/height for renderbuffer"),et.refCount+=1}}function Ae(Ie,Xe){Xe&&(Xe.texture?_.framebufferTexture2D(ta,Ie,Xe.target,Xe.texture._texture.texture,0):_.framebufferRenderbuffer(ta,Ie,Im,Xe.renderbuffer._renderbuffer.renderbuffer))}function Be(Ie){var Xe=So,Ke=null,Ot=null,At=Ie;typeof Ie=="object"&&(At=Ie.data,"target"in Ie&&(Xe=Ie.target|0)),S.type(At,"function","invalid attachment data");var Ze=At._reglType;return Ze==="texture2d"?(Ke=At,S(Xe===So)):Ze==="textureCube"?(Ke=At,S(Xe>=id&&Xe<id+6,"invalid cube map target")):Ze==="renderbuffer"?(Ot=At,Xe=Im):S.raise("invalid regl object for attachment"),new De(Xe,Ke,Ot)}function Z(Ie,Xe,Ke,Ot,At){if(Ke){var Ze=se.create2D({width:Ie,height:Xe,format:Ot,type:At});return Ze._texture.refCount=0,new De(So,Ze,null)}else{var et=be.create({width:Ie,height:Xe,format:Ot});return et._renderbuffer.refCount=0,new De(Im,null,et)}}function le(Ie){return Ie&&(Ie.texture||Ie.renderbuffer)}function Oe(Ie,Xe,Ke){Ie&&(Ie.texture?Ie.texture.resize(Xe,Ke):Ie.renderbuffer&&Ie.renderbuffer.resize(Xe,Ke),Ie.width=Xe,Ie.height=Ke)}var tt=0,Ee={};function Je(){this.id=tt++,Ee[this.id]=this,this.framebuffer=_.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Ye(Ie){Ie.colorAttachments.forEach(Le),Le(Ie.depthAttachment),Le(Ie.stencilAttachment),Le(Ie.depthStencilAttachment)}function bt(Ie){var Xe=Ie.framebuffer;S(Xe,"must not double destroy framebuffer"),_.deleteFramebuffer(Xe),Ie.framebuffer=null,oe.framebufferCount--,delete Ee[Ie.id]}function ve(Ie){var Xe;_.bindFramebuffer(ta,Ie.framebuffer);var Ke=Ie.colorAttachments;for(Xe=0;Xe<Ke.length;++Xe)Ae(zw+Xe,Ke[Xe]);for(Xe=Ke.length;Xe<F.maxColorAttachments;++Xe)_.framebufferTexture2D(ta,zw+Xe,So,null,0);_.framebufferTexture2D(ta,Dw,So,null,0),_.framebufferTexture2D(ta,Nw,So,null,0),_.framebufferTexture2D(ta,Lw,So,null,0),Ae(Nw,Ie.depthAttachment),Ae(Lw,Ie.stencilAttachment),Ae(Dw,Ie.depthStencilAttachment);var Ot=_.checkFramebufferStatus(ta);!_.isContextLost()&&Ot!==Mw&&S.raise("framebuffer configuration not supported, status = "+Ps[Ot]),_.bindFramebuffer(ta,de.next?de.next.framebuffer:null),de.cur=de.next,_.getError()}function ye(Ie,Xe){var Ke=new Je;oe.framebufferCount++;function Ot(Ze,et){var Et;S(de.next!==Ke,"can not update framebuffer which is currently in use");var It=0,Vt=0,_r=!0,$r=!0,Ht=null,Pr=!0,dr="rgba",zr="uint8",Ur=1,Fr=null,Xr=null,Qr=null,kr=!1;if(typeof Ze=="number")It=Ze|0,Vt=et|0||It;else if(!Ze)It=Vt=1;else{S.type(Ze,"object","invalid arguments for framebuffer");var zt=Ze;if("shape"in zt){var Jr=zt.shape;S(Array.isArray(Jr)&&Jr.length>=2,"invalid shape for framebuffer"),It=Jr[0],Vt=Jr[1]}else"radius"in zt&&(It=Vt=zt.radius),"width"in zt&&(It=zt.width),"height"in zt&&(Vt=zt.height);("color"in zt||"colors"in zt)&&(Ht=zt.color||zt.colors,Array.isArray(Ht)&&S(Ht.length===1||z.webgl_draw_buffers,"multiple render targets not supported")),Ht||("colorCount"in zt&&(Ur=zt.colorCount|0,S(Ur>0,"invalid color buffer count")),"colorTexture"in zt&&(Pr=!!zt.colorTexture,dr="rgba4"),"colorType"in zt&&(zr=zt.colorType,Pr?(S(z.oes_texture_float||!(zr==="float"||zr==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),S(z.oes_texture_half_float||!(zr==="half float"||zr==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):zr==="half float"||zr==="float16"?(S(z.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),dr="rgba16f"):(zr==="float"||zr==="float32")&&(S(z.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),dr="rgba32f"),S.oneOf(zr,Ne,"invalid color type")),"colorFormat"in zt&&(dr=zt.colorFormat,Te.indexOf(dr)>=0?Pr=!0:Se.indexOf(dr)>=0?Pr=!1:S.optional(function(){Pr?S.oneOf(zt.colorFormat,Te,"invalid color format for texture"):S.oneOf(zt.colorFormat,Se,"invalid color format for renderbuffer")}))),("depthTexture"in zt||"depthStencilTexture"in zt)&&(kr=!!(zt.depthTexture||zt.depthStencilTexture),S(!kr||z.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in zt&&(typeof zt.depth=="boolean"?_r=zt.depth:(Fr=zt.depth,$r=!1)),"stencil"in zt&&(typeof zt.stencil=="boolean"?$r=zt.stencil:(Xr=zt.stencil,_r=!1)),"depthStencil"in zt&&(typeof zt.depthStencil=="boolean"?_r=$r=zt.depthStencil:(Qr=zt.depthStencil,_r=!1,$r=!1))}var Jt=null,xt=null,Wt=null,Yt=null;if(Array.isArray(Ht))Jt=Ht.map(Be);else if(Ht)Jt=[Be(Ht)];else for(Jt=new Array(Ur),Et=0;Et<Ur;++Et)Jt[Et]=Z(It,Vt,Pr,dr,zr);S(z.webgl_draw_buffers||Jt.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),S(Jt.length<=F.maxColorAttachments,"too many color attachments, not supported"),It=It||Jt[0].width,Vt=Vt||Jt[0].height,Fr?xt=Be(Fr):_r&&!$r&&(xt=Z(It,Vt,kr,"depth","uint32")),Xr?Wt=Be(Xr):$r&&!_r&&(Wt=Z(It,Vt,!1,"stencil","uint8")),Qr?Yt=Be(Qr):!Fr&&!Xr&&$r&&_r&&(Yt=Z(It,Vt,kr,"depth stencil","depth stencil")),S(!!Fr+!!Xr+!!Qr<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Ir=null;for(Et=0;Et<Jt.length;++Et)if(je(Jt[Et],It,Vt),S(!Jt[Et]||Jt[Et].texture&&zO.indexOf(Jt[Et].texture._texture.format)>=0||Jt[Et].renderbuffer&&VO.indexOf(Jt[Et].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Et+" is invalid"),Jt[Et]&&Jt[Et].texture){var Li=Cm[Jt[Et].texture._texture.format]*ad[Jt[Et].texture._texture.type];Ir===null?Ir=Li:S(Ir===Li,"all color attachments much have the same number of bits per pixel.")}return je(xt,It,Vt),S(!xt||xt.texture&&xt.texture._texture.format===RO||xt.renderbuffer&&xt.renderbuffer._renderbuffer.format===MO,"invalid depth attachment for framebuffer object"),je(Wt,It,Vt),S(!Wt||Wt.renderbuffer&&Wt.renderbuffer._renderbuffer.format===PO,"invalid stencil attachment for framebuffer object"),je(Yt,It,Vt),S(!Yt||Yt.texture&&Yt.texture._texture.format===Fw||Yt.renderbuffer&&Yt.renderbuffer._renderbuffer.format===Fw,"invalid depth-stencil attachment for framebuffer object"),Ye(Ke),Ke.width=It,Ke.height=Vt,Ke.colorAttachments=Jt,Ke.depthAttachment=xt,Ke.stencilAttachment=Wt,Ke.depthStencilAttachment=Yt,Ot.color=Jt.map(le),Ot.depth=le(xt),Ot.stencil=le(Wt),Ot.depthStencil=le(Yt),Ot.width=Ke.width,Ot.height=Ke.height,ve(Ke),Ot}function At(Ze,et){S(de.next!==Ke,"can not resize a framebuffer which is currently in use");var Et=Math.max(Ze|0,1),It=Math.max(et|0||Et,1);if(Et===Ke.width&&It===Ke.height)return Ot;for(var Vt=Ke.colorAttachments,_r=0;_r<Vt.length;++_r)Oe(Vt[_r],Et,It);return Oe(Ke.depthAttachment,Et,It),Oe(Ke.stencilAttachment,Et,It),Oe(Ke.depthStencilAttachment,Et,It),Ke.width=Ot.width=Et,Ke.height=Ot.height=It,ve(Ke),Ot}return Ot(Ie,Xe),t(Ot,{resize:At,_reglType:"framebuffer",_framebuffer:Ke,destroy:function(){bt(Ke),Ye(Ke)},use:function(Ze){de.setFBO({framebuffer:Ot},Ze)}})}function st(Ie){var Xe=Array(6);function Ke(At){var Ze;S(Xe.indexOf(de.next)<0,"can not update framebuffer which is currently in use");var et={color:null},Et=0,It=null,Vt="rgba",_r="uint8",$r=1;if(typeof At=="number")Et=At|0;else if(!At)Et=1;else{S.type(At,"object","invalid arguments for framebuffer");var Ht=At;if("shape"in Ht){var Pr=Ht.shape;S(Array.isArray(Pr)&&Pr.length>=2,"invalid shape for framebuffer"),S(Pr[0]===Pr[1],"cube framebuffer must be square"),Et=Pr[0]}else"radius"in Ht&&(Et=Ht.radius|0),"width"in Ht?(Et=Ht.width|0,"height"in Ht&&S(Ht.height===Et,"must be square")):"height"in Ht&&(Et=Ht.height|0);("color"in Ht||"colors"in Ht)&&(It=Ht.color||Ht.colors,Array.isArray(It)&&S(It.length===1||z.webgl_draw_buffers,"multiple render targets not supported")),It||("colorCount"in Ht&&($r=Ht.colorCount|0,S($r>0,"invalid color buffer count")),"colorType"in Ht&&(S.oneOf(Ht.colorType,Ne,"invalid color type"),_r=Ht.colorType),"colorFormat"in Ht&&(Vt=Ht.colorFormat,S.oneOf(Ht.colorFormat,Te,"invalid color format for texture"))),"depth"in Ht&&(et.depth=Ht.depth),"stencil"in Ht&&(et.stencil=Ht.stencil),"depthStencil"in Ht&&(et.depthStencil=Ht.depthStencil)}var dr;if(It)if(Array.isArray(It))for(dr=[],Ze=0;Ze<It.length;++Ze)dr[Ze]=It[Ze];else dr=[It];else{dr=Array($r);var zr={radius:Et,format:Vt,type:_r};for(Ze=0;Ze<$r;++Ze)dr[Ze]=se.createCube(zr)}for(et.color=Array(dr.length),Ze=0;Ze<dr.length;++Ze){var Ur=dr[Ze];S(typeof Ur=="function"&&Ur._reglType==="textureCube","invalid cube map"),Et=Et||Ur.width,S(Ur.width===Et&&Ur.height===Et,"invalid cube map shape"),et.color[Ze]={target:id,data:dr[Ze]}}for(Ze=0;Ze<6;++Ze){for(var Fr=0;Fr<dr.length;++Fr)et.color[Fr].target=id+Ze;Ze>0&&(et.depth=Xe[0].depth,et.stencil=Xe[0].stencil,et.depthStencil=Xe[0].depthStencil),Xe[Ze]?Xe[Ze](et):Xe[Ze]=ye(et)}return t(Ke,{width:Et,height:Et,color:dr})}function Ot(At){var Ze,et=At|0;if(S(et>0&&et<=F.maxCubeMapSize,"invalid radius for cube fbo"),et===Ke.width)return Ke;var Et=Ke.color;for(Ze=0;Ze<Et.length;++Ze)Et[Ze].resize(et);for(Ze=0;Ze<6;++Ze)Xe[Ze].resize(et);return Ke.width=Ke.height=et,Ke}return Ke(Ie),t(Ke,{faces:Xe,resize:Ot,_reglType:"framebufferCube",destroy:function(){Xe.forEach(function(At){At.destroy()})}})}function Ve(){de.cur=null,de.next=null,de.dirty=!0,bn(Ee).forEach(function(Ie){Ie.framebuffer=_.createFramebuffer(),ve(Ie)})}return t(de,{getFramebuffer:function(Ie){if(typeof Ie=="function"&&Ie._reglType==="framebuffer"){var Xe=Ie._framebuffer;if(Xe instanceof Je)return Xe}return null},create:ye,createCube:st,clear:function(){bn(Ee).forEach(bt)},restore:Ve})}var HO=5126,Gw=34962,od=34963,jw=["attributes","elements","offset","count","primitive","instances"];function Om(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=HO,this.offset=0,this.stride=0,this.divisor=0}function qO(_,z,F,se,be,oe,de){for(var Te=F.maxAttributes,Se=new Array(Te),Ne=0;Ne<Te;++Ne)Se[Ne]=new Om;var De=0,Le={},je={Record:Om,scope:{},state:Se,currentVAO:null,targetVAO:null,restore:Be()?Ye:function(){},createVAO:bt,getVAO:le,destroyBuffer:Ae,setVAO:Be()?Oe:tt,clear:Be()?Ee:function(){}};function Ae(ve){for(var ye=0;ye<Se.length;++ye){var st=Se[ye];st.buffer===ve&&(_.disableVertexAttribArray(ye),st.buffer=null)}}function Be(){return z.oes_vertex_array_object}function Z(){return z.angle_instanced_arrays}function le(ve){return typeof ve=="function"&&ve._vao?ve._vao:null}function Oe(ve){if(ve!==je.currentVAO){var ye=Be();ve?ye.bindVertexArrayOES(ve.vao):ye.bindVertexArrayOES(null),je.currentVAO=ve}}function tt(ve){if(ve!==je.currentVAO){if(ve)ve.bindAttrs();else{for(var ye=Z(),st=0;st<Se.length;++st){var Ve=Se[st];Ve.buffer?(_.enableVertexAttribArray(st),Ve.buffer.bind(),_.vertexAttribPointer(st,Ve.size,Ve.type,Ve.normalized,Ve.stride,Ve.offfset),ye&&Ve.divisor&&ye.vertexAttribDivisorANGLE(st,Ve.divisor)):(_.disableVertexAttribArray(st),_.vertexAttrib4f(st,Ve.x,Ve.y,Ve.z,Ve.w))}de.elements?_.bindBuffer(od,de.elements.buffer.buffer):_.bindBuffer(od,null)}je.currentVAO=ve}}function Ee(){bn(Le).forEach(function(ve){ve.destroy()})}function Je(){this.id=++De,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var ve=Be();ve?this.vao=ve.createVertexArrayOES():this.vao=null,Le[this.id]=this,this.buffers=[]}Je.prototype.bindAttrs=function(){for(var ve=Z(),ye=this.attributes,st=0;st<ye.length;++st){var Ve=ye[st];Ve.buffer?(_.enableVertexAttribArray(st),_.bindBuffer(Gw,Ve.buffer.buffer),_.vertexAttribPointer(st,Ve.size,Ve.type,Ve.normalized,Ve.stride,Ve.offset),ve&&Ve.divisor&&ve.vertexAttribDivisorANGLE(st,Ve.divisor)):(_.disableVertexAttribArray(st),_.vertexAttrib4f(st,Ve.x,Ve.y,Ve.z,Ve.w))}for(var Ie=ye.length;Ie<Te;++Ie)_.disableVertexAttribArray(Ie);var Xe=oe.getElements(this.elements);Xe?_.bindBuffer(od,Xe.buffer.buffer):_.bindBuffer(od,null)},Je.prototype.refresh=function(){var ve=Be();ve&&(ve.bindVertexArrayOES(this.vao),this.bindAttrs(),je.currentVAO=null,ve.bindVertexArrayOES(null))},Je.prototype.destroy=function(){if(this.vao){var ve=Be();this===je.currentVAO&&(je.currentVAO=null,ve.bindVertexArrayOES(null)),ve.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Le[this.id]&&(delete Le[this.id],se.vaoCount-=1)};function Ye(){var ve=Be();ve&&bn(Le).forEach(function(ye){ye.refresh()})}function bt(ve){var ye=new Je;se.vaoCount+=1;function st(Ve){var Ie;if(Array.isArray(Ve))Ie=Ve,ye.elements&&ye.ownsElements&&ye.elements.destroy(),ye.elements=null,ye.ownsElements=!1,ye.offset=0,ye.count=0,ye.instances=-1,ye.primitive=4;else{if(S(typeof Ve=="object","invalid arguments for create vao"),S("attributes"in Ve,"must specify attributes for vao"),Ve.elements){var Xe=Ve.elements;ye.ownsElements?typeof Xe=="function"&&Xe._reglType==="elements"?(ye.elements.destroy(),ye.ownsElements=!1):(ye.elements(Xe),ye.ownsElements=!1):oe.getElements(Ve.elements)?(ye.elements=Ve.elements,ye.ownsElements=!1):(ye.elements=oe.create(Ve.elements),ye.ownsElements=!0)}else ye.elements=null,ye.ownsElements=!1;Ie=Ve.attributes,ye.offset=0,ye.count=-1,ye.instances=-1,ye.primitive=4,ye.elements&&(ye.count=ye.elements._elements.vertCount,ye.primitive=ye.elements._elements.primType),"offset"in Ve&&(ye.offset=Ve.offset|0),"count"in Ve&&(ye.count=Ve.count|0),"instances"in Ve&&(ye.instances=Ve.instances|0),"primitive"in Ve&&(S(Ve.primitive in zi,"bad primitive type: "+Ve.primitive),ye.primitive=zi[Ve.primitive]),S.optional(()=>{for(var _r=Object.keys(Ve),$r=0;$r<_r.length;++$r)S(jw.indexOf(_r[$r])>=0,'invalid option for vao: "'+_r[$r]+'" valid options are '+jw)}),S(Array.isArray(Ie),"attributes must be an array")}S(Ie.length<Te,"too many attributes"),S(Ie.length>0,"must specify at least one attribute");var Ke={},Ot=ye.attributes;Ot.length=Ie.length;for(var At=0;At<Ie.length;++At){var Ze=Ie[At],et=Ot[At]=new Om,Et=Ze.data||Ze;if(Array.isArray(Et)||e(Et)||On(Et)){var It;ye.buffers[At]&&(It=ye.buffers[At],e(Et)&&It._buffer.byteLength>=Et.byteLength?It.subdata(Et):(It.destroy(),ye.buffers[At]=null)),ye.buffers[At]||(It=ye.buffers[At]=be.create(Ze,Gw,!1,!0)),et.buffer=be.getBuffer(It),et.size=et.buffer.dimension|0,et.normalized=!1,et.type=et.buffer.dtype,et.offset=0,et.stride=0,et.divisor=0,et.state=1,Ke[At]=1}else be.getBuffer(Ze)?(et.buffer=be.getBuffer(Ze),et.size=et.buffer.dimension|0,et.normalized=!1,et.type=et.buffer.dtype,et.offset=0,et.stride=0,et.divisor=0,et.state=1):be.getBuffer(Ze.buffer)?(et.buffer=be.getBuffer(Ze.buffer),et.size=(+Ze.size||et.buffer.dimension)|0,et.normalized=!!Ze.normalized||!1,"type"in Ze?(S.parameter(Ze.type,Bi,"invalid buffer type"),et.type=Bi[Ze.type]):et.type=et.buffer.dtype,et.offset=(Ze.offset||0)|0,et.stride=(Ze.stride||0)|0,et.divisor=(Ze.divisor||0)|0,et.state=1,S(et.size>=1&&et.size<=4,"size must be between 1 and 4"),S(et.offset>=0,"invalid offset"),S(et.stride>=0&&et.stride<=255,"stride must be between 0 and 255"),S(et.divisor>=0,"divisor must be positive"),S(!et.divisor||!!z.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Ze?(S(At>0,"first attribute must not be a constant"),et.x=+Ze.x||0,et.y=+Ze.y||0,et.z=+Ze.z||0,et.w=+Ze.w||0,et.state=2):S(!1,"invalid attribute spec for location "+At)}for(var Vt=0;Vt<ye.buffers.length;++Vt)!Ke[Vt]&&ye.buffers[Vt]&&(ye.buffers[Vt].destroy(),ye.buffers[Vt]=null);return ye.refresh(),st}return st.destroy=function(){for(var Ve=0;Ve<ye.buffers.length;++Ve)ye.buffers[Ve]&&ye.buffers[Ve].destroy();ye.buffers.length=0,ye.ownsElements&&(ye.elements.destroy(),ye.elements=null,ye.ownsElements=!1),ye.destroy()},st._vao=ye,st._reglType="vao",st(ve)}return je}var Vw=35632,XO=35633,KO=35718,YO=35721;function ZO(_,z,F,se){var be={},oe={};function de(Z,le,Oe,tt){this.name=Z,this.id=le,this.location=Oe,this.info=tt}function Te(Z,le){for(var Oe=0;Oe<Z.length;++Oe)if(Z[Oe].id===le.id){Z[Oe].location=le.location;return}Z.push(le)}function Se(Z,le,Oe){var tt=Z===Vw?be:oe,Ee=tt[le];if(!Ee){var Je=z.str(le);Ee=_.createShader(Z),_.shaderSource(Ee,Je),_.compileShader(Ee),S.shaderError(_,Ee,Je,Z,Oe),tt[le]=Ee}return Ee}var Ne={},De=[],Le=0;function je(Z,le){this.id=Le++,this.fragId=Z,this.vertId=le,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,se.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Ae(Z,le,Oe){var tt,Ee,Je=Se(Vw,Z.fragId),Ye=Se(XO,Z.vertId),bt=Z.program=_.createProgram();if(_.attachShader(bt,Je),_.attachShader(bt,Ye),Oe)for(tt=0;tt<Oe.length;++tt){var ve=Oe[tt];_.bindAttribLocation(bt,ve[0],ve[1])}_.linkProgram(bt),S.linkError(_,bt,z.str(Z.fragId),z.str(Z.vertId),le);var ye=_.getProgramParameter(bt,KO);se.profile&&(Z.stats.uniformsCount=ye);var st=Z.uniforms;for(tt=0;tt<ye;++tt)if(Ee=_.getActiveUniform(bt,tt),Ee)if(Ee.size>1)for(var Ve=0;Ve<Ee.size;++Ve){var Ie=Ee.name.replace("[0]","["+Ve+"]");Te(st,new de(Ie,z.id(Ie),_.getUniformLocation(bt,Ie),Ee))}else Te(st,new de(Ee.name,z.id(Ee.name),_.getUniformLocation(bt,Ee.name),Ee));var Xe=_.getProgramParameter(bt,YO);se.profile&&(Z.stats.attributesCount=Xe);var Ke=Z.attributes;for(tt=0;tt<Xe;++tt)Ee=_.getActiveAttrib(bt,tt),Ee&&Te(Ke,new de(Ee.name,z.id(Ee.name),_.getAttribLocation(bt,Ee.name),Ee))}se.profile&&(F.getMaxUniformsCount=function(){var Z=0;return De.forEach(function(le){le.stats.uniformsCount>Z&&(Z=le.stats.uniformsCount)}),Z},F.getMaxAttributesCount=function(){var Z=0;return De.forEach(function(le){le.stats.attributesCount>Z&&(Z=le.stats.attributesCount)}),Z});function Be(){be={},oe={};for(var Z=0;Z<De.length;++Z)Ae(De[Z],null,De[Z].attributes.map(function(le){return[le.location,le.name]}))}return{clear:function(){var Z=_.deleteShader.bind(_);bn(be).forEach(Z),be={},bn(oe).forEach(Z),oe={},De.forEach(function(le){_.deleteProgram(le.program)}),De.length=0,Ne={},F.shaderCount=0},program:function(Z,le,Oe,tt){S.command(Z>=0,"missing vertex shader",Oe),S.command(le>=0,"missing fragment shader",Oe);var Ee=Ne[le];Ee||(Ee=Ne[le]={});var Je=Ee[Z];if(Je&&(Je.refCount++,!tt))return Je;var Ye=new je(le,Z);return F.shaderCount++,Ae(Ye,Oe,tt),Je||(Ee[Z]=Ye),De.push(Ye),t(Ye,{destroy:function(){if(Ye.refCount--,Ye.refCount<=0){_.deleteProgram(Ye.program);var bt=De.indexOf(Ye);De.splice(bt,1),F.shaderCount--}Ee[Ye.vertId].refCount<=0&&(_.deleteShader(oe[Ye.vertId]),delete oe[Ye.vertId],delete Ne[Ye.fragId][Ye.vertId]),Object.keys(Ne[Ye.fragId]).length||(_.deleteShader(be[Ye.fragId]),delete be[Ye.fragId],delete Ne[Ye.fragId])}})},restore:Be,shader:Se,frag:-1,vert:-1}}var QO=6408,$l=5121,JO=3333,sd=5126;function eB(_,z,F,se,be,oe,de){function Te(De){var Le;z.next===null?(S(be.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Le=$l):(S(z.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Le=z.next.colorAttachments[0].texture._texture.type,S.optional(function(){oe.oes_texture_float?(S(Le===$l||Le===sd,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Le===sd&&S(de.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):S(Le===$l,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var je=0,Ae=0,Be=se.framebufferWidth,Z=se.framebufferHeight,le=null;e(De)?le=De:De&&(S.type(De,"object","invalid arguments to regl.read()"),je=De.x|0,Ae=De.y|0,S(je>=0&&je<se.framebufferWidth,"invalid x offset for regl.read"),S(Ae>=0&&Ae<se.framebufferHeight,"invalid y offset for regl.read"),Be=(De.width||se.framebufferWidth-je)|0,Z=(De.height||se.framebufferHeight-Ae)|0,le=De.data||null),le&&(Le===$l?S(le instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Le===sd&&S(le instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),S(Be>0&&Be+je<=se.framebufferWidth,"invalid width for read pixels"),S(Z>0&&Z+Ae<=se.framebufferHeight,"invalid height for read pixels"),F();var Oe=Be*Z*4;return le||(Le===$l?le=new Uint8Array(Oe):Le===sd&&(le=le||new Float32Array(Oe))),S.isTypedArray(le,"data buffer for regl.read() must be a typedarray"),S(le.byteLength>=Oe,"data buffer for regl.read() too small"),_.pixelStorei(JO,4),_.readPixels(je,Ae,Be,Z,QO,Le,le),le}function Se(De){var Le;return z.setFBO({framebuffer:De.framebuffer},function(){Le=Te(De)}),Le}function Ne(De){return!De||!("framebuffer"in De)?Te(De):Se(De)}return Ne}function Us(_){return Array.prototype.slice.call(_)}function Fs(_){return Us(_).join("")}function tB(){var _=0,z=[],F=[];function se(Le){for(var je=0;je<F.length;++je)if(F[je]===Le)return z[je];var Ae="g"+_++;return z.push(Ae),F.push(Le),Ae}function be(){var Le=[];function je(){Le.push.apply(Le,Us(arguments))}var Ae=[];function Be(){var Z="v"+_++;return Ae.push(Z),arguments.length>0&&(Le.push(Z,"="),Le.push.apply(Le,Us(arguments)),Le.push(";")),Z}return t(je,{def:Be,toString:function(){return Fs([Ae.length>0?"var "+Ae.join(",")+";":"",Fs(Le)])}})}function oe(){var Le=be(),je=be(),Ae=Le.toString,Be=je.toString;function Z(le,Oe){je(le,Oe,"=",Le.def(le,Oe),";")}return t(function(){Le.apply(Le,Us(arguments))},{def:Le.def,entry:Le,exit:je,save:Z,set:function(le,Oe,tt){Z(le,Oe),Le(le,Oe,"=",tt,";")},toString:function(){return Ae()+Be()}})}function de(){var Le=Fs(arguments),je=oe(),Ae=oe(),Be=je.toString,Z=Ae.toString;return t(je,{then:function(){return je.apply(je,Us(arguments)),this},else:function(){return Ae.apply(Ae,Us(arguments)),this},toString:function(){var le=Z();return le&&(le="else{"+le+"}"),Fs(["if(",Le,"){",Be(),"}",le])}})}var Te=be(),Se={};function Ne(Le,je){var Ae=[];function Be(){var Ee="a"+Ae.length;return Ae.push(Ee),Ee}je=je||0;for(var Z=0;Z<je;++Z)Be();var le=oe(),Oe=le.toString,tt=Se[Le]=t(le,{arg:Be,toString:function(){return Fs(["function(",Ae.join(),"){",Oe(),"}"])}});return tt}function De(){var Le=['"use strict";',Te,"return {"];Object.keys(Se).forEach(function(Be){Le.push('"',Be,'":',Se[Be].toString(),",")}),Le.push("}");var je=Fs(Le).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Ae=Function.apply(null,z.concat(je));return Ae.apply(null,F)}return{global:Te,link:se,block:be,proc:Ne,scope:oe,cond:de,compile:De}}var Gs="xyzw".split(""),Ww=5121,js=1,Bm=2,Rm=0,zm=1,Nm=2,Lm=3,ud=4,Hw=5,qw=6,Xw="dither",Kw="blend.enable",Yw="blend.color",Dm="blend.equation",Mm="blend.func",Zw="depth.enable",Qw="depth.func",Jw="depth.range",e2="depth.mask",Pm="colorMask",t2="cull.enable",r2="cull.face",Um="frontFace",Fm="lineWidth",n2="polygonOffset.enable",Gm="polygonOffset.offset",i2="sample.alpha",a2="sample.enable",jm="sample.coverage",o2="stencil.enable",s2="stencil.mask",Vm="stencil.func",Wm="stencil.opFront",El="stencil.opBack",u2="scissor.enable",ld="scissor.box",ra="viewport",Sl="profile",To="framebuffer",Tl="vert",Al="frag",Ao="elements",ko="primitive",Io="count",cd="offset",fd="instances",kl="vao",Hm="Width",qm="Height",Vs=To+Hm,Ws=To+qm,rB=ra+Hm,nB=ra+qm,l2="drawingBuffer",c2=l2+Hm,f2=l2+qm,iB=[Mm,Dm,Vm,Wm,El,jm,ra,ld,Gm],Hs=34962,Xm=34963,aB=35632,oB=35633,d2=3553,sB=34067,uB=2884,lB=3042,cB=3024,fB=2960,dB=2929,pB=3089,hB=32823,mB=32926,gB=32928,Km=5126,dd=35664,pd=35665,hd=35666,Ym=5124,md=35667,gd=35668,yd=35669,Zm=35670,bd=35671,wd=35672,vd=35673,Il=35674,Cl=35675,Ol=35676,Bl=35678,Rl=35680,Qm=4,zl=1028,Co=1029,p2=2304,Jm=2305,yB=32775,bB=32776,wB=519,Na=7680,h2=0,m2=1,g2=32774,vB=513,y2=36160,_B=36064,Ni={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},b2=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],qs={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},La={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},w2={frag:aB,vert:oB},eg={cw:p2,ccw:Jm};function _d(_){return Array.isArray(_)||e(_)||On(_)}function v2(_){return _.sort(function(z,F){return z===ra?-1:F===ra?1:z<F?-1:1})}function qr(_,z,F,se){this.thisDep=_,this.contextDep=z,this.propDep=F,this.append=se}function Da(_){return _&&!(_.thisDep||_.contextDep||_.propDep)}function Rr(_){return new qr(!1,!1,!1,_)}function Tn(_,z){var F=_.type;if(F===Rm){var se=_.data.length;return new qr(!0,se>=1,se>=2,z)}else if(F===ud){var be=_.data;return new qr(be.thisDep,be.contextDep,be.propDep,z)}else{if(F===Hw)return new qr(!1,!1,!1,z);if(F===qw){for(var oe=!1,de=!1,Te=!1,Se=0;Se<_.data.length;++Se){var Ne=_.data[Se];if(Ne.type===zm)Te=!0;else if(Ne.type===Nm)de=!0;else if(Ne.type===Lm)oe=!0;else if(Ne.type===Rm){oe=!0;var De=Ne.data;De>=1&&(de=!0),De>=2&&(Te=!0)}else Ne.type===ud&&(oe=oe||Ne.data.thisDep,de=de||Ne.data.contextDep,Te=Te||Ne.data.propDep)}return new qr(oe,de,Te,z)}else return new qr(F===Lm,F===Nm,F===zm,z)}}var _2=new qr(!1,!1,!1,function(){});function xB(_,z,F,se,be,oe,de,Te,Se,Ne,De,Le,je,Ae,Be){var Z=Ne.Record,le={add:32774,subtract:32778,"reverse subtract":32779};F.ext_blend_minmax&&(le.min=yB,le.max=bB);var Oe=F.angle_instanced_arrays,tt=F.webgl_draw_buffers,Ee=F.oes_vertex_array_object,Je={dirty:!0,profile:Be.profile},Ye={},bt=[],ve={},ye={};function st(D){return D.replace(".","_")}function Ve(D,B,j){var Y=st(D);bt.push(D),Ye[Y]=Je[Y]=!!j,ve[Y]=B}function Ie(D,B,j){var Y=st(D);bt.push(D),Array.isArray(j)?(Je[Y]=j.slice(),Ye[Y]=j.slice()):Je[Y]=Ye[Y]=j,ye[Y]=B}Ve(Xw,cB),Ve(Kw,lB),Ie(Yw,"blendColor",[0,0,0,0]),Ie(Dm,"blendEquationSeparate",[g2,g2]),Ie(Mm,"blendFuncSeparate",[m2,h2,m2,h2]),Ve(Zw,dB,!0),Ie(Qw,"depthFunc",vB),Ie(Jw,"depthRange",[0,1]),Ie(e2,"depthMask",!0),Ie(Pm,Pm,[!0,!0,!0,!0]),Ve(t2,uB),Ie(r2,"cullFace",Co),Ie(Um,Um,Jm),Ie(Fm,Fm,1),Ve(n2,hB),Ie(Gm,"polygonOffset",[0,0]),Ve(i2,mB),Ve(a2,gB),Ie(jm,"sampleCoverage",[1,!1]),Ve(o2,fB),Ie(s2,"stencilMask",-1),Ie(Vm,"stencilFunc",[wB,0,-1]),Ie(Wm,"stencilOpSeparate",[zl,Na,Na,Na]),Ie(El,"stencilOpSeparate",[Co,Na,Na,Na]),Ve(u2,pB),Ie(ld,"scissor",[0,0,_.drawingBufferWidth,_.drawingBufferHeight]),Ie(ra,ra,[0,0,_.drawingBufferWidth,_.drawingBufferHeight]);var Xe={gl:_,context:je,strings:z,next:Ye,current:Je,draw:Le,elements:oe,buffer:be,shader:De,attributes:Ne.state,vao:Ne,uniforms:Se,framebuffer:Te,extensions:F,timer:Ae,isBufferArgs:_d},Ke={primTypes:zi,compareFuncs:qs,blendFuncs:Ni,blendEquations:le,stencilOps:La,glTypes:Bi,orientationType:eg};S.optional(function(){Xe.isArrayLike=cr}),tt&&(Ke.backBuffer=[Co],Ke.drawBuffer=fn(se.maxDrawbuffers,function(D){return D===0?[0]:fn(D,function(B){return _B+B})}));var Ot=0;function At(){var D=tB(),B=D.link,j=D.global;D.id=Ot++,D.batchId="0";var Y=B(Xe),Q=D.shared={props:"a0"};Object.keys(Xe).forEach(function(G){Q[G]=j.def(Y,".",G)}),S.optional(function(){D.CHECK=B(S),D.commandStr=S.guessCommand(),D.command=B(D.commandStr),D.assert=function(G,M,J){G("if(!(",M,"))",this.CHECK,".commandRaise(",B(J),",",this.command,");")},Ke.invalidBlendCombinations=b2});var H=D.next={},V=D.current={};Object.keys(ye).forEach(function(G){Array.isArray(Je[G])&&(H[G]=j.def(Q.next,".",G),V[G]=j.def(Q.current,".",G))});var X=D.constants={};Object.keys(Ke).forEach(function(G){X[G]=j.def(JSON.stringify(Ke[G]))}),D.invoke=function(G,M){switch(M.type){case Rm:var J=["this",Q.context,Q.props,D.batchId];return G.def(B(M.data),".call(",J.slice(0,Math.max(M.data.length+1,4)),")");case zm:return G.def(Q.props,M.data);case Nm:return G.def(Q.context,M.data);case Lm:return G.def("this",M.data);case ud:return M.data.append(D,G),M.data.ref;case Hw:return M.data.toString();case qw:return M.data.map(function(ee){return D.invoke(G,ee)})}},D.attribCache={};var N={};return D.scopeAttrib=function(G){var M=z.id(G);if(M in N)return N[M];var J=Ne.scope[M];J||(J=Ne.scope[M]=new Z);var ee=N[M]=B(J);return ee},D}function Ze(D){var B=D.static,j=D.dynamic,Y;if(Sl in B){var Q=!!B[Sl];Y=Rr(function(V,X){return Q}),Y.enable=Q}else if(Sl in j){var H=j[Sl];Y=Tn(H,function(V,X){return V.invoke(X,H)})}return Y}function et(D,B){var j=D.static,Y=D.dynamic;if(To in j){var Q=j[To];return Q?(Q=Te.getFramebuffer(Q),S.command(Q,"invalid framebuffer object"),Rr(function(V,X){var N=V.link(Q),G=V.shared;X.set(G.framebuffer,".next",N);var M=G.context;return X.set(M,"."+Vs,N+".width"),X.set(M,"."+Ws,N+".height"),N})):Rr(function(V,X){var N=V.shared;X.set(N.framebuffer,".next","null");var G=N.context;return X.set(G,"."+Vs,G+"."+c2),X.set(G,"."+Ws,G+"."+f2),"null"})}else if(To in Y){var H=Y[To];return Tn(H,function(V,X){var N=V.invoke(X,H),G=V.shared,M=G.framebuffer,J=X.def(M,".getFramebuffer(",N,")");S.optional(function(){V.assert(X,"!"+N+"||"+J,"invalid framebuffer object")}),X.set(M,".next",J);var ee=G.context;return X.set(ee,"."+Vs,J+"?"+J+".width:"+ee+"."+c2),X.set(ee,"."+Ws,J+"?"+J+".height:"+ee+"."+f2),J})}else return null}function Et(D,B,j){var Y=D.static,Q=D.dynamic;function H(N){if(N in Y){var G=Y[N];S.commandType(G,"object","invalid "+N,j.commandStr);var M=!0,J=G.x|0,ee=G.y|0,xe,Ue;return"width"in G?(xe=G.width|0,S.command(xe>=0,"invalid "+N,j.commandStr)):M=!1,"height"in G?(Ue=G.height|0,S.command(Ue>=0,"invalid "+N,j.commandStr)):M=!1,new qr(!M&&B&&B.thisDep,!M&&B&&B.contextDep,!M&&B&&B.propDep,function(Pe,ct){var nt=Pe.shared.context,ut=xe;"width"in G||(ut=ct.def(nt,".",Vs,"-",J));var lt=Ue;return"height"in G||(lt=ct.def(nt,".",Ws,"-",ee)),[J,ee,ut,lt]})}else if(N in Q){var Fe=Q[N],Qe=Tn(Fe,function(Pe,ct){var nt=Pe.invoke(ct,Fe);S.optional(function(){Pe.assert(ct,nt+"&&typeof "+nt+'==="object"',"invalid "+N)});var ut=Pe.shared.context,lt=ct.def(nt,".x|0"),ft=ct.def(nt,".y|0"),St=ct.def('"width" in ',nt,"?",nt,".width|0:","(",ut,".",Vs,"-",lt,")"),lr=ct.def('"height" in ',nt,"?",nt,".height|0:","(",ut,".",Ws,"-",ft,")");return S.optional(function(){Pe.assert(ct,St+">=0&&"+lr+">=0","invalid "+N)}),[lt,ft,St,lr]});return B&&(Qe.thisDep=Qe.thisDep||B.thisDep,Qe.contextDep=Qe.contextDep||B.contextDep,Qe.propDep=Qe.propDep||B.propDep),Qe}else return B?new qr(B.thisDep,B.contextDep,B.propDep,function(Pe,ct){var nt=Pe.shared.context;return[0,0,ct.def(nt,".",Vs),ct.def(nt,".",Ws)]}):null}var V=H(ra);if(V){var X=V;V=new qr(V.thisDep,V.contextDep,V.propDep,function(N,G){var M=X.append(N,G),J=N.shared.context;return G.set(J,"."+rB,M[2]),G.set(J,"."+nB,M[3]),M})}return{viewport:V,scissor_box:H(ld)}}function It(D,B){var j=D.static,Y=typeof j[Al]=="string"&&typeof j[Tl]=="string";if(Y){if(Object.keys(B.dynamic).length>0)return null;var Q=B.static,H=Object.keys(Q);if(H.length>0&&typeof Q[H[0]]=="number"){for(var V=[],X=0;X<H.length;++X)S(typeof Q[H[X]]=="number","must specify all vertex attribute locations when using vaos"),V.push([Q[H[X]]|0,H[X]]);return V}}return null}function Vt(D,B,j){var Y=D.static,Q=D.dynamic;function H(M){if(M in Y){var J=z.id(Y[M]);S.optional(function(){De.shader(w2[M],J,S.guessCommand())});var ee=Rr(function(){return J});return ee.id=J,ee}else if(M in Q){var xe=Q[M];return Tn(xe,function(Ue,Fe){var Qe=Ue.invoke(Fe,xe),Pe=Fe.def(Ue.shared.strings,".id(",Qe,")");return S.optional(function(){Fe(Ue.shared.shader,".shader(",w2[M],",",Pe,",",Ue.command,");")}),Pe})}return null}var V=H(Al),X=H(Tl),N=null,G;return Da(V)&&Da(X)?(N=De.program(X.id,V.id,null,j),G=Rr(function(M,J){return M.link(N)})):G=new qr(V&&V.thisDep||X&&X.thisDep,V&&V.contextDep||X&&X.contextDep,V&&V.propDep||X&&X.propDep,function(M,J){var ee=M.shared.shader,xe;V?xe=V.append(M,J):xe=J.def(ee,".",Al);var Ue;X?Ue=X.append(M,J):Ue=J.def(ee,".",Tl);var Fe=ee+".program("+Ue+","+xe;return S.optional(function(){Fe+=","+M.command}),J.def(Fe+")")}),{frag:V,vert:X,progVar:G,program:N}}function _r(D,B){var j=D.static,Y=D.dynamic,Q={},H=!1;function V(){if(kl in j){var ct=j[kl];return ct!==null&&Ne.getVAO(ct)===null&&(ct=Ne.createVAO(ct)),H=!0,Q.vao=ct,Rr(function(ut){var lt=Ne.getVAO(ct);return lt?ut.link(lt):"null"})}else if(kl in Y){H=!0;var nt=Y[kl];return Tn(nt,function(ut,lt){var ft=ut.invoke(lt,nt);return lt.def(ut.shared.vao+".getVAO("+ft+")")})}return null}var X=V(),N=!1;function G(){if(Ao in j){var ct=j[Ao];if(Q.elements=ct,_d(ct)){var nt=Q.elements=oe.create(ct,!0);ct=oe.getElements(nt),N=!0}else ct&&(ct=oe.getElements(ct),N=!0,S.command(ct,"invalid elements",B.commandStr));var ut=Rr(function(ft,St){if(ct){var lr=ft.link(ct);return ft.ELEMENTS=lr,lr}return ft.ELEMENTS=null,null});return ut.value=ct,ut}else if(Ao in Y){N=!0;var lt=Y[Ao];return Tn(lt,function(ft,St){var lr=ft.shared,Kr=lr.isBufferArgs,na=lr.elements,ia=ft.invoke(St,lt),aa=St.def("null"),dn=St.def(Kr,"(",ia,")"),Di=ft.cond(dn).then(aa,"=",na,".createStream(",ia,");").else(aa,"=",na,".getElements(",ia,");");return S.optional(function(){ft.assert(Di.else,"!"+ia+"||"+aa,"invalid elements")}),St.entry(Di),St.exit(ft.cond(dn).then(na,".destroyStream(",aa,");")),ft.ELEMENTS=aa,aa})}else if(H)return new qr(X.thisDep,X.contextDep,X.propDep,function(ft,St){return St.def(ft.shared.vao+".currentVAO?"+ft.shared.elements+".getElements("+ft.shared.vao+".currentVAO.elements):null")});return null}var M=G();function J(){if(ko in j){var ct=j[ko];return Q.primitive=ct,S.commandParameter(ct,zi,"invalid primitve",B.commandStr),Rr(function(ut,lt){return zi[ct]})}else if(ko in Y){var nt=Y[ko];return Tn(nt,function(ut,lt){var ft=ut.constants.primTypes,St=ut.invoke(lt,nt);return S.optional(function(){ut.assert(lt,St+" in "+ft,"invalid primitive, must be one of "+Object.keys(zi))}),lt.def(ft,"[",St,"]")})}else{if(N)return Da(M)?M.value?Rr(function(ut,lt){return lt.def(ut.ELEMENTS,".primType")}):Rr(function(){return Qm}):new qr(M.thisDep,M.contextDep,M.propDep,function(ut,lt){var ft=ut.ELEMENTS;return lt.def(ft,"?",ft,".primType:",Qm)});if(H)return new qr(X.thisDep,X.contextDep,X.propDep,function(ut,lt){return lt.def(ut.shared.vao+".currentVAO?"+ut.shared.vao+".currentVAO.primitive:"+Qm)})}return null}function ee(ct,nt){if(ct in j){var ut=j[ct]|0;return nt?Q.offset=ut:Q.instances=ut,S.command(!nt||ut>=0,"invalid "+ct,B.commandStr),Rr(function(ft,St){return nt&&(ft.OFFSET=ut),ut})}else if(ct in Y){var lt=Y[ct];return Tn(lt,function(ft,St){var lr=ft.invoke(St,lt);return nt&&(ft.OFFSET=lr,S.optional(function(){ft.assert(St,lr+">=0","invalid "+ct)})),lr})}else if(nt){if(N)return Rr(function(ft,St){return ft.OFFSET=0,0});if(H)return new qr(X.thisDep,X.contextDep,X.propDep,function(ft,St){return St.def(ft.shared.vao+".currentVAO?"+ft.shared.vao+".currentVAO.offset:0")})}else if(H)return new qr(X.thisDep,X.contextDep,X.propDep,function(ft,St){return St.def(ft.shared.vao+".currentVAO?"+ft.shared.vao+".currentVAO.instances:-1")});return null}var xe=ee(cd,!0);function Ue(){if(Io in j){var ct=j[Io]|0;return Q.count=ct,S.command(typeof ct=="number"&&ct>=0,"invalid vertex count",B.commandStr),Rr(function(){return ct})}else if(Io in Y){var nt=Y[Io];return Tn(nt,function(St,lr){var Kr=St.invoke(lr,nt);return S.optional(function(){St.assert(lr,"typeof "+Kr+'==="number"&&'+Kr+">=0&&"+Kr+"===("+Kr+"|0)","invalid vertex count")}),Kr})}else if(N)if(Da(M)){if(M)return xe?new qr(xe.thisDep,xe.contextDep,xe.propDep,function(St,lr){var Kr=lr.def(St.ELEMENTS,".vertCount-",St.OFFSET);return S.optional(function(){St.assert(lr,Kr+">=0","invalid vertex offset/element buffer too small")}),Kr}):Rr(function(St,lr){return lr.def(St.ELEMENTS,".vertCount")});var ut=Rr(function(){return-1});return S.optional(function(){ut.MISSING=!0}),ut}else{var lt=new qr(M.thisDep||xe.thisDep,M.contextDep||xe.contextDep,M.propDep||xe.propDep,function(St,lr){var Kr=St.ELEMENTS;return St.OFFSET?lr.def(Kr,"?",Kr,".vertCount-",St.OFFSET,":-1"):lr.def(Kr,"?",Kr,".vertCount:-1")});return S.optional(function(){lt.DYNAMIC=!0}),lt}else if(H){var ft=new qr(X.thisDep,X.contextDep,X.propDep,function(St,lr){return lr.def(St.shared.vao,".currentVAO?",St.shared.vao,".currentVAO.count:-1")});return ft}return null}var Fe=J(),Qe=Ue(),Pe=ee(fd,!1);return{elements:M,primitive:Fe,count:Qe,instances:Pe,offset:xe,vao:X,vaoActive:H,elementsActive:N,static:Q}}function $r(D,B){var j=D.static,Y=D.dynamic,Q={};return bt.forEach(function(H){var V=st(H);function X(N,G){if(H in j){var M=N(j[H]);Q[V]=Rr(function(){return M})}else if(H in Y){var J=Y[H];Q[V]=Tn(J,function(ee,xe){return G(ee,xe,ee.invoke(xe,J))})}}switch(H){case t2:case Kw:case Xw:case o2:case Zw:case u2:case n2:case i2:case a2:case e2:return X(function(N){return S.commandType(N,"boolean",H,B.commandStr),N},function(N,G,M){return S.optional(function(){N.assert(G,"typeof "+M+'==="boolean"',"invalid flag "+H,N.commandStr)}),M});case Qw:return X(function(N){return S.commandParameter(N,qs,"invalid "+H,B.commandStr),qs[N]},function(N,G,M){var J=N.constants.compareFuncs;return S.optional(function(){N.assert(G,M+" in "+J,"invalid "+H+", must be one of "+Object.keys(qs))}),G.def(J,"[",M,"]")});case Jw:return X(function(N){return S.command(cr(N)&&N.length===2&&typeof N[0]=="number"&&typeof N[1]=="number"&&N[0]<=N[1],"depth range is 2d array",B.commandStr),N},function(N,G,M){S.optional(function(){N.assert(G,N.shared.isArrayLike+"("+M+")&&"+M+".length===2&&typeof "+M+'[0]==="number"&&typeof '+M+'[1]==="number"&&'+M+"[0]<="+M+"[1]","depth range must be a 2d array")});var J=G.def("+",M,"[0]"),ee=G.def("+",M,"[1]");return[J,ee]});case Mm:return X(function(N){S.commandType(N,"object","blend.func",B.commandStr);var G="srcRGB"in N?N.srcRGB:N.src,M="srcAlpha"in N?N.srcAlpha:N.src,J="dstRGB"in N?N.dstRGB:N.dst,ee="dstAlpha"in N?N.dstAlpha:N.dst;return S.commandParameter(G,Ni,V+".srcRGB",B.commandStr),S.commandParameter(M,Ni,V+".srcAlpha",B.commandStr),S.commandParameter(J,Ni,V+".dstRGB",B.commandStr),S.commandParameter(ee,Ni,V+".dstAlpha",B.commandStr),S.command(b2.indexOf(G+", "+J)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+G+", "+J+")",B.commandStr),[Ni[G],Ni[J],Ni[M],Ni[ee]]},function(N,G,M){var J=N.constants.blendFuncs;S.optional(function(){N.assert(G,M+"&&typeof "+M+'==="object"',"invalid blend func, must be an object")});function ee(nt,ut){var lt=G.def('"',nt,ut,'" in ',M,"?",M,".",nt,ut,":",M,".",nt);return S.optional(function(){N.assert(G,lt+" in "+J,"invalid "+H+"."+nt+ut+", must be one of "+Object.keys(Ni))}),lt}var xe=ee("src","RGB"),Ue=ee("dst","RGB");S.optional(function(){var nt=N.constants.invalidBlendCombinations;N.assert(G,nt+".indexOf("+xe+'+", "+'+Ue+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Fe=G.def(J,"[",xe,"]"),Qe=G.def(J,"[",ee("src","Alpha"),"]"),Pe=G.def(J,"[",Ue,"]"),ct=G.def(J,"[",ee("dst","Alpha"),"]");return[Fe,Pe,Qe,ct]});case Dm:return X(function(N){if(typeof N=="string")return S.commandParameter(N,le,"invalid "+H,B.commandStr),[le[N],le[N]];if(typeof N=="object")return S.commandParameter(N.rgb,le,H+".rgb",B.commandStr),S.commandParameter(N.alpha,le,H+".alpha",B.commandStr),[le[N.rgb],le[N.alpha]];S.commandRaise("invalid blend.equation",B.commandStr)},function(N,G,M){var J=N.constants.blendEquations,ee=G.def(),xe=G.def(),Ue=N.cond("typeof ",M,'==="string"');return S.optional(function(){function Fe(Qe,Pe,ct){N.assert(Qe,ct+" in "+J,"invalid "+Pe+", must be one of "+Object.keys(le))}Fe(Ue.then,H,M),N.assert(Ue.else,M+"&&typeof "+M+'==="object"',"invalid "+H),Fe(Ue.else,H+".rgb",M+".rgb"),Fe(Ue.else,H+".alpha",M+".alpha")}),Ue.then(ee,"=",xe,"=",J,"[",M,"];"),Ue.else(ee,"=",J,"[",M,".rgb];",xe,"=",J,"[",M,".alpha];"),G(Ue),[ee,xe]});case Yw:return X(function(N){return S.command(cr(N)&&N.length===4,"blend.color must be a 4d array",B.commandStr),fn(4,function(G){return+N[G]})},function(N,G,M){return S.optional(function(){N.assert(G,N.shared.isArrayLike+"("+M+")&&"+M+".length===4","blend.color must be a 4d array")}),fn(4,function(J){return G.def("+",M,"[",J,"]")})});case s2:return X(function(N){return S.commandType(N,"number",V,B.commandStr),N|0},function(N,G,M){return S.optional(function(){N.assert(G,"typeof "+M+'==="number"',"invalid stencil.mask")}),G.def(M,"|0")});case Vm:return X(function(N){S.commandType(N,"object",V,B.commandStr);var G=N.cmp||"keep",M=N.ref||0,J="mask"in N?N.mask:-1;return S.commandParameter(G,qs,H+".cmp",B.commandStr),S.commandType(M,"number",H+".ref",B.commandStr),S.commandType(J,"number",H+".mask",B.commandStr),[qs[G],M,J]},function(N,G,M){var J=N.constants.compareFuncs;S.optional(function(){function Fe(){N.assert(G,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Fe(M+"&&typeof ",M,'==="object"'),Fe('!("cmp" in ',M,")||(",M,".cmp in ",J,")")});var ee=G.def('"cmp" in ',M,"?",J,"[",M,".cmp]",":",Na),xe=G.def(M,".ref|0"),Ue=G.def('"mask" in ',M,"?",M,".mask|0:-1");return[ee,xe,Ue]});case Wm:case El:return X(function(N){S.commandType(N,"object",V,B.commandStr);var G=N.fail||"keep",M=N.zfail||"keep",J=N.zpass||"keep";return S.commandParameter(G,La,H+".fail",B.commandStr),S.commandParameter(M,La,H+".zfail",B.commandStr),S.commandParameter(J,La,H+".zpass",B.commandStr),[H===El?Co:zl,La[G],La[M],La[J]]},function(N,G,M){var J=N.constants.stencilOps;S.optional(function(){N.assert(G,M+"&&typeof "+M+'==="object"',"invalid "+H)});function ee(xe){return S.optional(function(){N.assert(G,'!("'+xe+'" in '+M+")||("+M+"."+xe+" in "+J+")","invalid "+H+"."+xe+", must be one of "+Object.keys(La))}),G.def('"',xe,'" in ',M,"?",J,"[",M,".",xe,"]:",Na)}return[H===El?Co:zl,ee("fail"),ee("zfail"),ee("zpass")]});case Gm:return X(function(N){S.commandType(N,"object",V,B.commandStr);var G=N.factor|0,M=N.units|0;return S.commandType(G,"number",V+".factor",B.commandStr),S.commandType(M,"number",V+".units",B.commandStr),[G,M]},function(N,G,M){S.optional(function(){N.assert(G,M+"&&typeof "+M+'==="object"',"invalid "+H)});var J=G.def(M,".factor|0"),ee=G.def(M,".units|0");return[J,ee]});case r2:return X(function(N){var G=0;return N==="front"?G=zl:N==="back"&&(G=Co),S.command(!!G,V,B.commandStr),G},function(N,G,M){return S.optional(function(){N.assert(G,M+'==="front"||'+M+'==="back"',"invalid cull.face")}),G.def(M,'==="front"?',zl,":",Co)});case Fm:return X(function(N){return S.command(typeof N=="number"&&N>=se.lineWidthDims[0]&&N<=se.lineWidthDims[1],"invalid line width, must be a positive number between "+se.lineWidthDims[0]+" and "+se.lineWidthDims[1],B.commandStr),N},function(N,G,M){return S.optional(function(){N.assert(G,"typeof "+M+'==="number"&&'+M+">="+se.lineWidthDims[0]+"&&"+M+"<="+se.lineWidthDims[1],"invalid line width")}),M});case Um:return X(function(N){return S.commandParameter(N,eg,V,B.commandStr),eg[N]},function(N,G,M){return S.optional(function(){N.assert(G,M+'==="cw"||'+M+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),G.def(M+'==="cw"?'+p2+":"+Jm)});case Pm:return X(function(N){return S.command(cr(N)&&N.length===4,"color.mask must be length 4 array",B.commandStr),N.map(function(G){return!!G})},function(N,G,M){return S.optional(function(){N.assert(G,N.shared.isArrayLike+"("+M+")&&"+M+".length===4","invalid color.mask")}),fn(4,function(J){return"!!"+M+"["+J+"]"})});case jm:return X(function(N){S.command(typeof N=="object"&&N,V,B.commandStr);var G="value"in N?N.value:1,M=!!N.invert;return S.command(typeof G=="number"&&G>=0&&G<=1,"sample.coverage.value must be a number between 0 and 1",B.commandStr),[G,M]},function(N,G,M){S.optional(function(){N.assert(G,M+"&&typeof "+M+'==="object"',"invalid sample.coverage")});var J=G.def('"value" in ',M,"?+",M,".value:1"),ee=G.def("!!",M,".invert");return[J,ee]})}}),Q}function Ht(D,B){var j=D.static,Y=D.dynamic,Q={};return Object.keys(j).forEach(function(H){var V=j[H],X;if(typeof V=="number"||typeof V=="boolean")X=Rr(function(){return V});else if(typeof V=="function"){var N=V._reglType;N==="texture2d"||N==="textureCube"?X=Rr(function(G){return G.link(V)}):N==="framebuffer"||N==="framebufferCube"?(S.command(V.color.length>0,'missing color attachment for framebuffer sent to uniform "'+H+'"',B.commandStr),X=Rr(function(G){return G.link(V.color[0])})):S.commandRaise('invalid data for uniform "'+H+'"',B.commandStr)}else cr(V)?X=Rr(function(G){var M=G.global.def("[",fn(V.length,function(J){return S.command(typeof V[J]=="number"||typeof V[J]=="boolean","invalid uniform "+H,G.commandStr),V[J]}),"]");return M}):S.commandRaise('invalid or missing data for uniform "'+H+'"',B.commandStr);X.value=V,Q[H]=X}),Object.keys(Y).forEach(function(H){var V=Y[H];Q[H]=Tn(V,function(X,N){return X.invoke(N,V)})}),Q}function Pr(D,B){var j=D.static,Y=D.dynamic,Q={};return Object.keys(j).forEach(function(H){var V=j[H],X=z.id(H),N=new Z;if(_d(V))N.state=js,N.buffer=be.getBuffer(be.create(V,Hs,!1,!0)),N.type=0;else{var G=be.getBuffer(V);if(G)N.state=js,N.buffer=G,N.type=0;else if(S.command(typeof V=="object"&&V,"invalid data for attribute "+H,B.commandStr),"constant"in V){var M=V.constant;N.buffer="null",N.state=Bm,typeof M=="number"?N.x=M:(S.command(cr(M)&&M.length>0&&M.length<=4,"invalid constant for attribute "+H,B.commandStr),Gs.forEach(function(Pe,ct){ct<M.length&&(N[Pe]=M[ct])}))}else{_d(V.buffer)?G=be.getBuffer(be.create(V.buffer,Hs,!1,!0)):G=be.getBuffer(V.buffer),S.command(!!G,'missing buffer for attribute "'+H+'"',B.commandStr);var J=V.offset|0;S.command(J>=0,'invalid offset for attribute "'+H+'"',B.commandStr);var ee=V.stride|0;S.command(ee>=0&&ee<256,'invalid stride for attribute "'+H+'", must be integer betweeen [0, 255]',B.commandStr);var xe=V.size|0;S.command(!("size"in V)||xe>0&&xe<=4,'invalid size for attribute "'+H+'", must be 1,2,3,4',B.commandStr);var Ue=!!V.normalized,Fe=0;"type"in V&&(S.commandParameter(V.type,Bi,"invalid type for attribute "+H,B.commandStr),Fe=Bi[V.type]);var Qe=V.divisor|0;S.optional(function(){"divisor"in V&&(S.command(Qe===0||Oe,'cannot specify divisor for attribute "'+H+'", instancing not supported',B.commandStr),S.command(Qe>=0,'invalid divisor for attribute "'+H+'"',B.commandStr));var Pe=B.commandStr,ct=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(V).forEach(function(nt){S.command(ct.indexOf(nt)>=0,'unknown parameter "'+nt+'" for attribute pointer "'+H+'" (valid parameters are '+ct+")",Pe)})}),N.buffer=G,N.state=js,N.size=xe,N.normalized=Ue,N.type=Fe||G.dtype,N.offset=J,N.stride=ee,N.divisor=Qe}}Q[H]=Rr(function(Pe,ct){var nt=Pe.attribCache;if(X in nt)return nt[X];var ut={isStream:!1};return Object.keys(N).forEach(function(lt){ut[lt]=N[lt]}),N.buffer&&(ut.buffer=Pe.link(N.buffer),ut.type=ut.type||ut.buffer+".dtype"),nt[X]=ut,ut})}),Object.keys(Y).forEach(function(H){var V=Y[H];function X(N,G){var M=N.invoke(G,V),J=N.shared,ee=N.constants,xe=J.isBufferArgs,Ue=J.buffer;S.optional(function(){N.assert(G,M+"&&(typeof "+M+'==="object"||typeof '+M+'==="function")&&('+xe+"("+M+")||"+Ue+".getBuffer("+M+")||"+Ue+".getBuffer("+M+".buffer)||"+xe+"("+M+'.buffer)||("constant" in '+M+"&&(typeof "+M+'.constant==="number"||'+J.isArrayLike+"("+M+".constant))))",'invalid dynamic attribute "'+H+'"')});var Fe={isStream:G.def(!1)},Qe=new Z;Qe.state=js,Object.keys(Qe).forEach(function(ut){Fe[ut]=G.def(""+Qe[ut])});var Pe=Fe.buffer,ct=Fe.type;G("if(",xe,"(",M,")){",Fe.isStream,"=true;",Pe,"=",Ue,".createStream(",Hs,",",M,");",ct,"=",Pe,".dtype;","}else{",Pe,"=",Ue,".getBuffer(",M,");","if(",Pe,"){",ct,"=",Pe,".dtype;",'}else if("constant" in ',M,"){",Fe.state,"=",Bm,";","if(typeof "+M+'.constant === "number"){',Fe[Gs[0]],"=",M,".constant;",Gs.slice(1).map(function(ut){return Fe[ut]}).join("="),"=0;","}else{",Gs.map(function(ut,lt){return Fe[ut]+"="+M+".constant.length>"+lt+"?"+M+".constant["+lt+"]:0;"}).join(""),"}}else{","if(",xe,"(",M,".buffer)){",Pe,"=",Ue,".createStream(",Hs,",",M,".buffer);","}else{",Pe,"=",Ue,".getBuffer(",M,".buffer);","}",ct,'="type" in ',M,"?",ee.glTypes,"[",M,".type]:",Pe,".dtype;",Fe.normalized,"=!!",M,".normalized;");function nt(ut){G(Fe[ut],"=",M,".",ut,"|0;")}return nt("size"),nt("offset"),nt("stride"),nt("divisor"),G("}}"),G.exit("if(",Fe.isStream,"){",Ue,".destroyStream(",Pe,");","}"),Fe}Q[H]=Tn(V,X)}),Q}function dr(D){var B=D.static,j=D.dynamic,Y={};return Object.keys(B).forEach(function(Q){var H=B[Q];Y[Q]=Rr(function(V,X){return typeof H=="number"||typeof H=="boolean"?""+H:V.link(H)})}),Object.keys(j).forEach(function(Q){var H=j[Q];Y[Q]=Tn(H,function(V,X){return V.invoke(X,H)})}),Y}function zr(D,B,j,Y,Q){var H=D.static,V=D.dynamic;S.optional(function(){var nt=[To,Tl,Al,Ao,ko,cd,Io,fd,Sl,kl].concat(bt);function ut(lt){Object.keys(lt).forEach(function(ft){S.command(nt.indexOf(ft)>=0,'unknown parameter "'+ft+'"',Q.commandStr)})}ut(H),ut(V)});var X=It(D,B),N=et(D,Q),G=Et(D,N,Q),M=_r(D,Q),J=$r(D,Q),ee=Vt(D,Q,X);function xe(nt){var ut=G[nt];ut&&(J[nt]=ut)}xe(ra),xe(st(ld));var Ue=Object.keys(J).length>0,Fe={framebuffer:N,draw:M,shader:ee,state:J,dirty:Ue,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Fe.profile=Ze(D,Q),Fe.uniforms=Ht(j,Q),Fe.drawVAO=Fe.scopeVAO=M.vao,!Fe.drawVAO&&ee.program&&!X&&F.angle_instanced_arrays&&M.static.elements){var Qe=!0,Pe=ee.program.attributes.map(function(nt){var ut=B.static[nt];return Qe=Qe&&!!ut,ut});if(Qe&&Pe.length>0){var ct=Ne.getVAO(Ne.createVAO({attributes:Pe,elements:M.static.elements}));Fe.drawVAO=new qr(null,null,null,function(nt,ut){return nt.link(ct)}),Fe.useVAO=!0}}return X?Fe.useVAO=!0:Fe.attributes=Pr(B,Q),Fe.context=dr(Y,Q),Fe}function Ur(D,B,j){var Y=D.shared,Q=Y.context,H=D.scope();Object.keys(j).forEach(function(V){B.save(Q,"."+V);var X=j[V],N=X.append(D,B);Array.isArray(N)?H(Q,".",V,"=[",N.join(),"];"):H(Q,".",V,"=",N,";")}),B(H)}function Fr(D,B,j,Y){var Q=D.shared,H=Q.gl,V=Q.framebuffer,X;tt&&(X=B.def(Q.extensions,".webgl_draw_buffers"));var N=D.constants,G=N.drawBuffer,M=N.backBuffer,J;j?J=j.append(D,B):J=B.def(V,".next"),Y||B("if(",J,"!==",V,".cur){"),B("if(",J,"){",H,".bindFramebuffer(",y2,",",J,".framebuffer);"),tt&&B(X,".drawBuffersWEBGL(",G,"[",J,".colorAttachments.length]);"),B("}else{",H,".bindFramebuffer(",y2,",null);"),tt&&B(X,".drawBuffersWEBGL(",M,");"),B("}",V,".cur=",J,";"),Y||B("}")}function Xr(D,B,j){var Y=D.shared,Q=Y.gl,H=D.current,V=D.next,X=Y.current,N=Y.next,G=D.cond(X,".dirty");bt.forEach(function(M){var J=st(M);if(!(J in j.state)){var ee,xe;if(J in V){ee=V[J],xe=H[J];var Ue=fn(Je[J].length,function(Qe){return G.def(ee,"[",Qe,"]")});G(D.cond(Ue.map(function(Qe,Pe){return Qe+"!=="+xe+"["+Pe+"]"}).join("||")).then(Q,".",ye[J],"(",Ue,");",Ue.map(function(Qe,Pe){return xe+"["+Pe+"]="+Qe}).join(";"),";"))}else{ee=G.def(N,".",J);var Fe=D.cond(ee,"!==",X,".",J);G(Fe),J in ve?Fe(D.cond(ee).then(Q,".enable(",ve[J],");").else(Q,".disable(",ve[J],");"),X,".",J,"=",ee,";"):Fe(Q,".",ye[J],"(",ee,");",X,".",J,"=",ee,";")}}}),Object.keys(j.state).length===0&&G(X,".dirty=false;"),B(G)}function Qr(D,B,j,Y){var Q=D.shared,H=D.current,V=Q.current,X=Q.gl;v2(Object.keys(j)).forEach(function(N){var G=j[N];if(!(Y&&!Y(G))){var M=G.append(D,B);if(ve[N]){var J=ve[N];Da(G)?M?B(X,".enable(",J,");"):B(X,".disable(",J,");"):B(D.cond(M).then(X,".enable(",J,");").else(X,".disable(",J,");")),B(V,".",N,"=",M,";")}else if(cr(M)){var ee=H[N];B(X,".",ye[N],"(",M,");",M.map(function(xe,Ue){return ee+"["+Ue+"]="+xe}).join(";"),";")}else B(X,".",ye[N],"(",M,");",V,".",N,"=",M,";")}})}function kr(D,B){Oe&&(D.instancing=B.def(D.shared.extensions,".angle_instanced_arrays"))}function zt(D,B,j,Y,Q){var H=D.shared,V=D.stats,X=H.current,N=H.timer,G=j.profile;function M(){return typeof performance>"u"?"Date.now()":"performance.now()"}var J,ee;function xe(nt){J=B.def(),nt(J,"=",M(),";"),typeof Q=="string"?nt(V,".count+=",Q,";"):nt(V,".count++;"),Ae&&(Y?(ee=B.def(),nt(ee,"=",N,".getNumPendingQueries();")):nt(N,".beginQuery(",V,");"))}function Ue(nt){nt(V,".cpuTime+=",M(),"-",J,";"),Ae&&(Y?nt(N,".pushScopeStats(",ee,",",N,".getNumPendingQueries(),",V,");"):nt(N,".endQuery();"))}function Fe(nt){var ut=B.def(X,".profile");B(X,".profile=",nt,";"),B.exit(X,".profile=",ut,";")}var Qe;if(G){if(Da(G)){G.enable?(xe(B),Ue(B.exit),Fe("true")):Fe("false");return}Qe=G.append(D,B),Fe(Qe)}else Qe=B.def(X,".profile");var Pe=D.block();xe(Pe),B("if(",Qe,"){",Pe,"}");var ct=D.block();Ue(ct),B.exit("if(",Qe,"){",ct,"}")}function Jr(D,B,j,Y,Q){var H=D.shared;function V(N){switch(N){case dd:case md:case bd:return 2;case pd:case gd:case wd:return 3;case hd:case yd:case vd:return 4;default:return 1}}function X(N,G,M){var J=H.gl,ee=B.def(N,".location"),xe=B.def(H.attributes,"[",ee,"]"),Ue=M.state,Fe=M.buffer,Qe=[M.x,M.y,M.z,M.w],Pe=["buffer","normalized","offset","stride"];function ct(){B("if(!",xe,".buffer){",J,".enableVertexAttribArray(",ee,");}");var ut=M.type,lt;if(M.size?lt=B.def(M.size,"||",G):lt=G,B("if(",xe,".type!==",ut,"||",xe,".size!==",lt,"||",Pe.map(function(St){return xe+"."+St+"!=="+M[St]}).join("||"),"){",J,".bindBuffer(",Hs,",",Fe,".buffer);",J,".vertexAttribPointer(",[ee,lt,ut,M.normalized,M.stride,M.offset],");",xe,".type=",ut,";",xe,".size=",lt,";",Pe.map(function(St){return xe+"."+St+"="+M[St]+";"}).join(""),"}"),Oe){var ft=M.divisor;B("if(",xe,".divisor!==",ft,"){",D.instancing,".vertexAttribDivisorANGLE(",[ee,ft],");",xe,".divisor=",ft,";}")}}function nt(){B("if(",xe,".buffer){",J,".disableVertexAttribArray(",ee,");",xe,".buffer=null;","}if(",Gs.map(function(ut,lt){return xe+"."+ut+"!=="+Qe[lt]}).join("||"),"){",J,".vertexAttrib4f(",ee,",",Qe,");",Gs.map(function(ut,lt){return xe+"."+ut+"="+Qe[lt]+";"}).join(""),"}")}Ue===js?ct():Ue===Bm?nt():(B("if(",Ue,"===",js,"){"),ct(),B("}else{"),nt(),B("}"))}Y.forEach(function(N){var G=N.name,M=j.attributes[G],J;if(M){if(!Q(M))return;J=M.append(D,B)}else{if(!Q(_2))return;var ee=D.scopeAttrib(G);S.optional(function(){D.assert(B,ee+".state","missing attribute "+G)}),J={},Object.keys(new Z).forEach(function(xe){J[xe]=B.def(ee,".",xe)})}X(D.link(N),V(N.info.type),J)})}function Jt(D,B,j,Y,Q,H){for(var V=D.shared,X=V.gl,N,G=0;G<Y.length;++G){var M=Y[G],J=M.name,ee=M.info.type,xe=j.uniforms[J],Ue=D.link(M),Fe=Ue+".location",Qe;if(xe){if(!Q(xe))continue;if(Da(xe)){var Pe=xe.value;if(S.command(Pe!==null&&typeof Pe<"u",'missing uniform "'+J+'"',D.commandStr),ee===Bl||ee===Rl){S.command(typeof Pe=="function"&&(ee===Bl&&(Pe._reglType==="texture2d"||Pe._reglType==="framebuffer")||ee===Rl&&(Pe._reglType==="textureCube"||Pe._reglType==="framebufferCube")),"invalid texture for uniform "+J,D.commandStr);var ct=D.link(Pe._texture||Pe.color[0]._texture);B(X,".uniform1i(",Fe,",",ct+".bind());"),B.exit(ct,".unbind();")}else if(ee===Il||ee===Cl||ee===Ol){S.optional(function(){S.command(cr(Pe),"invalid matrix for uniform "+J,D.commandStr),S.command(ee===Il&&Pe.length===4||ee===Cl&&Pe.length===9||ee===Ol&&Pe.length===16,"invalid length for matrix uniform "+J,D.commandStr)});var nt=D.global.def("new Float32Array(["+Array.prototype.slice.call(Pe)+"])"),ut=2;ee===Cl?ut=3:ee===Ol&&(ut=4),B(X,".uniformMatrix",ut,"fv(",Fe,",false,",nt,");")}else{switch(ee){case Km:S.commandType(Pe,"number","uniform "+J,D.commandStr),N="1f";break;case dd:S.command(cr(Pe)&&Pe.length===2,"uniform "+J,D.commandStr),N="2f";break;case pd:S.command(cr(Pe)&&Pe.length===3,"uniform "+J,D.commandStr),N="3f";break;case hd:S.command(cr(Pe)&&Pe.length===4,"uniform "+J,D.commandStr),N="4f";break;case Zm:S.commandType(Pe,"boolean","uniform "+J,D.commandStr),N="1i";break;case Ym:S.commandType(Pe,"number","uniform "+J,D.commandStr),N="1i";break;case bd:S.command(cr(Pe)&&Pe.length===2,"uniform "+J,D.commandStr),N="2i";break;case md:S.command(cr(Pe)&&Pe.length===2,"uniform "+J,D.commandStr),N="2i";break;case wd:S.command(cr(Pe)&&Pe.length===3,"uniform "+J,D.commandStr),N="3i";break;case gd:S.command(cr(Pe)&&Pe.length===3,"uniform "+J,D.commandStr),N="3i";break;case vd:S.command(cr(Pe)&&Pe.length===4,"uniform "+J,D.commandStr),N="4i";break;case yd:S.command(cr(Pe)&&Pe.length===4,"uniform "+J,D.commandStr),N="4i";break}B(X,".uniform",N,"(",Fe,",",cr(Pe)?Array.prototype.slice.call(Pe):Pe,");")}continue}else Qe=xe.append(D,B)}else{if(!Q(_2))continue;Qe=B.def(V.uniforms,"[",z.id(J),"]")}ee===Bl?(S(!Array.isArray(Qe),"must specify a scalar prop for textures"),B("if(",Qe,"&&",Qe,'._reglType==="framebuffer"){',Qe,"=",Qe,".color[0];","}")):ee===Rl&&(S(!Array.isArray(Qe),"must specify a scalar prop for cube maps"),B("if(",Qe,"&&",Qe,'._reglType==="framebufferCube"){',Qe,"=",Qe,".color[0];","}")),S.optional(function(){function dn(li,k2){D.assert(B,li,'bad data or missing for uniform "'+J+'".  '+k2)}function Di(li){S(!Array.isArray(Qe),"must not specify an array type for uniform"),dn("typeof "+Qe+'==="'+li+'"',"invalid type, expected "+li)}function Wn(li,k2){Array.isArray(Qe)?S(Qe.length===li,"must have length "+li):dn(V.isArrayLike+"("+Qe+")&&"+Qe+".length==="+li,"invalid vector, should have length "+li,D.commandStr)}function A2(li){S(!Array.isArray(Qe),"must not specify a value type"),dn("typeof "+Qe+'==="function"&&'+Qe+'._reglType==="texture'+(li===d2?"2d":"Cube")+'"',"invalid texture type",D.commandStr)}switch(ee){case Ym:Di("number");break;case md:Wn(2,"number");break;case gd:Wn(3,"number");break;case yd:Wn(4,"number");break;case Km:Di("number");break;case dd:Wn(2,"number");break;case pd:Wn(3,"number");break;case hd:Wn(4,"number");break;case Zm:Di("boolean");break;case bd:Wn(2,"boolean");break;case wd:Wn(3,"boolean");break;case vd:Wn(4,"boolean");break;case Il:Wn(4,"number");break;case Cl:Wn(9,"number");break;case Ol:Wn(16,"number");break;case Bl:A2(d2);break;case Rl:A2(sB);break}});var lt=1;switch(ee){case Bl:case Rl:var ft=B.def(Qe,"._texture");B(X,".uniform1i(",Fe,",",ft,".bind());"),B.exit(ft,".unbind();");continue;case Ym:case Zm:N="1i";break;case md:case bd:N="2i",lt=2;break;case gd:case wd:N="3i",lt=3;break;case yd:case vd:N="4i",lt=4;break;case Km:N="1f";break;case dd:N="2f",lt=2;break;case pd:N="3f",lt=3;break;case hd:N="4f",lt=4;break;case Il:N="Matrix2fv";break;case Cl:N="Matrix3fv";break;case Ol:N="Matrix4fv";break}if(N.charAt(0)==="M"){B(X,".uniform",N,"(",Fe,",");var St=Math.pow(ee-Il+2,2),lr=D.global.def("new Float32Array(",St,")");Array.isArray(Qe)?B("false,(",fn(St,function(dn){return lr+"["+dn+"]="+Qe[dn]}),",",lr,")"):B("false,(Array.isArray(",Qe,")||",Qe," instanceof Float32Array)?",Qe,":(",fn(St,function(dn){return lr+"["+dn+"]="+Qe+"["+dn+"]"}),",",lr,")"),B(");")}else if(lt>1){for(var Kr=[],na=[],ia=0;ia<lt;++ia)Array.isArray(Qe)?na.push(Qe[ia]):na.push(B.def(Qe+"["+ia+"]")),H&&Kr.push(B.def());H&&B("if(!",D.batchId,"||",Kr.map(function(dn,Di){return dn+"!=="+na[Di]}).join("||"),"){",Kr.map(function(dn,Di){return dn+"="+na[Di]+";"}).join("")),B(X,".uniform",N,"(",Fe,",",na.join(","),");"),H&&B("}")}else{if(S(!Array.isArray(Qe),"uniform value must not be an array"),H){var aa=B.def();B("if(!",D.batchId,"||",aa,"!==",Qe,"){",aa,"=",Qe,";")}B(X,".uniform",N,"(",Fe,",",Qe,");"),H&&B("}")}}}function xt(D,B,j,Y){var Q=D.shared,H=Q.gl,V=Q.draw,X=Y.draw;function N(){var lt=X.elements,ft,St=B;return lt?((lt.contextDep&&Y.contextDynamic||lt.propDep)&&(St=j),ft=lt.append(D,St),X.elementsActive&&St("if("+ft+")"+H+".bindBuffer("+Xm+","+ft+".buffer.buffer);")):(ft=St.def(),St(ft,"=",V,".",Ao,";","if(",ft,"){",H,".bindBuffer(",Xm,",",ft,".buffer.buffer);}","else if(",Q.vao,".currentVAO){",ft,"=",D.shared.elements+".getElements("+Q.vao,".currentVAO.elements);",Ee?"":"if("+ft+")"+H+".bindBuffer("+Xm+","+ft+".buffer.buffer);","}")),ft}function G(){var lt=X.count,ft,St=B;return lt?((lt.contextDep&&Y.contextDynamic||lt.propDep)&&(St=j),ft=lt.append(D,St),S.optional(function(){lt.MISSING&&D.assert(B,"false","missing vertex count"),lt.DYNAMIC&&D.assert(St,ft+">=0","missing vertex count")})):(ft=St.def(V,".",Io),S.optional(function(){D.assert(St,ft+">=0","missing vertex count")})),ft}var M=N();function J(lt){var ft=X[lt];return ft?ft.contextDep&&Y.contextDynamic||ft.propDep?ft.append(D,j):ft.append(D,B):B.def(V,".",lt)}var ee=J(ko),xe=J(cd),Ue=G();if(typeof Ue=="number"){if(Ue===0)return}else j("if(",Ue,"){"),j.exit("}");var Fe,Qe;Oe&&(Fe=J(fd),Qe=D.instancing);var Pe=M+".type",ct=X.elements&&Da(X.elements)&&!X.vaoActive;function nt(){function lt(){j(Qe,".drawElementsInstancedANGLE(",[ee,Ue,Pe,xe+"<<(("+Pe+"-"+Ww+")>>1)",Fe],");")}function ft(){j(Qe,".drawArraysInstancedANGLE(",[ee,xe,Ue,Fe],");")}M&&M!=="null"?ct?lt():(j("if(",M,"){"),lt(),j("}else{"),ft(),j("}")):ft()}function ut(){function lt(){j(H+".drawElements("+[ee,Ue,Pe,xe+"<<(("+Pe+"-"+Ww+")>>1)"]+");")}function ft(){j(H+".drawArrays("+[ee,xe,Ue]+");")}M&&M!=="null"?ct?lt():(j("if(",M,"){"),lt(),j("}else{"),ft(),j("}")):ft()}Oe&&(typeof Fe!="number"||Fe>=0)?typeof Fe=="string"?(j("if(",Fe,">0){"),nt(),j("}else if(",Fe,"<0){"),ut(),j("}")):nt():ut()}function Wt(D,B,j,Y,Q){var H=At(),V=H.proc("body",Q);return S.optional(function(){H.commandStr=B.commandStr,H.command=H.link(B.commandStr)}),Oe&&(H.instancing=V.def(H.shared.extensions,".angle_instanced_arrays")),D(H,V,j,Y),H.compile().body}function Yt(D,B,j,Y){kr(D,B),j.useVAO?j.drawVAO?B(D.shared.vao,".setVAO(",j.drawVAO.append(D,B),");"):B(D.shared.vao,".setVAO(",D.shared.vao,".targetVAO);"):(B(D.shared.vao,".setVAO(null);"),Jr(D,B,j,Y.attributes,function(){return!0})),Jt(D,B,j,Y.uniforms,function(){return!0},!1),xt(D,B,B,j)}function Ir(D,B){var j=D.proc("draw",1);kr(D,j),Ur(D,j,B.context),Fr(D,j,B.framebuffer),Xr(D,j,B),Qr(D,j,B.state),zt(D,j,B,!1,!0);var Y=B.shader.progVar.append(D,j);if(j(D.shared.gl,".useProgram(",Y,".program);"),B.shader.program)Yt(D,j,B,B.shader.program);else{j(D.shared.vao,".setVAO(null);");var Q=D.global.def("{}"),H=j.def(Y,".id"),V=j.def(Q,"[",H,"]");j(D.cond(V).then(V,".call(this,a0);").else(V,"=",Q,"[",H,"]=",D.link(function(X){return Wt(Yt,D,B,X,1)}),"(",Y,");",V,".call(this,a0);"))}Object.keys(B.state).length>0&&j(D.shared.current,".dirty=true;"),D.shared.vao&&j(D.shared.vao,".setVAO(null);")}function Li(D,B,j,Y){D.batchId="a1",kr(D,B);function Q(){return!0}Jr(D,B,j,Y.attributes,Q),Jt(D,B,j,Y.uniforms,Q,!1),xt(D,B,B,j)}function Oo(D,B,j,Y){kr(D,B);var Q=j.contextDep,H=B.def(),V="a0",X="a1",N=B.def();D.shared.props=N,D.batchId=H;var G=D.scope(),M=D.scope();B(G.entry,"for(",H,"=0;",H,"<",X,";++",H,"){",N,"=",V,"[",H,"];",M,"}",G.exit);function J(Pe){return Pe.contextDep&&Q||Pe.propDep}function ee(Pe){return!J(Pe)}if(j.needsContext&&Ur(D,M,j.context),j.needsFramebuffer&&Fr(D,M,j.framebuffer),Qr(D,M,j.state,J),j.profile&&J(j.profile)&&zt(D,M,j,!1,!0),Y)j.useVAO?j.drawVAO?J(j.drawVAO)?M(D.shared.vao,".setVAO(",j.drawVAO.append(D,M),");"):G(D.shared.vao,".setVAO(",j.drawVAO.append(D,G),");"):G(D.shared.vao,".setVAO(",D.shared.vao,".targetVAO);"):(G(D.shared.vao,".setVAO(null);"),Jr(D,G,j,Y.attributes,ee),Jr(D,M,j,Y.attributes,J)),Jt(D,G,j,Y.uniforms,ee,!1),Jt(D,M,j,Y.uniforms,J,!0),xt(D,G,M,j);else{var xe=D.global.def("{}"),Ue=j.shader.progVar.append(D,M),Fe=M.def(Ue,".id"),Qe=M.def(xe,"[",Fe,"]");M(D.shared.gl,".useProgram(",Ue,".program);","if(!",Qe,"){",Qe,"=",xe,"[",Fe,"]=",D.link(function(Pe){return Wt(Li,D,j,Pe,2)}),"(",Ue,");}",Qe,".call(this,a0[",H,"],",H,");")}}function U(D,B){var j=D.proc("batch",2);D.batchId="0",kr(D,j);var Y=!1,Q=!0;Object.keys(B.context).forEach(function(xe){Y=Y||B.context[xe].propDep}),Y||(Ur(D,j,B.context),Q=!1);var H=B.framebuffer,V=!1;H?(H.propDep?Y=V=!0:H.contextDep&&Y&&(V=!0),V||Fr(D,j,H)):Fr(D,j,null),B.state.viewport&&B.state.viewport.propDep&&(Y=!0);function X(xe){return xe.contextDep&&Y||xe.propDep}Xr(D,j,B),Qr(D,j,B.state,function(xe){return!X(xe)}),(!B.profile||!X(B.profile))&&zt(D,j,B,!1,"a1"),B.contextDep=Y,B.needsContext=Q,B.needsFramebuffer=V;var N=B.shader.progVar;if(N.contextDep&&Y||N.propDep)Oo(D,j,B,null);else{var G=N.append(D,j);if(j(D.shared.gl,".useProgram(",G,".program);"),B.shader.program)Oo(D,j,B,B.shader.program);else{j(D.shared.vao,".setVAO(null);");var M=D.global.def("{}"),J=j.def(G,".id"),ee=j.def(M,"[",J,"]");j(D.cond(ee).then(ee,".call(this,a0,a1);").else(ee,"=",M,"[",J,"]=",D.link(function(xe){return Wt(Oo,D,B,xe,2)}),"(",G,");",ee,".call(this,a0,a1);"))}}Object.keys(B.state).length>0&&j(D.shared.current,".dirty=true;"),D.shared.vao&&j(D.shared.vao,".setVAO(null);")}function ue(D,B){var j=D.proc("scope",3);D.batchId="a2";var Y=D.shared,Q=Y.current;Ur(D,j,B.context),B.framebuffer&&B.framebuffer.append(D,j),v2(Object.keys(B.state)).forEach(function(V){var X=B.state[V],N=X.append(D,j);cr(N)?N.forEach(function(G,M){j.set(D.next[V],"["+M+"]",G)}):j.set(Y.next,"."+V,N)}),zt(D,j,B,!0,!0),[Ao,cd,Io,fd,ko].forEach(function(V){var X=B.draw[V];X&&j.set(Y.draw,"."+V,""+X.append(D,j))}),Object.keys(B.uniforms).forEach(function(V){var X=B.uniforms[V].append(D,j);Array.isArray(X)&&(X="["+X.join()+"]"),j.set(Y.uniforms,"["+z.id(V)+"]",X)}),Object.keys(B.attributes).forEach(function(V){var X=B.attributes[V].append(D,j),N=D.scopeAttrib(V);Object.keys(new Z).forEach(function(G){j.set(N,"."+G,X[G])})}),B.scopeVAO&&j.set(Y.vao,".targetVAO",B.scopeVAO.append(D,j));function H(V){var X=B.shader[V];X&&j.set(Y.shader,"."+V,X.append(D,j))}H(Tl),H(Al),Object.keys(B.state).length>0&&(j(Q,".dirty=true;"),j.exit(Q,".dirty=true;")),j("a1(",D.shared.context,",a0,",D.batchId,");")}function re(D){if(!(typeof D!="object"||cr(D))){for(var B=Object.keys(D),j=0;j<B.length;++j)if(Mr.isDynamic(D[B[j]]))return!0;return!1}}function ot(D,B,j){var Y=B.static[j];if(!Y||!re(Y))return;var Q=D.global,H=Object.keys(Y),V=!1,X=!1,N=!1,G=D.global.def("{}");H.forEach(function(J){var ee=Y[J];if(Mr.isDynamic(ee)){typeof ee=="function"&&(ee=Y[J]=Mr.unbox(ee));var xe=Tn(ee,null);V=V||xe.thisDep,N=N||xe.propDep,X=X||xe.contextDep}else{switch(Q(G,".",J,"="),typeof ee){case"number":Q(ee);break;case"string":Q('"',ee,'"');break;case"object":Array.isArray(ee)&&Q("[",ee.join(),"]");break;default:Q(D.link(ee));break}Q(";")}});function M(J,ee){H.forEach(function(xe){var Ue=Y[xe];if(Mr.isDynamic(Ue)){var Fe=J.invoke(ee,Ue);ee(G,".",xe,"=",Fe,";")}})}B.dynamic[j]=new Mr.DynamicVariable(ud,{thisDep:V,contextDep:X,propDep:N,ref:G,append:M}),delete B.static[j]}function Gt(D,B,j,Y,Q){var H=At();H.stats=H.link(Q),Object.keys(B.static).forEach(function(X){ot(H,B,X)}),iB.forEach(function(X){ot(H,D,X)});var V=zr(D,B,j,Y,H);return Ir(H,V),ue(H,V),U(H,V),t(H.compile(),{destroy:function(){V.shader.program.destroy()}})}return{next:Ye,current:Je,procs:function(){var D=At(),B=D.proc("poll"),j=D.proc("refresh"),Y=D.block();B(Y),j(Y);var Q=D.shared,H=Q.gl,V=Q.next,X=Q.current;Y(X,".dirty=false;"),Fr(D,B),Fr(D,j,null,!0);var N;Oe&&(N=D.link(Oe)),F.oes_vertex_array_object&&j(D.link(F.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var G=0;G<se.maxAttributes;++G){var M=j.def(Q.attributes,"[",G,"]"),J=D.cond(M,".buffer");J.then(H,".enableVertexAttribArray(",G,");",H,".bindBuffer(",Hs,",",M,".buffer.buffer);",H,".vertexAttribPointer(",G,",",M,".size,",M,".type,",M,".normalized,",M,".stride,",M,".offset);").else(H,".disableVertexAttribArray(",G,");",H,".vertexAttrib4f(",G,",",M,".x,",M,".y,",M,".z,",M,".w);",M,".buffer=null;"),j(J),Oe&&j(N,".vertexAttribDivisorANGLE(",G,",",M,".divisor);")}return j(D.shared.vao,".currentVAO=null;",D.shared.vao,".setVAO(",D.shared.vao,".targetVAO);"),Object.keys(ve).forEach(function(ee){var xe=ve[ee],Ue=Y.def(V,".",ee),Fe=D.block();Fe("if(",Ue,"){",H,".enable(",xe,")}else{",H,".disable(",xe,")}",X,".",ee,"=",Ue,";"),j(Fe),B("if(",Ue,"!==",X,".",ee,"){",Fe,"}")}),Object.keys(ye).forEach(function(ee){var xe=ye[ee],Ue=Je[ee],Fe,Qe,Pe=D.block();if(Pe(H,".",xe,"("),cr(Ue)){var ct=Ue.length;Fe=D.global.def(V,".",ee),Qe=D.global.def(X,".",ee),Pe(fn(ct,function(nt){return Fe+"["+nt+"]"}),");",fn(ct,function(nt){return Qe+"["+nt+"]="+Fe+"["+nt+"];"}).join("")),B("if(",fn(ct,function(nt){return Fe+"["+nt+"]!=="+Qe+"["+nt+"]"}).join("||"),"){",Pe,"}")}else Fe=Y.def(V,".",ee),Qe=Y.def(X,".",ee),Pe(Fe,");",X,".",ee,"=",Fe,";"),B("if(",Fe,"!==",Qe,"){",Pe,"}");j(Pe)}),D.compile()}(),compile:Gt}}function $B(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var EB=34918,SB=34919,x2=35007,TB=function(_,z){if(!z.ext_disjoint_timer_query)return null;var F=[];function se(){return F.pop()||z.ext_disjoint_timer_query.createQueryEXT()}function be(Oe){F.push(Oe)}var oe=[];function de(Oe){var tt=se();z.ext_disjoint_timer_query.beginQueryEXT(x2,tt),oe.push(tt),Ae(oe.length-1,oe.length,Oe)}function Te(){z.ext_disjoint_timer_query.endQueryEXT(x2)}function Se(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Ne=[];function De(){return Ne.pop()||new Se}function Le(Oe){Ne.push(Oe)}var je=[];function Ae(Oe,tt,Ee){var Je=De();Je.startQueryIndex=Oe,Je.endQueryIndex=tt,Je.sum=0,Je.stats=Ee,je.push(Je)}var Be=[],Z=[];function le(){var Oe,tt,Ee=oe.length;if(Ee!==0){Z.length=Math.max(Z.length,Ee+1),Be.length=Math.max(Be.length,Ee+1),Be[0]=0,Z[0]=0;var Je=0;for(Oe=0,tt=0;tt<oe.length;++tt){var Ye=oe[tt];z.ext_disjoint_timer_query.getQueryObjectEXT(Ye,SB)?(Je+=z.ext_disjoint_timer_query.getQueryObjectEXT(Ye,EB),be(Ye)):oe[Oe++]=Ye,Be[tt+1]=Je,Z[tt+1]=Oe}for(oe.length=Oe,Oe=0,tt=0;tt<je.length;++tt){var bt=je[tt],ve=bt.startQueryIndex,ye=bt.endQueryIndex;bt.sum+=Be[ye]-Be[ve];var st=Z[ve],Ve=Z[ye];Ve===st?(bt.stats.gpuTime+=bt.sum/1e6,Le(bt)):(bt.startQueryIndex=st,bt.endQueryIndex=Ve,je[Oe++]=bt)}je.length=Oe}}return{beginQuery:de,endQuery:Te,pushScopeStats:Ae,update:le,getNumPendingQueries:function(){return oe.length},clear:function(){F.push.apply(F,oe);for(var Oe=0;Oe<F.length;Oe++)z.ext_disjoint_timer_query.deleteQueryEXT(F[Oe]);oe.length=0,F.length=0},restore:function(){oe.length=0,F.length=0}}},AB=16384,kB=256,IB=1024,CB=34962,$2="webglcontextlost",E2="webglcontextrestored",S2=1,OB=2,BB=3;function T2(_,z){for(var F=0;F<_.length;++F)if(_[F]===z)return F;return-1}function RB(_){var z=cf(_);if(!z)return null;var F=z.gl,se=F.getContextAttributes(),be=F.isContextLost(),oe=ff(F,z);if(!oe)return null;var de=vs(),Te=$B(),Se=oe.extensions,Ne=TB(F,Se),De=yn(),Le=F.drawingBufferWidth,je=F.drawingBufferHeight,Ae={tick:0,time:0,viewportWidth:Le,viewportHeight:je,framebufferWidth:Le,framebufferHeight:je,drawingBufferWidth:Le,drawingBufferHeight:je,pixelRatio:z.pixelRatio},Be={},Z={elements:null,primitive:4,count:-1,offset:0,instances:-1},le=um(F,Se),Oe=hm(F,Te,z,Je),tt=Uf(F,Se,Oe,Te),Ee=qO(F,Se,le,Te,Oe,tt,Z);function Je(xt){return Ee.destroyBuffer(xt)}var Ye=ZO(F,de,Te,z),bt=EO(F,Se,le,function(){st.procs.poll()},Ae,Te,z),ve=SO(F,Se,le,Te,z),ye=WO(F,Se,le,bt,ve,Te),st=xB(F,de,Se,le,Oe,tt,bt,ye,Be,Ee,Ye,Z,Ae,Ne,z),Ve=eB(F,ye,st.procs.poll,Ae,se,Se,le),Ie=st.next,Xe=F.canvas,Ke=[],Ot=[],At=[],Ze=[z.onDestroy],et=null;function Et(){if(Ke.length===0){Ne&&Ne.update(),et=null;return}et=Br.next(Et),Qr();for(var xt=Ke.length-1;xt>=0;--xt){var Wt=Ke[xt];Wt&&Wt(Ae,null,0)}F.flush(),Ne&&Ne.update()}function It(){!et&&Ke.length>0&&(et=Br.next(Et))}function Vt(){et&&(Br.cancel(Et),et=null)}function _r(xt){xt.preventDefault(),be=!0,Vt(),Ot.forEach(function(Wt){Wt()})}function $r(xt){F.getError(),be=!1,oe.restore(),Ye.restore(),Oe.restore(),bt.restore(),ve.restore(),ye.restore(),Ee.restore(),Ne&&Ne.restore(),st.procs.refresh(),It(),At.forEach(function(Wt){Wt()})}Xe&&(Xe.addEventListener($2,_r,!1),Xe.addEventListener(E2,$r,!1));function Ht(){Ke.length=0,Vt(),Xe&&(Xe.removeEventListener($2,_r),Xe.removeEventListener(E2,$r)),Ye.clear(),ye.clear(),ve.clear(),Ee.clear(),bt.clear(),tt.clear(),Oe.clear(),Ne&&Ne.clear(),Ze.forEach(function(xt){xt()})}function Pr(xt){S(!!xt,"invalid args to regl({...})"),S.type(xt,"object","invalid args to regl({...})");function Wt(Q){var H=t({},Q);delete H.uniforms,delete H.attributes,delete H.context,delete H.vao,"stencil"in H&&H.stencil.op&&(H.stencil.opBack=H.stencil.opFront=H.stencil.op,delete H.stencil.op);function V(X){if(X in H){var N=H[X];delete H[X],Object.keys(N).forEach(function(G){H[X+"."+G]=N[G]})}}return V("blend"),V("depth"),V("cull"),V("stencil"),V("polygonOffset"),V("scissor"),V("sample"),"vao"in Q&&(H.vao=Q.vao),H}function Yt(Q,H){var V={},X={};return Object.keys(Q).forEach(function(N){var G=Q[N];if(Mr.isDynamic(G)){X[N]=Mr.unbox(G,N);return}else if(H&&Array.isArray(G)){for(var M=0;M<G.length;++M)if(Mr.isDynamic(G[M])){X[N]=Mr.unbox(G,N);return}}V[N]=G}),{dynamic:X,static:V}}var Ir=Yt(xt.context||{},!0),Li=Yt(xt.uniforms||{},!0),Oo=Yt(xt.attributes||{},!1),U=Yt(Wt(xt),!1),ue={gpuTime:0,cpuTime:0,count:0},re=st.compile(U,Oo,Li,Ir,ue),ot=re.draw,Gt=re.batch,D=re.scope,B=[];function j(Q){for(;B.length<Q;)B.push(null);return B}function Y(Q,H){var V;if(be&&S.raise("context lost"),typeof Q=="function")return D.call(this,null,Q,0);if(typeof H=="function")if(typeof Q=="number")for(V=0;V<Q;++V)D.call(this,null,H,V);else if(Array.isArray(Q))for(V=0;V<Q.length;++V)D.call(this,Q[V],H,V);else return D.call(this,Q,H,0);else if(typeof Q=="number"){if(Q>0)return Gt.call(this,j(Q|0),Q|0)}else if(Array.isArray(Q)){if(Q.length)return Gt.call(this,Q,Q.length)}else return ot.call(this,Q)}return t(Y,{stats:ue,destroy:function(){re.destroy()}})}var dr=ye.setFBO=Pr({framebuffer:Mr.define.call(null,S2,"framebuffer")});function zr(xt,Wt){var Yt=0;st.procs.poll();var Ir=Wt.color;Ir&&(F.clearColor(+Ir[0]||0,+Ir[1]||0,+Ir[2]||0,+Ir[3]||0),Yt|=AB),"depth"in Wt&&(F.clearDepth(+Wt.depth),Yt|=kB),"stencil"in Wt&&(F.clearStencil(Wt.stencil|0),Yt|=IB),S(!!Yt,"called regl.clear with no buffer specified"),F.clear(Yt)}function Ur(xt){if(S(typeof xt=="object"&&xt,"regl.clear() takes an object as input"),"framebuffer"in xt)if(xt.framebuffer&&xt.framebuffer_reglType==="framebufferCube")for(var Wt=0;Wt<6;++Wt)dr(t({framebuffer:xt.framebuffer.faces[Wt]},xt),zr);else dr(xt,zr);else zr(null,xt)}function Fr(xt){S.type(xt,"function","regl.frame() callback must be a function"),Ke.push(xt);function Wt(){var Yt=T2(Ke,xt);S(Yt>=0,"cannot cancel a frame twice");function Ir(){var Li=T2(Ke,Ir);Ke[Li]=Ke[Ke.length-1],Ke.length-=1,Ke.length<=0&&Vt()}Ke[Yt]=Ir}return It(),{cancel:Wt}}function Xr(){var xt=Ie.viewport,Wt=Ie.scissor_box;xt[0]=xt[1]=Wt[0]=Wt[1]=0,Ae.viewportWidth=Ae.framebufferWidth=Ae.drawingBufferWidth=xt[2]=Wt[2]=F.drawingBufferWidth,Ae.viewportHeight=Ae.framebufferHeight=Ae.drawingBufferHeight=xt[3]=Wt[3]=F.drawingBufferHeight}function Qr(){Ae.tick+=1,Ae.time=zt(),Xr(),st.procs.poll()}function kr(){bt.refresh(),Xr(),st.procs.refresh(),Ne&&Ne.update()}function zt(){return(yn()-De)/1e3}kr();function Jr(xt,Wt){S.type(Wt,"function","listener callback must be a function");var Yt;switch(xt){case"frame":return Fr(Wt);case"lost":Yt=Ot;break;case"restore":Yt=At;break;case"destroy":Yt=Ze;break;default:S.raise("invalid event, must be one of frame,lost,restore,destroy")}return Yt.push(Wt),{cancel:function(){for(var Ir=0;Ir<Yt.length;++Ir)if(Yt[Ir]===Wt){Yt[Ir]=Yt[Yt.length-1],Yt.pop();return}}}}var Jt=t(Pr,{clear:Ur,prop:Mr.define.bind(null,S2),context:Mr.define.bind(null,OB),this:Mr.define.bind(null,BB),draw:Pr({}),buffer:function(xt){return Oe.create(xt,CB,!1,!1)},elements:function(xt){return tt.create(xt,!1)},texture:bt.create2D,cube:bt.createCube,renderbuffer:ve.create,framebuffer:ye.create,framebufferCube:ye.createCube,vao:Ee.createVAO,attributes:se,frame:Fr,on:Jr,limits:le,hasExtension:function(xt){return le.extensions.indexOf(xt.toLowerCase())>=0},read:Ve,destroy:Ht,_gl:F,_refresh:kr,poll:function(){Qr(),Ne&&Ne.update()},now:zt,stats:Te});return z.onDone(null,Jt),Jt}return RB})});var LC={};I2(LC,{InferenceSession:()=>Tb,TRACE:()=>qc,TRACE_FUNC_BEGIN:()=>Ti,TRACE_FUNC_END:()=>ri,Tensor:()=>Si,default:()=>wW,env:()=>vr,registerBackend:()=>fs});var Eb,e9,t9,r9,n9,We,Hu,i9,Hc,Cc,to,fs,_T,J6,ek,a9,tk,o9,u1,ti,rk,vr,s9,nk,ik,u9,dh,ak,ok,sk,uk,lk,l9,us,Fc,l1,ck,c9,fk,dk,f9,Ln,Sb,Si,pk,qc,c1,Ti,ri,hk,mk,d9,Tb,p9,h9,m9,g9,y9,yk,Ai,Ab,bk,f1,d1,wk,b9,vk,p1,h1,_k,xT,w9,m1,ub,$T,Nn,xk,ph,ET,ST,g1,TT,y1,$k,b1,Ek,kb,w1,hh,Oc,v1,AT,kT,IT,Ib,gr,ms,Ei,Ah,ur,Cb,Sk,v9,CT,OT,BT,Bc,RT,Tk,_9,ls,va,cs,zh,kh,Ob,Bb,lb,Ct,Rb,Ak,zT,NT,LT,DT,zb,MT,Qt,_a,PT,Vu,me,Ih,kk,Ik,Ck,Ft,Nb,Ok,_1,cb,x1,UT,$1,FT,E1,S1,T1,GT,Bk,x9,Rc,jT,Rk,$9,Lb,A1,mh,gh,VT,WT,k1,fb,HT,zk,E9,qT,ar,Or,Wu,yh,Yr,mn,$t,Tr,db,ju,io,_t,zc,$e,wt,Nk,Db,XT,Lk,jt,KT,I1,YT,ZT,QT,JT,Dn,Dk,Mk,ao,eA,tA,rA,nA,iA,aA,oA,sA,uA,lA,wi,Pk,Uk,Fk,Gk,jk,Vk,Wk,Hk,qk,Xk,S9,vi,cA,Ch,pb,_i,fA,dA,pA,hA,mA,gA,yA,bA,wA,vA,xi,Kk,Yk,Zk,Qk,Jk,eI,tI,rI,nI,iI,Mb,C1,aI,oI,hb,T9,_A,bh,xA,$A,EA,Xc,SA,sI,Pb,TA,AA,kA,uI,A9,IA,CA,lI,k9,OA,nr,cI,fI,dI,pI,hI,mI,gI,yI,bI,BA,wI,vI,_I,xI,jc,$I,Th,EI,SI,TI,AI,kI,II,CI,OI,BI,RI,zI,NI,LI,DI,MI,PI,O1,UI,mb,gb,FI,GI,jI,RA,zA,VI,Ub,NA,LA,WI,I9,DA,MA,$i,HI,qI,XI,KI,YI,ZI,QI,JI,e5,t5,C9,PA,UA,FA,GA,r5,n5,O9,ds,ps,hs,Fb,gs,nn,i5,Gb,a5,B9,Wc,jb,Vb,jA,VA,yb,B1,WA,bb,HA,Oh,Wb,qA,o5,R9,XA,R1,Nc,KA,z1,YA,s5,u5,z9,l5,c5,N9,ZA,wh,QA,vh,wb,N1,JA,e4,vb,L9,f5,D9,t4,r4,n4,L1,d5,i4,D1,a4,p5,M9,o4,h5,m5,P9,s4,u4,l4,g5,y5,U9,_h,Lc,M1,c4,f4,d4,p4,P1,h4,b5,w5,F9,m4,U1,g4,y4,v5,G9,b4,_5,j9,w4,v4,x5,$5,V9,_4,E5,S5,W9,x4,$4,T5,A5,H9,E4,S4,k5,I5,q9,T4,A4,C5,O5,X9,Zi,wa,is,as,k4,I4,C4,O4,B4,R4,z4,N4,B5,R5,K9,En,L4,z5,F1,D4,Vc,N5,L5,M4,P4,U4,F4,_b,D5,M5,P5,G4,Bh,U5,F5,j4,V4,G1,W4,G5,Y9,j1,H4,q4,j5,Z9,X4,K4,V5,Q9,Y4,W5,J9,Z4,Q4,J4,H5,q5,eW,e6,t6,r6,n6,i6,a6,o6,s6,X5,tW,Dc,V1,W1,H1,q1,u6,l6,X1,K1,K5,Y5,Y1,Z5,Q5,Z1,J5,eC,tC,rC,rW,c6,f6,nC,iC,nW,d6,p6,aC,iW,h6,Q1,J1,m6,oC,sC,aW,g6,y6,b6,eb,w6,v6,_6,x6,$6,E6,S6,T6,tb,A6,k6,I6,C6,O6,uC,lC,oW,B6,R6,cC,sW,z6,Mc,N6,rb,L6,D6,fC,dC,uW,M6,P6,pC,hC,lW,nb,U6,F6,G6,mC,cW,j6,V6,gC,fW,yC,dW,bC,pW,wC,W6,H6,q6,vC,hW,_C,xh,X6,xC,mW,K6,Hb,qb,ro,Y6,ib,Rh,Xb,Kb,ab,Yb,Zb,Qb,EC,no,ei,Gu,Pc,Uc,$h,ob,Eh,os,ss,Z6,SC,TC,AC,kC,IC,CC,OC,BC,sb,Q6,RC,gW,zC,xb,$b,NC,yW,bW,wW,DC=tg(()=>{Eb=Object.defineProperty,e9=Object.getOwnPropertyDescriptor,t9=Object.getOwnPropertyNames,r9=Object.prototype.hasOwnProperty,n9=(e=>typeof Bo<"u"?Bo:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof Bo<"u"?Bo:t)[r]}):e)(function(e){if(typeof Bo<"u")return Bo.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),We=(e,t)=>()=>(e&&(t=e(e=0)),t),Hu=(e,t)=>{for(var r in t)Eb(e,r,{get:t[r],enumerable:!0})},i9=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of t9(t))!r9.call(e,i)&&i!==r&&Eb(e,i,{get:()=>t[i],enumerable:!(n=e9(t,i))||n.enumerable});return e},Hc=e=>i9(Eb({},"__esModule",{value:!0}),e),ek=We(()=>{"use strict";Cc=new Map,to=[],fs=(e,t,r)=>{if(t&&typeof t.init=="function"&&typeof t.createInferenceSessionHandler=="function"){let n=Cc.get(e);if(n===void 0)Cc.set(e,{backend:t,priority:r});else{if(n.priority>r)return;if(n.priority===r&&n.backend!==t)throw new Error(`cannot register backend "${e}" using priority ${r}`)}if(r>=0){let i=to.indexOf(e);i!==-1&&to.splice(i,1);for(let a=0;a<to.length;a++)if(Cc.get(to[a]).priority<=r){to.splice(a,0,e);return}to.push(e)}return}throw new TypeError("not a valid backend")},_T=async e=>{let t=Cc.get(e);if(!t)return"backend not found.";if(t.initialized)return t.backend;if(t.aborted)return t.error;{let r=!!t.initPromise;try{return r||(t.initPromise=t.backend.init(e)),await t.initPromise,t.initialized=!0,t.backend}catch(n){return r||(t.error=`${n}`,t.aborted=!0),t.error}finally{delete t.initPromise}}},J6=async e=>{let t=e.executionProviders||[],r=t.map(u=>typeof u=="string"?u:u.name),n=r.length===0?to:r,i,a=[],o=new Set;for(let u of n){let l=await _T(u);typeof l=="string"?a.push({name:u,err:l}):(i||(i=l),i===l&&o.add(u))}if(!i)throw new Error(`no available backend found. ERR: ${a.map(u=>`[${u.name}] ${u.err}`).join(", ")}`);for(let{name:u,err:l}of a)r.includes(u)&&console.warn(`removing requested execution provider "${u}" from session options because it is not available: ${l}`);let s=t.filter(u=>o.has(typeof u=="string"?u:u.name));return[i,new Proxy(e,{get:(u,l)=>l==="executionProviders"?s:Reflect.get(u,l)})]}}),a9=We(()=>{"use strict";ek()}),o9=We(()=>{"use strict";tk="1.22.0"}),rk=We(()=>{"use strict";o9(),u1="warning",ti={wasm:{},webgl:{},webgpu:{},versions:{common:tk},set logLevel(e){if(e!==void 0){if(typeof e!="string"||["verbose","info","warning","error","fatal"].indexOf(e)===-1)throw new Error(`Unsupported logging level: ${e}`);u1=e}},get logLevel(){return u1}},Object.defineProperty(ti,"logLevel",{enumerable:!0})}),s9=We(()=>{"use strict";rk(),vr=ti}),u9=We(()=>{"use strict";nk=(e,t)=>{let r=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);r.width=e.dims[3],r.height=e.dims[2];let n=r.getContext("2d");if(n!=null){let i,a;t?.tensorLayout!==void 0&&t.tensorLayout==="NHWC"?(i=e.dims[2],a=e.dims[3]):(i=e.dims[3],a=e.dims[2]);let o=t?.format!==void 0?t.format:"RGB",s=t?.norm,u,l;s===void 0||s.mean===void 0?u=[255,255,255,255]:typeof s.mean=="number"?u=[s.mean,s.mean,s.mean,s.mean]:(u=[s.mean[0],s.mean[1],s.mean[2],0],s.mean[3]!==void 0&&(u[3]=s.mean[3])),s===void 0||s.bias===void 0?l=[0,0,0,0]:typeof s.bias=="number"?l=[s.bias,s.bias,s.bias,s.bias]:(l=[s.bias[0],s.bias[1],s.bias[2],0],s.bias[3]!==void 0&&(l[3]=s.bias[3]));let c=a*i,f=0,p=c,d=c*2,m=-1;o==="RGBA"?(f=0,p=c,d=c*2,m=c*3):o==="RGB"?(f=0,p=c,d=c*2):o==="RBG"&&(f=0,d=c,p=c*2);for(let g=0;g<a;g++)for(let x=0;x<i;x++){let b=(e.data[f++]-l[0])*u[0],y=(e.data[p++]-l[1])*u[1],E=(e.data[d++]-l[2])*u[2],$=m===-1?255:(e.data[m++]-l[3])*u[3];n.fillStyle="rgba("+b+","+y+","+E+","+$+")",n.fillRect(x,g,1,1)}if("toDataURL"in r)return r.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},ik=(e,t)=>{let r=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),n;if(r!=null){let i,a,o;t?.tensorLayout!==void 0&&t.tensorLayout==="NHWC"?(i=e.dims[2],a=e.dims[1],o=e.dims[3]):(i=e.dims[3],a=e.dims[2],o=e.dims[1]);let s=t!==void 0&&t.format!==void 0?t.format:"RGB",u=t?.norm,l,c;u===void 0||u.mean===void 0?l=[255,255,255,255]:typeof u.mean=="number"?l=[u.mean,u.mean,u.mean,u.mean]:(l=[u.mean[0],u.mean[1],u.mean[2],255],u.mean[3]!==void 0&&(l[3]=u.mean[3])),u===void 0||u.bias===void 0?c=[0,0,0,0]:typeof u.bias=="number"?c=[u.bias,u.bias,u.bias,u.bias]:(c=[u.bias[0],u.bias[1],u.bias[2],0],u.bias[3]!==void 0&&(c[3]=u.bias[3]));let f=a*i;if(t!==void 0&&(t.format!==void 0&&o===4&&t.format!=="RGBA"||o===3&&t.format!=="RGB"&&t.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let p=4,d=0,m=1,g=2,x=3,b=0,y=f,E=f*2,$=-1;s==="RGBA"?(b=0,y=f,E=f*2,$=f*3):s==="RGB"?(b=0,y=f,E=f*2):s==="RBG"&&(b=0,E=f,y=f*2),n=r.createImageData(i,a);for(let k=0;k<a*i;d+=p,m+=p,g+=p,x+=p,k++)n.data[d]=(e.data[b++]-c[0])*l[0],n.data[m]=(e.data[y++]-c[1])*l[1],n.data[g]=(e.data[E++]-c[2])*l[2],n.data[x]=$===-1?255:(e.data[$++]-c[3])*l[3]}else throw new Error("Can not access image data");return n}}),l9=We(()=>{"use strict";Sb(),dh=(e,t)=>{if(e===void 0)throw new Error("Image buffer must be defined");if(t.height===void 0||t.width===void 0)throw new Error("Image height and width must be defined");if(t.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:r,width:n}=t,i=t.norm??{mean:255,bias:0},a,o;typeof i.mean=="number"?a=[i.mean,i.mean,i.mean,i.mean]:a=[i.mean[0],i.mean[1],i.mean[2],i.mean[3]??255],typeof i.bias=="number"?o=[i.bias,i.bias,i.bias,i.bias]:o=[i.bias[0],i.bias[1],i.bias[2],i.bias[3]??0];let s=t.format!==void 0?t.format:"RGBA",u=t.tensorFormat!==void 0&&t.tensorFormat!==void 0?t.tensorFormat:"RGB",l=r*n,c=u==="RGBA"?new Float32Array(l*4):new Float32Array(l*3),f=4,p=0,d=1,m=2,g=3,x=0,b=l,y=l*2,E=-1;s==="RGB"&&(f=3,p=0,d=1,m=2,g=-1),u==="RGBA"?E=l*3:u==="RBG"?(x=0,y=l,b=l*2):u==="BGR"&&(y=0,b=l,x=l*2);for(let $=0;$<l;$++,p+=f,m+=f,d+=f,g+=f)c[x++]=(e[p]+o[0])/a[0],c[b++]=(e[d]+o[1])/a[1],c[y++]=(e[m]+o[2])/a[2],E!==-1&&g!==-1&&(c[E++]=(e[g]+o[3])/a[3]);return u==="RGBA"?new Ln("float32",c,[1,4,r,n]):new Ln("float32",c,[1,3,r,n])},ak=async(e,t)=>{let r=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,n=typeof ImageData<"u"&&e instanceof ImageData,i=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,a=typeof e=="string",o,s=t??{},u=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},l=c=>typeof HTMLCanvasElement<"u"&&c instanceof HTMLCanvasElement||c instanceof OffscreenCanvas?c.getContext("2d"):null;if(r){let c=u();c.width=e.width,c.height=e.height;let f=l(c);if(f!=null){let p=e.height,d=e.width;if(t!==void 0&&t.resizedHeight!==void 0&&t.resizedWidth!==void 0&&(p=t.resizedHeight,d=t.resizedWidth),t!==void 0){if(s=t,t.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");s.tensorFormat="RGBA",s.height=p,s.width=d}else s.tensorFormat="RGBA",s.height=p,s.width=d;f.drawImage(e,0,0),o=f.getImageData(0,0,d,p).data}else throw new Error("Can not access image data")}else if(n){let c,f;if(t!==void 0&&t.resizedWidth!==void 0&&t.resizedHeight!==void 0?(c=t.resizedHeight,f=t.resizedWidth):(c=e.height,f=e.width),t!==void 0&&(s=t),s.format="RGBA",s.height=c,s.width=f,t!==void 0){let p=u();p.width=f,p.height=c;let d=l(p);if(d!=null)d.putImageData(e,0,0),o=d.getImageData(0,0,f,c).data;else throw new Error("Can not access image data")}else o=e.data}else if(i){if(t===void 0)throw new Error("Please provide image config with format for Imagebitmap");let c=u();c.width=e.width,c.height=e.height;let f=l(c);if(f!=null){let p=e.height,d=e.width;return f.drawImage(e,0,0,d,p),o=f.getImageData(0,0,d,p).data,s.height=p,s.width=d,dh(o,s)}else throw new Error("Can not access image data")}else{if(a)return new Promise((c,f)=>{let p=u(),d=l(p);if(!e||!d)return f();let m=new Image;m.crossOrigin="Anonymous",m.src=e,m.onload=()=>{p.width=m.width,p.height=m.height,d.drawImage(m,0,0,p.width,p.height);let g=d.getImageData(0,0,p.width,p.height);s.height=p.height,s.width=p.width,c(dh(g.data,s))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(o!==void 0)return dh(o,s);throw new Error("Input data provided is not supported - aborted tensor creation")},ok=(e,t)=>{let{width:r,height:n,download:i,dispose:a}=t,o=[1,n,r,4];return new Ln({location:"texture",type:"float32",texture:e,dims:o,download:i,dispose:a})},sk=(e,t)=>{let{dataType:r,dims:n,download:i,dispose:a}=t;return new Ln({location:"gpu-buffer",type:r??"float32",gpuBuffer:e,dims:n,download:i,dispose:a})},uk=(e,t)=>{let{dataType:r,dims:n,download:i,dispose:a}=t;return new Ln({location:"ml-tensor",type:r??"float32",mlTensor:e,dims:n,download:i,dispose:a})},lk=(e,t,r)=>new Ln({location:"cpu-pinned",type:e,data:t,dims:r??[t.length]})}),c9=We(()=>{"use strict";us=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),Fc=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),l1=!1,ck=()=>{if(!l1){l1=!0;let e=typeof BigInt64Array<"u"&&BigInt64Array.from,t=typeof BigUint64Array<"u"&&BigUint64Array.from,r=globalThis.Float16Array,n=typeof r<"u"&&r.from;e&&(us.set("int64",BigInt64Array),Fc.set(BigInt64Array,"int64")),t&&(us.set("uint64",BigUint64Array),Fc.set(BigUint64Array,"uint64")),n?(us.set("float16",r),Fc.set(r,"float16")):us.set("float16",Uint16Array)}}}),f9=We(()=>{"use strict";Sb(),fk=e=>{let t=1;for(let r=0;r<e.length;r++){let n=e[r];if(typeof n!="number"||!Number.isSafeInteger(n))throw new TypeError(`dims[${r}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${r}] must be a non-negative integer, got: ${n}`);t*=n}return t},dk=(e,t)=>{switch(e.location){case"cpu":return new Ln(e.type,e.data,t);case"cpu-pinned":return new Ln({location:"cpu-pinned",data:e.data,type:e.type,dims:t});case"texture":return new Ln({location:"texture",texture:e.texture,type:e.type,dims:t});case"gpu-buffer":return new Ln({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:t});case"ml-tensor":return new Ln({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:t});default:throw new Error(`tensorReshape: tensor location ${e.location} is not supported`)}}}),Sb=We(()=>{"use strict";u9(),l9(),c9(),f9(),Ln=class{constructor(e,t,r){ck();let n,i;if(typeof e=="object"&&"location"in e)switch(this.dataLocation=e.location,n=e.type,i=e.dims,e.location){case"cpu-pinned":{let o=us.get(n);if(!o)throw new TypeError(`unsupported type "${n}" to create tensor from pinned buffer`);if(!(e.data instanceof o))throw new TypeError(`buffer should be of type ${o.name}`);this.cpuData=e.data;break}case"texture":{if(n!=="float32")throw new TypeError(`unsupported type "${n}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break}case"gpu-buffer":{if(n!=="float32"&&n!=="float16"&&n!=="int32"&&n!=="int64"&&n!=="uint32"&&n!=="uint8"&&n!=="bool"&&n!=="uint4"&&n!=="int4")throw new TypeError(`unsupported type "${n}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break}case"ml-tensor":{if(n!=="float32"&&n!=="float16"&&n!=="int32"&&n!=="int64"&&n!=="uint32"&&n!=="uint64"&&n!=="int8"&&n!=="uint8"&&n!=="bool"&&n!=="uint4"&&n!=="int4")throw new TypeError(`unsupported type "${n}" to create tensor from MLTensor`);this.mlTensorData=e.mlTensor,this.downloader=e.download,this.disposer=e.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let o,s;if(typeof e=="string")if(n=e,s=r,e==="string"){if(!Array.isArray(t))throw new TypeError("A string tensor's data must be a string array.");o=t}else{let u=us.get(e);if(u===void 0)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(t)){if(e==="float16"&&u===Uint16Array||e==="uint4"||e==="int4")throw new TypeError(`Creating a ${e} tensor from number array is not supported. Please use ${u.name} as data.`);e==="uint64"||e==="int64"?o=u.from(t,BigInt):o=u.from(t)}else if(t instanceof u)o=t;else if(t instanceof Uint8ClampedArray)if(e==="uint8")o=Uint8Array.from(t);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(e==="float16"&&t instanceof Uint16Array&&u!==Uint16Array)o=new globalThis.Float16Array(t.buffer,t.byteOffset,t.length);else throw new TypeError(`A ${n} tensor's data must be type of ${u}`)}else if(s=t,Array.isArray(e)){if(e.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let u=typeof e[0];if(u==="string")n="string",o=e;else if(u==="boolean")n="bool",o=Uint8Array.from(e);else throw new TypeError(`Invalid element type of data array: ${u}.`)}else if(e instanceof Uint8ClampedArray)n="uint8",o=Uint8Array.from(e);else{let u=Fc.get(e.constructor);if(u===void 0)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);n=u,o=e}if(s===void 0)s=[o.length];else if(!Array.isArray(s))throw new TypeError("A tensor's dims must be a number array");i=s,this.cpuData=o,this.dataLocation="cpu"}let a=fk(i);if(this.cpuData&&a!==this.cpuData.length&&!((n==="uint4"||n==="int4")&&Math.ceil(a/2)===this.cpuData.length))throw new Error(`Tensor's size(${a}) does not match data length(${this.cpuData.length}).`);this.type=n,this.dims=i,this.size=a}static async fromImage(e,t){return ak(e,t)}static fromTexture(e,t){return ok(e,t)}static fromGpuBuffer(e,t){return sk(e,t)}static fromMLTensor(e,t){return uk(e,t)}static fromPinnedBuffer(e,t,r){return lk(e,t,r)}toDataURL(e){return nk(this,e)}toImageData(e){return ik(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(e){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let t=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=t,e&&this.disposer&&(this.disposer(),this.disposer=void 0),t}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return dk(this,e)}}}),pk=We(()=>{"use strict";Sb(),Si=Ln}),hk=We(()=>{"use strict";rk(),qc=(e,t)=>{(typeof ti.trace>"u"?!ti.wasm.trace:!ti.trace)||console.timeStamp(`${e}::ORT::${t}`)},c1=(e,t)=>{let r=new Error().stack?.split(/\r\n|\r|\n/g)||[],n=!1;for(let i=0;i<r.length;i++){if(n&&!r[i].includes("TRACE_FUNC")){let a=`FUNC_${e}::${r[i].trim().split(" ")[1]}`;t&&(a+=`::${t}`),qc("CPU",a);return}r[i].includes("TRACE_FUNC")&&(n=!0)}},Ti=e=>{(typeof ti.trace>"u"?!ti.wasm.trace:!ti.trace)||c1("BEGIN",e)},ri=e=>{(typeof ti.trace>"u"?!ti.wasm.trace:!ti.trace)||c1("END",e)}}),d9=We(()=>{"use strict";ek(),pk(),hk(),mk=class gk{constructor(t){this.handler=t}async run(t,r,n){Ti();let i={},a={};if(typeof t!="object"||t===null||t instanceof Si||Array.isArray(t))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let o=!0;if(typeof r=="object"){if(r===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(r instanceof Si)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(r)){if(r.length===0)throw new TypeError("'fetches' cannot be an empty array.");o=!1;for(let l of r){if(typeof l!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(l)===-1)throw new RangeError(`'fetches' contains invalid output name: ${l}.`);i[l]=null}if(typeof n=="object"&&n!==null)a=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else{let l=!1,c=Object.getOwnPropertyNames(r);for(let f of this.outputNames)if(c.indexOf(f)!==-1){let p=r[f];(p===null||p instanceof Si)&&(l=!0,o=!1,i[f]=p)}if(l){if(typeof n=="object"&&n!==null)a=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else a=r}}else if(typeof r<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let l of this.inputNames)if(typeof t[l]>"u")throw new Error(`input '${l}' is missing in 'feeds'.`);if(o)for(let l of this.outputNames)i[l]=null;let s=await this.handler.run(t,i,a),u={};for(let l in s)if(Object.hasOwnProperty.call(s,l)){let c=s[l];c instanceof Si?u[l]=c:u[l]=new Si(c.type,c.data,c.dims)}return ri(),u}async release(){return this.handler.dispose()}static async create(t,r,n,i){Ti();let a,o={};if(typeof t=="string"){if(a=t,typeof r=="object"&&r!==null)o=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof Uint8Array){if(a=t,typeof r=="object"&&r!==null)o=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer){let c=t,f=0,p=t.byteLength;if(typeof r=="object"&&r!==null)o=r;else if(typeof r=="number"){if(f=r,!Number.isSafeInteger(f))throw new RangeError("'byteOffset' must be an integer.");if(f<0||f>=c.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${c.byteLength}).`);if(p=t.byteLength-f,typeof n=="number"){if(p=n,!Number.isSafeInteger(p))throw new RangeError("'byteLength' must be an integer.");if(p<=0||f+p>c.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${c.byteLength-f}].`);if(typeof i=="object"&&i!==null)o=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(typeof n<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof r<"u")throw new TypeError("'options' must be an object.");a=new Uint8Array(c,f,p)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[s,u]=await J6(o),l=await s.createInferenceSessionHandler(a,u);return ri(),new gk(l)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),p9=We(()=>{"use strict";d9(),Tb=mk}),h9=We(()=>{"use strict"}),m9=We(()=>{"use strict"}),g9=We(()=>{"use strict"}),y9=We(()=>{"use strict"}),yk={};Hu(yk,{InferenceSession:()=>Tb,TRACE:()=>qc,TRACE_FUNC_BEGIN:()=>Ti,TRACE_FUNC_END:()=>ri,Tensor:()=>Si,env:()=>vr,registerBackend:()=>fs});Ai=We(()=>{"use strict";a9(),s9(),p9(),pk(),h9(),m9(),hk(),g9(),y9()}),Ab=We(()=>{"use strict"}),bk={};Hu(bk,{default:()=>wk});b9=We(()=>{"use strict";EC(),ms(),kb(),f1="ort-wasm-proxy-worker",d1=globalThis.self?.name===f1,d1&&(self.onmessage=e=>{let{type:t,in:r}=e.data;try{switch(t){case"init-wasm":Ib(r.wasm).then(()=>{Hb(r).then(()=>{postMessage({type:t})},n=>{postMessage({type:t,err:n})})},n=>{postMessage({type:t,err:n})});break;case"init-ep":{let{epName:n,env:i}=r;qb(i,n).then(()=>{postMessage({type:t})},a=>{postMessage({type:t,err:a})});break}case"copy-from":{let{buffer:n}=r,i=Rh(n);postMessage({type:t,out:i});break}case"create":{let{model:n,options:i}=r;Xb(n,i).then(a=>{postMessage({type:t,out:a})},a=>{postMessage({type:t,err:a})});break}case"release":Kb(r),postMessage({type:t});break;case"run":{let{sessionId:n,inputIndices:i,inputs:a,outputIndices:o,options:s}=r;Yb(n,i,a,o,new Array(o.length).fill(null),s).then(u=>{u.some(l=>l[3]!=="cpu")?postMessage({type:t,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:t,out:u},Qb([...a,...u]))},u=>{postMessage({type:t,err:u})});break}case"end-profiling":Zb(r),postMessage({type:t});break;default:}}catch(n){postMessage({type:t,err:n})}}),wk=d1?null:e=>new Worker(e??Nn,{type:"module",name:f1})}),vk={};Hu(vk,{default:()=>_k});w9=We(()=>{"use strict";h1=(p1=import.meta.url,async function(e={}){var t,r,n=e,i=new Promise((h,v)=>{t=h,r=v}),a=typeof window=="object",o=typeof WorkerGlobalScope<"u",s=o&&self.name?.startsWith("em-pthread");n.mountExternalData=(h,v)=>{h.startsWith("./")&&(h=h.substring(2)),(n.Fb||(n.Fb=new Map)).set(h,v)},n.unmountExternalData=()=>{delete n.Fb};var u=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,qc:!0}).buffer.constructor;let l=h=>async(...v)=>{try{if(n.Gb)throw Error("Session already started");let A=n.Gb={ec:v[0],errors:[]},I=await h(...v);if(n.Gb!==A)throw Error("Session mismatch");n.Kb?.flush();let L=A.errors;if(0<L.length){let K=await Promise.all(L);if(K=K.filter(_e=>_e),0<K.length)throw Error(K.join(`
`))}return I}finally{n.Gb=null}};n.jsepInit=(h,v)=>{if(h==="webgpu"){[n.Kb,n.Vb,n.Zb,n.Lb,n.Yb,n.kb,n.$b,n.bc,n.Wb,n.Xb,n.ac]=v;let A=n.Kb;n.jsepRegisterBuffer=(I,L,K,_e)=>A.registerBuffer(I,L,K,_e),n.jsepGetBuffer=I=>A.getBuffer(I),n.jsepCreateDownloader=(I,L,K)=>A.createDownloader(I,L,K),n.jsepOnCreateSession=I=>{A.onCreateSession(I)},n.jsepOnReleaseSession=I=>{A.onReleaseSession(I)},n.jsepOnRunStart=I=>A.onRunStart(I),n.cc=(I,L)=>{A.upload(I,L)}}else if(h==="webnn"){let A=v[0];[n.oc,n.Ob,n.webnnEnsureTensor,n.Pb,n.webnnDownloadTensor]=v.slice(1),n.webnnReleaseTensorId=n.Ob,n.webnnUploadTensor=n.Pb,n.webnnOnRunStart=I=>A.onRunStart(I),n.webnnOnRunEnd=A.onRunEnd.bind(A),n.webnnRegisterMLContext=(I,L)=>{A.registerMLContext(I,L)},n.webnnOnReleaseSession=I=>{A.onReleaseSession(I)},n.webnnCreateMLTensorDownloader=(I,L)=>A.createMLTensorDownloader(I,L),n.webnnRegisterMLTensor=(I,L,K,_e)=>A.registerMLTensor(I,L,K,_e),n.webnnCreateMLContext=I=>A.createMLContext(I),n.webnnRegisterMLConstant=(I,L,K,_e,Ce,rt)=>A.registerMLConstant(I,L,K,_e,Ce,n.Fb,rt),n.webnnRegisterGraphInput=A.registerGraphInput.bind(A),n.webnnIsGraphInput=A.isGraphInput.bind(A),n.webnnRegisterGraphOutput=A.registerGraphOutput.bind(A),n.webnnIsGraphOutput=A.isGraphOutput.bind(A),n.webnnCreateTemporaryTensor=A.createTemporaryTensor.bind(A),n.webnnIsGraphInputOutputTypeSupported=A.isGraphInputOutputTypeSupported.bind(A)}};let c=()=>{let h=(v,A,I)=>(...L)=>{let K=Gn,_e=A?.();L=v(...L);let Ce=A?.();return _e!==Ce&&(v=Ce,I(_e),A=I=null),Gn!=K?new Promise((rt,yt)=>{As={resolve:rt,reject:yt}}):L};(()=>{for(let v of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])n[v]=h(n[v],()=>n[v],A=>n[v]=A)})(),l!==void 0&&(n._OrtRun=l(n._OrtRun),n._OrtRunWithBinding=l(n._OrtRunWithBinding)),c=void 0};n.asyncInit=()=>{c?.()};var f,p,d=Object.assign({},n),m=(h,v)=>{throw v},g="";(a||o)&&(o?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),p1&&(g=p1),g=g.startsWith("blob:")?"":g.slice(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1),o&&(p=h=>{var v=new XMLHttpRequest;return v.open("GET",h,!1),v.responseType="arraybuffer",v.send(null),new Uint8Array(v.response)}),f=async h=>{if(he(h))return new Promise((A,I)=>{var L=new XMLHttpRequest;L.open("GET",h,!0),L.responseType="arraybuffer",L.onload=()=>{L.status==200||L.status==0&&L.response?A(L.response):I(L.status)},L.onerror=I,L.send(null)});var v=await fetch(h,{credentials:"same-origin"});if(v.ok)return v.arrayBuffer();throw Error(v.status+" : "+v.url)});var x=console.log.bind(console),b=console.error.bind(console),y=x,E=b;Object.assign(n,d),d=null;var $,k,R,C,P,W,te,ce,pe,ge,fe,Me,Ge,He=n.wasmBinary,dt=!1,he=h=>h.startsWith("file://");function qe(){return $.buffer!=C.buffer&&Bt(),C}function ae(){return $.buffer!=C.buffer&&Bt(),P}function we(){return $.buffer!=C.buffer&&Bt(),W}function Re(){return $.buffer!=C.buffer&&Bt(),te}function ne(){return $.buffer!=C.buffer&&Bt(),ce}function at(){return $.buffer!=C.buffer&&Bt(),pe}function kt(){return $.buffer!=C.buffer&&Bt(),ge}function pt(){return $.buffer!=C.buffer&&Bt(),Ge}if(s){let h=function(v){try{var A=v.data,I=A.Cb;if(I==="load"){let L=[];self.onmessage=K=>L.push(K),self.startWorker=()=>{postMessage({Cb:"loaded"});for(let K of L)h(K);self.onmessage=h};for(let K of A.Sb)n[K]&&!n[K].proxy||(n[K]=(..._e)=>{postMessage({Cb:"callHandler",Rb:K,args:_e})},K=="print"&&(y=n[K]),K=="printErr"&&(E=n[K]));$=A.lc,Bt(),gt(A.mc)}else if(I==="run"){Xh(A.Bb),wo(A.Bb,0,0,1,0,0),vs(),al(A.Bb),Dt||(Ra(),Dt=!0);try{Kh(A.hc,A.Ib)}catch(L){if(L!="unwind")throw L}}else A.target!=="setimmediate"&&(I==="checkMailbox"?Dt&&xs():I&&(E(`worker: received unknown command ${I}`),E(A)))}catch(L){throw Xf(),L}};var mt=h,gt,Dt=!1;E=function(...v){v=v.join(" "),console.error(v)},self.alert=function(...v){postMessage({Cb:"alert",text:v.join(" "),jc:Ns()})},self.onunhandledrejection=v=>{throw v.reason||v},self.onmessage=h}function Bt(){var h=$.buffer;n.HEAP8=C=new Int8Array(h),n.HEAP16=W=new Int16Array(h),n.HEAPU8=P=new Uint8Array(h),n.HEAPU16=te=new Uint16Array(h),n.HEAP32=ce=new Int32Array(h),n.HEAPU32=pe=new Uint32Array(h),n.HEAPF32=ge=new Float32Array(h),n.HEAPF64=Ge=new Float64Array(h),n.HEAP64=fe=new BigInt64Array(h),n.HEAPU64=Me=new BigUint64Array(h)}function er(){s?startWorker(n):vt.Da()}s||($=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),Bt());var yr,Kt=0,br=null;function w(){if(--Kt==0&&br){var h=br;br=null,h()}}function T(h){throw E(h="Aborted("+h+")"),dt=!0,h=new WebAssembly.RuntimeError(h+". Build with -sASSERTIONS for more info."),r(h),h}function O(){return{a:{L:S,Aa:ie,b:lf,$:ff,A:pf,pa:hf,X:gf,Z:yf,qa:Yu,na:Zu,ga:xr,ma:bf,J:wf,Y:vf,V:_f,oa:xf,W:$f,va:Yh,E:Qh,Q:Jh,O:tm,D:_s,v:Tf,r:nm,P:im,z:um,R:On,ja:bn,T:kf,aa:lm,M:cm,F:ol,ia:al,sa:fm,t:dm,Ca:pm,w:ul,o:Ri,m:Rf,c:tl,Ba:hm,n:mm,j:bm,u:zi,p:wm,f:vm,s:fo,l:_m,e:Ia,k:Lf,h:Ca,g:Df,d:Qi,da:ll,ea:Ff,fa:xm,ba:Gf,ca:cl,N:Vf,xa:jn,ua:Ji,i:mo,C:Cs,G:Wf,ta:fl,x:dl,ra:Hf,U:$m,q:jf,y:Em,K:Sm,S:Tm,za:pl,ya:Ba,ka:Rs,la:hl,_:Pn,B:ml,I:gl,ha:yl,H:bl,a:$,wa:cn}}}var q={840156:(h,v,A,I,L)=>{if(n===void 0||!n.Fb)return 1;if((h=Ar(Number(h>>>0))).startsWith("./")&&(h=h.substring(2)),!(h=n.Fb.get(h)))return 2;if(v=Number(v>>>0),A=Number(A>>>0),I=Number(I>>>0),v+A>h.byteLength)return 3;try{let K=h.subarray(v,v+A);switch(L){case 0:ae().set(K,I>>>0);break;case 1:n.nc?n.nc(I,K):n.cc(I,K);break;default:return 4}return 0}catch{return 4}},840980:(h,v,A)=>{n.Pb(h,ae().subarray(v>>>0,v+A>>>0))},841044:()=>n.oc(),841086:h=>{n.Ob(h)},841123:()=>{n.Wb()},841154:()=>{n.Xb()},841183:()=>{n.ac()},841208:h=>n.Vb(h),841241:h=>n.Zb(h),841273:(h,v,A)=>{n.Lb(Number(h),Number(v),Number(A),!0)},841336:(h,v,A)=>{n.Lb(Number(h),Number(v),Number(A))},841393:()=>typeof wasmOffsetConverter<"u",841450:h=>{n.kb("Abs",h,void 0)},841501:h=>{n.kb("Neg",h,void 0)},841552:h=>{n.kb("Floor",h,void 0)},841605:h=>{n.kb("Ceil",h,void 0)},841657:h=>{n.kb("Reciprocal",h,void 0)},841715:h=>{n.kb("Sqrt",h,void 0)},841767:h=>{n.kb("Exp",h,void 0)},841818:h=>{n.kb("Erf",h,void 0)},841869:h=>{n.kb("Sigmoid",h,void 0)},841924:(h,v,A)=>{n.kb("HardSigmoid",h,{alpha:v,beta:A})},842003:h=>{n.kb("Log",h,void 0)},842054:h=>{n.kb("Sin",h,void 0)},842105:h=>{n.kb("Cos",h,void 0)},842156:h=>{n.kb("Tan",h,void 0)},842207:h=>{n.kb("Asin",h,void 0)},842259:h=>{n.kb("Acos",h,void 0)},842311:h=>{n.kb("Atan",h,void 0)},842363:h=>{n.kb("Sinh",h,void 0)},842415:h=>{n.kb("Cosh",h,void 0)},842467:h=>{n.kb("Asinh",h,void 0)},842520:h=>{n.kb("Acosh",h,void 0)},842573:h=>{n.kb("Atanh",h,void 0)},842626:h=>{n.kb("Tanh",h,void 0)},842678:h=>{n.kb("Not",h,void 0)},842729:(h,v,A)=>{n.kb("Clip",h,{min:v,max:A})},842798:h=>{n.kb("Clip",h,void 0)},842850:(h,v)=>{n.kb("Elu",h,{alpha:v})},842908:h=>{n.kb("Gelu",h,void 0)},842960:h=>{n.kb("Relu",h,void 0)},843012:(h,v)=>{n.kb("LeakyRelu",h,{alpha:v})},843076:(h,v)=>{n.kb("ThresholdedRelu",h,{alpha:v})},843146:(h,v)=>{n.kb("Cast",h,{to:v})},843204:h=>{n.kb("Add",h,void 0)},843255:h=>{n.kb("Sub",h,void 0)},843306:h=>{n.kb("Mul",h,void 0)},843357:h=>{n.kb("Div",h,void 0)},843408:h=>{n.kb("Pow",h,void 0)},843459:h=>{n.kb("Equal",h,void 0)},843512:h=>{n.kb("Greater",h,void 0)},843567:h=>{n.kb("GreaterOrEqual",h,void 0)},843629:h=>{n.kb("Less",h,void 0)},843681:h=>{n.kb("LessOrEqual",h,void 0)},843740:(h,v,A,I,L)=>{n.kb("ReduceMean",h,{keepDims:!!v,noopWithEmptyAxes:!!A,axes:I?Array.from(ne().subarray(Number(I)>>>0,Number(L)>>>0)):[]})},843915:(h,v,A,I,L)=>{n.kb("ReduceMax",h,{keepDims:!!v,noopWithEmptyAxes:!!A,axes:I?Array.from(ne().subarray(Number(I)>>>0,Number(L)>>>0)):[]})},844089:(h,v,A,I,L)=>{n.kb("ReduceMin",h,{keepDims:!!v,noopWithEmptyAxes:!!A,axes:I?Array.from(ne().subarray(Number(I)>>>0,Number(L)>>>0)):[]})},844263:(h,v,A,I,L)=>{n.kb("ReduceProd",h,{keepDims:!!v,noopWithEmptyAxes:!!A,axes:I?Array.from(ne().subarray(Number(I)>>>0,Number(L)>>>0)):[]})},844438:(h,v,A,I,L)=>{n.kb("ReduceSum",h,{keepDims:!!v,noopWithEmptyAxes:!!A,axes:I?Array.from(ne().subarray(Number(I)>>>0,Number(L)>>>0)):[]})},844612:(h,v,A,I,L)=>{n.kb("ReduceL1",h,{keepDims:!!v,noopWithEmptyAxes:!!A,axes:I?Array.from(ne().subarray(Number(I)>>>0,Number(L)>>>0)):[]})},844785:(h,v,A,I,L)=>{n.kb("ReduceL2",h,{keepDims:!!v,noopWithEmptyAxes:!!A,axes:I?Array.from(ne().subarray(Number(I)>>>0,Number(L)>>>0)):[]})},844958:(h,v,A,I,L)=>{n.kb("ReduceLogSum",h,{keepDims:!!v,noopWithEmptyAxes:!!A,axes:I?Array.from(ne().subarray(Number(I)>>>0,Number(L)>>>0)):[]})},845135:(h,v,A,I,L)=>{n.kb("ReduceSumSquare",h,{keepDims:!!v,noopWithEmptyAxes:!!A,axes:I?Array.from(ne().subarray(Number(I)>>>0,Number(L)>>>0)):[]})},845315:(h,v,A,I,L)=>{n.kb("ReduceLogSumExp",h,{keepDims:!!v,noopWithEmptyAxes:!!A,axes:I?Array.from(ne().subarray(Number(I)>>>0,Number(L)>>>0)):[]})},845495:h=>{n.kb("Where",h,void 0)},845548:(h,v,A)=>{n.kb("Transpose",h,{perm:v?Array.from(ne().subarray(Number(v)>>>0,Number(A)>>>0)):[]})},845672:(h,v,A,I)=>{n.kb("DepthToSpace",h,{blocksize:v,mode:Ar(A),format:I?"NHWC":"NCHW"})},845805:(h,v,A,I)=>{n.kb("DepthToSpace",h,{blocksize:v,mode:Ar(A),format:I?"NHWC":"NCHW"})},845938:(h,v,A,I,L,K,_e,Ce,rt,yt,Pt,Zt,or,Hr,ea)=>{n.kb("ConvTranspose",h,{format:rt?"NHWC":"NCHW",autoPad:v,dilations:[A],group:I,kernelShape:[L],pads:[K,_e],strides:[Ce],wIsConst:()=>!!qe()[yt>>>0],outputPadding:Pt?Array.from(ne().subarray(Number(Pt)>>>0,Number(Zt)>>>0)):[],outputShape:or?Array.from(ne().subarray(Number(or)>>>0,Number(Hr)>>>0)):[],activation:Ar(ea)})},846371:(h,v,A,I,L,K,_e,Ce,rt,yt,Pt,Zt,or,Hr)=>{n.kb("ConvTranspose",h,{format:Ce?"NHWC":"NCHW",autoPad:v,dilations:Array.from(ne().subarray(Number(A)>>>0,2+(Number(A)>>>0)>>>0)),group:I,kernelShape:Array.from(ne().subarray(Number(L)>>>0,2+(Number(L)>>>0)>>>0)),pads:Array.from(ne().subarray(Number(K)>>>0,4+(Number(K)>>>0)>>>0)),strides:Array.from(ne().subarray(Number(_e)>>>0,2+(Number(_e)>>>0)>>>0)),wIsConst:()=>!!qe()[rt>>>0],outputPadding:yt?Array.from(ne().subarray(Number(yt)>>>0,Number(Pt)>>>0)):[],outputShape:Zt?Array.from(ne().subarray(Number(Zt)>>>0,Number(or)>>>0)):[],activation:Ar(Hr)})},847032:(h,v,A,I,L,K,_e,Ce,rt,yt,Pt,Zt,or,Hr,ea)=>{n.kb("ConvTranspose",h,{format:rt?"NHWC":"NCHW",autoPad:v,dilations:[A],group:I,kernelShape:[L],pads:[K,_e],strides:[Ce],wIsConst:()=>!!qe()[yt>>>0],outputPadding:Pt?Array.from(ne().subarray(Number(Pt)>>>0,Number(Zt)>>>0)):[],outputShape:or?Array.from(ne().subarray(Number(or)>>>0,Number(Hr)>>>0)):[],activation:Ar(ea)})},847465:(h,v,A,I,L,K,_e,Ce,rt,yt,Pt,Zt,or,Hr)=>{n.kb("ConvTranspose",h,{format:Ce?"NHWC":"NCHW",autoPad:v,dilations:Array.from(ne().subarray(Number(A)>>>0,2+(Number(A)>>>0)>>>0)),group:I,kernelShape:Array.from(ne().subarray(Number(L)>>>0,2+(Number(L)>>>0)>>>0)),pads:Array.from(ne().subarray(Number(K)>>>0,4+(Number(K)>>>0)>>>0)),strides:Array.from(ne().subarray(Number(_e)>>>0,2+(Number(_e)>>>0)>>>0)),wIsConst:()=>!!qe()[rt>>>0],outputPadding:yt?Array.from(ne().subarray(Number(yt)>>>0,Number(Pt)>>>0)):[],outputShape:Zt?Array.from(ne().subarray(Number(Zt)>>>0,Number(or)>>>0)):[],activation:Ar(Hr)})},848126:(h,v)=>{n.kb("GlobalAveragePool",h,{format:v?"NHWC":"NCHW"})},848217:(h,v,A,I,L,K,_e,Ce,rt,yt,Pt,Zt,or,Hr)=>{n.kb("AveragePool",h,{format:Hr?"NHWC":"NCHW",auto_pad:v,ceil_mode:A,count_include_pad:I,storage_order:L,dilations:K?Array.from(ne().subarray(Number(K)>>>0,Number(_e)>>>0)):[],kernel_shape:Ce?Array.from(ne().subarray(Number(Ce)>>>0,Number(rt)>>>0)):[],pads:yt?Array.from(ne().subarray(Number(yt)>>>0,Number(Pt)>>>0)):[],strides:Zt?Array.from(ne().subarray(Number(Zt)>>>0,Number(or)>>>0)):[]})},848696:(h,v)=>{n.kb("GlobalAveragePool",h,{format:v?"NHWC":"NCHW"})},848787:(h,v,A,I,L,K,_e,Ce,rt,yt,Pt,Zt,or,Hr)=>{n.kb("AveragePool",h,{format:Hr?"NHWC":"NCHW",auto_pad:v,ceil_mode:A,count_include_pad:I,storage_order:L,dilations:K?Array.from(ne().subarray(Number(K)>>>0,Number(_e)>>>0)):[],kernel_shape:Ce?Array.from(ne().subarray(Number(Ce)>>>0,Number(rt)>>>0)):[],pads:yt?Array.from(ne().subarray(Number(yt)>>>0,Number(Pt)>>>0)):[],strides:Zt?Array.from(ne().subarray(Number(Zt)>>>0,Number(or)>>>0)):[]})},849266:(h,v)=>{n.kb("GlobalMaxPool",h,{format:v?"NHWC":"NCHW"})},849353:(h,v,A,I,L,K,_e,Ce,rt,yt,Pt,Zt,or,Hr)=>{n.kb("MaxPool",h,{format:Hr?"NHWC":"NCHW",auto_pad:v,ceil_mode:A,count_include_pad:I,storage_order:L,dilations:K?Array.from(ne().subarray(Number(K)>>>0,Number(_e)>>>0)):[],kernel_shape:Ce?Array.from(ne().subarray(Number(Ce)>>>0,Number(rt)>>>0)):[],pads:yt?Array.from(ne().subarray(Number(yt)>>>0,Number(Pt)>>>0)):[],strides:Zt?Array.from(ne().subarray(Number(Zt)>>>0,Number(or)>>>0)):[]})},849828:(h,v)=>{n.kb("GlobalMaxPool",h,{format:v?"NHWC":"NCHW"})},849915:(h,v,A,I,L,K,_e,Ce,rt,yt,Pt,Zt,or,Hr)=>{n.kb("MaxPool",h,{format:Hr?"NHWC":"NCHW",auto_pad:v,ceil_mode:A,count_include_pad:I,storage_order:L,dilations:K?Array.from(ne().subarray(Number(K)>>>0,Number(_e)>>>0)):[],kernel_shape:Ce?Array.from(ne().subarray(Number(Ce)>>>0,Number(rt)>>>0)):[],pads:yt?Array.from(ne().subarray(Number(yt)>>>0,Number(Pt)>>>0)):[],strides:Zt?Array.from(ne().subarray(Number(Zt)>>>0,Number(or)>>>0)):[]})},850390:(h,v,A,I,L)=>{n.kb("Gemm",h,{alpha:v,beta:A,transA:I,transB:L})},850494:h=>{n.kb("MatMul",h,void 0)},850548:(h,v,A,I)=>{n.kb("ArgMax",h,{keepDims:!!v,selectLastIndex:!!A,axis:I})},850656:(h,v,A,I)=>{n.kb("ArgMin",h,{keepDims:!!v,selectLastIndex:!!A,axis:I})},850764:(h,v)=>{n.kb("Softmax",h,{axis:v})},850827:(h,v)=>{n.kb("Concat",h,{axis:v})},850887:(h,v,A,I,L)=>{n.kb("Split",h,{axis:v,numOutputs:A,splitSizes:I?Array.from(ne().subarray(Number(I)>>>0,Number(L)>>>0)):[]})},851043:h=>{n.kb("Expand",h,void 0)},851097:(h,v)=>{n.kb("Gather",h,{axis:Number(v)})},851168:(h,v)=>{n.kb("GatherElements",h,{axis:Number(v)})},851247:(h,v)=>{n.kb("GatherND",h,{batch_dims:Number(v)})},851326:(h,v,A,I,L,K,_e,Ce,rt,yt,Pt)=>{n.kb("Resize",h,{antialias:v,axes:A?Array.from(ne().subarray(Number(A)>>>0,Number(I)>>>0)):[],coordinateTransformMode:Ar(L),cubicCoeffA:K,excludeOutside:_e,extrapolationValue:Ce,keepAspectRatioPolicy:Ar(rt),mode:Ar(yt),nearestMode:Ar(Pt)})},851688:(h,v,A,I,L,K,_e)=>{n.kb("Slice",h,{starts:v?Array.from(ne().subarray(Number(v)>>>0,Number(A)>>>0)):[],ends:I?Array.from(ne().subarray(Number(I)>>>0,Number(L)>>>0)):[],axes:K?Array.from(ne().subarray(Number(K)>>>0,Number(_e)>>>0)):[]})},851952:h=>{n.kb("Tile",h,void 0)},852004:(h,v,A)=>{n.kb("InstanceNormalization",h,{epsilon:v,format:A?"NHWC":"NCHW"})},852118:(h,v,A)=>{n.kb("InstanceNormalization",h,{epsilon:v,format:A?"NHWC":"NCHW"})},852232:h=>{n.kb("Range",h,void 0)},852285:(h,v)=>{n.kb("Einsum",h,{equation:Ar(v)})},852366:(h,v,A,I,L)=>{n.kb("Pad",h,{mode:v,value:A,pads:I?Array.from(ne().subarray(Number(I)>>>0,Number(L)>>>0)):[]})},852509:(h,v,A,I,L,K)=>{n.kb("BatchNormalization",h,{epsilon:v,momentum:A,spatial:!!L,trainingMode:!!I,format:K?"NHWC":"NCHW"})},852678:(h,v,A,I,L,K)=>{n.kb("BatchNormalization",h,{epsilon:v,momentum:A,spatial:!!L,trainingMode:!!I,format:K?"NHWC":"NCHW"})},852847:(h,v,A)=>{n.kb("CumSum",h,{exclusive:Number(v),reverse:Number(A)})},852944:(h,v,A)=>{n.kb("DequantizeLinear",h,{axis:v,blockSize:A})},853034:(h,v,A,I,L)=>{n.kb("GridSample",h,{align_corners:v,mode:Ar(A),padding_mode:Ar(I),format:L?"NHWC":"NCHW"})},853204:(h,v,A,I,L)=>{n.kb("GridSample",h,{align_corners:v,mode:Ar(A),padding_mode:Ar(I),format:L?"NHWC":"NCHW"})},853374:(h,v)=>{n.kb("ScatterND",h,{reduction:Ar(v)})},853459:(h,v,A,I,L,K,_e,Ce,rt)=>{n.kb("Attention",h,{numHeads:v,isUnidirectional:A,maskFilterValue:I,scale:L,doRotary:K,qkvHiddenSizes:_e?Array.from(ne().subarray(Number(Ce)>>>0,Number(Ce)+_e>>>0)):[],pastPresentShareBuffer:!!rt})},853731:h=>{n.kb("BiasAdd",h,void 0)},853786:h=>{n.kb("BiasSplitGelu",h,void 0)},853847:h=>{n.kb("FastGelu",h,void 0)},853903:(h,v,A,I,L,K,_e,Ce,rt,yt,Pt,Zt,or,Hr,ea,Am)=>{n.kb("Conv",h,{format:Zt?"NHWC":"NCHW",auto_pad:v,dilations:A?Array.from(ne().subarray(Number(A)>>>0,Number(I)>>>0)):[],group:L,kernel_shape:K?Array.from(ne().subarray(Number(K)>>>0,Number(_e)>>>0)):[],pads:Ce?Array.from(ne().subarray(Number(Ce)>>>0,Number(rt)>>>0)):[],strides:yt?Array.from(ne().subarray(Number(yt)>>>0,Number(Pt)>>>0)):[],w_is_const:()=>!!qe()[Number(or)>>>0],activation:Ar(Hr),activation_params:ea?Array.from(kt().subarray(Number(ea)>>>0,Number(Am)>>>0)):[]})},854487:h=>{n.kb("Gelu",h,void 0)},854539:(h,v,A,I,L,K,_e,Ce,rt)=>{n.kb("GroupQueryAttention",h,{numHeads:v,kvNumHeads:A,scale:I,softcap:L,doRotary:K,rotaryInterleaved:_e,smoothSoftmax:Ce,localWindowSize:rt})},854756:(h,v,A,I)=>{n.kb("LayerNormalization",h,{axis:v,epsilon:A,simplified:!!I})},854867:(h,v,A,I)=>{n.kb("LayerNormalization",h,{axis:v,epsilon:A,simplified:!!I})},854978:(h,v,A,I,L,K)=>{n.kb("MatMulNBits",h,{k:v,n:A,accuracyLevel:I,bits:L,blockSize:K})},855105:(h,v,A,I,L,K)=>{n.kb("MultiHeadAttention",h,{numHeads:v,isUnidirectional:A,maskFilterValue:I,scale:L,doRotary:K})},855264:(h,v)=>{n.kb("QuickGelu",h,{alpha:v})},855328:(h,v,A,I,L)=>{n.kb("RotaryEmbedding",h,{interleaved:!!v,numHeads:A,rotaryEmbeddingDim:I,scale:L})},855467:(h,v,A)=>{n.kb("SkipLayerNormalization",h,{epsilon:v,simplified:!!A})},855569:(h,v,A)=>{n.kb("SkipLayerNormalization",h,{epsilon:v,simplified:!!A})},855671:(h,v,A,I)=>{n.kb("GatherBlockQuantized",h,{gatherAxis:v,quantizeAxis:A,blockSize:I})},855792:h=>{n.$b(h)},855826:(h,v)=>n.bc(Number(h),Number(v),n.Gb.ec,n.Gb.errors)};function ie(h,v,A){return Bf(async()=>{await n.Yb(Number(h),Number(v),Number(A))})}function S(){return typeof wasmOffsetConverter<"u"}class ze{constructor(v){An(this,"name","ExitStatus");this.message=`Program terminated with exit(${v})`,this.status=v}}var Mt=h=>{h.terminate(),h.onmessage=()=>{}},qt=[],fr=h=>{Un.length==0&&(sf(),of(Un[0]));var v=Un.pop();if(!v)return 6;ki.push(v),Br[h.Bb]=v,v.Bb=h.Bb;var A={Cb:"run",hc:h.fc,Ib:h.Ib,Bb:h.Bb};return v.postMessage(A,h.Nb),0},Lt=0,Rt=(h,v,...A)=>{for(var I=2*A.length,L=xl(),K=xo(8*I),_e=K>>>3,Ce=0;Ce<A.length;Ce++){var rt=A[Ce];typeof rt=="bigint"?(fe[_e+2*Ce]=1n,fe[_e+2*Ce+1]=rt):(fe[_e+2*Ce]=0n,pt()[_e+2*Ce+1>>>0]=rt)}return h=Kf(h,0,I,K,v),_o(L),h};function cn(h){if(s)return Rt(0,1,h);if(R=h,!(0<Lt)){for(var v of ki)Mt(v);for(v of Un)Mt(v);Un=[],ki=[],Br={},dt=!0}m(0,new ze(h))}function Ea(h){if(s)return Rt(1,0,h);Pn(h)}var Pn=h=>{if(R=h,s)throw Ea(h),"unwind";cn(h)},Un=[],ki=[],Mr=[],Br={},yn=h=>{var v=h.Bb;delete Br[v],Un.push(h),ki.splice(ki.indexOf(h),1),h.Bb=0,Yf(v)};function vs(){Mr.forEach(h=>h())}var of=h=>new Promise(v=>{h.onmessage=L=>{var K=(L=L.data).Cb;if(L.Hb&&L.Hb!=Ns()){var _e=Br[L.Hb];_e?_e.postMessage(L,L.Nb):E(`Internal error! Worker sent a message "${K}" to target pthread ${L.Hb}, but that thread no longer exists!`)}else K==="checkMailbox"?xs():K==="spawnThread"?fr(L):K==="cleanupThread"?yn(Br[L.ic]):K==="loaded"?(h.loaded=!0,v(h)):K==="alert"?alert(`Thread ${L.jc}: ${L.text}`):L.target==="setimmediate"?h.postMessage(L):K==="callHandler"?n[L.Rb](...L.args):K&&E(`worker sent an unknown command ${K}`)},h.onerror=L=>{throw E(`worker sent an error! ${L.filename}:${L.lineno}: ${L.message}`),L};var A,I=[];for(A of[])n.propertyIsEnumerable(A)&&I.push(A);h.postMessage({Cb:"load",Sb:I,lc:$,mc:k})});function sf(){var h=new Worker((()=>{let v=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new v("ort.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});Un.push(h)}var Xh=h=>{Bt();var v=at()[h+52>>>2>>>0];h=at()[h+56>>>2>>>0],_l(v,v-h),_o(v)},Kh=(h,v)=>{Lt=0,h=$o(h,v),0<Lt?R=h:vo(h)};class uf{constructor(v){this.Jb=v-24}}function lf(h,v,A){var I=new uf(h>>>=0);throw v>>>=0,A>>>=0,at()[I.Jb+16>>>2>>>0]=0,at()[I.Jb+4>>>2>>>0]=v,at()[I.Jb+8>>>2>>>0]=A,h}function cf(h,v,A,I){return s?Rt(2,1,h,v,A,I):ff(h,v,A,I)}function ff(h,v,A,I){if(h>>>=0,A>>>=0,I>>>=0,u===void 0)return 6;var L=[];return s&&L.length===0?cf(h,v>>>=0,A,I):(h={fc:A,Bb:h,Ib:I,Nb:L},s?(h.Cb="spawnThread",postMessage(h,L),0):fr(h))}var fn=typeof TextDecoder<"u"?new TextDecoder:void 0,df=(h,v=0,A=NaN)=>{var I=(v>>>=0)+A;for(A=v;h[A]&&!(A>=I);)++A;if(16<A-v&&h.buffer&&fn)return fn.decode(h.buffer instanceof ArrayBuffer?h.subarray(v,A):h.slice(v,A));for(I="";v<A;){var L=h[v++];if(128&L){var K=63&h[v++];if((224&L)==192)I+=String.fromCharCode((31&L)<<6|K);else{var _e=63&h[v++];65536>(L=(240&L)==224?(15&L)<<12|K<<6|_e:(7&L)<<18|K<<12|_e<<6|63&h[v++])?I+=String.fromCharCode(L):(L-=65536,I+=String.fromCharCode(55296|L>>10,56320|1023&L))}}else I+=String.fromCharCode(L)}return I},Ar=(h,v)=>(h>>>=0)?df(ae(),h,v):"";function pf(h,v,A){return s?Rt(3,1,h,v,A):0}function hf(h,v){if(s)return Rt(4,1,h,v)}var mf=h=>{for(var v=0,A=0;A<h.length;++A){var I=h.charCodeAt(A);127>=I?v++:2047>=I?v+=2:55296<=I&&57343>=I?(v+=4,++A):v+=3}return v},Sa=(h,v,A)=>{var I=ae();if(v>>>=0,0<A){var L=v;A=v+A-1;for(var K=0;K<h.length;++K){var _e=h.charCodeAt(K);if(55296<=_e&&57343>=_e&&(_e=65536+((1023&_e)<<10)|1023&h.charCodeAt(++K)),127>=_e){if(v>=A)break;I[v++>>>0]=_e}else{if(2047>=_e){if(v+1>=A)break;I[v++>>>0]=192|_e>>6}else{if(65535>=_e){if(v+2>=A)break;I[v++>>>0]=224|_e>>12}else{if(v+3>=A)break;I[v++>>>0]=240|_e>>18,I[v++>>>0]=128|_e>>12&63}I[v++>>>0]=128|_e>>6&63}I[v++>>>0]=128|63&_e}}I[v>>>0]=0,h=v-L}else h=0;return h};function gf(h,v){if(s)return Rt(5,1,h,v)}function yf(h,v,A){if(s)return Rt(6,1,h,v,A)}function Yu(h,v,A){return s?Rt(7,1,h,v,A):0}function Zu(h,v){if(s)return Rt(8,1,h,v)}function xr(h,v,A){if(s)return Rt(9,1,h,v,A)}function bf(h,v,A,I){if(s)return Rt(10,1,h,v,A,I)}function wf(h,v,A,I){if(s)return Rt(11,1,h,v,A,I)}function vf(h,v,A,I){if(s)return Rt(12,1,h,v,A,I)}function _f(h){if(s)return Rt(13,1,h)}function xf(h,v){if(s)return Rt(14,1,h,v)}function $f(h,v,A){if(s)return Rt(15,1,h,v,A)}var Ef,Ii,Yh=()=>T(""),Fn=h=>{for(var v="";ae()[h>>>0];)v+=Ef[ae()[h++>>>0]];return v},Qu={},Ju={},Zh={};function ai(h,v,A={}){return function(I,L,K={}){var _e=L.name;if(!I)throw new Ii(`type "${_e}" must have a positive integer typeid pointer`);if(Ju.hasOwnProperty(I)){if(K.Tb)return;throw new Ii(`Cannot register type '${_e}' twice`)}Ju[I]=L,delete Zh[I],Qu.hasOwnProperty(I)&&(L=Qu[I],delete Qu[I],L.forEach(Ce=>Ce()))}(h,v,A)}var Sf=(h,v,A)=>{switch(v){case 1:return A?I=>qe()[I>>>0]:I=>ae()[I>>>0];case 2:return A?I=>we()[I>>>1>>>0]:I=>Re()[I>>>1>>>0];case 4:return A?I=>ne()[I>>>2>>>0]:I=>at()[I>>>2>>>0];case 8:return A?I=>fe[I>>>3]:I=>Me[I>>>3];default:throw new TypeError(`invalid integer width (${v}): ${h}`)}};function Qh(h,v,A){A>>>=0,ai(h>>>=0,{name:v=Fn(v>>>0),fromWireType:I=>I,toWireType:function(I,L){if(typeof L!="bigint"&&typeof L!="number")throw L=L===null?"null":(I=typeof L)=="object"||I==="array"||I==="function"?L.toString():""+L,new TypeError(`Cannot convert "${L}" to ${this.name}`);return typeof L=="number"&&(L=BigInt(L)),L},Db:Ci,readValueFromPointer:Sf(v,A,v.indexOf("u")==-1),Eb:null})}var Ci=8;function Jh(h,v,A,I){ai(h>>>=0,{name:v=Fn(v>>>0),fromWireType:function(L){return!!L},toWireType:function(L,K){return K?A:I},Db:Ci,readValueFromPointer:function(L){return this.fromWireType(ae()[L>>>0])},Eb:null})}var el=[],oi=[];function tl(h){9<(h>>>=0)&&--oi[h+1]==0&&(oi[h]=void 0,el.push(h))}var an=h=>{if(!h)throw new Ii("Cannot use deleted val. handle = "+h);return oi[h]},Sn=h=>{switch(h){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let v=el.pop()||oi.length;return oi[v]=h,oi[v+1]=1,v}};function rl(h){return this.fromWireType(at()[h>>>2>>>0])}var em={name:"emscripten::val",fromWireType:h=>{var v=an(h);return tl(h),v},toWireType:(h,v)=>Sn(v),Db:Ci,readValueFromPointer:rl,Eb:null};function tm(h){return ai(h>>>0,em)}var rm=(h,v)=>{switch(v){case 4:return function(A){return this.fromWireType(kt()[A>>>2>>>0])};case 8:return function(A){return this.fromWireType(pt()[A>>>3>>>0])};default:throw new TypeError(`invalid float width (${v}): ${h}`)}};function _s(h,v,A){A>>>=0,ai(h>>>=0,{name:v=Fn(v>>>0),fromWireType:I=>I,toWireType:(I,L)=>L,Db:Ci,readValueFromPointer:rm(v,A),Eb:null})}function Tf(h,v,A,I,L){if(h>>>=0,A>>>=0,v=Fn(v>>>0),L===-1&&(L=4294967295),L=Ce=>Ce,I===0){var K=32-8*A;L=Ce=>Ce<<K>>>K}var _e=v.includes("unsigned")?function(Ce,rt){return rt>>>0}:function(Ce,rt){return rt};ai(h,{name:v,fromWireType:L,toWireType:_e,Db:Ci,readValueFromPointer:Sf(v,A,I!==0),Eb:null})}function nm(h,v,A){function I(K){var _e=at()[K>>>2>>>0];return K=at()[K+4>>>2>>>0],new L(qe().buffer,K,_e)}var L=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][v];ai(h>>>=0,{name:A=Fn(A>>>0),fromWireType:I,Db:Ci,readValueFromPointer:I},{Tb:!0})}function im(h,v){ai(h>>>=0,{name:v=Fn(v>>>0),fromWireType:function(A){for(var I,L=at()[A>>>2>>>0],K=A+4,_e=K,Ce=0;Ce<=L;++Ce){var rt=K+Ce;Ce!=L&&ae()[rt>>>0]!=0||(_e=Ar(_e,rt-_e),I===void 0?I=_e:(I+="\0",I+=_e),_e=rt+1)}return Vn(A),I},toWireType:function(A,I){I instanceof ArrayBuffer&&(I=new Uint8Array(I));var L=typeof I=="string";if(!(L||I instanceof Uint8Array||I instanceof Uint8ClampedArray||I instanceof Int8Array))throw new Ii("Cannot pass non-string to std::string");var K=L?mf(I):I.length,_e=Ls(4+K+1),Ce=_e+4;if(at()[_e>>>2>>>0]=K,L)Sa(I,Ce,K+1);else if(L)for(L=0;L<K;++L){var rt=I.charCodeAt(L);if(255<rt)throw Vn(_e),new Ii("String has UTF-16 code units that do not fit in 8 bits");ae()[Ce+L>>>0]=rt}else for(L=0;L<K;++L)ae()[Ce+L>>>0]=I[L];return A!==null&&A.push(Vn,_e),_e},Db:Ci,readValueFromPointer:rl,Eb(A){Vn(A)}})}var Ta=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,nl=(h,v)=>{for(var A=h>>1,I=A+v/2;!(A>=I)&&Re()[A>>>0];)++A;if(32<(A<<=1)-h&&Ta)return Ta.decode(ae().slice(h,A));for(A="",I=0;!(I>=v/2);++I){var L=we()[h+2*I>>>1>>>0];if(L==0)break;A+=String.fromCharCode(L)}return A},Af=(h,v,A)=>{if(A??(A=2147483647),2>A)return 0;var I=v;A=(A-=2)<2*h.length?A/2:h.length;for(var L=0;L<A;++L){var K=h.charCodeAt(L);we()[v>>>1>>>0]=K,v+=2}return we()[v>>>1>>>0]=0,v-I},il=h=>2*h.length,am=(h,v)=>{for(var A=0,I="";!(A>=v/4);){var L=ne()[h+4*A>>>2>>>0];if(L==0)break;++A,65536<=L?(L-=65536,I+=String.fromCharCode(55296|L>>10,56320|1023&L)):I+=String.fromCharCode(L)}return I},om=(h,v,A)=>{if(v>>>=0,A??(A=2147483647),4>A)return 0;var I=v;A=I+A-4;for(var L=0;L<h.length;++L){var K=h.charCodeAt(L);if(55296<=K&&57343>=K&&(K=65536+((1023&K)<<10)|1023&h.charCodeAt(++L)),ne()[v>>>2>>>0]=K,(v+=4)+4>A)break}return ne()[v>>>2>>>0]=0,v-I},sm=h=>{for(var v=0,A=0;A<h.length;++A){var I=h.charCodeAt(A);55296<=I&&57343>=I&&++A,v+=4}return v};function um(h,v,A){if(h>>>=0,v>>>=0,A=Fn(A>>>=0),v===2)var I=nl,L=Af,K=il,_e=Ce=>Re()[Ce>>>1>>>0];else v===4&&(I=am,L=om,K=sm,_e=Ce=>at()[Ce>>>2>>>0]);ai(h,{name:A,fromWireType:Ce=>{for(var rt,yt=at()[Ce>>>2>>>0],Pt=Ce+4,Zt=0;Zt<=yt;++Zt){var or=Ce+4+Zt*v;Zt!=yt&&_e(or)!=0||(Pt=I(Pt,or-Pt),rt===void 0?rt=Pt:(rt+="\0",rt+=Pt),Pt=or+v)}return Vn(Ce),rt},toWireType:(Ce,rt)=>{if(typeof rt!="string")throw new Ii(`Cannot pass non-string to C++ string type ${A}`);var yt=K(rt),Pt=Ls(4+yt+v);return at()[Pt>>>2>>>0]=yt/v,L(rt,Pt+4,yt+v),Ce!==null&&Ce.push(Vn,Pt),Pt},Db:Ci,readValueFromPointer:rl,Eb(Ce){Vn(Ce)}})}function On(h,v){ai(h>>>=0,{Ub:!0,name:v=Fn(v>>>0),Db:0,fromWireType:()=>{},toWireType:()=>{}})}function bn(h){wo(h>>>0,!o,1,!a,131072,!1),vs()}var Aa=h=>{if(!dt)try{if(h(),!(0<Lt))try{s?vo(R):Pn(R)}catch(v){v instanceof ze||v=="unwind"||m(0,v)}}catch(v){v instanceof ze||v=="unwind"||m(0,v)}};function al(h){h>>>=0,typeof Atomics.kc=="function"&&(Atomics.kc(ne(),h>>>2,h).value.then(xs),h+=128,Atomics.store(ne(),h>>>2,1))}var xs=()=>{var h=Ns();h&&(al(h),Aa(Ds))};function kf(h,v){(h>>>=0)==v>>>0?setTimeout(xs):s?postMessage({Hb:h,Cb:"checkMailbox"}):(h=Br[h])&&h.postMessage({Cb:"checkMailbox"})}var $s=[];function lm(h,v,A,I,L){for(v>>>=0,I/=2,$s.length=I,A=L>>>0>>>3,L=0;L<I;L++)$s[L]=fe[A+2*L]?fe[A+2*L+1]:pt()[A+2*L+1>>>0];return(v?q[v]:vl[h])(...$s)}var cm=()=>{Lt=0};function ol(h){h>>>=0,s?postMessage({Cb:"cleanupThread",ic:h}):yn(Br[h])}function fm(h){}var Es=(h,v)=>{var A=Ju[h];if(A===void 0)throw h=zs(h),A=Fn(h),Vn(h),new Ii(`${v} has unknown type ${A}`);return A},If=(h,v,A)=>{var I=[];return h=h.toWireType(I,A),I.length&&(at()[v>>>2>>>0]=Sn(I)),h};function dm(h,v,A){return v>>>=0,A>>>=0,h=an(h>>>0),v=Es(v,"emval::as"),If(v,A,h)}function pm(h,v){return v>>>=0,h=an(h>>>0),(v=Es(v,"emval::as")).toWireType(null,h)}var Ss=h=>{try{h()}catch(v){T(v)}},Oi=0,Gn=null,Bi=0,Ts=[],Cf={},lo={},sl=0,As=null,Of=[];function Bf(h){return function(v){if(!dt){if(Oi===0){var A=!1,I=!1;v((L=0)=>{if(!dt&&(Bi=L,A=!0,I)){Oi=2,Ss(()=>ed(Gn)),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.resume(),L=!1;try{var K=function(){var rt=ne()[Gn+8>>>2>>>0];return rt=vt[lo[rt]],--Lt,rt()}()}catch(rt){K=rt,L=!0}var _e=!1;if(!Gn){var Ce=As;Ce&&(As=null,(L?Ce.reject:Ce.resolve)(K),_e=!0)}if(L&&!_e)throw K}}),I=!0,A||(Oi=1,Gn=function(){var L=Ls(65548),K=L+12;at()[L>>>2>>>0]=K,at()[L+4>>>2>>>0]=K+65536,K=Ts[0];var _e=Cf[K];return _e===void 0&&(_e=sl++,Cf[K]=_e,lo[_e]=K),K=_e,ne()[L+8>>>2>>>0]=K,L}(),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.pause(),Ss(()=>Qf(Gn)))}else Oi===2?(Oi=0,Ss(td),Vn(Gn),Gn=null,Of.forEach(Aa)):T(`invalid state: ${Oi}`);return Bi}}(v=>{h().then(v)})}function ul(h){return h>>>=0,Bf(async()=>{var v=await an(h);return Sn(v)})}var ka=[];function Ri(h,v,A,I){return A>>>=0,I>>>=0,(h=ka[h>>>0])(null,v=an(v>>>0),A,I)}var ks={},co=h=>{var v=ks[h];return v===void 0?Fn(h):v};function Rf(h,v,A,I,L){return A>>>=0,I>>>=0,L>>>=0,(h=ka[h>>>0])(v=an(v>>>0),v[A=co(A)],I,L)}function hm(h,v){return v>>>=0,(h=an(h>>>0))==an(v)}var zf=()=>typeof globalThis=="object"?globalThis:Function("return this")();function mm(h){return(h>>>=0)==0?Sn(zf()):(h=co(h),Sn(zf()[h]))}var gm=h=>{var v=ka.length;return ka.push(h),v},ym=(h,v)=>{for(var A=Array(h),I=0;I<h;++I)A[I]=Es(at()[v+4*I>>>2>>>0],"parameter "+I);return A},Nf=(h,v)=>Object.defineProperty(v,"name",{value:h});function bm(h,v,A){var I=(v=ym(h,v>>>0)).shift();h--;var L=`return function (obj, func, destructorsRef, args) {
`,K=0,_e=[];A===0&&_e.push("obj");for(var Ce=["retType"],rt=[I],yt=0;yt<h;++yt)_e.push("arg"+yt),Ce.push("argType"+yt),rt.push(v[yt]),L+=`  var arg${yt} = argType${yt}.readValueFromPointer(args${K?"+"+K:""});
`,K+=v[yt].Db;return L+=`  var rv = ${A===1?"new func":"func.call"}(${_e.join(", ")});
`,I.Ub||(Ce.push("emval_returnValue"),rt.push(If),L+=`  return emval_returnValue(retType, destructorsRef, rv);
`),Ce.push(L+`};
`),h=function(Pt){var Zt=Function;if(!(Zt instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof Zt} which is not a function`);var or=Nf(Zt.name||"unknownFunctionName",function(){});return or.prototype=Zt.prototype,or=new or,(Pt=Zt.apply(or,Pt))instanceof Object?Pt:or}(Ce)(...rt),A=`methodCaller<(${v.map(Pt=>Pt.name).join(", ")}) => ${I.name}>`,gm(Nf(A,h))}function zi(h){return h=co(h>>>0),Sn(n[h])}function wm(h,v){return v>>>=0,h=an(h>>>0),v=an(v),Sn(h[v])}function vm(h){9<(h>>>=0)&&(oi[h+1]+=1)}function fo(){return Sn([])}function _m(h){h=an(h>>>0);for(var v=Array(h.length),A=0;A<h.length;A++)v[A]=h[A];return Sn(v)}function Ia(h){return Sn(co(h>>>0))}function Lf(){return Sn({})}function Ca(h){for(var v=an(h>>>=0);v.length;){var A=v.pop();v.pop()(A)}tl(h)}function Df(h,v,A){v>>>=0,A>>>=0,h=an(h>>>0),v=an(v),A=an(A),h[v]=A}function Qi(h,v){return v>>>=0,h=(h=Es(h>>>0,"_emval_take_value")).readValueFromPointer(v),Sn(h)}function ll(h,v){h=-9007199254740992>h||9007199254740992<h?NaN:Number(h),v>>>=0,h=new Date(1e3*h),ne()[v>>>2>>>0]=h.getUTCSeconds(),ne()[v+4>>>2>>>0]=h.getUTCMinutes(),ne()[v+8>>>2>>>0]=h.getUTCHours(),ne()[v+12>>>2>>>0]=h.getUTCDate(),ne()[v+16>>>2>>>0]=h.getUTCMonth(),ne()[v+20>>>2>>>0]=h.getUTCFullYear()-1900,ne()[v+24>>>2>>>0]=h.getUTCDay(),h=(h.getTime()-Date.UTC(h.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,ne()[v+28>>>2>>>0]=h}var Mf=h=>h%4==0&&(h%100!=0||h%400==0),Pf=[0,31,60,91,121,152,182,213,244,274,305,335],Uf=[0,31,59,90,120,151,181,212,243,273,304,334];function Ff(h,v){h=-9007199254740992>h||9007199254740992<h?NaN:Number(h),v>>>=0,h=new Date(1e3*h),ne()[v>>>2>>>0]=h.getSeconds(),ne()[v+4>>>2>>>0]=h.getMinutes(),ne()[v+8>>>2>>>0]=h.getHours(),ne()[v+12>>>2>>>0]=h.getDate(),ne()[v+16>>>2>>>0]=h.getMonth(),ne()[v+20>>>2>>>0]=h.getFullYear()-1900,ne()[v+24>>>2>>>0]=h.getDay();var A=(Mf(h.getFullYear())?Pf:Uf)[h.getMonth()]+h.getDate()-1|0;ne()[v+28>>>2>>>0]=A,ne()[v+36>>>2>>>0]=-60*h.getTimezoneOffset(),A=new Date(h.getFullYear(),6,1).getTimezoneOffset();var I=new Date(h.getFullYear(),0,1).getTimezoneOffset();h=0|(A!=I&&h.getTimezoneOffset()==Math.min(I,A)),ne()[v+32>>>2>>>0]=h}function xm(h){h>>>=0;var v=new Date(ne()[h+20>>>2>>>0]+1900,ne()[h+16>>>2>>>0],ne()[h+12>>>2>>>0],ne()[h+8>>>2>>>0],ne()[h+4>>>2>>>0],ne()[h>>>2>>>0],0),A=ne()[h+32>>>2>>>0],I=v.getTimezoneOffset(),L=new Date(v.getFullYear(),6,1).getTimezoneOffset(),K=new Date(v.getFullYear(),0,1).getTimezoneOffset(),_e=Math.min(K,L);return 0>A?ne()[h+32>>>2>>>0]=+(L!=K&&_e==I):0<A!=(_e==I)&&(L=Math.max(K,L),v.setTime(v.getTime()+6e4*((0<A?_e:L)-I))),ne()[h+24>>>2>>>0]=v.getDay(),A=(Mf(v.getFullYear())?Pf:Uf)[v.getMonth()]+v.getDate()-1|0,ne()[h+28>>>2>>>0]=A,ne()[h>>>2>>>0]=v.getSeconds(),ne()[h+4>>>2>>>0]=v.getMinutes(),ne()[h+8>>>2>>>0]=v.getHours(),ne()[h+12>>>2>>>0]=v.getDate(),ne()[h+16>>>2>>>0]=v.getMonth(),ne()[h+20>>>2>>>0]=v.getYear(),h=v.getTime(),BigInt(isNaN(h)?-1:h/1e3)}function Gf(h,v,A,I,L,K,_e){return s?Rt(16,1,h,v,A,I,L,K,_e):-52}function cl(h,v,A,I,L,K){if(s)return Rt(17,1,h,v,A,I,L,K)}var cr={},jf=()=>performance.timeOrigin+performance.now();function Vf(h,v){if(s)return Rt(18,1,h,v);if(cr[h]&&(clearTimeout(cr[h].id),delete cr[h]),!v)return 0;var A=setTimeout(()=>{delete cr[h],Aa(()=>Zf(h,performance.timeOrigin+performance.now()))},v);return cr[h]={id:A,rc:v},0}function jn(h,v,A,I){h>>>=0,v>>>=0,A>>>=0,I>>>=0;var L=new Date().getFullYear(),K=new Date(L,0,1).getTimezoneOffset();L=new Date(L,6,1).getTimezoneOffset();var _e=Math.max(K,L);at()[h>>>2>>>0]=60*_e,ne()[v>>>2>>>0]=+(K!=L),h=(v=Ce=>{var rt=Math.abs(Ce);return`UTC${0<=Ce?"-":"+"}${String(Math.floor(rt/60)).padStart(2,"0")}${String(rt%60).padStart(2,"0")}`})(K),v=v(L),L<K?(Sa(h,A,17),Sa(v,I,17)):(Sa(h,I,17),Sa(v,A,17))}var fl=()=>Date.now(),Is=1;function Ji(h,v,A){if(!(0<=h&&3>=h))return 28;if(h===0)h=Date.now();else{if(!Is)return 52;h=performance.timeOrigin+performance.now()}return fe[A>>>0>>>3]=BigInt(Math.round(1e6*h)),0}var po=[],ho=(h,v)=>{po.length=0;for(var A;A=ae()[h++>>>0];){var I=A!=105;v+=(I&=A!=112)&&v%8?4:0,po.push(A==112?at()[v>>>2>>>0]:A==106?fe[v>>>3]:A==105?ne()[v>>>2>>>0]:pt()[v>>>3>>>0]),v+=I?8:4}return po};function mo(h,v,A){return h>>>=0,v=ho(v>>>0,A>>>0),q[h](...v)}function Cs(h,v,A){return h>>>=0,v=ho(v>>>0,A>>>0),q[h](...v)}var Wf=()=>{};function dl(h,v){return E(Ar(h>>>0,v>>>0))}var Hf=()=>{throw Lt+=1,"unwind"};function $m(){return 4294901760}var Em=()=>navigator.hardwareConcurrency;function Sm(){return T("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function Tm(h){h>>>=0;var v=ae().length;if(h<=v||4294901760<h)return!1;for(var A=1;4>=A;A*=2){var I=v*(1+.2/A);I=Math.min(I,h+100663296);e:{I=(Math.min(4294901760,65536*Math.ceil(Math.max(h,I)/65536))-$.buffer.byteLength+65535)/65536|0;try{$.grow(I),Bt();var L=1;break e}catch{}L=void 0}if(L)return!0}return!1}var Oa=()=>(T("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),si={},Os=h=>{h.forEach(v=>{var A=Oa();A&&(si[A]=v)})};function pl(){var h=Error().stack.toString().split(`
`);return h[0]=="Error"&&h.shift(),Os(h),si.Mb=Oa(),si.dc=h,si.Mb}function Ba(h,v,A){if(h>>>=0,v>>>=0,si.Mb==h)var I=si.dc;else(I=Error().stack.toString().split(`
`))[0]=="Error"&&I.shift(),Os(I);for(var L=3;I[L]&&Oa()!=h;)++L;for(h=0;h<A&&I[h+L];++h)ne()[v+4*h>>>2>>>0]=Oa();return h}var go,yo={},Bs=()=>{if(!go){var h,v={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(h in yo)yo[h]===void 0?delete v[h]:v[h]=yo[h];var A=[];for(h in v)A.push(`${h}=${v[h]}`);go=A}return go};function Rs(h,v){if(s)return Rt(19,1,h,v);h>>>=0,v>>>=0;var A=0;return Bs().forEach((I,L)=>{var K=v+A;for(L=at()[h+4*L>>>2>>>0]=K,K=0;K<I.length;++K)qe()[L++>>>0]=I.charCodeAt(K);qe()[L>>>0]=0,A+=I.length+1}),0}function hl(h,v){if(s)return Rt(20,1,h,v);h>>>=0,v>>>=0;var A=Bs();at()[h>>>2>>>0]=A.length;var I=0;return A.forEach(L=>I+=L.length+1),at()[v>>>2>>>0]=I,0}function ml(h){return s?Rt(21,1,h):52}function gl(h,v,A,I){return s?Rt(22,1,h,v,A,I):52}function yl(h,v,A,I){return s?Rt(23,1,h,v,A,I):70}var qf=[null,[],[]];function bl(h,v,A,I){if(s)return Rt(24,1,h,v,A,I);v>>>=0,A>>>=0,I>>>=0;for(var L=0,K=0;K<A;K++){var _e=at()[v>>>2>>>0],Ce=at()[v+4>>>2>>>0];v+=8;for(var rt=0;rt<Ce;rt++){var yt=ae()[_e+rt>>>0],Pt=qf[h];yt===0||yt===10?((h===1?y:E)(df(Pt)),Pt.length=0):Pt.push(yt)}L+=Ce}return at()[I>>>2>>>0]=L,0}s||function(){for(var h=n.numThreads-1;h--;)sf();qt.unshift(()=>{Kt++,function(v){s?v():Promise.all(Un.map(of)).then(v)}(()=>w())})}();for(var wl=Array(256),bo=0;256>bo;++bo)wl[bo]=String.fromCharCode(bo);Ef=wl,Ii=n.BindingError=class extends Error{constructor(h){super(h),this.name="BindingError"}},n.InternalError=class extends Error{constructor(h){super(h),this.name="InternalError"}},oi.push(0,1,void 0,1,null,1,!0,1,!1,1),n.count_emval_handles=()=>oi.length/2-5-el.length;var vt,vl=[cn,Ea,cf,pf,hf,gf,yf,Yu,Zu,xr,bf,wf,vf,_f,xf,$f,Gf,cl,Vf,Rs,hl,ml,gl,yl,bl];(async function(){function h(I,L){return vt=I.exports,vt=function(){var K=vt,_e={};for(let[Ce,rt]of Object.entries(K))_e[Ce]=typeof rt=="function"?(...yt)=>{Ts.push(Ce);try{return rt(...yt)}finally{dt||(Ts.pop(),Gn&&Oi===1&&Ts.length===0&&(Oi=0,Lt+=1,Ss(Jf),typeof Fibers<"u"&&Fibers.sc()))}}:rt;return _e}(),vt=function(){var K=vt,_e=rt=>yt=>rt(yt)>>>0,Ce=rt=>()=>rt()>>>0;return(K=Object.assign({},K)).Ea=_e(K.Ea),K.gb=Ce(K.gb),K.ib=_e(K.ib),K.ub=_e(K.ub),K.vb=Ce(K.vb),K.__cxa_get_exception_ptr=_e(K.__cxa_get_exception_ptr),K}(),Mr.push(vt.jb),k=L,w(),vt}Kt++;var v=O();if(n.instantiateWasm)return new Promise(I=>{n.instantiateWasm(v,(L,K)=>{h(L,K),I(L.exports)})});if(s)return new Promise(I=>{gt=L=>{var K=new WebAssembly.Instance(L,O());I(h(K,L))}});yr??(yr=n.locateFile?n.locateFile?n.locateFile("ort-wasm-simd-threaded.jsep.wasm",g):g+"ort-wasm-simd-threaded.jsep.wasm":new URL("ort-wasm-simd-threaded.jsep.wasm",import.meta.url).href);try{var A=await async function(I){var L=yr;if(!He&&typeof WebAssembly.instantiateStreaming=="function"&&!he(L))try{var K=fetch(L,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(K,I)}catch(_e){E(`wasm streaming compile failed: ${_e}`),E("falling back to ArrayBuffer instantiation")}return async function(_e,Ce){try{var rt=await async function(yt){if(!He)try{var Pt=await f(yt);return new Uint8Array(Pt)}catch{}if(yt==yr&&He)yt=new Uint8Array(He);else{if(!p)throw"both async and sync fetching of the wasm failed";yt=p(yt)}return yt}(_e);return await WebAssembly.instantiate(rt,Ce)}catch(yt){E(`failed to asynchronously prepare wasm: ${yt}`),T(yt)}}(L,I)}(v);return h(A.instance,A.module)}catch(I){return r(I),Promise.reject(I)}})();var zs=h=>(zs=vt.Ea)(h),Ra=()=>(Ra=vt.Fa)();n._OrtInit=(h,v)=>(n._OrtInit=vt.Ga)(h,v),n._OrtGetLastError=(h,v)=>(n._OrtGetLastError=vt.Ha)(h,v),n._OrtCreateSessionOptions=(h,v,A,I,L,K,_e,Ce,rt,yt)=>(n._OrtCreateSessionOptions=vt.Ia)(h,v,A,I,L,K,_e,Ce,rt,yt),n._OrtAppendExecutionProvider=(h,v,A,I,L)=>(n._OrtAppendExecutionProvider=vt.Ja)(h,v,A,I,L),n._OrtAddFreeDimensionOverride=(h,v,A)=>(n._OrtAddFreeDimensionOverride=vt.Ka)(h,v,A),n._OrtAddSessionConfigEntry=(h,v,A)=>(n._OrtAddSessionConfigEntry=vt.La)(h,v,A),n._OrtReleaseSessionOptions=h=>(n._OrtReleaseSessionOptions=vt.Ma)(h),n._OrtCreateSession=(h,v,A)=>(n._OrtCreateSession=vt.Na)(h,v,A),n._OrtReleaseSession=h=>(n._OrtReleaseSession=vt.Oa)(h),n._OrtGetInputOutputCount=(h,v,A)=>(n._OrtGetInputOutputCount=vt.Pa)(h,v,A),n._OrtGetInputOutputMetadata=(h,v,A,I)=>(n._OrtGetInputOutputMetadata=vt.Qa)(h,v,A,I),n._OrtFree=h=>(n._OrtFree=vt.Ra)(h),n._OrtCreateTensor=(h,v,A,I,L,K)=>(n._OrtCreateTensor=vt.Sa)(h,v,A,I,L,K),n._OrtGetTensorData=(h,v,A,I,L)=>(n._OrtGetTensorData=vt.Ta)(h,v,A,I,L),n._OrtReleaseTensor=h=>(n._OrtReleaseTensor=vt.Ua)(h),n._OrtCreateRunOptions=(h,v,A,I)=>(n._OrtCreateRunOptions=vt.Va)(h,v,A,I),n._OrtAddRunConfigEntry=(h,v,A)=>(n._OrtAddRunConfigEntry=vt.Wa)(h,v,A),n._OrtReleaseRunOptions=h=>(n._OrtReleaseRunOptions=vt.Xa)(h),n._OrtCreateBinding=h=>(n._OrtCreateBinding=vt.Ya)(h),n._OrtBindInput=(h,v,A)=>(n._OrtBindInput=vt.Za)(h,v,A),n._OrtBindOutput=(h,v,A,I)=>(n._OrtBindOutput=vt._a)(h,v,A,I),n._OrtClearBoundOutputs=h=>(n._OrtClearBoundOutputs=vt.$a)(h),n._OrtReleaseBinding=h=>(n._OrtReleaseBinding=vt.ab)(h),n._OrtRunWithBinding=(h,v,A,I,L)=>(n._OrtRunWithBinding=vt.bb)(h,v,A,I,L),n._OrtRun=(h,v,A,I,L,K,_e,Ce)=>(n._OrtRun=vt.cb)(h,v,A,I,L,K,_e,Ce),n._OrtEndProfiling=h=>(n._OrtEndProfiling=vt.db)(h),n._JsepOutput=(h,v,A)=>(n._JsepOutput=vt.eb)(h,v,A),n._JsepGetNodeName=h=>(n._JsepGetNodeName=vt.fb)(h);var Ns=()=>(Ns=vt.gb)(),Vn=n._free=h=>(Vn=n._free=vt.hb)(h),Ls=n._malloc=h=>(Ls=n._malloc=vt.ib)(h),wo=(h,v,A,I,L,K)=>(wo=vt.lb)(h,v,A,I,L,K),Xf=()=>(Xf=vt.mb)(),Kf=(h,v,A,I,L)=>(Kf=vt.nb)(h,v,A,I,L),Yf=h=>(Yf=vt.ob)(h),vo=h=>(vo=vt.pb)(h),Zf=(h,v)=>(Zf=vt.qb)(h,v),Ds=()=>(Ds=vt.rb)(),_l=(h,v)=>(_l=vt.sb)(h,v),_o=h=>(_o=vt.tb)(h),xo=h=>(xo=vt.ub)(h),xl=()=>(xl=vt.vb)(),$o=n.dynCall_ii=(h,v)=>($o=n.dynCall_ii=vt.wb)(h,v),Qf=h=>(Qf=vt.xb)(h),Jf=()=>(Jf=vt.yb)(),ed=h=>(ed=vt.zb)(h),td=()=>(td=vt.Ab)();return n.stackSave=()=>xl(),n.stackRestore=h=>_o(h),n.stackAlloc=h=>xo(h),n.setValue=function(h,v,A="i8"){switch(A.endsWith("*")&&(A="*"),A){case"i1":case"i8":qe()[h>>>0]=v;break;case"i16":we()[h>>>1>>>0]=v;break;case"i32":ne()[h>>>2>>>0]=v;break;case"i64":fe[h>>>3]=BigInt(v);break;case"float":kt()[h>>>2>>>0]=v;break;case"double":pt()[h>>>3>>>0]=v;break;case"*":at()[h>>>2>>>0]=v;break;default:T(`invalid type for setValue: ${A}`)}},n.getValue=function(h,v="i8"){switch(v.endsWith("*")&&(v="*"),v){case"i1":case"i8":return qe()[h>>>0];case"i16":return we()[h>>>1>>>0];case"i32":return ne()[h>>>2>>>0];case"i64":return fe[h>>>3];case"float":return kt()[h>>>2>>>0];case"double":return pt()[h>>>3>>>0];case"*":return at()[h>>>2>>>0];default:T(`invalid type for getValue: ${v}`)}},n.UTF8ToString=Ar,n.stringToUTF8=Sa,n.lengthBytesUTF8=mf,function h(){if(0<Kt)br=h;else if(s)t(n),er();else{for(;0<qt.length;)qt.shift()(n);0<Kt?br=h:(n.calledRun=!0,dt||(er(),t(n)))}}(),n.PTR_SIZE=4,i}),_k=h1,xT=globalThis.self?.name?.startsWith("em-pthread"),xT&&h1()}),kb=We(()=>{"use strict";Ab(),m1=typeof location>"u"?void 0:location.origin,ub=import.meta.url>"file:"&&import.meta.url<"file;",$T=()=>{if(ub){let e=URL;return new URL(new e("ort.bundle.min.mjs",import.meta.url).href,m1).href}return import.meta.url},Nn=$T(),xk=()=>{if(Nn&&!Nn.startsWith("blob:"))return Nn.substring(0,Nn.lastIndexOf("/")+1)},ph=(e,t)=>{try{let r=t??Nn;return(r?new URL(e,r):new URL(e)).origin===m1}catch{return!1}},ET=(e,t)=>{let r=t??Nn;try{return(r?new URL(e,r):new URL(e)).href}catch{return}},ST=(e,t)=>`${t??"./"}${e}`,g1=async e=>{let t=await(await fetch(e,{credentials:"same-origin"})).blob();return URL.createObjectURL(t)},TT=async e=>(await import(e)).default,y1=(b9(),Hc(bk)).default,$k=async()=>{if(!Nn)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(ph(Nn))return[void 0,y1()];let e=await g1(Nn);return[e,y1(e)]},b1=(w9(),Hc(vk)).default,Ek=async(e,t,r)=>{if(!e&&!t&&b1&&Nn&&ph(Nn))return[void 0,b1];{let n="ort-wasm-simd-threaded.jsep.mjs",i=e??ET(n,t),a=r&&i&&!ph(i,t),o=a?await g1(i):i??ST(n,t);return[a?o:void 0,await TT(o)]}}}),ms=We(()=>{"use strict";kb(),hh=!1,Oc=!1,v1=!1,AT=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},kT=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},IT=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},Ib=async e=>{if(hh)return Promise.resolve();if(Oc)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(v1)throw new Error("previous call to 'initializeWebAssembly()' failed.");Oc=!0;let t=e.initTimeout,r=e.numThreads;if(e.simd!==!1){if(e.simd==="relaxed"){if(!IT())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!kT())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let n=AT();r>1&&!n&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+r+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),e.numThreads=r=1);let i=e.wasmPaths,a=typeof i=="string"?i:void 0,o=i?.mjs,s=o?.href??o,u=i?.wasm,l=u?.href??u,c=e.wasmBinary,[f,p]=await Ek(s,a,r>1),d=!1,m=[];if(t>0&&m.push(new Promise(g=>{setTimeout(()=>{d=!0,g()},t)})),m.push(new Promise((g,x)=>{let b={numThreads:r};if(c)b.wasmBinary=c;else if(l||a)b.locateFile=y=>l??a+y;else if(s&&s.indexOf("blob:")!==0)b.locateFile=y=>new URL(y,s).href;else if(f){let y=xk();y&&(b.locateFile=E=>y+E)}p(b).then(y=>{Oc=!1,hh=!0,w1=y,g(),f&&URL.revokeObjectURL(f)},y=>{Oc=!1,v1=!0,x(y)})})),await Promise.race(m),d)throw new Error(`WebAssembly backend initializing failed due to timeout: ${t}ms`)},gr=()=>{if(hh&&w1)return w1;throw new Error("WebAssembly is not initialized yet.")}}),Cb=We(()=>{"use strict";ms(),Ei=(e,t)=>{let r=gr(),n=r.lengthBytesUTF8(e)+1,i=r._malloc(n);return r.stringToUTF8(e,i,n),t.push(i),i},Ah=(e,t,r,n)=>{if(typeof e=="object"&&e!==null){if(r.has(e))throw new Error("Circular reference in options");r.add(e)}Object.entries(e).forEach(([i,a])=>{let o=t?t+i:i;if(typeof a=="object")Ah(a,o+".",r,n);else if(typeof a=="string"||typeof a=="number")n(o,a.toString());else if(typeof a=="boolean")n(o,a?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof a}`)})},ur=e=>{let t=gr(),r=t.stackSave();try{let n=t.PTR_SIZE,i=t.stackAlloc(2*n);t._OrtGetLastError(i,i+n);let a=Number(t.getValue(i,n===4?"i32":"i64")),o=t.getValue(i+n,"*"),s=o?t.UTF8ToString(o):"";throw new Error(`${e} ERROR_CODE: ${a}, ERROR_MESSAGE: ${s}`)}finally{t.stackRestore(r)}}}),v9=We(()=>{"use strict";ms(),Cb(),Sk=e=>{let t=gr(),r=0,n=[],i=e||{};try{if(e?.logSeverityLevel===void 0)i.logSeverityLevel=2;else if(typeof e.logSeverityLevel!="number"||!Number.isInteger(e.logSeverityLevel)||e.logSeverityLevel<0||e.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${e.logSeverityLevel}`);if(e?.logVerbosityLevel===void 0)i.logVerbosityLevel=0;else if(typeof e.logVerbosityLevel!="number"||!Number.isInteger(e.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${e.logVerbosityLevel}`);e?.terminate===void 0&&(i.terminate=!1);let a=0;return e?.tag!==void 0&&(a=Ei(e.tag,n)),r=t._OrtCreateRunOptions(i.logSeverityLevel,i.logVerbosityLevel,!!i.terminate,a),r===0&&ur("Can't create run options."),e?.extra!==void 0&&Ah(e.extra,"",new WeakSet,(o,s)=>{let u=Ei(o,n),l=Ei(s,n);t._OrtAddRunConfigEntry(r,u,l)!==0&&ur(`Can't set a run config entry: ${o} - ${s}.`)}),[r,n]}catch(a){throw r!==0&&t._OrtReleaseRunOptions(r),n.forEach(o=>t._free(o)),a}}}),_9=We(()=>{"use strict";ms(),Cb(),CT=e=>{switch(e){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${e}`)}},OT=e=>{switch(e){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${e}`)}},BT=e=>{e.extra||(e.extra={}),e.extra.session||(e.extra.session={});let t=e.extra.session;t.use_ort_model_bytes_directly||(t.use_ort_model_bytes_directly="1"),e.executionProviders&&e.executionProviders.some(r=>(typeof r=="string"?r:r.name)==="webgpu")&&(e.enableMemPattern=!1)},Bc=(e,t,r,n)=>{let i=Ei(t,n),a=Ei(r,n);gr()._OrtAddSessionConfigEntry(e,i,a)!==0&&ur(`Can't set a session config entry: ${t} - ${r}.`)},RT=async(e,t,r)=>{for(let n of t){let i=typeof n=="string"?n:n.name,a=[];switch(i){case"webnn":if(i="WEBNN",typeof n!="string"){let c=n?.deviceType;c&&Bc(e,"deviceType",c,r)}break;case"webgpu":if(i="JS",typeof n!="string"){let c=n;if(c?.preferredLayout){if(c.preferredLayout!=="NCHW"&&c.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${c.preferredLayout}`);Bc(e,"preferredLayout",c.preferredLayout,r)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${i}`)}let o=Ei(i,r),s=a.length,u=0,l=0;if(s>0){u=gr()._malloc(s*gr().PTR_SIZE),r.push(u),l=gr()._malloc(s*gr().PTR_SIZE),r.push(l);for(let c=0;c<s;c++)gr().setValue(u+c*gr().PTR_SIZE,a[c][0],"*"),gr().setValue(l+c*gr().PTR_SIZE,a[c][1],"*")}await gr()._OrtAppendExecutionProvider(e,o,u,l,s)!==0&&ur(`Can't append execution provider: ${i}.`)}},Tk=async e=>{let t=gr(),r=0,n=[],i=e||{};BT(i);try{let a=CT(i.graphOptimizationLevel??"all"),o=OT(i.executionMode??"sequential"),s=typeof i.logId=="string"?Ei(i.logId,n):0,u=i.logSeverityLevel??2;if(!Number.isInteger(u)||u<0||u>4)throw new Error(`log serverity level is not valid: ${u}`);let l=i.logVerbosityLevel??0;if(!Number.isInteger(l)||l<0||l>4)throw new Error(`log verbosity level is not valid: ${l}`);let c=typeof i.optimizedModelFilePath=="string"?Ei(i.optimizedModelFilePath,n):0;if(r=t._OrtCreateSessionOptions(a,!!i.enableCpuMemArena,!!i.enableMemPattern,o,!!i.enableProfiling,0,s,u,l,c),r===0&&ur("Can't create session options."),i.executionProviders&&await RT(r,i.executionProviders,n),i.enableGraphCapture!==void 0){if(typeof i.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${i.enableGraphCapture}`);Bc(r,"enableGraphCapture",i.enableGraphCapture.toString(),n)}if(i.freeDimensionOverrides)for(let[f,p]of Object.entries(i.freeDimensionOverrides)){if(typeof f!="string")throw new Error(`free dimension override name must be a string: ${f}`);if(typeof p!="number"||!Number.isInteger(p)||p<0)throw new Error(`free dimension override value must be a non-negative integer: ${p}`);let d=Ei(f,n);t._OrtAddFreeDimensionOverride(r,d,p)!==0&&ur(`Can't set a free dimension override: ${f} - ${p}.`)}return i.extra!==void 0&&Ah(i.extra,"",new WeakSet,(f,p)=>{Bc(r,f,p,n)}),[r,n]}catch(a){throw r!==0&&t._OrtReleaseSessionOptions(r)!==0&&ur("Can't release session options."),n.forEach(o=>t._free(o)),a}}}),Ct=We(()=>{"use strict";ls=e=>{switch(e){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${e}`)}},va=e=>{switch(e){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${e}`)}},cs=(e,t)=>{let r=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][e],n=typeof t=="number"?t:t.reduce((i,a)=>i*a,1);return r>0?Math.ceil(n*r):void 0},zh=e=>{switch(e){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${e}`)}},kh=e=>{switch(e){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${e}`)}},Ob=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",Bb=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint64"||e==="int8"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",lb=e=>{switch(e){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${e}`)}}}),Ak=We(()=>{"use strict";Ab(),Rb=async e=>{if(typeof e=="string"){let t=await fetch(e);if(!t.ok)throw new Error(`failed to load external data file: ${e}`);let r=t.headers.get("Content-Length"),n=r?parseInt(r,10):0;if(n<1073741824)return new Uint8Array(await t.arrayBuffer());{if(!t.body)throw new Error(`failed to load external data file: ${e}, no response body.`);let i=t.body.getReader(),a;try{a=new ArrayBuffer(n)}catch(s){if(s instanceof RangeError){let u=Math.ceil(n/65536);a=new WebAssembly.Memory({initial:u,maximum:u}).buffer}else throw s}let o=0;for(;;){let{done:s,value:u}=await i.read();if(s)break;let l=u.byteLength;new Uint8Array(a,o,l).set(u),o+=l}return new Uint8Array(a,0,n)}}else return e instanceof Blob?new Uint8Array(await e.arrayBuffer()):e instanceof Uint8Array?e:new Uint8Array(e)}}),_a=We(()=>{"use strict";Ct(),zT=["V","I","W","E","F"],NT=(e,t)=>{console.log(`[${zT[e]},${new Date().toISOString()}]${t}`)},zb=(e,t)=>{LT=e,DT=t},MT=(e,t)=>{let r=kh(e),n=kh(LT);r>=n&&NT(r,typeof t=="function"?t():t)},Qt=(...e)=>{DT&&MT(...e)}}),Ft=We(()=>{"use strict";PT=class{static calcMatMulShape(e,t){return e[1]!==t[0]?void 0:[e[0],t[1]]}},Vu=class{static calcShape(e,t,r=!1){let n=e.length,i=t.length;if(n===0)return t;if(i===0)return e;let a=Math.max(e.length,t.length),o=new Array(a);if(r){if(n<2||i<2)return;let s=PT.calcMatMulShape([e[n-2],e[n-1]],[t[i-2],t[i-1]]);if(s===void 0)return;[o[a-2],o[a-1]]=s}for(let s=r?3:1;s<=a;s++){let u=n-s<0?1:e[n-s],l=i-s<0?1:t[i-s];if(u!==l&&u>1&&l>1)return;let c=Math.max(u,l);if(u&&l)o[a-s]=Math.max(u,l);else{if(c>1)return;o[a-s]=0}}return o}static isValidBroadcast(e,t){let r=e.length,n=t.length;if(r>n)return!1;for(let i=1;i<=r;i++)if(e[r-i]!==1&&e[r-i]!==t[n-i])return!1;return!0}},me=class Sh{static size(t){return Sh.getSizeFromDimensionRange(t,0,t.length)}static convertShape(t,r=4){let n=t.length;if(n===0)return[];let i=new Array(n),a=n-1;for(;a>=0;){if(t[a]%r===0){i[a]=t[a]/r;break}if(r%t[a]!==0)throw new Error("cannot convert shape");i[a]=1,r/=t[a],a--}for(a--;a>=0;a--)i[a]=t[a];return i}static sizeFromDimension(t,r){if(r<0||r>t.length)throw new Error(`invalid dimension of ${r} for sizeFromDimension as Tensor has ${t.length} dimensions.`);return Sh.getSizeFromDimensionRange(t,r,t.length)}static sizeToDimension(t,r){if(r<0||r>t.length)throw new Error(`invalid dimension of ${r} for sizeToDimension as Tensor has ${t.length} dimensions.`);return Sh.getSizeFromDimensionRange(t,0,r)}static getSizeFromDimensionRange(t,r,n){let i=1;for(let a=r;a<n;a++){if(t[a]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");i*=Number(t[a])}return i}static computeStrides(t){let r=t.length;if(r===0)return[];if(r===1)return[1];let n=new Array(r);n[r-1]=1,n[r-2]=t[r-1];for(let i=r-3;i>=0;--i)n[i]=n[i+1]*t[i+1];return n}static normalizeAxis(t,r){if(t<-r&&t>=r)throw new Error("unsupported axis for this operation.");return t<0?t+r:t}static normalizeAxes(t,r){return t.map(n=>this.normalizeAxis(n,r??t.length))}static sortBasedOnPerm(t,r){return r?r.map(n=>t[n]):t.slice().reverse()}static padShape(t,r){let n=t.length;return t.map((i,a)=>i+r[a]+r[a+n])}static areEqual(t,r){return t.length!==r.length?!1:t.every((n,i)=>n===r[i])}},Ih=class Gc{static adjustPoolAttributes(t,r,n,i,a,o){if(!t&&n.length!==r.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(t)for(let s=0;s<r.length-2;s++)s>=n.length?n.push(r[s+2]):n[s]=r[s+2];for(let s=0;s<n.length;s++)if(s<i.length){if(i[s]<0)throw new Error("strides should be greater than or equal to 1")}else i.push(1);for(let s=0;s<n.length;s++)if(s<a.length){if(a[s]<0)throw new Error("dilations should be greater than or equal to 1")}else a.push(1);for(let s=0;s<n.length*2;s++)if(s<o.length){if(o[s]<0)throw new Error("pad should be greater than or equal to 1")}else o.push(0);for(let s=0;s<n.length;s++){if(n[s]<=0)throw new Error("kernel shapes need to be greater than 0");if(o[s]>=n[s]||o[s+n.length]>=n[s])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(t,r,n,i,a,o,s){if(s){if(a.length!==2*(t.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(r.length!==t.length-2)throw new Error("length of strides should be the length of data dimensions");if(i.length!==t.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let u=0;u<t.length-2;u++)Gc.adjustPadAndReturnShape(t[u+(o?1:2)],r[u],n[u],i[u],a,u,u+t.length-2,s)}}static computePoolOutputShape(t,r,n,i,a,o,s){if(r.length<=0)throw new Error("input shape must be of size greater than 0");let u=[r[0],r[1]];return Gc.computeShapeHelper(t,r,u,n,i,a,o,s),u}static computeConvOutputShape(t,r,n,i,a,o,s){if(t.length<=0||r.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let u=[t[0],r[0]];return Gc.computeShapeHelper(!1,t,u,n,i,a,o,s),u}static computeShapeHelper(t,r,n,i,a,o,s,u){if(t)for(let l=0;l<r.length-2;l++)n.push(1);else for(let l=0;l<r.length-2;l++)n.push(Gc.adjustPadAndReturnShape(r[l+2],i[l],a[l],o[l],s,l,l+r.length-2,u))}static adjustPadAndReturnShape(t,r,n,i,a,o,s,u){let l=n*(i-1)+1;if(u&&u!=="NOTSET")switch(u){case"VALID":return a[o]=0,a[s]=0,Math.floor((t-l)/r+1);case"SAME_LOWER":case"SAME_UPPER":if(n!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let c=((t+r-1)/r-1)*r+i-t;return a[o]=Math.floor(u==="SAME_LOWER"?(c+1)/2:c/2),a[s]=c-a[o],Math.floor((t+c-i)/r+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((t+a[o]+a[s]-l)/r+1)}},kk=class{static getShapeOfGemmResult(e,t,r,n,i){if(e.length!==2||r.length!==2)throw new Error("shape need to be of size 2");let a,o,s;t?(a=e[1],o=e[0]):(a=e[0],o=e[1]);let u=-1;if(n?(s=r[0],u=1):(s=r[1],u=0),r[u]!==o)throw new Error("dimension mismatch");if(a<=0||s<=0||o<=0)throw new Error("invalid shape specified");if(i&&!Vu.isValidBroadcast(i,[a,s]))throw new Error("gemm: invalid bias shape for broadcast");return[a,s,o]}},Ik=-34028234663852886e22,Ck=34028234663852886e22}),Ok=We(()=>{"use strict";Ct(),Nb=(e,t)=>new(zh(t))(e)}),x9=We(()=>{"use strict";Ct(),_a(),_1=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),cb=(e,t)=>{if(t==="int32")return e;let r=_1.get(t);if(!r)throw new Error(`WebNN backend does not support data type: ${t}`);let n=r/8;if(e.byteLength%n!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${n}.`);let i=e.byteLength/n,a=new(zh(t))(e.buffer,e.byteOffset,i);switch(t){case"int64":case"uint64":{let o=new Int32Array(i);for(let s=0;s<i;s++){let u=a[s];if(u>2147483647n||u<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");o[s]=Number(u)}return new Uint8Array(o.buffer)}case"int8":case"uint8":case"uint32":{if(t==="uint32"&&a.some(s=>s>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let o=Int32Array.from(a,Number);return new Uint8Array(o.buffer)}default:throw new Error(`Unsupported data conversion from ${t} to 'int32'`)}},x1=(e,t)=>{if(t==="int32")return e;if(e.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let r=e.byteLength/4,n=new Int32Array(e.buffer,e.byteOffset,r);switch(t){case"int64":{let i=BigInt64Array.from(n,BigInt);return new Uint8Array(i.buffer)}case"uint64":{if(n.some(a=>a<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let i=BigUint64Array.from(n,BigInt);return new Uint8Array(i.buffer)}case"int8":{if(n.some(a=>a<-128||a>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let i=Int8Array.from(n,Number);return new Uint8Array(i.buffer)}case"uint8":{if(n.some(i=>i<0||i>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(n,Number)}case"uint32":{if(n.some(a=>a<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let i=Uint32Array.from(n,Number);return new Uint8Array(i.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${t}`)}},UT=1,$1=()=>UT++,FT=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),E1=(e,t)=>{let r=_1.get(e);if(!r)throw new Error(`WebNN backend does not support data type: ${e}`);return t.length>0?Math.ceil(t.reduce((n,i)=>n*i)*r/8):0},S1=class{constructor(e){this.isDataConverted=!1;let{sessionId:t,context:r,tensor:n,dataType:i,shape:a,fallbackDataType:o}=e;this.sessionId=t,this.mlContext=r,this.mlTensor=n,this.dataType=i,this.tensorShape=a,this.fallbackDataType=o}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return E1(this.dataType,this.tensorShape)}destroy(){Qt("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(e){this.mlContext.writeTensor(this.mlTensor,e)}async read(e){if(this.fallbackDataType){let t=await this.mlContext.readTensor(this.mlTensor),r=x1(new Uint8Array(t),this.dataType);if(e){(e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).set(r);return}else return r.buffer}else return e?this.mlContext.readTensor(this.mlTensor,e):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(e,t,r){return this.mlContext===e&&this.dataType===t&&this.tensorShape.length===r.length&&this.tensorShape.every((n,i)=>n===r[i])}setIsDataConverted(e){this.isDataConverted=e}},T1=class{constructor(e,t){this.tensorManager=e,this.wrapper=t}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(e,t,r,n){let i=this.tensorManager.getMLContext(e),a;if(!i.opSupportLimits().input.dataTypes.includes(t)){if(a=FT.get(t),!a||!i.opSupportLimits().input.dataTypes.includes(a))throw new Error(`WebNN backend does not support data type: ${t}`);Qt("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${t} to ${a}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(i,t,r))return this.wrapper.tensor;if(n){if(this.wrapper.byteLength!==E1(t,r))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let o=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(e,t,r,o,!0,!0,a),n&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(e){let t=e;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")t=cb(e,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(e.byteLength===this.wrapper.byteLength){this.wrapper.write(t);return}else Qt("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(t):this.activeUpload=new Uint8Array(t)}async download(e){if(this.activeUpload){let t=this.wrapper?.isDataConverted?x1(this.activeUpload,this.wrapper?.type):this.activeUpload;if(e){e instanceof ArrayBuffer?new Uint8Array(e).set(t):new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(t);return}else return t.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return e?this.wrapper.read(e):this.wrapper.read()}},GT=class{constructor(e){this.backend=e,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(e){let t=this.backend.getMLContext(e);if(!t)throw new Error("MLContext not found for session.");return t}reserveTensorId(){let e=$1();return this.tensorTrackersById.set(e,new T1(this)),e}releaseTensorId(e){let t=this.tensorTrackersById.get(e);t&&(this.tensorTrackersById.delete(e),t.tensorWrapper&&this.releaseTensor(t.tensorWrapper))}async ensureTensor(e,t,r,n,i){Qt("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${t}, dataType: ${r}, shape: ${n}, copyOld: ${i}}`);let a=this.tensorTrackersById.get(t);if(!a)throw new Error("Tensor not found.");return a.ensureTensor(e,r,n,i)}upload(e,t){let r=this.tensorTrackersById.get(e);if(!r)throw new Error("Tensor not found.");r.upload(t)}async download(e,t){Qt("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${e}, dstBuffer: ${t?.byteLength}}`);let r=this.tensorTrackersById.get(e);if(!r)throw new Error("Tensor not found.");return r.download(t)}releaseTensorsForSession(e){for(let t of this.freeTensors)t.sessionId===e&&t.destroy();this.freeTensors=this.freeTensors.filter(t=>t.sessionId!==e)}registerTensor(e,t,r,n){let i=this.getMLContext(e),a=$1(),o=new S1({sessionId:e,context:i,tensor:t,dataType:r,shape:n});return this.tensorTrackersById.set(a,new T1(this,o)),this.externalTensors.add(o),a}async getCachedTensor(e,t,r,n,i,a,o){let s=this.getMLContext(e);for(let[l,c]of this.freeTensors.entries())if(c.canReuseTensor(s,t,r)){Qt("verbose",()=>`[WebNN] Reusing tensor {dataType: ${t}, ${o?`fallbackDataType: ${o},`:""} shape: ${r}`);let f=this.freeTensors.splice(l,1)[0];return f.sessionId=e,f}Qt("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${t}, ${o?`fallbackDataType: ${o},`:""} shape: ${r}}`);let u=await s.createTensor({dataType:o??t,shape:r,dimensions:r,usage:n,writable:i,readable:a});return new S1({sessionId:e,context:s,tensor:u,dataType:t,shape:r,fallbackDataType:o})}releaseTensor(e){this.externalTensors.has(e)&&this.externalTensors.delete(e),this.freeTensors.push(e)}},Bk=(...e)=>new GT(...e)}),$9=We(()=>{"use strict";Ct(),ms(),Ok(),x9(),_a(),Rc=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),jT=(e,t)=>{if(e===t)return!0;if(e===void 0||t===void 0)return!1;let r=Object.keys(e).sort(),n=Object.keys(t).sort();return r.length===n.length&&r.every((i,a)=>i===n[a]&&e[i]===t[i])},Rk=class{constructor(e){this.tensorManager=Bk(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,zb(e.logLevel,!!e.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(e){Qt("verbose",()=>`[WebNN] onRunStart {sessionId: ${e}}`),this.activeSessionId=e}onRunEnd(e){Qt("verbose",()=>`[WebNN] onRunEnd {sessionId: ${e}}`);let t=this.temporarySessionTensorIds.get(e);if(t){for(let r of t)Qt("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${r}}`),this.tensorManager.releaseTensorId(r);this.temporarySessionTensorIds.delete(e),this.activeSessionId=void 0}}async createMLContext(e){if(e instanceof GPUDevice){let r=this.mlContextCache.findIndex(n=>n.gpuDevice===e);if(r!==-1)return this.mlContextCache[r].mlContext;{let n=await navigator.ml.createContext(e);return this.mlContextCache.push({gpuDevice:e,mlContext:n}),n}}else if(e===void 0){let r=this.mlContextCache.findIndex(n=>n.options===void 0&&n.gpuDevice===void 0);if(r!==-1)return this.mlContextCache[r].mlContext;{let n=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:n}),n}}let t=this.mlContextCache.findIndex(r=>jT(r.options,e));if(t!==-1)return this.mlContextCache[t].mlContext;{let r=await navigator.ml.createContext(e);return this.mlContextCache.push({options:e,mlContext:r}),r}}registerMLContext(e,t){this.mlContextBySessionId.set(e,t);let r=this.sessionIdsByMLContext.get(t);r||(r=new Set,this.sessionIdsByMLContext.set(t,r)),r.add(e),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(e,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(e,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(e){this.sessionGraphInputs.delete(e),this.sessionGraphOutputs.delete(e);let t=this.mlContextBySessionId.get(e);if(!t)return;this.tensorManager.releaseTensorsForSession(e),this.mlContextBySessionId.delete(e);let r=this.sessionIdsByMLContext.get(t);if(r.delete(e),r.size===0){this.sessionIdsByMLContext.delete(t);let n=this.mlContextCache.findIndex(i=>i.mlContext===t);n!==-1&&this.mlContextCache.splice(n,1)}}getMLContext(e){return this.mlContextBySessionId.get(e)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(e){Qt("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${e}}`),this.tensorManager.releaseTensorId(e)}async ensureTensor(e,t,r,n,i){let a=Rc.get(r);if(!a)throw new Error(`Unsupported ONNX data type: ${r}`);return this.tensorManager.ensureTensor(e??this.currentSessionId,t,a,n,i)}async createTemporaryTensor(e,t,r){Qt("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${t}, shape: ${r}}`);let n=Rc.get(t);if(!n)throw new Error(`Unsupported ONNX data type: ${t}`);let i=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(e,i,n,r,!1);let a=this.temporarySessionTensorIds.get(e);return a?a.push(i):this.temporarySessionTensorIds.set(e,[i]),i}uploadTensor(e,t){if(!gr().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");Qt("verbose",()=>`[WebNN] uploadTensor {tensorId: ${e}, data: ${t.byteLength}}`),this.tensorManager.upload(e,t)}async downloadTensor(e,t){return this.tensorManager.download(e,t)}createMLTensorDownloader(e,t){return async()=>{let r=await this.tensorManager.download(e);return Nb(r,t)}}registerMLTensor(e,t,r,n){let i=Rc.get(r);if(!i)throw new Error(`Unsupported ONNX data type: ${r}`);let a=this.tensorManager.registerTensor(e,t,i,n);return Qt("verbose",()=>`[WebNN] registerMLTensor {tensor: ${t}, dataType: ${i}, dimensions: ${n}} -> {tensorId: ${a}}`),a}registerMLConstant(e,t,r,n,i,a,o=!1){if(!a)throw new Error("External mounted files are not available.");let s=e;e.startsWith("./")&&(s=e.substring(2));let u=a.get(s);if(!u)throw new Error(`File with name ${s} not found in preloaded files.`);if(t+r>u.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let l=u.slice(t,t+r).buffer,c;switch(i.dataType){case"float32":c=new Float32Array(l);break;case"float16":c=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(l):new Uint16Array(l);break;case"int32":c=new Int32Array(l);break;case"uint32":c=new Uint32Array(l);break;case"int64":if(o){let f=cb(new Uint8Array(l),"int64");c=new Int32Array(f.buffer),i.dataType="int32"}else c=new BigInt64Array(l);break;case"uint64":c=new BigUint64Array(l);break;case"int8":c=new Int8Array(l);break;case"int4":case"uint4":case"uint8":c=new Uint8Array(l);break;default:throw new Error(`Unsupported data type: ${i.dataType} in creating WebNN Constant from external data.`)}return Qt("verbose",()=>`[WebNN] registerMLConstant {dataType: ${i.dataType}, shape: ${i.shape}}} ${o?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),n.constant(i,c)}registerGraphInput(e){this.temporaryGraphInputs.push(e)}registerGraphOutput(e){this.temporaryGraphOutputs.push(e)}isGraphInput(e,t){let r=this.sessionGraphInputs.get(e);return r?r.includes(t):!1}isGraphOutput(e,t){let r=this.sessionGraphOutputs.get(e);return r?r.includes(t):!1}isGraphInputOutputTypeSupported(e,t,r=!0){let n=this.mlContextBySessionId.get(e),i=Rc.get(ls(t));return typeof i>"u"?!1:r?!!n?.opSupportLimits().input.dataTypes.includes(i):!!n?.opSupportLimits().output.dataTypes.includes(i)}flush(){}}}),Lb=We(()=>{"use strict"}),E9=We(()=>{"use strict";_a(),Lb(),A1=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),mh=[],gh=e=>Math.ceil(Number(e)/16)*16,VT=e=>{for(let t=0;t<mh.length;t++){let r=mh[t];if(e<=r)return r}return Math.ceil(e/16)*16},WT=1,k1=()=>WT++,fb=async(e,t,r,n)=>{let i=gh(r),a=e.device.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let o=e.getCommandEncoder();e.endComputePass(),o.copyBufferToBuffer(t,0,a,0,i),e.flush(),await a.mapAsync(GPUMapMode.READ);let s=a.getMappedRange();if(n){let u=n();return u.set(new Uint8Array(s,0,r)),u}else return new Uint8Array(s.slice(0,r))}finally{a.destroy()}},HT=class{constructor(e){this.backend=e,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[t]of A1)mh.push(t),this.freeBuffers.set(t,[]),this.freeUniformBuffers.set(t,[]);this.sessionCount=0}upload(e,t){let r=t.buffer,n=t.byteOffset,i=t.byteLength,a=gh(i),o=this.storageCache.get(e);if(!o)throw new Error("gpu data for uploading does not exist");if(Number(o.originalSize)!==i)throw new Error(`inconsistent data size. gpu data size=${o.originalSize}, data size=${i}`);let s=this.backend.device.createBuffer({mappedAtCreation:!0,size:a,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),u=s.getMappedRange();new Uint8Array(u).set(new Uint8Array(r,n,i)),s.unmap();let l=this.backend.device.createCommandEncoder();l.copyBufferToBuffer(s,0,o.gpuData.buffer,0,a),this.backend.device.queue.submit([l.finish()]),s.destroy(),Qt("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${e})`)}memcpy(e,t){let r=this.storageCache.get(e);if(!r)throw new Error("source gpu data for memcpy does not exist");let n=this.storageCache.get(t);if(!n)throw new Error("destination gpu data for memcpy does not exist");if(r.originalSize!==n.originalSize)throw new Error("inconsistent source and destination gpu data size");let i=gh(r.originalSize),a=this.backend.getCommandEncoder();this.backend.endComputePass(),a.copyBufferToBuffer(r.gpuData.buffer,0,n.gpuData.buffer,0,i)}registerExternalBuffer(e,t,r){let n;if(r){if(n=r[0],e===r[1])return Qt("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${t}) => id=${n}, buffer is the same, skip.`),n;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else n=k1();return this.storageCache.set(n,{gpuData:{id:n,type:0,buffer:e},originalSize:t}),Qt("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${t}) => id=${n}, registered.`),n}unregisterExternalBuffer(e){e!==void 0&&(this.storageCache.delete(e),Qt("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${e}`))}create(e,t=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let r=VT(e),n,i=(t&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,a=(t&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(i||a){let s=(i?this.freeBuffers:this.freeUniformBuffers).get(r);s?s.length>0?n=s.pop():n=this.backend.device.createBuffer({size:r,usage:t}):n=this.backend.device.createBuffer({size:r,usage:t})}else n=this.backend.device.createBuffer({size:r,usage:t});let o={id:k1(),type:0,buffer:n};return this.storageCache.set(o.id,{gpuData:o,originalSize:Number(e)}),Qt("verbose",()=>`[WebGPU] GpuDataManager.create(size=${e}) => id=${o.id}`),o}get(e){return this.storageCache.get(e)?.gpuData}release(e){let t=typeof e=="bigint"?Number(e):e,r=this.storageCache.get(t);if(!r){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return Qt("verbose",()=>`[WebGPU] GpuDataManager.release(id=${t}), gpuDataId=${r.gpuData.id}`),this.storageCache.delete(t),this.buffersPending.push(r.gpuData.buffer),r.originalSize}async download(e,t){let r=this.storageCache.get(Number(e));if(!r)throw new Error("data does not exist");await fb(this.backend,r.gpuData.buffer,r.originalSize,t)}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let e of this.buffersPending){let t=A1.get(e.size);if((e.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let r=this.freeBuffers.get(e.size)||[];t===void 0||r.length>=t?e.destroy():r.push(e)}else if((e.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let r=this.freeUniformBuffers.get(e.size)||[];t===void 0||r.length>=t?e.destroy():r.push(e)}else e.destroy()}this.buffersPending=[]}else{let e=this.capturedPendingBuffers.get(this.backend.currentSessionId);e||(e=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,e));for(let t of this.buffersPending)e.push(t);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.freeUniformBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.storageCache.forEach(e=>{e.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(e){let t=this.capturedPendingBuffers.get(e);t&&(t.forEach(r=>{r.destroy()}),this.capturedPendingBuffers.delete(e)),this.sessionCount-=1,this.sessionCount===0&&(Qt("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(r=>{r.gpuData.buffer.destroy()}),this.storageCache=new Map)}},zk=(...e)=>new HT(...e)}),Or=We(()=>{"use strict";qT=class{constructor(e){Object.assign(this,e)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(e=>`${this[e]}`).join(";")),this.key}},ar=e=>new qT(e)}),jt=We(()=>{"use strict";Ct(),Ft(),Wu=64,yh=(e,t)=>{if(t===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(e)){case 10:return t>1?`vec${t}<f16>`:"f16";case 1:return t>1?`vec${t}<f32>`:"f32";case 6:return t>1?`vec${t}<i32>`:"i32";case 12:return t>1?`vec${t}<u32>`:"u32";case 7:if(t>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(t>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(t!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${e}`)}},Yr=(e,t=1)=>{let r=yh(e,t);return typeof r=="string"?r:r[0]},mn=(e,t=1)=>{let r=yh(e,t);return typeof r=="string"?r:r[1]},$t=(...e)=>{let t=[];return e.forEach(r=>{r.length!==0&&t.push({type:12,data:r},{type:12,data:me.computeStrides(r)})}),t},Tr=e=>e%4===0?4:e%2===0?2:1,db=(e="f32",t,r="0")=>!t||t===1?`${e}(${r})`:`vec${t}<${e}>(${r})`,ju=(e,t,r)=>e==="f32"?r:t===1?`f32(${r})`:`vec${t}<f32>(${r})`,io=(e,t)=>t===4?`(${e}.x + ${e}.y + ${e}.z + ${e}.w)`:t===2?`(${e}.x + ${e}.y)`:t===3?`(${e}.x + ${e}.y + ${e}.z)`:e,_t=(e,t,r,n)=>e.startsWith("uniforms.")&&r>4?typeof t=="string"?n==="f16"?`${e}[(${t}) / 8][(${t}) % 8 / 4][(${t}) % 8 % 4]`:`${e}[(${t}) / 4][(${t}) % 4]`:n==="f16"?`${e}[${Math.floor(t/8)}][${Math.floor(t%8/4)}][${t%8%4}]`:`${e}[${Math.floor(t/4)}][${t%4}]`:r>1?`${e}[${t}]`:e,zc=(e,t,r,n,i)=>{let a=typeof r=="number",o=a?r:r.length,s=[...new Array(o).keys()],u=o<2?"u32":o<=4?`vec${o}<u32>`:`array<u32, ${o}>`,l=yh(t,i),c=typeof l=="string"?l:l[1],f=typeof l=="string"?l:l[0],p={indices:u,value:c,storage:f,tensor:t},d=ae=>typeof ae=="string"?ae:`${ae}u`,m={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},g=a?"uniforms.":"",x=`${g}${e}_shape`,b=`${g}${e}_strides`,y="";for(let ae=0;ae<o-1;ae++)y+=`
    let dim${ae} = current / ${_t(b,ae,o)};
    let rest${ae} = current % ${_t(b,ae,o)};
    indices[${ae}] = dim${ae};
    current = rest${ae};
    `;y+=`indices[${o-1}] = current;`;let E=o<2?"":`
  fn o2i_${e}(offset: u32) -> ${p.indices} {
    var indices: ${p.indices};
    var current = offset;
    ${y}
    return indices;
  }`,$=ae=>(m.offsetToIndices=!0,o<2?ae:`o2i_${e}(${ae})`),k=[];if(o>=2)for(let ae=o-1;ae>=0;ae--)k.push(`${_t(b,ae,o)} * (indices[${ae}])`);let R=o<2?"":`
  fn i2o_${e}(indices: ${p.indices}) -> u32 {
    return ${k.join("+")};
  }`,C=ae=>(m.indicesToOffset=!0,o<2?ae:`i2o_${e}(${ae})`),P=(...ae)=>o===0?"0u":`${p.indices}(${ae.map(d).join(",")})`,W=(ae,we)=>o<2?`${ae}`:`${_t(ae,we,o)}`,te=(ae,we,Re)=>o<2?`${ae}=${Re};`:`${_t(ae,we,o)}=${Re};`,ce={},pe=(ae,we)=>{m.broadcastedIndicesToOffset=!0;let Re=`${we.name}broadcastedIndicesTo${e}Offset`;if(Re in ce)return`${Re}(${ae})`;let ne=[];for(let at=o-1;at>=0;at--){let kt=we.indicesGet("outputIndices",at+we.rank-o);ne.push(`${W(b,at)} * (${kt} % ${W(x,at)})`)}return ce[Re]=`fn ${Re}(outputIndices: ${we.type.indices}) -> u32 {
             return ${ne.length>0?ne.join("+"):"0u"};
           }`,`${Re}(${ae})`},ge=(ae,we)=>(()=>{if(p.storage===p.value)return`${e}[${ae}]=${we};`;if(p.storage==="vec2<u32>"&&p.value==="i32")return`${e}[${ae}]=vec2<u32>(u32(${we}), select(0u, 0xFFFFFFFFu, ${we} < 0));`;if(p.storage==="vec2<u32>"&&p.value==="u32")return`${e}[${ae}]=vec2<u32>(u32(${we}), 0u);`;if(p.storage==="u32"&&p.value==="vec4<bool>")return`${e}[${ae}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${we}));`;throw new Error(`not supported combination of storage type ${p.storage} and value type ${p.value} yet`)})(),fe=ae=>(()=>{if(p.storage===p.value)return`${e}[${ae}]`;if(p.storage==="vec2<u32>"&&p.value==="i32")return`i32(${e}[${ae}].x)`;if(p.storage==="vec2<u32>"&&p.value==="u32")return`u32(${e}[${ae}].x)`;if(p.storage==="u32"&&p.value==="vec4<bool>")return`vec4<bool>(bool(${e}[${ae}] & 0xFFu), bool(${e}[${ae}] & 0xFF00u), bool(${e}[${ae}] & 0xFF0000u), bool(${e}[${ae}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${p.storage} and value type ${p.value} yet`)})(),Me=o<2?"":`
  fn get_${e}ByIndices(indices: ${p.indices}) -> ${c} {
    return ${fe(`i2o_${e}(indices)`)};
  }`,Ge=o<2?"":(()=>{let ae=s.map(Re=>`d${Re}: u32`).join(", "),we=s.map(Re=>`d${Re}`).join(", ");return`
  fn get_${e}(${ae}) -> ${c} {
    return get_${e}ByIndices(${P(we)});
  }`})(),He=(...ae)=>{if(ae.length!==o)throw new Error(`indices length must be ${o}`);let we=ae.map(d).join(",");return o===0?fe("0u"):o===1?fe(we[0]):(m.get=!0,m.getByIndices=!0,m.indicesToOffset=!0,`get_${e}(${we})`)},dt=ae=>o<2?fe(ae):(m.getByIndices=!0,m.indicesToOffset=!0,`get_${e}ByIndices(${ae})`),he=o<2?"":`
  fn set_${e}ByIndices(indices: ${p.indices}, value: ${c}) {
    ${ge(`i2o_${e}(indices)`,"value")}
  }`,qe=o<2?"":(()=>{let ae=s.map(Re=>`d${Re}: u32`).join(", "),we=s.map(Re=>`d${Re}`).join(", ");return`
  fn set_${e}(${ae}, value: ${c}) {
    set_${e}ByIndices(${P(we)}, value);
  }`})();return{impl:()=>{let ae=[],we=!1;return m.offsetToIndices&&(ae.push(E),we=!0),m.indicesToOffset&&(ae.push(R),we=!0),m.broadcastedIndicesToOffset&&(Object.values(ce).forEach(Re=>ae.push(Re)),we=!0),m.set&&(ae.push(qe),we=!0),m.setByIndices&&(ae.push(he),we=!0),m.get&&(ae.push(Ge),we=!0),m.getByIndices&&(ae.push(Me),we=!0),!a&&we&&ae.unshift(`const ${x} = ${p.indices}(${r.join(",")});`,`const ${b} = ${p.indices}(${me.computeStrides(r).join(",")});`),ae.join(`
`)},type:p,offsetToIndices:$,indicesToOffset:C,broadcastedIndicesToOffset:pe,indices:P,indicesGet:W,indicesSet:te,set:(...ae)=>{if(ae.length!==o+1)throw new Error(`indices length must be ${o}`);let we=ae[o];if(typeof we!="string")throw new Error("value must be string");let Re=ae.slice(0,o).map(d).join(",");return o===0?ge("0u",we):o===1?ge(Re[0],we):(m.set=!0,m.setByIndices=!0,m.indicesToOffset=!0,`set_${e}(${Re}, ${we})`)},setByOffset:ge,setByIndices:(ae,we)=>o<2?ge(ae,we):(m.setByIndices=!0,m.indicesToOffset=!0,`set_${e}ByIndices(${ae}, ${we});`),get:He,getByOffset:fe,getByIndices:dt,usage:n,name:e,strides:b,shape:x,rank:o}},$e=(e,t,r,n=1)=>zc(e,t,r,"input",n),wt=(e,t,r,n=1)=>zc(e,t,r,"output",n),Nk=(e,t,r)=>zc(e,t,r,"atomicOutput",1),Db=(e,t,r,n=1)=>zc(e,t,r,"internal",n),XT=class{constructor(e,t){this.normalizedDispatchGroup=e,this.limits=t,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(e){return`if (global_idx >= ${typeof e=="number"?`${e}u`:e}) { return; }`}mainStart(e=Wu){let t=typeof e=="number"?e:e[0],r=typeof e=="number"?1:e[1],n=typeof e=="number"?1:e[2];if(t>this.limits.maxComputeWorkgroupSizeX||r>this.limits.maxComputeWorkgroupSizeY||n>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${t}, ${r}, ${n}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(t*r*n>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${t}, ${r}, ${n}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let i=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,a=i?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,o=i?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${t*r*n}u + local_idx;`;return`@compute @workgroup_size(${t}, ${r}, ${n})
  fn main(${a}) {
    ${o}
  `}appendVariableUniforms(e){e.rank!==0&&(e.shape.startsWith("uniforms.")&&this.uniforms.push({name:e.shape.replace("uniforms.",""),type:"u32",length:e.rank}),e.strides.startsWith("uniforms.")&&this.uniforms.push({name:e.strides.replace("uniforms.",""),type:"u32",length:e.rank}))}declareVariable(e,t){if(e.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(e),this.appendVariableUniforms(e);let r=e.usage==="input"?"read":"read_write",n=e.usage==="atomicOutput"?"atomic<i32>":e.type.storage;return`@group(0) @binding(${t}) var<storage, ${r}> ${e.name}: array<${n}>;`}declareVariables(...e){return e.map(t=>this.declareVariable(t,this.variableIndex++)).join(`
`)}registerInternalVariable(e){if(e.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(e),this.appendVariableUniforms(e)}registerInternalVariables(...e){return e.forEach(t=>this.registerInternalVariable(t)),this}registerUniform(e,t,r=1){return this.uniforms.push({name:e,type:t,length:r}),this}registerUniforms(e){return this.uniforms=this.uniforms.concat(e),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let e=[];for(let{name:t,type:r,length:n}of this.uniforms)if(n&&n>4)r==="f16"?e.push(`@align(16) ${t}:array<mat2x4<${r}>, ${Math.ceil(n/8)}>`):e.push(`${t}:array<vec4<${r}>, ${Math.ceil(n/4)}>`);else{let i=n==null||n===1?r:`vec${n}<${r}>`;e.push(`${t}:${i}`)}return`
      struct Uniforms { ${e.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(e=>e.impl()).join(`
`)+this.internalVariables.map(e=>e.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let e=t=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(t)];return this.uniforms.map(t=>[e(t.type),t.length??1])}},Lk=(e,t)=>new XT(e,t)}),ao=We(()=>{"use strict";Ct(),Ft(),Or(),jt(),KT=(e,t)=>{if(!e||e.length!==1)throw new Error("Transpose requires 1 input.");if(t.length!==0&&t.length!==e[0].dims.length)throw new Error(`perm size ${t.length} does not match input rank ${e[0].dims.length}`)},I1=(e,t)=>t.length!==0?t:[...new Array(e).keys()].reverse(),YT=(e,t)=>me.sortBasedOnPerm(e,I1(e.length,t)),ZT=(e,t,r,n)=>{let i=`fn perm(i: ${n.type.indices}) -> ${r.type.indices} {
    var a: ${r.type.indices};`;for(let a=0;a<t;++a)i+=`a[${e[a]}]=i[${a}];`;return i+="return a;}"},QT=(e,t)=>{let r=[],n=[];for(let i=0;i<e.length;++i)e[i]!==1&&r.push(e[i]),e[t[i]]!==1&&n.push(t[i]);return{newShape:r,newPerm:n}},JT=(e,t)=>{let r=0;for(let n=0;n<e.length;++n)if(t[e[n]]!==1){if(e[n]<r)return!1;r=e[n]}return!0},Dn=(e,t)=>{let r=e.dataType,n=e.dims.length,i=I1(n,t),a=YT(e.dims,i),o=e.dims,s=a,u=n<2||JT(i,e.dims),l;if(u)return l=m=>{let g=$e("input",r,o,4),x=wt("output",r,s,4);return`
  ${m.registerUniform("output_size","u32").declareVariables(g,x)}
  ${m.mainStart()}
    ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let m=me.size(a);return{outputs:[{dims:a,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(m/64/4)},programUniforms:[{type:12,data:Math.ceil(m/4)}]}},getShaderSource:l};let{newShape:c,newPerm:f}=QT(e.dims,i),p=me.areEqual(f,[2,3,1]),d=me.areEqual(f,[3,1,2]);if(c.length===2||p||d){o=p?[c[0],c[1]*c[2]]:d?[c[0]*c[1],c[2]]:c,s=[o[1],o[0]];let m=16;return l=g=>{let x=$e("a",r,o.length),b=wt("output",r,s.length);return`
  ${g.registerUniform("output_size","u32").declareVariables(x,b)}
  var<workgroup> tile : array<array<${b.type.value}, ${m+1}>, ${m}>;
  ${g.mainStart([m,m,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${m} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${m}u + local_id.x;
    let input_row = workgroup_id_x * ${m}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${x.getByIndices(`${x.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${m}u + local_id.x;
    let output_row = workgroup_id_y * ${m}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${b.setByIndices(`${b.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let g=me.size(a);return{outputs:[{dims:a,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(s[1]/m),y:Math.ceil(s[0]/m)},programUniforms:[{type:12,data:g},...$t(o,s)]}},getShaderSource:l}}return l=m=>{let g=$e("a",r,o.length),x=wt("output",r,s.length);return`
  ${m.registerUniform("output_size","u32").declareVariables(g,x)}

  ${ZT(i,n,g,x)}

  ${m.mainStart()}
    ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${x.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${x.setByOffset("global_idx",g.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${t}`,inputDependencies:["rank"]},getRunData:()=>{let m=me.size(a);return{outputs:[{dims:a,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:[{type:12,data:m},...$t(o,s)]}},getShaderSource:l}},Dk=(e,t)=>{KT(e.inputs,t.perm),e.compute(Dn(e.inputs[0],t.perm))},Mk=e=>ar({perm:e.perm})}),S9=We(()=>{"use strict";Ct(),Ft(),jt(),Mb(),ao(),eA={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},tA={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},rA={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},nA={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},iA=(e,t)=>{let r=[];for(let n=t-e;n<t;++n)r.push(n);return r},aA=(e,t)=>{let r=[],n=e.length;for(let a=0;a<n;a++)t.indexOf(a)===-1&&r.push(e[a]);let i=t.map(a=>e[a]);return[r,i]},oA=(e,t)=>{let r=e.length+t.length,n=[],i=0;for(let a=0;a<r;a++)t.indexOf(a)===-1?n.push(e[i++]):n.push(1);return n},sA=(e,t)=>{for(let r=0;r<e.length;++r)if(e[e.length-r-1]!==t-1-r)return!1;return!0},uA=(e,t)=>{let r=[];if(!sA(e,t)){for(let n=0;n<t;++n)e.indexOf(n)===-1&&r.push(n);e.forEach(n=>r.push(n))}return r},lA=(e,t,r,n,i,a,o)=>{let s=r[0].dims,u=me.size(a),l=me.size(o),c=$e("_A",r[0].dataType,s),f=wt("output",i,a),p=64;u===1&&(p=256);let d=`
          var<workgroup> aBestValues : array<f32, ${p}>;
       `,m=g=>`
        ${g.registerUniform("reduceSize","u32").declareVariables(c,f)}
        ${d}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${g.mainStart(p)}

          let outputIndex = global_idx / ${p};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${rA[n]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${p}) {
           let candidate = f32(${c.getByOffset("offset + k")});
           bestValue = ${eA[n]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${p}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${tA[n]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${f.setByOffset("outputIndex",`${n==="mean"?`${f.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${f.type.storage}(${nA[n]})`}`)};
         }
        }`;return{name:e,shaderCache:{hint:`${t};${p}`,inputDependencies:["type"]},getShaderSource:m,getRunData:()=>({outputs:[{dims:a,dataType:i}],dispatchGroup:{x:u},programUniforms:[{type:12,data:l}]})}},wi=(e,t,r,n)=>{let i=e.inputs.length===1?r:pb(e.inputs,r),a=i.axes;a.length===0&&!i.noopWithEmptyAxes&&(a=e.inputs[0].dims.map((d,m)=>m));let o=me.normalizeAxes(a,e.inputs[0].dims.length),s=o,u=e.inputs[0],l=uA(s,e.inputs[0].dims.length);l.length>0&&(u=e.compute(Dn(e.inputs[0],l),{inputs:[0],outputs:[-1]})[0],s=iA(s.length,u.dims.length));let[c,f]=aA(u.dims,s),p=c;i.keepDims&&(p=oA(c,o)),e.compute(lA(t,i.cacheKey,[u],n,e.inputs[0].dataType,p,f),{inputs:[u]})},Pk=(e,t)=>{wi(e,"ReduceMeanShared",t,"mean")},Uk=(e,t)=>{wi(e,"ReduceL1Shared",t,"l1")},Fk=(e,t)=>{wi(e,"ReduceL2Shared",t,"l2")},Gk=(e,t)=>{wi(e,"ReduceLogSumExpShared",t,"logSumExp")},jk=(e,t)=>{wi(e,"ReduceMaxShared",t,"max")},Vk=(e,t)=>{wi(e,"ReduceMinShared",t,"min")},Wk=(e,t)=>{wi(e,"ReduceProdShared",t,"prod")},Hk=(e,t)=>{wi(e,"ReduceSumShared",t,"sum")},qk=(e,t)=>{wi(e,"ReduceSumSquareShared",t,"sumSquare")},Xk=(e,t)=>{wi(e,"ReduceLogSumShared",t,"logSum")}}),Mb=We(()=>{"use strict";Ct(),Ft(),Or(),jt(),S9(),vi=e=>{if(!e||e.length===0||e.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(e.length===2&&e[1].dims.length!==1)throw new Error("Invalid axes input dims.")},cA=e=>["","",`var value = ${e.getByIndices("input_indices")};`,""],Ch=(e,t,r,n,i,a,o=!1,s=!1)=>{let u=[],l=r[0].dims,c=l.length,f=me.normalizeAxes(i,c),p=!s&&f.length===0;l.forEach((g,x)=>{p||f.indexOf(x)>=0?o&&u.push(1):u.push(g)});let d=u.length,m=me.size(u);return{name:e,shaderCache:t,getShaderSource:g=>{let x=[],b=$e("_A",r[0].dataType,c),y=wt("output",a,d),E=n(b,y,f),$=E[2];for(let k=0,R=0;k<c;k++)p||f.indexOf(k)>=0?(o&&R++,$=`for(var j${k}: u32 = 0; j${k} < ${l[k]}; j${k}++) {
                  ${E[2].includes("last_index")?`let last_index = j${k};`:""}
                  ${b.indicesSet("input_indices",k,`j${k}`)}
                  ${$}
                }`):(x.push(`${b.indicesSet("input_indices",k,y.indicesGet("output_indices",R))};`),R++);return`

        ${g.registerUniform("output_size","u32").declareVariables(b,y)}

        ${g.mainStart()}
          ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${b.type.indices};
          let output_indices = ${y.offsetToIndices("global_idx")};

          ${x.join(`
`)}
          ${E[0]}       // init ops for reduce max/min
          ${E[1]}
          ${$}
          ${E[3]}
          ${E.length===4?y.setByOffset("global_idx","value"):E.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:u,dataType:a}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:[{type:12,data:m},...$t(l,u)]})}},pb=(e,t)=>{let r=[];return e[1].dims[0]>0&&e[1].getBigInt64Array().forEach(n=>r.push(Number(n))),ar({axes:r,keepDims:t.keepDims,noopWithEmptyAxes:t.noopWithEmptyAxes})},_i=(e,t,r,n)=>{let i=e.inputs,a=i.length===1?r:pb(i,r);e.compute(Ch(t,{hint:a.cacheKey,inputDependencies:["rank"]},[i[0]],a.noopWithEmptyAxes&&a.axes.length===0?cA:n,a.axes,i[0].dataType,a.keepDims,a.noopWithEmptyAxes),{inputs:[0]})},fA=(e,t)=>{vi(e.inputs),_i(e,"ReduceLogSum",t,(r,n)=>[`var value = ${n.type.storage}(0);`,"",`value += ${r.getByIndices("input_indices")};`,"value = log(value);"])},dA=(e,t)=>{vi(e.inputs),_i(e,"ReduceL1",t,(r,n)=>[`var value = ${n.type.storage}(0);`,"",`value += abs(${r.getByIndices("input_indices")});`,""])},pA=(e,t)=>{vi(e.inputs),_i(e,"ReduceL2",t,(r,n)=>[`var t = ${n.type.value}(0); var value = ${n.type.value}(0);`,"",`t = ${r.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},hA=(e,t)=>{vi(e.inputs),_i(e,"ReduceLogSumExp",t,(r,n)=>[`var value = ${n.type.storage}(0);`,"",`value += exp(${r.getByIndices("input_indices")});`,"value = log(value);"])},mA=(e,t)=>{vi(e.inputs),_i(e,"ReduceMax",t,(r,n,i)=>{let a=[];for(let o=0;o<r.rank;o++)(i.indexOf(o)>=0||i.length===0)&&a.push(r.indicesSet("input_indices",o,0));return[`${a.join(`
`)}`,`var value = ${r.getByIndices("input_indices")};`,`value = max(value, ${r.getByIndices("input_indices")});`,""]})},gA=(e,t)=>{vi(e.inputs),_i(e,"ReduceMean",t,(r,n,i)=>{let a=1;for(let o=0;o<r.rank;o++)(i.indexOf(o)>=0||i.length===0)&&(a*=e.inputs[0].dims[o]);return["var sum = f32(0);","",`sum += f32(${r.getByIndices("input_indices")});`,`let value = ${n.type.value}(sum / ${a});`]})},yA=(e,t)=>{vi(e.inputs),_i(e,"ReduceMin",t,(r,n,i)=>{let a=[];for(let o=0;o<r.rank;o++)(i.indexOf(o)>=0||i.length===0)&&a.push(`input_indices[${o}] = 0;`);return[`${a.join(`
`)}`,`var value = ${r.getByIndices("input_indices")};`,`value = min(value, ${r.getByIndices("input_indices")});`,""]})},bA=(e,t)=>{vi(e.inputs),_i(e,"ReduceProd",t,(r,n)=>[`var value = ${n.type.storage}(1);`,"",`value *= ${r.getByIndices("input_indices")};`,""])},wA=(e,t)=>{vi(e.inputs),_i(e,"ReduceSum",t,(r,n)=>[`var value = ${n.type.storage}(0);`,"",`value += ${r.getByIndices("input_indices")};`,""])},vA=(e,t)=>{vi(e.inputs),_i(e,"ReduceSumSquare",t,(r,n)=>[`var t = ${n.type.value}(0); var value = ${n.type.value}(0);`,"",`t = ${r.getByIndices("input_indices")}; value += t * t;`,""])},xi=(e,t,r)=>{if(t.length===0)return r;let n=1,i=1;for(let a=0;a<t.length;a++)t.indexOf(a)===-1?n*=e[a]:i*=e[a];return i<32&&n>1024},Kk=(e,t)=>{xi(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?gA(e,t):Pk(e,t)},Yk=(e,t)=>{xi(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?dA(e,t):Uk(e,t)},Zk=(e,t)=>{xi(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?pA(e,t):Fk(e,t)},Qk=(e,t)=>{xi(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?hA(e,t):Gk(e,t)},Jk=(e,t)=>{xi(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?mA(e,t):jk(e,t)},eI=(e,t)=>{xi(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?yA(e,t):Vk(e,t)},tI=(e,t)=>{xi(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?bA(e,t):Wk(e,t)},rI=(e,t)=>{xi(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?wA(e,t):Hk(e,t)},nI=(e,t)=>{xi(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?vA(e,t):qk(e,t)},iI=(e,t)=>{xi(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?fA(e,t):Xk(e,t)}}),T9=We(()=>{"use strict";Ct(),Or(),Mb(),C1=e=>{if(!e||e.length===0||e.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(e[0].dataType!==1)throw new Error("Invalid input type.")},aI=(e,t)=>{C1(e.inputs);let r=(n,i,a)=>{let o=[];for(let s=0;s<n.rank;s++)(a.indexOf(s)>=0||a.length===0)&&o.push(`input_indices[${s}] = 0;`);return[`${o.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${n.getByIndices("input_indices")} ${t.selectLastIndex>0?"<=":"<"} value) {
         value = ${n.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",i.setByOffset("global_idx","best_index")]};e.compute(Ch("ArgMin",{hint:t.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],r,[t.axis],7,t.keepDims),{inputs:[0]})},oI=(e,t)=>{C1(e.inputs);let r=(n,i,a)=>{let o=[];for(let s=0;s<n.rank;s++)(a.indexOf(s)>=0||a.length===0)&&o.push(`input_indices[${s}] = 0;`);return[`${o.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${n.getByIndices("input_indices")} ${t.selectLastIndex>0?">=":">"} value) {
         value = ${n.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",i.setByOffset("global_idx","best_index")]};e.compute(Ch("argMax",{hint:t.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],r,[t.axis],7,t.keepDims),{inputs:[0]})},hb=e=>ar(e)}),Pb=We(()=>{"use strict";Ct(),Ft(),Lb(),jt(),_A=(e,t)=>{let r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5];if(o&&s)throw new Error("Attention cannot have both past and attention_bias");if(r.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let u=r.dims[0],l=r.dims[1],c=r.dims[2];if(i.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(n.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(n.dims[0]!==c)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(i.dims[0]!==n.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let f=i.dims[0]/3,p=f,d=p;if(t.qkvHiddenSizes.length>0){if(t.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let E of t.qkvHiddenSizes)if(E%t.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");f=t.qkvHiddenSizes[0],p=t.qkvHiddenSizes[1],d=t.qkvHiddenSizes[2]}let m=l;if(f!==p)throw new Error("qkv_hidden_sizes first element should be same as the second");if(i.dims[0]!==f+p+d)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let g=0;if(o){if(p!==d)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(o.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(o.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(o.dims[1]!==u)throw new Error('Input "past" second dimension must be batch_size');if(o.dims[2]!==t.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(o.dims[4]!==p/t.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');t.pastPresentShareBuffer||(g=o.dims[3])}let x=m+g,b=-1,y=0;if(a)throw new Error("Mask not supported");if(o)throw new Error("past is not supported");if(s){if(s.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if(s.dims[0]!==u||s.dims[1]!==t.numHeads||s.dims[2]!==l||s.dims[3]!==x)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:u,sequenceLength:l,pastSequenceLength:g,kvSequenceLength:m,totalSequenceLength:x,maxSequenceLength:b,inputHiddenSize:c,hiddenSize:f,vHiddenSize:d,headSize:Math.floor(f/t.numHeads),vHeadSize:Math.floor(d/t.numHeads),numHeads:t.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:t.maskFilterValue,maskType:y,scale:t.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},bh=(e,t,r)=>t&&e?`
      let total_sequence_length_input = u32(${t.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${e?.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${r?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,xA=(e,t,r,n,i,a,o,s)=>{let u=Tr(o?1:a),l=64,c=a/u;c<l&&(l=32);let f=Math.ceil(a/u/l),p=[{type:12,data:t},{type:12,data:r},{type:12,data:n},{type:12,data:i},{type:12,data:c},{type:12,data:f}],d=Yr(e.dataType,u),m=mn(1,u),g=["type"];o&&g.push("type"),s&&g.push("type");let x=b=>{let y=wt("x",e.dataType,e.dims,u),E=[y],$=o?$e("seq_lens",o.dataType,o.dims):void 0;$&&E.push($);let k=s?$e("total_sequence_length_input",s.dataType,s.dims):void 0;k&&E.push(k);let R=mn(e.dataType),C=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${l}>;
  var<workgroup> thread_sum: array<f32, ${l}>;
  ${b.registerUniforms(C).declareVariables(...E)}
  ${b.mainStart([l,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${bh($,k,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${l}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${o?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${m}(-3.402823e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${m}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(u){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${u}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.402823e+38f);
    for (var i = 0u; i < ${l}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${m}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${m}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(u){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${u}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${l}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${y.type.value}(${R}(1.0) / ${R}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${m}(x[offset + i]);
        x[offset + i] = ${y.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${o?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${y.type.value}(${R}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${l};${d};${u}`,inputDependencies:g},getShaderSource:x,getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:i,z:t*r},programUniforms:p})}},$A=(e,t,r,n,i,a,o,s,u)=>{let l=o+a.kvSequenceLength,c=[a.batchSize,a.numHeads,a.sequenceLength,l],f=e>1&&n,p=a.kvNumHeads?a.kvNumHeads:a.numHeads,d=f?[a.batchSize,p,l,a.headSize]:void 0,m=a.nReps?a.nReps:1,g=a.scale===0?1/Math.sqrt(a.headSize):a.scale,x=Tr(a.headSize),b=a.headSize/x,y=12,E={x:Math.ceil(l/y),y:Math.ceil(a.sequenceLength/y),z:a.batchSize*a.numHeads},$=[{type:12,data:a.sequenceLength},{type:12,data:b},{type:12,data:l},{type:12,data:a.numHeads},{type:12,data:a.headSize},{type:1,data:g},{type:12,data:o},{type:12,data:a.kvSequenceLength},{type:12,data:m}],k=f&&n&&me.size(n.dims)>0,R=["type","type"];k&&R.push("type"),i&&R.push("type"),s&&R.push("type"),u&&R.push("type");let C=[{dims:c,dataType:t.dataType,gpuDataType:0}];f&&C.push({dims:d,dataType:t.dataType,gpuDataType:0});let P=W=>{let te=$e("q",t.dataType,t.dims,x),ce=$e("key",r.dataType,r.dims,x),pe=[te,ce];if(k){let he=$e("past_key",n.dataType,n.dims,x);pe.push(he)}i&&pe.push($e("attention_bias",i.dataType,i.dims));let ge=s?$e("seq_lens",s.dataType,s.dims):void 0;ge&&pe.push(ge);let fe=u?$e("total_sequence_length_input",u.dataType,u.dims):void 0;fe&&pe.push(fe);let Me=wt("output",t.dataType,c),Ge=[Me];f&&Ge.push(wt("present_key",t.dataType,d,x));let He=mn(1,x),dt=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${y}u;

  var<workgroup> tileQ: array<${te.type.storage}, ${y*y}>;
  var<workgroup> tileK: array<${te.type.storage}, ${y*y}>;
  ${W.registerUniforms(dt).declareVariables(...pe,...Ge)}
  ${W.mainStart([y,y,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${m===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${m===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${bh(ge,fe,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${k&&f?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${f?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${He}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${k&&f?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${f?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${He}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(x){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${x}`)}})()};
        output[outputIdx] = ${Me.type.value} (sum * uniforms.alpha) + ${i?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${x};${i!==void 0};${n!==void 0};${e}`,inputDependencies:R},getRunData:()=>({outputs:C,dispatchGroup:E,programUniforms:$}),getShaderSource:P}},EA=(e,t,r,n,i,a,o=void 0,s=void 0)=>{let u=a+i.kvSequenceLength,l=i.nReps?i.nReps:1,c=i.vHiddenSize*l,f=e>1&&n,p=i.kvNumHeads?i.kvNumHeads:i.numHeads,d=f?[i.batchSize,p,u,i.headSize]:void 0,m=[i.batchSize,i.sequenceLength,c],g=12,x={x:Math.ceil(i.vHeadSize/g),y:Math.ceil(i.sequenceLength/g),z:i.batchSize*i.numHeads},b=[{type:12,data:i.sequenceLength},{type:12,data:u},{type:12,data:i.vHeadSize},{type:12,data:i.numHeads},{type:12,data:i.headSize},{type:12,data:c},{type:12,data:a},{type:12,data:i.kvSequenceLength},{type:12,data:l}],y=f&&n&&me.size(n.dims)>0,E=["type","type"];y&&E.push("type"),o&&E.push("type"),s&&E.push("type");let $=[{dims:m,dataType:t.dataType,gpuDataType:0}];f&&$.push({dims:d,dataType:t.dataType,gpuDataType:0});let k=R=>{let C=$e("probs",t.dataType,t.dims),P=$e("v",r.dataType,r.dims),W=[C,P];y&&W.push($e("past_value",n.dataType,n.dims));let te=o?$e("seq_lens",o.dataType,o.dims):void 0;o&&W.push(te);let ce=s?$e("total_sequence_length_input",s.dataType,s.dims):void 0;s&&W.push(ce);let pe=[wt("output",t.dataType,m)];f&&pe.push(wt("present_value",t.dataType,d));let ge=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${g}u;
  var<workgroup> tileQ: array<${C.type.value}, ${g*g}>;
  var<workgroup> tileV: array<${C.type.value}, ${g*g}>;
  ${R.registerUniforms(ge).declareVariables(...W,...pe)}
  ${R.mainStart([g,g,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${l===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${l===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${bh(te,ce,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${y&&f?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${f?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${C.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${y&&f?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${f?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${n!==void 0};${e}`,inputDependencies:E},getRunData:()=>({outputs:$,dispatchGroup:x,programUniforms:b}),getShaderSource:k}},Xc=(e,t,r,n,i,a,o,s,u,l,c=void 0,f=void 0)=>{let p=Math.min(e.outputCount,1+(o?1:0)+(s?1:0)),d=p>1?l.pastSequenceLength:0,m=d+l.kvSequenceLength,g=u&&me.size(u.dims)>0?u:void 0,x=[t,r];p>1&&o&&me.size(o.dims)>0&&x.push(o),g&&x.push(g),c&&x.push(c),f&&x.push(f);let b=e.compute($A(p,t,r,o,g,l,d,c,f),{inputs:x,outputs:p>1?[-1,1]:[-1]})[0];e.compute(xA(b,l.batchSize,l.numHeads,d,l.sequenceLength,m,c,f),{inputs:c&&f?[b,c,f]:[b],outputs:[]});let y=[b,n];p>1&&s&&me.size(s.dims)>0&&y.push(s),c&&y.push(c),f&&y.push(f),e.compute(EA(p,b,n,s,l,d,c,f),{inputs:y,outputs:p>1?[0,2]:[0]})},SA=(e,t)=>{let r=[t.batchSize,t.numHeads,t.sequenceLength,t.headSize],n=t.sequenceLength,i=t.inputHiddenSize,a=t.headSize,o=12,s={x:Math.ceil(t.headSize/o),y:Math.ceil(t.sequenceLength/o),z:t.batchSize*t.numHeads},u=[e.inputs[0],e.inputs[1],e.inputs[2]],l=[{type:12,data:n},{type:12,data:i},{type:12,data:a},{type:12,data:t.numHeads},{type:12,data:t.headSize},{type:12,data:t.hiddenSize},{type:12,data:t.hiddenSize+t.hiddenSize+t.vHiddenSize}],c=f=>{let p=wt("output_q",u[0].dataType,r),d=wt("output_k",u[0].dataType,r),m=wt("output_v",u[0].dataType,r),g=$e("input",u[0].dataType,u[0].dims),x=$e("weight",u[1].dataType,u[1].dims),b=$e("bias",u[2].dataType,u[2].dims),y=g.type.storage,E=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${o}u;
  var<workgroup> tileInput: array<${y}, ${o*o}>;
  var<workgroup> tileWeightQ: array<${y}, ${o*o}>;
  var<workgroup> tileWeightK: array<${y}, ${o*o}>;
  var<workgroup> tileWeightV: array<${y}, ${o*o}>;
  ${f.registerUniforms(E).declareVariables(g,x,b,p,d,m)}
  ${f.mainStart([o,o,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${y}(0);
    var valueK = ${y}(0);
    var valueV = ${y}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return e.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:r,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:r,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:r,dataType:e.inputs[0].dataType,gpuDataType:0}],dispatchGroup:s,programUniforms:l}),getShaderSource:c},{inputs:u,outputs:[-1,-1,-1]})},sI=(e,t)=>{let r=_A(e.inputs,t),[n,i,a]=SA(e,r);return Xc(e,n,i,a,e.inputs[4],void 0,void 0,void 0,e.inputs[5],r)}}),A9=We(()=>{"use strict";Ai(),Ct(),Ft(),Or(),jt(),TA=(e,t)=>{if(!e||e.length!==5)throw new Error("BatchNormalization requires 5 inputs");let r=(n,i,a)=>{let o=i.length;if(o!==n.length)throw new Error(`${a}: num dimensions != ${o}`);i.forEach((s,u)=>{if(s!==n[u])throw new Error(`${a}: dim[${u}] do not match`)})};if(e[0].dims.length>1){let n=t.format==="NHWC"?t.spatial?e[0].dims.slice(-1):e[0].dims.slice(-1).concat(e[0].dims.slice(1,e[0].dims.length-1)):e[0].dims.slice(1,t.spatial?2:void 0);r(e[1].dims,n,"Invalid input scale"),r(e[2].dims,n,"Invalid input B"),r(e[3].dims,n,"Invalid input mean"),r(e[4].dims,n,"Invalid input var")}else r(e[1].dims,[1],"Invalid input scale"),r(e[2].dims,[1],"Invalid input B"),r(e[3].dims,[1],"Invalid input mean"),r(e[4].dims,[1],"Invalid input var")},AA=(e,t)=>{let{epsilon:r,spatial:n,format:i}=t,a=e[0].dims,o=n?Tr(a[a.length-1]):1,s=i==="NHWC"&&a.length>1?o:1,u=me.size(a)/o,l=n,c=l?a.length:a,f=$e("x",e[0].dataType,e[0].dims,o),p=$e("scale",e[1].dataType,e[1].dims,s),d=$e("bias",e[2].dataType,e[2].dims,s),m=$e("inputMean",e[3].dataType,e[3].dims,s),g=$e("inputVar",e[4].dataType,e[4].dims,s),x=wt("y",e[0].dataType,c,o),b=()=>{let E="";if(n)E=`let cOffset = ${a.length===1?"0u":i==="NHWC"?`outputIndices[${a.length-1}] / ${o}`:"outputIndices[1]"};`;else if(i==="NCHW")E=`
            ${x.indicesSet("outputIndices","0","0")}
            let cOffset = ${x.indicesToOffset("outputIndices")};`;else{E=`var cIndices = ${p.type.indices}(0);
                       cIndices[0] = outputIndices[${a.length-1}];`;for(let $=1;$<p.rank;$++)E+=`cIndices[${$}] = outputIndices[${$}];`;E+=`let cOffset = ${p.indicesToOffset("cIndices")};`}return E},y=E=>`
  const epsilon = ${r};
  ${E.registerUniform("outputSize","u32").declareVariables(f,p,d,m,g,x)}
  ${E.mainStart()}
  ${E.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${x.offsetToIndices(`global_idx * ${o}`)};
    ${b()}
    let scale = ${p.getByOffset("cOffset")};
    let bias = ${d.getByOffset("cOffset")};
    let inputMean = ${m.getByOffset("cOffset")};
    let inputVar = ${g.getByOffset("cOffset")};
    let x = ${f.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${x.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${t.epsilon}_${t.format}_${n}_${o}`,inputDependencies:l?["rank","type","type","type","type"]:void 0},getShaderSource:y,getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:l?[{type:12,data:u},...$t(a)]:[{type:12,data:u}]})}},kA=e=>ar(e),uI=(e,t)=>{let{inputs:r,outputCount:n}=e,i=kA({...t,outputCount:n});if(vr.webgpu.validateInputContent&&TA(r,i),t.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");e.compute(AA(r,i))}}),k9=We(()=>{"use strict";Ft(),jt(),IA=e=>{if(e[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(e[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(e[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},CA=e=>{let t=e[0].dims,r=e[0].dims[2],n=me.size(t)/4,i=e[0].dataType,a=$e("input",i,t,4),o=$e("bias",i,[r],4),s=$e("residual",i,t,4),u=wt("output",i,t,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(n/64)}}),getShaderSource:l=>`
  const channels = ${r}u / 4;
  ${l.declareVariables(a,o,s,u)}

  ${l.mainStart()}
    ${l.guardAgainstOutOfBoundsWorkgroupSizes(n)}
    let value = ${a.getByOffset("global_idx")}
      + ${o.getByOffset("global_idx % channels")} + ${s.getByOffset("global_idx")};
    ${u.setByOffset("global_idx","value")}
  }`}},lI=e=>{IA(e.inputs),e.compute(CA(e.inputs))}}),Ub=We(()=>{"use strict";Ct(),Ft(),Or(),jt(),OA=(e,t,r,n,i,a,o)=>{let s=Math.ceil(t/4),u="";typeof i=="string"?u=`${i}(a)`:u=i("a");let l=$e("inputData",r,[s],4),c=wt("outputData",n,[s],4),f=[{name:"vec_size",type:"u32"}];return o&&f.push(...o),`
      ${e.registerUniforms(f).declareVariables(l,c)}

  ${a??""}

  ${e.mainStart()}
    ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${l.getByOffset("global_idx")};
    ${c.setByOffset("global_idx",u)}
  }`},nr=(e,t,r,n,i,a=e.dataType,o,s)=>{let u=[{type:12,data:Math.ceil(me.size(e.dims)/4)}];return o&&u.push(...o),{name:t,shaderCache:{hint:i,inputDependencies:["type"]},getShaderSource:l=>OA(l,me.size(e.dims),e.dataType,a,r,n,s),getRunData:l=>({outputs:[{dims:e.dims,dataType:a}],dispatchGroup:{x:Math.ceil(me.size(l[0].dims)/64/4)},programUniforms:u})}},cI=e=>{e.compute(nr(e.inputs[0],"Abs","abs"))},fI=e=>{e.compute(nr(e.inputs[0],"Acos","acos"))},dI=e=>{e.compute(nr(e.inputs[0],"Acosh","acosh"))},pI=e=>{e.compute(nr(e.inputs[0],"Asin","asin"))},hI=e=>{e.compute(nr(e.inputs[0],"Asinh","asinh"))},mI=e=>{e.compute(nr(e.inputs[0],"Atan","atan"))},gI=e=>{e.compute(nr(e.inputs[0],"Atanh","atanh"))},yI=e=>ar(e),bI=(e,t)=>{let r;switch(t.to){case 10:r="vec4<f16>";break;case 1:r="vec4<f32>";break;case 12:r="vec4<u32>";break;case 6:r="vec4<i32>";break;case 9:r="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${t.to}`)}e.compute(nr(e.inputs[0],"Cast",r,void 0,t.cacheKey,t.to))},BA=e=>{let t,r,n=e.length>=2&&e[1].data!==0,i=e.length>=3&&e[2].data!==0;switch(e[0].dataType){case 1:t=n?e[1].getFloat32Array()[0]:-34028234663852886e22,r=i?e[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:t=n?e[1].getUint16Array()[0]:64511,r=i?e[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return ar({min:t,max:r})},wI=(e,t)=>{let r=t||BA(e.inputs),n=mn(e.inputs[0].dataType);e.compute(nr(e.inputs[0],"Clip",i=>`clamp(${i}, vec4<${n}>(uniforms.min), vec4<${n}>(uniforms.max))`,void 0,r.cacheKey,void 0,[{type:e.inputs[0].dataType,data:r.min},{type:e.inputs[0].dataType,data:r.max}],[{name:"min",type:n},{name:"max",type:n}]),{inputs:[0]})},vI=e=>{e.compute(nr(e.inputs[0],"Ceil","ceil"))},_I=e=>{e.compute(nr(e.inputs[0],"Cos","cos"))},xI=e=>{e.compute(nr(e.inputs[0],"Cosh","cosh"))},jc=e=>ar(e),$I=(e,t)=>{let r=mn(e.inputs[0].dataType);e.compute(nr(e.inputs[0],"Elu",n=>`elu_vf32(${n})`,`
  const elu_alpha_ = ${r}(${t.alpha});

  fn elu_f32(a: ${r}) -> ${r} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${r}>) -> vec4<${r}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,t.cacheKey))},Th=(e="f32")=>`
const r0: ${e} = 0.3275911;
const r1: ${e} = 0.254829592;
const r2: ${e} = -0.284496736;
const r3: ${e} = 1.421413741;
const r4: ${e} = -1.453152027;
const r5: ${e} = 1.061405429;

fn erf_vf32(v: vec4<${e}>) -> vec4<${e}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,EI=e=>{let t=mn(e.inputs[0].dataType);e.compute(nr(e.inputs[0],"Erf",r=>`erf_vf32(${r})`,Th(t)))},SI=e=>{e.compute(nr(e.inputs[0],"Exp","exp"))},TI=e=>{e.compute(nr(e.inputs[0],"Floor","floor"))},AI=e=>{let t=mn(e.inputs[0].dataType);e.compute(nr(e.inputs[0],"Gelu",r=>`0.5 * ${r} * (1.0 + erf_vf32(${r} * 0.7071067811865475))`,Th(t)))},kI=(e,t)=>{let r=mn(e.inputs[0].dataType);e.compute(nr(e.inputs[0],"LeakyRelu",n=>`select(leaky_relu_alpha_ * ${n}, ${n}, ${n} >= vec4<${r}>(0.0))`,`const leaky_relu_alpha_ = ${r}(${t.alpha});`,t.cacheKey))},II=e=>{e.compute(nr(e.inputs[0],"Not",t=>`!${t}`))},CI=e=>{e.compute(nr(e.inputs[0],"Neg",t=>`-${t}`))},OI=e=>{e.compute(nr(e.inputs[0],"Reciprocal",t=>`1.0/${t}`))},BI=e=>{let t=mn(e.inputs[0].dataType);e.compute(nr(e.inputs[0],"Relu",r=>`select(vec4<${t}>(0.0), ${r}, ${r} > vec4<${t}>(0.0))`))},RI=e=>{e.compute(nr(e.inputs[0],"Sigmoid",t=>`(1.0 / (1.0 + exp(-${t})))`))},zI=e=>ar(e),NI=(e,t)=>{let r=mn(e.inputs[0].dataType);e.compute(nr(e.inputs[0],"HardSigmoid",n=>`max(vec4<${r}>(0.0), min(vec4<${r}>(1.0), ${t.alpha} * ${n} + vec4<${r}>(${t.beta})))`,void 0,t.cacheKey))},LI=e=>{e.compute(nr(e.inputs[0],"Sin","sin"))},DI=e=>{e.compute(nr(e.inputs[0],"Sinh","sinh"))},MI=e=>{e.compute(nr(e.inputs[0],"Sqrt","sqrt"))},PI=e=>{e.compute(nr(e.inputs[0],"Tan","tan"))},O1=e=>`sign(${e}) * (1 - exp(-2 * abs(${e}))) / (1 + exp(-2 * abs(${e})))`,UI=e=>{e.compute(nr(e.inputs[0],"Tanh",O1))},mb=(e="f32")=>`
const fast_gelu_a: ${e} = 0.5;
const fast_gelu_b: ${e} = 0.7978845608028654;
const fast_gelu_c: ${e} = 0.035677408136300125;

fn tanh_v(v: vec4<${e}>) -> vec4<${e}> {
  return ${O1("v")};
}
`,gb=e=>`(fast_gelu_a + fast_gelu_a * tanh_v(${e} * (fast_gelu_c * ${e} * ${e} + fast_gelu_b))) * ${e}`,FI=e=>{let t=mn(e.inputs[0].dataType);e.compute(nr(e.inputs[0],"FastGelu",gb,mb(t),void 0,e.inputs[0].dataType))},GI=(e,t)=>{let r=mn(e.inputs[0].dataType);return e.compute(nr(e.inputs[0],"ThresholdedRelu",n=>`select(vec4<${r}>(0.0), ${n}, ${n} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${r}>(${t.alpha});`,t.cacheKey)),0},jI=e=>{e.compute(nr(e.inputs[0],"Log","log"))},RA=(e,t)=>`
const alpha = vec4<${e}>(${t});
const one = ${e}(1.0);
const zero = ${e}(0.0);

fn quick_gelu_impl(x: vec4<${e}>) -> vec4<${e}> {
  let v = x *alpha;
  var x1 : vec4<${e}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,zA=e=>`quick_gelu_impl(${e})`,VI=(e,t)=>{let r=mn(e.inputs[0].dataType);e.compute(nr(e.inputs[0],"QuickGelu",zA,RA(r,t.alpha),t.cacheKey,e.inputs[0].dataType))}}),I9=We(()=>{"use strict";Ft(),jt(),Ub(),NA=e=>{if(e[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(e[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(e[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},LA=e=>{let t=e[0].dims.slice();t[2]=t[2]/2;let r=$e("input",e[0].dataType,e[0].dims,4),n=$e("bias",e[0].dataType,[e[0].dims[2]],4),i=wt("output",e[0].dataType,t,4),a=me.size(t)/4,o=Yr(e[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)}}),getShaderSource:s=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${e[0].dims[2]/4/2}u;

  ${s.declareVariables(r,n,i)}

  ${Th(o)}

  ${s.mainStart()}
    ${s.guardAgainstOutOfBoundsWorkgroupSizes(a)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${i.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},WI=e=>{NA(e.inputs),e.compute(LA(e.inputs))}}),C9=We(()=>{"use strict";Ct(),Ft(),jt(),DA=(e,t,r,n,i,a,o,s,u,l,c,f)=>{let p,d;typeof s=="string"?p=d=(y,E)=>`${s}((${y}),(${E}))`:typeof s=="function"?p=d=s:(p=s.scalar,d=s.vector);let m=wt("outputData",c,n.length,4),g=$e("aData",u,t.length,4),x=$e("bData",l,r.length,4),b;if(i)if(a){let y=me.size(t)===1,E=me.size(r)===1,$=t.length>0&&t[t.length-1]%4===0,k=r.length>0&&r[r.length-1]%4===0;y||E?b=m.setByOffset("global_idx",d(y?`${g.type.value}(${g.getByOffset("0")}.x)`:g.getByOffset("global_idx"),E?`${x.type.value}(${x.getByOffset("0")}.x)`:x.getByOffset("global_idx"))):b=`
            let outputIndices = ${m.offsetToIndices("global_idx * 4u")};
            let offsetA = ${g.broadcastedIndicesToOffset("outputIndices",m)};
            let offsetB = ${x.broadcastedIndicesToOffset("outputIndices",m)};
            ${m.setByOffset("global_idx",d(o||$?g.getByOffset("offsetA / 4u"):`${g.type.value}(${g.getByOffset("offsetA / 4u")}[offsetA % 4u])`,o||k?x.getByOffset("offsetB / 4u"):`${x.type.value}(${x.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else b=m.setByOffset("global_idx",d(g.getByOffset("global_idx"),x.getByOffset("global_idx")));else{if(!a)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let y=(E,$,k="")=>{let R=`aData[indexA${$}][componentA${$}]`,C=`bData[indexB${$}][componentB${$}]`;return`
            let outputIndices${$} = ${m.offsetToIndices(`global_idx * 4u + ${$}u`)};
            let offsetA${$} = ${g.broadcastedIndicesToOffset(`outputIndices${$}`,m)};
            let offsetB${$} = ${x.broadcastedIndicesToOffset(`outputIndices${$}`,m)};
            let indexA${$} = offsetA${$} / 4u;
            let indexB${$} = offsetB${$} / 4u;
            let componentA${$} = offsetA${$} % 4u;
            let componentB${$} = offsetB${$} % 4u;
            ${E}[${$}] = ${k}(${p(R,C)});
          `};c===9?b=`
            var data = vec4<u32>(0);
            ${y("data",0,"u32")}
            ${y("data",1,"u32")}
            ${y("data",2,"u32")}
            ${y("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:b=`
            ${y("outputData[global_idx]",0)}
            ${y("outputData[global_idx]",1)}
            ${y("outputData[global_idx]",2)}
            ${y("outputData[global_idx]",3)}
          `}return`
        ${e.registerUniform("vec_size","u32").declareVariables(g,x,m)}

        ${f??""}

        ${e.mainStart()}
        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${b}
      }`},MA=(e,t,r,n,i,a,o=r.dataType)=>{let s=r.dims.map(g=>Number(g)??1),u=n.dims.map(g=>Number(g)??1),l=!me.areEqual(s,u),c=s,f=me.size(s),p=!1,d=!1,m=[l];if(l){let g=Vu.calcShape(s,u,!1);if(!g)throw new Error("Can't perform binary op on the given tensors");c=g.slice(),f=me.size(c);let x=me.size(s)===1,b=me.size(u)===1,y=s.length>0&&s[s.length-1]%4===0,E=u.length>0&&u[u.length-1]%4===0;m.push(x),m.push(b),m.push(y),m.push(E);let $=1;for(let k=1;k<c.length;k++){let R=s[s.length-k],C=u[u.length-k];if(R===C)$*=R;else break}$%4===0?(d=!0,p=!0):(x||b||y||E)&&(p=!0)}else p=!0;return m.push(p),{name:e,shaderCache:{hint:t+m.map(g=>g.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:g=>DA(g,s,u,c,p,l,d,i,r.dataType,n.dataType,o,a),getRunData:()=>({outputs:[{dims:c,dataType:o}],dispatchGroup:{x:Math.ceil(f/64/4)},programUniforms:[{type:12,data:Math.ceil(me.size(c)/4)},...$t(s,u,c)]})}},$i=(e,t,r,n,i,a)=>{e.compute(MA(t,i??"",e.inputs[0],e.inputs[1],r,n,a))},HI=e=>{$i(e,"Add",(t,r)=>`${t}+${r}`)},qI=e=>{$i(e,"Div",(t,r)=>`${t}/${r}`)},XI=e=>{$i(e,"Equal",{scalar:(t,r)=>`u32(${t}==${r})`,vector:(t,r)=>`vec4<u32>(${t}==${r})`},void 0,void 0,9)},KI=e=>{$i(e,"Mul",(t,r)=>`${t}*${r}`)},YI=e=>{let t=$e("input",e.inputs[0].dataType,e.inputs[0].dims).type.value;$i(e,"Pow",{scalar:(r,n)=>`pow_custom(${r},${n})`,vector:(r,n)=>`pow_vector_custom(${r},${n})`},`
    fn pow_custom(a : ${t}, b : ${t}) -> ${t} {
      if (b == ${t}(0.0)) {
        return ${t}(1.0);
      } else if (a < ${t}(0.0) && f32(b) != floor(f32(b))) {
        return ${t}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${t}(1.0), round(f32(abs(b) % ${t}(2.0))) != 1.0) * ${t}(${t==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${t}>, b : vec4<${t}>) -> vec4<${t}> {
      // TODO: implement vectorized pow
      return vec4<${t}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},ZI=e=>{$i(e,"Sub",(t,r)=>`${t}-${r}`)},QI=e=>{$i(e,"Greater",{scalar:(t,r)=>`u32(${t}>${r})`,vector:(t,r)=>`vec4<u32>(${t}>${r})`},void 0,void 0,9)},JI=e=>{$i(e,"Less",{scalar:(t,r)=>`u32(${t}<${r})`,vector:(t,r)=>`vec4<u32>(${t}<${r})`},void 0,void 0,9)},e5=e=>{$i(e,"GreaterOrEqual",{scalar:(t,r)=>`u32(${t}>=${r})`,vector:(t,r)=>`vec4<u32>(${t}>=${r})`},void 0,void 0,9)},t5=e=>{$i(e,"LessOrEqual",{scalar:(t,r)=>`u32(${t}<=${r})`,vector:(t,r)=>`vec4<u32>(${t}<=${r})`},void 0,void 0,9)}}),O9=We(()=>{"use strict";Ct(),Ft(),Or(),jt(),PA=(e,t)=>{if(!e||e.length<1)throw new Error("too few inputs");let r=0,n=e[r],i=n.dataType,a=n.dims.length;e.forEach((o,s)=>{if(s!==r){if(o.dataType!==i)throw new Error("input tensors should be one type");if(o.dims.length!==a)throw new Error("input tensors should have the same shape");o.dims.forEach((u,l)=>{if(l!==t&&u!==n.dims[l])throw new Error("non concat dimensions must match")})}})},UA=(e,t)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${e}u>(${t});
    for (var i: u32 = 0u; i < ${e}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${e}u;
  }`,FA=(e,t)=>{let r=e.length,n=[];for(let i=0;i<r;++i){let a=t.setByOffset("global_idx",e[i].getByIndices("indices"));r===1?n.push(a):i===0?n.push(`if (inputIndex == ${i}u) { ${a} }`):i===r-1?n.push(`else { ${a} }`):n.push(`else if (inputIndex == ${i}) { ${a} }`)}return n.join(`
`)},GA=(e,t,r,n)=>{let i=me.size(r),a=new Array(e.length),o=new Array(e.length),s=0,u=[],l=[],c=[{type:12,data:i}];for(let g=0;g<e.length;++g)s+=e[g].dims[t],a[g]=s,l.push(e[g].dims.length),o[g]=$e(`input${g}`,n,l[g]),u.push("rank"),c.push({type:12,data:a[g]});for(let g=0;g<e.length;++g)c.push(...$t(e[g].dims));c.push(...$t(r));let f=wt("output",n,r.length),p=f.indicesGet("indices",t),d=Array.from(Array(a.length).keys()).map(g=>`uniforms.sizeInConcatAxis${g}`).join(","),m=g=>`

  ${(()=>{g.registerUniform("outputSize","u32");for(let x=0;x<e.length;x++)g.registerUniform(`sizeInConcatAxis${x}`,"u32");return g.declareVariables(...o,f)})()}

  ${UA(a.length,d)}

  ${g.mainStart()}
    ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${f.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${p});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${a.length}u>(${d});
      ${p} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${FA(o,f)}
  }`;return{name:"Concat",shaderCache:{hint:`${t}`,inputDependencies:u},getRunData:()=>({outputs:[{dims:r,dataType:n}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:c}),getShaderSource:m}},r5=(e,t)=>{let r=e.inputs,n=r[0].dims,i=me.normalizeAxis(t.axis,n.length);PA(r,i);let a=n.slice();a[i]=r.reduce((s,u)=>s+(u.dims.length>i?u.dims[i]:0),0);let o=r.filter(s=>me.size(s.dims)>0);e.compute(GA(o,i,a,r[0].dataType),{inputs:o})},n5=e=>ar({axis:e.axis})}),gs=We(()=>{"use strict";Ct(),Ft(),ds=(e,t,r="f32")=>{switch(e.activation){case"Relu":return`value = max(value, ${t}(0.0));`;case"Sigmoid":return`value = (${t}(1.0) / (${t}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${t}(${r}(uniforms.clip_min)), ${t}(${r}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${t}(0.0), min(${t}(1.0), ${r}(uniforms.alpha) * value + ${r}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${r}(uniforms.alpha) * value, value, value >= ${t}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${e.activation}`)}},ps=(e,t)=>{e.activation==="Clip"?t.push({type:1,data:e.clipMax},{type:1,data:e.clipMin}):e.activation==="HardSigmoid"?t.push({type:1,data:e.alpha},{type:1,data:e.beta}):e.activation==="LeakyRelu"&&t.push({type:1,data:e.alpha})},hs=(e,t)=>{e.activation==="Clip"?t.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):e.activation==="HardSigmoid"?t.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):e.activation==="LeakyRelu"&&t.push({name:"alpha",type:"f32"})},Fb=e=>{let t=e?.activation||"";if(t==="HardSigmoid"){let[r,n]=e?.activation_params||[.2,.5];return{activation:t,alpha:r,beta:n}}else if(t==="Clip"){let[r,n]=e?.activation_params||[Ik,Ck];return{activation:t,clipMax:n,clipMin:r}}else if(t==="LeakyRelu"){let[r]=e?.activation_params||[.01];return{activation:t,alpha:r}}return{activation:t}}}),Gb=We(()=>{"use strict";nn=(e,t)=>{switch(e){case 1:return t;case 2:return`vec2<${t}>`;case 3:return`vec3<${t}>`;case 4:return`vec4<${t}>`;default:throw new Error(`${e}-component is not supported.`)}},i5=e=>`
      ${e?"value = value + getBiasByOutputCoords(coords);":""}
      `}),B9=We(()=>{"use strict";a5=e=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${e}.x), i32(${e}.y), i32(${e}.z), 1));
}
`}),Vb=We(()=>{"use strict";Ct(),Ft(),jt(),gs(),Wc=(e,t,r,n,i)=>{let a=n-r;return`
      ${Array.from({length:r}).map((o,s)=>`
      if (${_t(t.shape,s,t.rank)} != 1) {
        ${t.indicesSet(e,s,_t(i,s+a,n))}
      } else {
        ${t.indicesSet(e,s,0)}
      }`).join("")}
`},jb=(e,t,r,n,i=!1,a)=>{let o=e[0].dims,s=e[1].dims,u=o[o.length-2],l=s[s.length-1],c=o[o.length-1],f=Tr(l),p=Tr(c),d=Tr(u),m=me.size(r)/f/d,g=e.length>2,x=n?n.slice(0,-2):r.slice(0,-2),b=[me.size(x),u,l],y=[{type:12,data:m},{type:12,data:u},{type:12,data:l},{type:12,data:c}];ps(t,y),y.push(...$t(x,o,s)),g&&y.push(...$t(e[2].dims)),y.push(...$t(b));let E=$=>{let k=Db("batch_dims",e[0].dataType,x.length),R=$e("a",e[0].dataType,o.length,p),C=$e("b",e[1].dataType,s.length,f),P=wt("output",e[0].dataType,b.length,f),W=Yr(P.type.tensor),te=ds(t,P.type.value,W),ce=[R,C],pe="";if(g){let Me=i?f:1;ce.push($e("bias",e[2].dataType,e[2].dims.length,Me)),pe=`${i?`value += bias[col / ${Me}];`:`value += ${P.type.value}(bias[row + i]);`}`}let ge=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];hs(t,ge);let fe=()=>{let Me=`var a_data: ${R.type.value};`;for(let Ge=0;Ge<p;Ge++)Me+=`
              let b_data${Ge} = b[(b_offset + (k + ${Ge}) * uniforms.N + col) / ${f}];`;for(let Ge=0;Ge<d;Ge++){Me+=`a_data = a[(a_offset + (row + ${Ge}) * uniforms.K + k) / ${p}];`;for(let He=0;He<p;He++)Me+=`
            values[${Ge}] = fma(${C.type.value}(a_data${p===1?"":`[${He}]`}), b_data${He}, values[${Ge}]);
`}return Me};return`
  ${$.registerUniforms(ge).registerInternalVariables(k).declareVariables(...ce,P)}
  ${$.mainStart()}
    ${$.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${f})) * ${f};
    var index1 = global_idx / (uniforms.N / ${f});
    let stride1 = uniforms.M / ${d};
    let row = (index1 % stride1) * ${d};
    let batch = index1 / stride1;

    ${r.length===2?"":`let batch_indices = ${k.offsetToIndices("batch")};`}

    var a_indices: ${R.type.indices};
    ${Wc("a_indices",R,R.rank-2,k.rank,"batch_indices")}
    ${R.indicesSet("a_indices",R.rank-2,0)}
    ${R.indicesSet("a_indices",R.rank-1,0)}
    let a_offset = ${R.indicesToOffset("a_indices")};

    var b_indices: ${C.type.indices};
    ${Wc("b_indices",C,C.rank-2,k.rank,"batch_indices")}
    ${C.indicesSet("b_indices",C.rank-2,0)}
    ${C.indicesSet("b_indices",C.rank-1,0)}
    let b_offset = ${C.indicesToOffset("b_indices")};
    var values: array<${P.type.value}, ${d}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${p}) {
      ${fe()}
    }
    for (var i = 0u; i < ${d}u; i++) {
      var value = values[i];
      ${pe}
      ${te}
      let cur_indices = ${P.type.indices}(batch, row + i, col);
      let offset = ${P.indicesToOffset("cur_indices")};
      ${P.setByOffset(`offset / ${f}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${t.activation};${f};${p};${d};${i}`,inputDependencies:g?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:a?a(r):r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:y}),getShaderSource:E}}}),Wb=We(()=>{"use strict";Ct(),Ft(),jt(),gs(),Vb(),Gb(),jA=(e,t)=>e?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${t?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${t?", batchIndices":""});
        `,VA=(e,t)=>e?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${t===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${t===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${t===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,yb=(e,t,r="f32",n,i=!1,a=32,o=!1,s=32)=>{let u=t[1]*e[1],l=t[0]*e[0],c=i?u:a,f=i?a:u,p=c/t[0],d=a/t[1];if(!((i&&p===4&&e[1]===4||!i&&(p===3||p===4))&&c%t[0]===0&&a%t[1]===0&&e[0]===4))throw new Error(`If transposeA ${i} is true, innerElementSize ${p} and workPerThread[1] ${e[1]} must be 4.
      Otherwise, innerElementSize ${p} must be 3 or 4.
  tileAWidth ${c} must be divisible by workgroupSize[0]${t[0]}. tileInner ${a} must be divisible by workgroupSize[1] ${t[1]}. colPerThread ${e[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${p}<${r}>, ${c/p}>, ${f}>;
var<workgroup> mm_Bsub: array<array<vec4<${r}>, ${l/e[0]}>, ${a}>;

const rowPerThread = ${e[1]};
const colPerThread = ${e[0]};
const innerElementSize = ${p};
const tileInner = ${a};

@compute @workgroup_size(${t[0]}, ${t[1]}, ${t[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${o?"0":"i32(globalId.z)"};
  ${n?`let batchIndices = ${n.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${u};

  let num_tiles = ${o?`${Math.ceil(s/a)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${o?`i32(globalId.z) * ${s}`:"0"};

  var acc: array<vec4<${r}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${d};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${jA(i,n)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${d}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${n?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${p===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${VA(i,p)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},B1=(e,t)=>e?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${t?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${t?", batchIndices":""});
            `,WA=e=>e?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",bb=(e,t,r="f32",n,i=!1,a=32,o=!1,s=32,u=!1)=>{let l=e[1]*t[1],c=e[0]*t[0],f=i?l:a,p=i?a:l;if(!(p%t[1]===0&&f%t[0]===0&&a%t[1]===0))throw new Error(`tileAHight ${p} must be divisible by workgroupSize[1]${t[1]}, tileAWidth ${f} must be divisible by workgroupSize[0]${t[0]}, tileInner ${a} must be divisible by workgroupSize[1]${t[1]}`);let d=p/t[1],m=f/t[0],g=a/t[1],x=u?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${l};
    let globalColStart = i32(workgroupId.x) * ${c};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${p}; inputRow = inputRow + ${t[1]}) {
        for (var inputCol = localCol; inputCol < ${f}; inputCol = inputCol + ${t[0]}) {
          ${B1(i,n)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${a}; inputRow = inputRow + ${t[1]}) {
            for (var inputCol = localCol; inputCol < ${c}; inputCol = inputCol + ${t[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${n?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${r}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${t[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${i?`mm_Asub[k][localRow + innerRow * ${t[1]}];`:`mm_Asub[localRow + innerRow * ${t[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${t[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${t[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${l};

let tileRowA = i32(localId.y) * ${d};
let tileColA = i32(localId.x) * ${m};
let tileRowB = i32(localId.y) * ${g};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${d}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${m}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${B1(i,n)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${g}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${n?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${r}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${WA(i)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${r}, ${f}>, ${p}>;
  var<workgroup> mm_Bsub : array<array<${r}, ${c}>, ${a}>;
  const rowPerThread = ${e[1]};
  const colPerThread = ${e[0]};
  const tileInner = ${a};

@compute @workgroup_size(${t[0]}, ${t[1]}, ${t[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${o?"0":"i32(globalId.z)"};
    ${n?`let batchIndices = ${n.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${o?`${Math.ceil(s/a)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${o?`i32(globalId.z) * ${s}`:"0"};

    var acc : array<array<${r}, colPerThread>, rowPerThread>;
    ${x}
  }
`},HA=(e,t,r,n,i=!1)=>{let[a,o,s,u]=n,l=Yr(n[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${a.type.indices}) -> ${nn(e,l)} {
      var value = ${nn(e,l)}(0.0);
      let col = colIn * ${e};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${o.type.indices};
        ${Wc("aIndices",o,o.rank-2,a.rank,"batchIndices")}
        ${o.indicesSet("aIndices",o.rank-2,"u32(row)")}
        ${o.indicesSet("aIndices",o.rank-1,"u32(colIn)")}
        value = ${o.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${a.type.indices}) -> ${nn(e,l)} {
      var value = ${nn(e,l)}(0.0);
      let col = colIn * ${e};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${s.type.indices};
        ${Wc("bIndices",s,s.rank-2,a.rank,"batchIndices")}
        ${s.indicesSet("bIndices",s.rank-2,"u32(row)")}
        ${s.indicesSet("bIndices",s.rank-1,"u32(colIn)")}
        value = ${s.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${nn(e,l)}) {
      let col = colIn * ${e};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${t?`value = value + ${i?"bias[colIn]":`${nn(e,l)}(bias[row])`};`:""}
        ${r}
        ${u.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},Oh=(e,t,r,n,i=!1,a)=>{let o=e[0].dims,s=e[1].dims,u=o.slice(0,-2),l=s.slice(0,-2),c=n?n.slice(0,-2):r.slice(0,-2),f=me.size(c),p=o[o.length-2],d=o[o.length-1],m=s[s.length-1],g=d%4===0&&m%4===0,x=p<=8?[4,1,1]:[4,4,1],b=[8,8,1],y=[Math.ceil(m/b[0]/x[0]),Math.ceil(p/b[1]/x[1]),Math.ceil(f/b[2]/x[2])],E=g?4:1,$=[...u,p,d/E],k=$.length,R=[...l,d,m/E],C=R.length,P=[f,p,m/E],W=[{type:6,data:p},{type:6,data:m},{type:6,data:d}];ps(t,W),W.push(...$t(c,$,R));let te=["rank","rank"],ce=e.length>2;ce&&(W.push(...$t(e[2].dims)),te.push("rank")),W.push(...$t(P));let pe=ge=>{let fe=c.length,Me=Db("batchDims",e[0].dataType,fe,1),Ge=Yr(e[0].dataType),He=$e("a",e[0].dataType,k,E),dt=$e("b",e[1].dataType,C,E),he=wt("result",e[0].dataType,P.length,E),qe=[He,dt];if(ce){let at=i?E:1;qe.push($e("bias",e[2].dataType,e[2].dims.length,at))}let ae=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];hs(t,ae);let we=Yr(he.type.tensor),Re=ds(t,he.type.value,we),ne=HA(E,ce,Re,[Me,He,dt,he],i);return`
  ${ge.registerUniforms(ae).registerInternalVariables(Me).declareVariables(...qe,he)}
  ${ne}
  ${g?yb(x,b,Ge,Me):bb(x,b,Ge,Me)}
                   `};return{name:"MatMul",shaderCache:{hint:`${x};${t.activation};${g};${i}`,inputDependencies:te},getRunData:()=>({outputs:[{dims:a?a(r):r,dataType:e[0].dataType}],dispatchGroup:{x:y[0],y:y[1],z:y[2]},programUniforms:W}),getShaderSource:pe}}}),R9=We(()=>{"use strict";Ct(),_a(),jt(),gs(),Gb(),B9(),Wb(),qA=(e,t,r,n,i=!1,a,o=4,s=4,u=4,l="f32")=>{let c=W=>{switch(W){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${l}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${W} is not supported.`)}},f=W=>{switch(W){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${W} is not supported.`)}},p=e?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,d=e?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,m=e?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",g=e?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",x=e?"row":"col",b=e?"col":"row",y=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${x} / outWidth;
    let outCol = ${x} % outWidth;

    let WRow = ${b} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${b} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${b} % inChannels;
    var resData = ${nn(o,l)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${m} && xCol >= 0 && xCol < ${g}) {
      ${p}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${c(o)}
    }
    return resData;`,E=e?t&&n?`
    let col = colIn * ${o};
    ${y}`:`
    let col = colIn * ${o};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${y}
    }
    return ${nn(o,l)}(0.0);`:n&&r?`
    let col = colIn * ${o};
    ${y}`:`
    let col = colIn * ${o};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${y}
    }
    return ${nn(o,l)}(0.0);`,$=e?n&&r?f(s):`
    let col = colIn * ${s};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${f(s)}
    }
    return ${nn(s,l)}(0.0);`:`
    let col = colIn * ${s};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${f(s)}
    }
    return ${nn(s,l)}(0.0);`,k=nn(u,l),R=nn(e?o:s,l),C=nn(e?s:o,l),P=ds(a,k,l);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${R} {
      ${e?E:$}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${C} {
      ${e?$:E}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${k}) {
      let col = colIn * ${u};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${d}
      ${i5(i)}
      ${P}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},o5=(e,t,r,n,i,a,o,s,u)=>{let l=t.format==="NHWC",c=l?e[0].dims[3]:e[0].dims[1],f=r[0],p=l?r[2]:r[3],d=l?r[1]:r[2],m=l?r[3]:r[1],g=l&&(c%4===0||c%3===0)&&m%4===0,x=l?m:p*d,b=l?p*d:m,y=[8,8,1],E=n<=8?[4,1,1]:[4,4,1],$=[Math.ceil(x/y[0]/E[0]),Math.ceil(b/y[1]/E[1]),Math.ceil(f/y[2]/E[2])];Qt("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${$}`);let k=g?l&&c%4!==0?3:4:1,R=y[1]*E[1],C=y[0]*E[0],P=Math.max(y[0]*k,y[1]),W=n%R===0,te=i%C===0,ce=a%P===0,pe=g?[k,4,4]:[1,1,1],ge=[{type:6,data:n},{type:6,data:i},{type:6,data:a},{type:6,data:[t.pads[0],t.pads[1]]},{type:6,data:t.strides},{type:6,data:t.dilations}];ps(t,ge),ge.push(...$t(e[0].dims,e[1].dims));let fe=["rank","rank"];o&&(ge.push(...$t(e[2].dims)),fe.push("rank")),ge.push(...$t(r));let Me=Ge=>{let He=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];hs(t,He);let dt=g?4:1,he=Yr(e[0].dataType),qe=`
      fn setOutputAtIndex(flatIndex : i32, value : ${g?`vec4<${he}>`:he}) {
        result[flatIndex] = ${g?`vec4<${he}>`:he}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${g?`vec4<${he}>`:he}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${g?"/ 4":""}, value);
      }`,ae=$e("x",e[0].dataType,e[0].dims.length,k===3?1:k),we=$e("w",e[1].dataType,e[1].dims.length,dt),Re=[ae,we],ne=wt("result",e[0].dataType,r.length,dt);if(o){let at=$e("bias",e[2].dataType,e[2].dims.length,dt);Re.push(at),qe+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${g?`vec4<${he}>`:he} {
          return bias[coords.${l?"w":"y"}${g?"/ 4":""}];
        }`}return`
        ${a5("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${Ge.registerUniforms(He).declareVariables(...Re,ne)}
        ${qe}
        ${qA(l,W,te,ce,o,t,pe[0],pe[1],pe[2],he)}
        ${g?yb(E,y,he,void 0,!l,P):bb(E,y,he,void 0,!l,P,!1,void 0,s)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${t.cacheKey};${k};${g};${W};${te};${ce};${R};${C};${P}`,inputDependencies:fe},getRunData:()=>({outputs:[{dims:u?u(r):r,dataType:e[0].dataType}],dispatchGroup:{x:$[0],y:$[1],z:$[2]},programUniforms:ge}),getShaderSource:Me}}}),z9=We(()=>{"use strict";Ct(),_a(),Ft(),jt(),gs(),Gb(),XA=e=>{let t=1;for(let r=0;r<e.length;r++)t*=e[r];return t},R1=e=>typeof e=="number"?[e,e,e]:e,Nc=(e,t)=>t<=1?e:e+(e-1)*(t-1),KA=(e,t,r,n=1)=>{let i=Nc(t,n);return Math.floor((e[0]*(r-1)-r+i)/2)},z1=(e,t,r,n,i)=>{i==null&&(i=KA(e,t[0],n[0]));let a=[0,0,0,r];for(let o=0;o<3;o++)e[o]+2*i>=t[o]&&(a[o]=Math.trunc((e[o]-t[o]+2*i)/n[o]+1));return a},YA=(e,t,r,n,i,a,o,s,u,l)=>{let c,f,p,d;if(e==="VALID"&&(e=0),typeof e=="number"){c={top:e,bottom:e,left:e,right:e,front:e,back:e};let m=z1([t,r,n,1],[s,u,l],1,[i,a,o],e);f=m[0],p=m[1],d=m[2]}else if(Array.isArray(e)){if(!e.every((g,x,b)=>g===b[0]))throw Error(`Unsupported padding parameter: ${e}`);c={top:e[0],bottom:e[1],left:e[2],right:e[3],front:e[4],back:e[5]};let m=z1([t,r,n,1],[s,u,l],1,[i,a,o],e[0]);f=m[0],p=m[1],d=m[2]}else if(e==="SAME_UPPER"){f=Math.ceil(t/i),p=Math.ceil(r/a),d=Math.ceil(n/o);let m=(f-1)*i+s-t,g=(p-1)*a+u-r,x=(d-1)*o+l-n,b=Math.floor(m/2),y=m-b,E=Math.floor(g/2),$=g-E,k=Math.floor(x/2),R=x-k;c={top:E,bottom:$,left:k,right:R,front:b,back:y}}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:c,outDepth:f,outHeight:p,outWidth:d}},s5=(e,t,r,n,i,a=!1,o="channelsLast")=>{let s,u,l,c,f;if(o==="channelsLast")[s,u,l,c,f]=e;else if(o==="channelsFirst")[s,f,u,l,c]=e;else throw new Error(`Unknown dataFormat ${o}`);let[p,,d,m,g]=t,[x,b,y]=R1(r),[E,$,k]=R1(n),R=Nc(d,E),C=Nc(m,$),P=Nc(g,k),{padInfo:W,outDepth:te,outHeight:ce,outWidth:pe}=YA(i,u,l,c,x,b,y,R,C,P),ge=a?p*f:p,fe=[0,0,0,0,0];return o==="channelsFirst"?fe=[s,ge,te,ce,pe]:o==="channelsLast"&&(fe=[s,te,ce,pe,ge]),{batchSize:s,dataFormat:o,inDepth:u,inHeight:l,inWidth:c,inChannels:f,outDepth:te,outHeight:ce,outWidth:pe,outChannels:ge,padInfo:W,strideDepth:x,strideHeight:b,strideWidth:y,filterDepth:d,filterHeight:m,filterWidth:g,effectiveFilterDepth:R,effectiveFilterHeight:C,effectiveFilterWidth:P,dilationDepth:E,dilationHeight:$,dilationWidth:k,inShape:e,outShape:fe,filterShape:t}},u5=(e,t,r,n,i,a)=>{let o=a==="channelsLast",s=o?e[0].dims[3]:e[0].dims[1],u=!1,l=[64,1,1],c={x:r.map((y,E)=>E)},f=[Math.ceil(XA(c.x.map(y=>r[y]))/l[0]),1,1];Qt("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${f}`);let p=u?o&&s%4!==0?3:4:1,d=me.size(r),m=[{type:12,data:d},{type:12,data:n},{type:12,data:i},{type:12,data:t.strides},{type:12,data:t.dilations}];ps(t,m),m.push(...$t(e[0].dims,e[1].dims));let g=["rank","rank"],x=e.length===3;x&&(m.push(...$t(e[2].dims)),g.push("rank")),m.push(...$t(r));let b=y=>{let E=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:n.length},{name:"pads",type:"u32",length:i.length},{name:"strides",type:"u32",length:t.strides.length},{name:"dilations",type:"u32",length:t.dilations.length}];hs(t,E);let $=u?4:1,k=Yr(e[0].dataType),R=$e("x",e[0].dataType,e[0].dims.length,p===3?1:p),C=$e("W",e[1].dataType,e[1].dims.length,$),P=[R,C],W=wt("result",e[0].dataType,r.length,$),te="";if(x){let ge=$e("bias",e[2].dataType,e[2].dims.length,$);P.push(ge),te+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${u?`vec4<${k}>`:k} {
          return bias[${o?_t("coords",4,5):_t("coords",1,5)}${u?"/ 4":""}];
        }`}let ce=nn(p,k),pe=ds(t,ce,k);return`
            ${te}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${R.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${C.getByIndices("aIndices")};
            }
          ${y.registerUniforms(E).declareVariables(...P,W)}
          ${y.mainStart()}
          ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${W.offsetToIndices("global_idx")};
              let batch = ${_t("coords",0,R.rank)};
              let d2 = ${o?_t("coords",R.rank-1,R.rank):_t("coords",1,R.rank)};
              let xFRCCorner = vec3<u32>(${o?_t("coords",1,R.rank):_t("coords",2,R.rank)},
              ${o?_t("coords",2,R.rank):_t("coords",3,R.rank)},
              ${o?_t("coords",3,R.rank):_t("coords",4,R.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${o?_t("uniforms.x_shape",1,R.rank):_t("uniforms.x_shape",2,R.rank)};
              let xShapeZ = ${o?_t("uniforms.x_shape",2,R.rank):_t("uniforms.x_shape",3,R.rank)};
              let xShapeW = ${o?_t("uniforms.x_shape",3,R.rank):_t("uniforms.x_shape",4,R.rank)};
              let xShapeU = ${o?_t("uniforms.x_shape",4,R.rank):_t("uniforms.x_shape",1,R.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${o?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${o?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${o?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${o?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${x?"value = value + getBiasByOutputCoords(coords)":""};
              ${pe}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${t.cacheKey};${o};${p};${x}`,inputDependencies:g},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:f[0],y:f[1],z:f[2]},programUniforms:m}),getShaderSource:b}}}),N9=We(()=>{"use strict";Ct(),Ft(),jt(),gs(),l5=(e,t,r,n)=>{let i=e.length>2,a=i?"value += b[output_channel];":"",o=e[0].dims,s=e[1].dims,u=t.format==="NHWC",l=u?r[3]:r[1],c=l/t.group,f=u&&c>=4?Tr(l):1,p=me.size(r)/f,d=[{type:12,data:p},{type:12,data:t.dilations},{type:12,data:[t.strides[0],t.strides[1]]},{type:12,data:[t.pads[0],t.pads[1]]},{type:12,data:c}];ps(t,d),d.push(...$t(o,[s[0],s[1],s[2],s[3]/f]));let m=i?["rank","rank","rank"]:["rank","rank"];d.push(...$t([r[0],r[1],r[2],r[3]/f]));let g=x=>{let b=wt("output",e[0].dataType,r.length,f),y=Yr(b.type.tensor),E=ds(t,b.type.value,y),$=$e("x",e[0].dataType,o.length),k=$e("w",e[1].dataType,s.length,f),R=[$,k];i&&R.push($e("b",e[2].dataType,e[2].dims,f));let C=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:t.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];hs(t,C);let P=u?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${$.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${k.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${$.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${k.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${x.registerUniforms(C).declareVariables(...R,b)}

  ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${b.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${u?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${u?1:2}], outputIndices[${u?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${f} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${u?2:1}];

    var value: ${b.type.value} = ${b.type.value}(0);
    ${P}
    ${a}
    ${E}
    ${b.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${t.cacheKey}_${f}`,inputDependencies:m},getRunData:()=>({outputs:[{dims:n?n(r):r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:d}),getShaderSource:g}},c5=(e,t,r,n)=>{let i=e.length>2,a=Tr(r[3]),o=Tr(r[2]),s=me.size(r)/a/o,u=[e[0].dims[0],e[0].dims[1],e[0].dims[2],e[0].dims[3]/a],l=[e[1].dims[0],e[1].dims[1],e[1].dims[2],e[1].dims[3]/a],c=[r[0],r[1],r[2],r[3]/a],f=[{type:12,data:s},{type:6,data:[t.strides[0],t.strides[1]]},{type:6,data:[t.pads[0],t.pads[1]]}];ps(t,f),f.push(...$t(u,l,c));let p=(o-1)*t.strides[1]+l[1],d=m=>{let g=wt("output",e[0].dataType,c.length,a),x=Yr(g.type.tensor),b=ds(t,g.type.value,x),y=$e("x",e[0].dataType,u.length,a),E=$e("w",e[1].dataType,l.length,a),$=[y,E];i&&$.push($e("b",e[2].dataType,e[2].dims,a));let k=i?"value += b[output_channel];":"",R=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return hs(t,R),`
  ${m.registerUniforms(R).declareVariables(...$,g)}
  ${m.mainStart()}
    ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${o}u;
    let col = (index1 % width1) * ${o}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${y.type.value}, ${p}>;
    var values: array<${g.type.value}, ${o}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${l[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${p}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${y.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${y.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${l[1]}; w_width++) {
          let w_val = ${E.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${o}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${o}u; i++) {
      var value = values[i];
      ${k}
      ${b}
      ${g.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${t.cacheKey};${a};${o};${p};${l[0]};${l[1]}`,inputDependencies:i?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:n?n(r):r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:f}),getShaderSource:d}}}),L9=We(()=>{"use strict";Ft(),R9(),z9(),Wb(),N9(),gs(),Vb(),ao(),ZA=(e,t,r,n,i,a)=>{let o=e[0],s=e.slice(a?1:2,a?3:4),u=s.length,l=t[0],c=t.slice(2).map((p,d)=>p+(p-1)*(r[d]-1)),f=s.map((p,d)=>p+n[d]+n[d+u]).map((p,d)=>Math.floor((p-c[d]+i[d])/i[d]));return f.splice(0,0,o),f.splice(a?3:1,0,l),f},wh=[2,3,1,0],QA=(e,t)=>{if(!e||e.length!==2&&e.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length>5)throw new Error("greater than 5D is not supported");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");let r=e[0].dims[t.format==="NHWC"?e[0].dims.length-1:1],n=e[1].dims[1]*t.group;if(r!==n)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(e.length===3&&(e[2].dims.length!==1||e[1].dims[0]!==e[2].dims[0]))throw new Error("invalid bias");let i=e[0].dims.length-2;if(t.dilations.length!==i)throw new Error(`dilations should be ${i}D`);if(t.strides.length!==i)throw new Error(`strides should be ${i}D`);if(t.pads.length!==i*2)throw new Error(`pads should be ${i*2}D`);if(t.kernelShape.length!==0&&t.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape")},vh=(e,t)=>{let r=e.kernelShape.slice();r.length<t[1].dims.length-2&&r.push(...Array(t[1].dims.length-2-r.length).fill(0));for(let a=2;a<t[1].dims.length;++a)r[a-2]===0&&(r[a-2]=t[1].dims[a]);let n=e.pads.slice();Ih.adjustPadsBasedOnAutoPad(t[0].dims,e.strides,e.dilations,r,n,e.format==="NHWC",e.autoPad);let i=Object.assign({},e);return Object.assign(i,{kernelShape:r,pads:n}),i},wb=e=>{let t=Fb(e),r=e.format,n=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],i=e.dilations,a=e.group,o=e.kernel_shape,s=e.pads,u=e.strides,l=e.w_is_const();return{autoPad:n,format:r,dilations:i,group:a,kernelShape:o,pads:s,strides:u,wIsConst:l,...t,cacheKey:`${e.format};${t.activation};`}},N1=(e,t,r,n)=>{let i=r.format==="NHWC",a=ZA(t[0].dims,t[1].dims,r.dilations,r.pads,r.strides,i);if(r.group!==1){let R=[t[0]];if(i){let C=e.kernelCustomData.wT??e.compute(Dn(t[1],wh),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];r.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=C),R.push(C)}else R.push(t[1]);t.length===3&&R.push(t[2]),!e.adapterInfo.isArchitecture("ampere")&&i&&t[1].dims[0]===r.group&&t[1].dims[1]===1&&r.dilations[0]===1&&r.dilations[1]===1?e.compute(c5(R,r,a,n),{inputs:R}):e.compute(l5(R,r,a,n),{inputs:R});return}let o=t.length===3,s=t[0].dims[i?1:2],u=t[0].dims[i?2:3],l=t[0].dims[i?3:1],c=t[1].dims[2],f=t[1].dims[3],p=a[i?1:2],d=a[i?2:3],m=a[i?3:1],g=i&&c===s&&f===u&&r.pads[0]===0&&r.pads[1]===0;if(g||c===1&&f===1&&r.dilations[0]===1&&r.dilations[1]===1&&r.strides[0]===1&&r.strides[1]===1&&r.pads[0]===0&&r.pads[1]===0){let R=a[0],C,P,W,te=[];if(i){let ge=e.kernelCustomData.wT??e.compute(Dn(t[1],wh),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];if(r.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=ge),g){let fe=s*u*l;C=t[0].reshape([1,R,fe]),P=ge.reshape([1,fe,m]),W=[1,R,m]}else C=t[0].reshape([R,s*u,l]),P=ge.reshape([1,l,m]),W=[R,p*d,m];te.push(C),te.push(P)}else C=t[0].reshape([R,l,s*u]),P=t[1].reshape([1,m,l]),W=[R,m,p*d],te.push(P),te.push(C);o&&te.push(t[2]);let ce=W[2],pe=te[0].dims[te[0].dims.length-1];ce<8&&pe<8?e.compute(jb(te,r,a,W,i,n),{inputs:te}):e.compute(Oh(te,r,a,W,i,n),{inputs:te});return}let x=!0,b=e.kernelCustomData.wT??e.compute(Dn(t[1],wh),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];r.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=b);let y=[t[0],b];o&&y.push(t[2]);let E=i?p*d:m,$=i?m:p*d,k=c*f*l;e.compute(o5(y,r,a,E,$,k,o,x,n),{inputs:y})},JA=(e,t)=>{let r=t.format==="NHWC",n=[e.inputs[0].reshape(r?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];e.inputs.length===3&&n.push(e.inputs[2]);let i=[0,t.pads[0],0,t.pads[1]],a=[1].concat(t.strides),o=[1].concat(t.dilations),s=[1].concat(t.kernelShape),u=vh({...t,pads:i,strides:a,dilations:o,kernelShape:s},n);N1(e,n,u,l=>r?[l[0],l[2],l[3]]:[l[0],l[1],l[3]])},e4=(e,t,r)=>{let n=r.format==="NHWC"?"channelsLast":"channelsFirst",i=vh(r,t),a=r.autoPad==="NOTSET"?r.pads:r.autoPad,o=s5(t[0].dims,t[1].dims,r.strides,r.dilations,a,!1,n);e.compute(u5(t,i,o.outShape,[o.filterDepth,o.filterHeight,o.filterWidth],[o.padInfo.front,o.padInfo.top,o.padInfo.left],n))},vb=(e,t)=>{if(QA(e.inputs,t),e.inputs[0].dims.length===3)JA(e,t);else if(e.inputs[0].dims.length===5)e4(e,e.inputs,t);else{let r=vh(t,e.inputs);N1(e,e.inputs,r)}}}),D9=We(()=>{"use strict";Ct(),_a(),Ft(),jt(),f5=(e,t,r)=>{let n=e.length>2,i=t.outputShape,a=t.format==="NHWC",o=t.group,s=e[1].dims,u=s[2]/o,l=s[3],c=a?Tr(u):1,f=a&&l===1&&u>=4,p=f?Math.floor(u/4)*4:Math.floor(u/c)*c,d=u-p,m=a?Tr(l):1,g=a?l===1?c:m:1,x=me.size(i)/m,b=[Math.ceil(x/64),1,1];Qt("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${b}`);let y=["rank","rank"],E=[t.strides[0],t.strides[1]],$=[t.kernelShape[a?1:2],t.kernelShape[a?2:3]],k=[t.dilations[0],t.dilations[1]],R=[$[0]+(t.dilations[0]<=1?0:(t.kernelShape[a?1:2]-1)*(t.dilations[0]-1)),$[1]+(t.dilations[1]<=1?0:(t.kernelShape[a?2:3]-1)*(t.dilations[1]-1))],C=[R[0]-1-Math.floor((t.pads[0]+t.pads[2])/2),R[1]-1-Math.floor((t.pads[1]+t.pads[3])/2)],P=[{type:12,data:x},{type:12,data:E},{type:12,data:$},{type:12,data:k},{type:12,data:R},{type:6,data:C},{type:12,data:p},{type:12,data:u},{type:12,data:l},...$t(e[0].dims,e[1].dims)];n&&(P.push(...$t(e[2].dims)),y.push("rank")),P.push(...$t(i));let W=te=>{let ce=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:E.length},{name:"filter_dims",type:"u32",length:$.length},{name:"dilations",type:"u32",length:$.length},{name:"effective_filter_dims",type:"u32",length:R.length},{name:"pads",type:"i32",length:C.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],pe=Yr(e[0].dataType),ge=a?1:2,fe=a?2:3,Me=a?3:1,Ge=$e("W",e[1].dataType,e[1].dims.length,g),He=$e("Dy",e[0].dataType,e[0].dims.length,c),dt=[He,Ge];n&&dt.push($e("bias",e[2].dataType,[i[Me]].length,m));let he=wt("result",e[0].dataType,i.length,m),qe=()=>{let Re="";if(f)c===4?Re+=`
        let xValue = ${He.getByOffset("x_offset")};
        let wValue = ${Ge.getByOffset("w_offset")};
        dotProd = dotProd + dot(xValue, wValue);
        x_offset += 1u;
        w_offset += 1u;`:c===2?Re+=`
          dotProd = dotProd + dot(vec4<${pe}>(${He.getByOffset("x_offset")}, ${He.getByOffset("x_offset + 1u")}), vec4<${pe}>(${Ge.getByOffset("w_offset")}, ${Ge.getByOffset("w_offset + 1u")}));
          x_offset += 2u;
          w_offset += 2u;`:c===1&&(Re+=`
          dotProd = dotProd + dot(vec4<${pe}>(${He.getByOffset("x_offset")}, ${He.getByOffset("x_offset + 1u")}, ${He.getByOffset("x_offset + 2u")}, ${He.getByOffset("x_offset + 3u")}), vec4<${pe}>(${Ge.getByOffset("w_offset")}, ${Ge.getByOffset("w_offset + 1u")}, ${Ge.getByOffset("w_offset + 2u")}, ${Ge.getByOffset("w_offset + 3u")}));
          x_offset += 4u;
          w_offset += 4u;`);else if(Re+=`
                  let xValue = ${a?He.getByOffset(`${He.indicesToOffset(`${He.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${c}`):He.get("batch","inputChannel","idyR","idyC")};
        `,c===1)Re+=`
          let w_offset = ${Ge.indicesToOffset(`${Ge.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
          let wValue = ${Ge.getByOffset(`w_offset / ${g}`)};
          dotProd = dotProd + xValue * wValue;`;else for(let ne=0;ne<c;ne++)Re+=`
            let wValue${ne} = ${Ge.getByOffset(`${Ge.indicesToOffset(`${Ge.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${ne}, wOutChannel)`)} / ${g}`)};
            dotProd = dotProd + xValue[${ne}] * wValue${ne};`;return Re},ae=()=>{if(d===0)return"";if(!f)throw new Error(`packInputAs4 ${f} is not true.`);let Re="";if(c===1){Re+="dotProd = dotProd";for(let ne=0;ne<d;ne++)Re+=`
            + ${He.getByOffset(`x_offset + ${ne}`)} * ${Ge.getByOffset(`w_offset + ${ne}`)}`;Re+=";"}else if(c===2){if(d!==2)throw new Error(`Invalid inputChannelsRemainder ${d}.`);Re+=`
          let xValue = ${He.getByOffset("x_offset")};
          let wValue = ${Ge.getByOffset("w_offset")};
          dotProd = dotProd + dot(xValue, wValue);`}return Re},we=`
            let outputIndices = ${he.offsetToIndices(`global_idx * ${m}`)};
            let batch = ${he.indicesGet("outputIndices",0)};
            let d1 = ${he.indicesGet("outputIndices",Me)};
            let r = ${he.indicesGet("outputIndices",ge)};
            let c = ${he.indicesGet("outputIndices",fe)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${he.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${pe}(dyRCorner) + ${pe}(wR)) / ${pe}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${pe}(uniforms.Dy_shape[${ge}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }
              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${pe}(dyCCorner) + ${pe}(wC)) / ${pe}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${pe}(uniforms.Dy_shape[${fe}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                ${f?`
                var x_offset = ${He.indicesToOffset(`${He.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${c};
                var w_offset = ${Ge.indicesToOffset(`${Ge.type.indices}(wRPerm, wCPerm, inputChannel, wOutChannel)`)} / ${g};
                  `:""}
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ${f?4:c}) {
                  ${qe()}
                  inputChannel = inputChannel + ${f?4:c};
                }
                ${ae()}
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${n?` + bias[d1 / ${m}]`:""};
            ${he.setByOffset("global_idx","value")};
          `;return`
    ${te.registerUniforms(ce).declareVariables(...dt,he)}
      ${te.mainStart()}
      ${te.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${we}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${t.cacheKey};${c}${g}${m}${f}${d}`,inputDependencies:y},getRunData:()=>({dispatchGroup:{x:b[0],y:b[1],z:b[2]},outputs:[{dims:r?r(i):i,dataType:e[0].dataType}],programUniforms:P}),getShaderSource:W}}}),M9=We(()=>{"use strict";D9(),gs(),ao(),t4=(e,t,r,n,i,a)=>(e-1)*t+r+(n-1)*i+1-a,r4=(e,t,r,n,i)=>{let a=Math.floor(e/2);t==="SAME_UPPER"?(r[n]=a,r[i]=e-a):t==="SAME_LOWER"&&(r[n]=e-a,r[i]=a)},n4=(e,t,r,n,i,a,o,s,u,l)=>{let c=e.length-2,f=l.length===0;u.length<c&&u.push(...Array(c-u.length).fill(0));let p=e[0],d=t[s?3:1]*i;for(let m=0,g=e.length-c-(s?1:0);m<c;++m,++g){let x=e[g],b=f?x*o[m]:l[m],y=t4(x,o[m],a[m],t[g],r[m],b);r4(y,n,a,m,m+c),f&&l.push(o[m]*(x-1)+u[m]+(t[g]-1)*r[m]+1-a[m]-a[m+c])}l.splice(0,0,p),l.splice(s?3:1,0,d)},L1=(e,t)=>{let r=e.kernelShape.slice();if(e.kernelShape.length===0||e.kernelShape.reduce((f,p)=>f*p,1)===0){r.length=0;for(let f=2;f<t[1].dims.length;++f)r.push(t[1].dims[f])}let n=e.format==="NHWC";r.splice(0,0,t[1].dims[0]),r.splice(n?3:1,0,t[1].dims[1]);let i=e.pads.slice(),a=e.outputShape.slice(),o=e.outputPadding.slice(),s=t[0].dims,u=e.dilations.slice();if(u.reduce((f,p)=>f+p,0)===0){let f=t[0].dims.length-2;u=new Array(f).fill(1)}let l=e.strides.slice();if(l.reduce((f,p)=>f+p,0)===0){let f=t[0].dims.length-2;l=new Array(f).fill(1)}n4(s,r,u,e.autoPad,e.group,i,l,n,o,a);let c=Object.assign({},e);return Object.assign(c,{kernelShape:r,pads:i,outputPadding:o,outputShape:a,dilations:u,strides:l}),c},d5=e=>{let t=Fb(e),r=e.format,n=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof e.autoPad>"u"?0:e.autoPad],i=e.dilations,a=e.group,o=e.kernelShape,s=e.pads,u=e.strides,l=e.wIsConst(),c=e.outputPadding,f=e.outputShape;return{autoPad:n,format:r,dilations:i,group:a,kernelShape:o,outputPadding:c,outputShape:f,pads:s,strides:u,wIsConst:l,...t,cacheKey:`${e.format};${t.activation};`}},i4=(e,t)=>{if(!e||e.length!==2&&e.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length!==4&&e[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");let r=e[0].dims[t.format==="NHWC"?e[0].dims.length-1:1],n=e[1].dims[0];if(r!==n)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let i=e[1].dims[1]*t.group;if(e.length===3&&(e[2].dims.length!==1||e[2].dims[0]!==i))throw new Error("invalid bias");let a=e[0].dims.length-2;if(t.dilations.reduce((o,s)=>o+s,0)>0&&t.dilations.length!==a)throw new Error(`dilations should be ${a}D`);if(t.strides.reduce((o,s)=>o+s,0)>0&&t.strides.length!==a)throw new Error(`strides should be ${a}D`);if(t.pads.reduce((o,s)=>o+s,0)>0&&t.pads.length!==a*2)throw new Error(`pads should be ${a*2}D`);if(t.outputPadding.length!==a&&t.outputPadding.length!==0)throw new Error(`output_padding should be ${a}D`);if(t.kernelShape.reduce((o,s)=>o+s,0)>0&&t.kernelShape.length!==0&&t.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape");if(t.outputShape.length!==0&&t.outputShape.length!==e[0].dims.length-2)throw new Error("invalid output shape")},D1=(e,t,r,n)=>{let i=e.kernelCustomData.wT??e.compute(Dn(t[1],[2,3,0,1]),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];r.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=i);let a=[t[0],i];t.length===3&&a.push(t[2]),e.compute(f5(a,r,n),{inputs:a})},a4=(e,t)=>{let r=t.format==="NHWC",n=[e.inputs[0].reshape(r?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];e.inputs.length===3&&n.push(e.inputs[2]);let i=t.kernelShape;(i.length===0||i[0]===0)&&(i=[e.inputs[1].dims[2]]);let a=t.dilations;(a.length===0||a[0]===0)&&(a=[1]);let o=t.strides;(o.length===0||o[0]===0)&&(o=[1]);let s=t.pads;s.length===0&&(s=[0,0]),s=[0,s[0],0,s[1]],o=[1].concat(o),a=[1].concat(a),i=[1].concat(i);let u=t.outputPadding;u=[0].concat(u);let l=L1({...t,pads:s,strides:o,dilations:a,kernelShape:i,outputPadding:u},n);D1(e,n,l,c=>r?[c[0],c[2],c[3]]:[c[0],c[1],c[3]])},p5=(e,t)=>{if(i4(e.inputs,t),e.inputs[0].dims.length===3)a4(e,t);else{let r=L1(t,e.inputs);D1(e,e.inputs,r)}}}),P9=We(()=>{"use strict";Ct(),Ft(),Or(),jt(),o4=(e,t,r,n)=>{let i=me.size(t),a=t.length,o=$e("input",e,a),s=wt("output",e,a),u=r.dataType===6?r.getInt32Array()[0]:Number(r.getBigInt64Array()[0]),l=me.normalizeAxis(u,a),c=f=>{let p=` i32(${o.indicesGet("inputIndices","uniforms.axis")}) `,d=_t("uniforms.input_shape","uniforms.axis",a),m=n.reverse?p+(n.exclusive?" + 1":""):"0",g=n.reverse?d:p+(n.exclusive?"":" + 1");return`
                ${f.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(o,s)}
                ${f.mainStart()}
                  ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${s.offsetToIndices("global_idx")};
                  var sum = ${s.type.value}(0);
                  let first : i32 = ${m};
                  let last : i32 = ${g};
                  for (var i : i32 = first; i < last; i++) {
                    ${o.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${o.getByIndices("inputIndices")};
                  }
                  ${s.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:n.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:t,dataType:e}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:[{type:12,data:i},{type:12,data:l},...$t(t,t)]}),getShaderSource:c}},h5=(e,t)=>{let r=e.inputs[0].dims,n=e.inputs[0].dataType,i=e.inputs[1];e.compute(o4(n,r,i,t),{inputs:[0]})},m5=e=>{let t=e.exclusive===1,r=e.reverse===1;return ar({exclusive:t,reverse:r})}}),U9=We(()=>{"use strict";Ct(),Ft(),Or(),jt(),s4=e=>{if(!e||e.length!==1)throw new Error("DepthToSpace requires 1 input.");if(e[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},u4=(e,t,r,n)=>{let i=[];i.push(`fn perm(i: ${n.type.indices}) -> ${r.type.indices} {
    var a: ${r.type.indices};`);for(let a=0;a<t;++a)i.push(r.indicesSet("a",e[a],`i[${a}]`));return i.push("return a;}"),i.join(`
`)},l4=(e,t)=>{let r,n,i,a,o,s,u=t.format==="NHWC",l=t.blocksize,c=t.mode==="DCR";u?([r,n,i,a]=e.dims,o=c?[r,n,i,l,l,a/l**2]:[r,n,i,a/l**2,l,l],s=c?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([r,n,i,a]=[e.dims[0],e.dims[2],e.dims[3],e.dims[1]],o=c?[r,l,l,a/l**2,n,i]:[r,a/l**2,l,l,n,i],s=c?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let f=e.reshape(o),p=f.dims.length,d=e.dataType,m=$e("a",d,p),g=wt("output",d,p),x=b=>`
  ${b.registerUniform("output_size","u32").declareVariables(m,g)}

  ${u4(s,p,m,g)}

  ${b.mainStart()}
    ${b.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${g.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${g.setByOffset("global_idx",m.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${e.dims};${t.blocksize};${t.mode}`,inputDependencies:["rank"]},getRunData:b=>{let y=u?[r,n*l,i*l,a/l**2]:[r,a/l**2,n*l,i*l],E=me.size(y),$=f.dims,k=me.sortBasedOnPerm($,s);return{outputs:[{dims:y,dataType:b[0].dataType}],dispatchGroup:{x:Math.ceil(E/64)},programUniforms:[{type:12,data:E},...$t($,k)]}},getShaderSource:x}},g5=(e,t)=>{s4(e.inputs),e.compute(l4(e.inputs[0],t))},y5=e=>ar({blocksize:e.blocksize,mode:e.mode,format:e.format})}),F9=We(()=>{"use strict";Ct(),Ft(),Or(),jt(),_h="[a-zA-Z]|\\.\\.\\.",Lc="("+_h+")+",M1="^"+Lc+"$",c4="("+Lc+",)*"+Lc,f4="^"+c4+"$",d4=class{constructor(e=-1){this.symbolToIndices=new Map,this.inputIndex=e}addSymbol(e,t){let r=this.symbolToIndices.get(e);r===void 0?r=[t]:r.push(t),this.symbolToIndices.set(e,r)}},p4=class{constructor(e,t){this.equation=t,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[r,n]=t.includes("->")?t.split("->",2):[t,""];if(!r.match(RegExp(f4)))throw new Error("Invalid LHS term");if(r.split(",").forEach((i,a)=>{let o=e[a].dims.slice();if(!i.match(RegExp(M1)))throw new Error("Invalid LHS term");let s=this.processTerm(i,!0,o,a);this.lhs.push(s)}),n==="")n+=[...this.symbolToInfo.entries()].filter(([i,a])=>a.count===1||i==="...").map(([i])=>i).join("");else if(!n.match(RegExp(Lc)))throw new Error("Invalid RHS");n.match(RegExp(_h,"g"))?.forEach(i=>{if(i==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let a=this.symbolToInfo.get(i);if(a===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(a.dimValue)}}),this.rhs=this.processTerm(n,!1,this.outputDims)}addSymbol(e,t,r){let n=this.symbolToInfo.get(e);if(n!==void 0){if(n.dimValue!==t&&n.count!==1)throw new Error("Dimension mismatch");n.count++,n.inputIndices.push(r)}else n={count:1,dimValue:t,inputIndices:[r]};this.symbolToInfo.set(e,n)}processTerm(e,t,r,n=-1){let i=r.length,a=!1,o=[],s=0;if(!e.match(RegExp(M1))&&!t&&e!=="")throw new Error("Invalid LHS term");let u=e.match(RegExp(_h,"g")),l=new d4(n);return u?.forEach((c,f)=>{if(c==="..."){if(a)throw new Error("Only one ellipsis is allowed per input term");a=!0;let p=i-u.length+1;if(p<0)throw new Error("Ellipsis out of bounds");if(o=r.slice(s,s+p),this.hasEllipsis){if(this.ellipsisDims.length!==o.length||this.ellipsisDims.toString()!==o.toString())throw new Error("Ellipsis dimensions mismatch")}else if(t)this.hasEllipsis=!0,this.ellipsisDims=o;else throw new Error("Ellipsis must be specified in the LHS");for(let d=0;d<o.length;d++){let m=String.fromCharCode(48+d);l.addSymbol(m,f+d),this.addSymbol(m,r[s++],n)}}else l.addSymbol(c,f+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(c,r[s++],n)}),l}},P1=e=>e+"_max",h4=(e,t,r,n)=>{let i=e.map(l=>l.length).map((l,c)=>$e(`input${c}`,t,l)),a=me.size(n),o=wt("output",t,n.length),s=[...r.symbolToInfo.keys()].filter(l=>!r.rhs.symbolToIndices.has(l)),u=l=>{let c=[],f="var prod = 1.0;",p="var sum = 0.0;",d="sum += prod;",m=[],g=[],x=[],b=[],y=r.symbolToInfo.size===r.rhs.symbolToIndices.size;r.symbolToInfo.forEach(($,k)=>{if(r.rhs.symbolToIndices.has(k)){let R=r.rhs.symbolToIndices.get(k)?.[0];R!==void 0&&r.lhs.forEach((C,P)=>{if($.inputIndices.includes(P)){let W=C.symbolToIndices.get(k);if(W===void 0)throw new Error("Invalid symbol error");W.forEach(te=>{c.push(`${i[P].indicesSet(`input${P}Indices`,te,o.indicesGet("outputIndices",R))}`)})}})}else r.lhs.forEach((R,C)=>{if($.inputIndices.includes(C)){let P=R.symbolToIndices.get(k);if(P===void 0)throw new Error("Invalid symbol error");P.forEach(W=>{m.push(`${i[C].indicesSet(`input${C}Indices`,W,`${k}`)}`)}),b.push(`prod *= ${i[C].getByIndices(`input${C}Indices`)};`)}}),g.push(`for(var ${k}: u32 = 0; ${k} < uniforms.${P1(k)}; ${k}++) {`),x.push("}")});let E=y?[...c,`let sum = ${i.map(($,k)=>$.getByIndices(`input${k}Indices`)).join(" * ")};`]:[...c,p,...g,...m,f,...b,d,...x];return`
            ${l.registerUniforms(s.map($=>({name:`${P1($)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...i,o)}

            ${l.mainStart()}
            ${l.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${o.offsetToIndices("global_idx")};
            ${i.map(($,k)=>`var input${k}Indices: ${i[k].type.indices};`).join(`
`)}
            ${E.join(`
`)};
            ${o.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:r.equation,inputDependencies:e.map(()=>"rank")},getRunData:()=>{let l=s.filter(f=>r.symbolToInfo.has(f)).map(f=>({type:12,data:r.symbolToInfo.get(f)?.dimValue||0}));l.push({type:12,data:a});let c=e.map((f,p)=>[...$t(f)]).reduce((f,p)=>f.concat(p),l);return c.push(...$t(n)),{outputs:[{dims:n,dataType:t}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:c}},getShaderSource:u}},b5=(e,t)=>{let r=new p4(e.inputs,t.equation),n=r.outputDims,i=e.inputs.map((a,o)=>a.dims);e.compute(h4(i,e.inputs[0].dataType,r,n))},w5=e=>{let t=e.equation.replace(/\s+/g,"");return ar({equation:t})}}),G9=We(()=>{"use strict";Ct(),Ft(),jt(),m4=e=>{if(!e||e.length!==2)throw new Error("Expand requires 2 input.");let t=e[0].dims,r=Array.from(e[1].getBigInt64Array(),Number),n=r.length<t.length?0:r.length-t.length,i=t.length<r.length?0:t.length-r.length;for(;n<r.length&&i<t.length;++n,++i)if(r[n]!==t[i]&&r[n]!==1&&t[i]!==1)throw new Error("Expand requires shape to be broadcastable to input")},U1=(e,t)=>{let r=e.length-t.length,n=[];for(let i=0;i<r;++i)n.push(e[i]);for(let i=0;i<t.length;++i)n.push(t[i]===1?e[i+r]:t[i]);return n},g4=(e,t)=>e.length>t.length?U1(e,t):U1(t,e),y4=e=>{let t=e[0].dims,r=Array.from(e[1].getBigInt64Array(),Number),n=g4(t,r),i=e[0].dataType,a=i===9||me.size(t)===1,o=i===9||t.length>0&&t[t.length-1]%4===0?4:1,s=a||n.length>0&&n[n.length-1]%4===0?4:1,u=Math.ceil(me.size(n)/s),l=f=>{let p=$e("input",i,t.length,o),d=wt("output",i,n.length,s),m;if(i===9){let g=(x,b,y="")=>`
          let outputIndices${b} = ${d.offsetToIndices(`outputOffset + ${b}u`)};
          let offset${b} = ${p.broadcastedIndicesToOffset(`outputIndices${b}`,d)};
          let index${b} = offset${b} / 4u;
          let component${b} = offset${b} % 4u;
          ${x}[${b}] = ${y}(${p.getByOffset(`index${b}`)}[component${b}]);
        `;m=`
        let outputOffset = global_idx * ${s};
        var data = vec4<u32>(0);
        ${g("data",0,"u32")}
        ${g("data",1,"u32")}
        ${g("data",2,"u32")}
        ${g("data",3,"u32")}
        ${d.setByOffset("global_idx","data")}
      }`}else m=`
        let outputIndices = ${d.offsetToIndices(`global_idx * ${s}`)};
        let inputOffset = ${p.broadcastedIndicesToOffset("outputIndices",d)};
        let data = ${d.type.value}(${p.getByOffset(`inputOffset / ${o}`)});
        ${d.setByOffset("global_idx","data")}
      }`;return`
    ${f.registerUniform("vec_size","u32").declareVariables(p,d)}
    ${f.mainStart()}
    ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${m}`},c=[{type:12,data:u},...$t(t,n)];return{name:"Expand",shaderCache:{hint:`${n.length};${o}${s}`,inputDependencies:["rank"]},getShaderSource:l,getRunData:()=>({outputs:[{dims:n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:c})}},v5=e=>{m4(e.inputs),e.compute(y4(e.inputs),{inputs:[0]})}}),j9=We(()=>{"use strict";Ct(),Ft(),jt(),Ub(),b4=e=>{let t=e[0].dataType,r=me.size(e[0].dims),n=me.size(e[1].dims),i=n%4===0,a=o=>{let s=$e("x",t,[1],4),u=$e("bias",t,[1],4),l=wt("y",t,[1],4),c=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],f=d=>`
      let bias${d}_offset: u32 = (global_idx * 4 + ${d}) % uniforms.bias_size;
      let bias${d} = ${u.getByOffset(`bias${d}_offset / 4`)}[bias${d}_offset % 4];`,p=i?`
      let bias = ${u.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${f(0)}${f(1)}${f(2)}${f(3)}
      let bias = ${s.type.value}(bias0, bias1, bias2, bias3);`;return`${o.registerUniforms(c).declareVariables(s,u,l)}

    ${mb(mn(t))}

    ${o.mainStart(Wu)}
      ${o.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${s.getByOffset("global_idx")};
      ${p}
      let x_in = x + bias;
      ${l.setByOffset("global_idx",gb("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${i}`,inputDependencies:["type","type"]},getShaderSource:a,getRunData:o=>({outputs:[{dims:o[0].dims,dataType:o[0].dataType}],programUniforms:[{type:12,data:Math.ceil(r/4)},{type:12,data:n}],dispatchGroup:{x:Math.ceil(r/Wu/4)}})}},_5=e=>{e.inputs.length<2||me.size(e.inputs[1].dims)===0?FI(e):e.compute(b4(e.inputs))}}),V9=We(()=>{"use strict";Ct(),Ft(),Or(),jt(),w4=e=>{if(!e||e.length!==2)throw new Error("Gather requires 2 inputs.")},v4=(e,t)=>{let r=e[0].dims,n=e[1].dims,i=r.length,a=me.normalizeAxis(t.axis,i),o=r.slice(0);o.splice(a,1,...n);let s=r[a],u=e[0].dataType===9?4:1,l=Math.ceil(me.size(o)/u),c=[{type:12,data:l},{type:6,data:s},{type:12,data:a},...$t(e[0].dims,e[1].dims,o)],f=p=>{let d=$e("data",e[0].dataType,e[0].dims.length,u),m=$e("inputIndices",e[1].dataType,e[1].dims.length),g=wt("output",e[0].dataType,o.length,u),x=y=>{let E=n.length,$=`var indicesIndices${y}  = ${m.type.indices}(0);`;for(let k=0;k<E;k++)$+=`${E>1?`indicesIndices${y}[${k}]`:`indicesIndices${y}`} = ${o.length>1?`outputIndices${y}[uniforms.axis + ${k}]`:`outputIndices${y}`};`;$+=`
          var idx${y} = ${m.getByIndices(`indicesIndices${y}`)};
          if (idx${y} < 0) {
            idx${y} = idx${y} + uniforms.axisDimLimit;
          }
          var dataIndices${y} : ${d.type.indices};
        `;for(let k=0,R=0;k<i;k++)k===a?($+=`${i>1?`dataIndices${y}[${k}]`:`dataIndices${y}`} = u32(idx${y});`,R+=E):($+=`${i>1?`dataIndices${y}[${k}]`:`dataIndices${y}`} = ${o.length>1?`outputIndices${y}[${R}]`:`outputIndices${y}`};`,R++);return $},b;if(e[0].dataType===9){let y=(E,$,k="")=>`
          let outputIndices${$} = ${g.offsetToIndices(`outputOffset + ${$}u`)};
          ${x($)};
          let offset${$} = ${d.indicesToOffset(`dataIndices${$}`)};
          let index${$} = offset${$} / 4u;
          let component${$} = offset${$} % 4u;
          ${E}[${$}] = ${k}(${d.getByOffset(`index${$}`)}[component${$}]);
        `;b=`
        let outputOffset = global_idx * ${u};
        var value = vec4<u32>(0);
        ${y("value",0,"u32")}
        ${y("value",1,"u32")}
        ${y("value",2,"u32")}
        ${y("value",3,"u32")}
        ${g.setByOffset("global_idx","value")}
      `}else b=`
      let outputIndices = ${g.offsetToIndices("global_idx")};
      ${x("")};
      let value = ${d.getByIndices("dataIndices")};
      ${g.setByOffset("global_idx","value")};
      `;return`
      ${p.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(d,m,g)}
      ${p.mainStart()}
        ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${b}
      }`};return{name:"Gather",shaderCache:{hint:t.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:o,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:c}),getShaderSource:f}},x5=e=>ar({axis:e.axis}),$5=(e,t)=>{let r=e.inputs;w4(r),e.compute(v4(e.inputs,t))}}),W9=We(()=>{"use strict";Ct(),Ft(),jt(),_4=(e,t,r,n,i,a,o,s,u)=>{let l=[{type:12,data:a},{type:12,data:n},{type:12,data:i},{type:12,data:r},{type:12,data:o},{type:12,data:s},{type:12,data:u}],c=[a];l.push(...$t(t.dims,c));let f=p=>{let d=$e("indices_data",t.dataType,t.dims.length),m=wt("input_slice_offsets_data",12,1,1),g=[d,m],x=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:i.length},{name:"sizes_from_slice_dims_data",type:"u32",length:r.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${p.registerUniforms(x).declareVariables(...g)}
  ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${i.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${r.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return e.compute({name:"computeSliceOffsets",shaderCache:{hint:`${i.length}_${r.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:c,dataType:e.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:l}),getShaderSource:f},{inputs:[t],outputs:[-1]})[0]},E5=(e,t)=>{let r=e.inputs,n=r[0].dims,i=r[0].dataType,a=r[1].dims,o=a[a.length-1],s=me.sizeToDimension(a,a.length-1),u=me.sizeFromDimension(n,t.batchDims+o),l=me.sizeToDimension(n,t.batchDims),c=me.sizeFromDimension(n,t.batchDims),f=s/l,p=new Array(o),d=u;for(let $=0;$<o;++$)p[o-1-$]=d,d*=n[t.batchDims+o-1-$];let m=_4(e,r[1],p,t.batchDims,n,s,f,c,o),g=t.batchDims+o;if(g>n.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let x=a.slice(0,-1).concat(n.slice(g)),b=me.size(x),y=[{type:12,data:b},{type:12,data:u},...$t(r[0].dims,m.dims,x)],E=$=>{let k=$e("data",r[0].dataType,r[0].dims.length),R=$e("slice_offsets",12,m.dims.length),C=wt("output",r[0].dataType,x.length);return`
          ${$.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(k,R,C)}
            ${$.mainStart()}
            ${$.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};e.compute({name:"GatherND",shaderCache:{hint:t.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:x,dataType:i}],dispatchGroup:{x:Math.ceil(b/64)},programUniforms:y}),getShaderSource:E},{inputs:[r[0],m]})},S5=e=>({batchDims:e.batch_dims,cacheKey:""})}),H9=We(()=>{"use strict";Ct(),Ft(),Or(),jt(),x4=(e,t)=>{if(e.length<3||e.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let r=me.normalizeAxis(t.quantizeAxis,e[0].dims.length),n=t.blockSize,i=e[0],a=e[2],o=e.length===4?e[3]:void 0;if(a.dims.length!==i.dims.length||!i.dims.map((s,u)=>u===r?Math.ceil(s/n)===a.dims[u]:s===a.dims[u]).reduce((s,u)=>s&&u,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(o){if(o.dataType!==i.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(o.dims.length!==a.dims.length||!o.dims.map((s,u)=>s===a.dims[u]).reduce((s,u)=>s&&u,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},$4=(e,t)=>{let r=e[0].dims,n=e[1].dims,i=r.length,a=me.normalizeAxis(t.gatherAxis,i),o=me.normalizeAxis(t.quantizeAxis,i),s=r.slice(0);s.splice(a,1,...n);let u=me.size(s),l=e[2].dataType,c=e[0].dataType===22,f=[{type:12,data:u},{type:12,data:o},{type:12,data:a},{type:12,data:t.blockSize},...$t(...e.map((d,m)=>d.dims),s)],p=d=>{let m=$e("data",e[0].dataType,e[0].dims.length),g=$e("inputIndices",e[1].dataType,e[1].dims.length),x=$e("scales",e[2].dataType,e[2].dims.length),b=e.length>3?$e("zeroPoint",e[3].dataType,e[3].dims.length):void 0,y=wt("output",l,s.length),E=[m,g,x];b&&E.push(b);let $=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${d.registerUniforms($).declareVariables(...E,y)}
        ${d.mainStart()}
        let output_indices = ${y.offsetToIndices("global_idx")};
        var indices_indices = ${g.type.indices}(0);
        ${n.length>1?`
          for (var i: u32 = 0; i < ${n.length}; i++) {
            let index = ${y.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${g.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${y.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${m.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${y.indicesGet("output_indices","i")};
          ${m.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${g.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${r[a]};
        }
        ${m.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${s.length}; i++) {
          let index = ${y.indicesGet("output_indices",`i + ${n.length} - 1`)};
          ${m.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${m.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${m.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${c?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${x.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${x.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${x.getByIndices("scale_indices")};
        ${b?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${b.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${b.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${c?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${mn(l)}(quantized_data - zero_point) * scale;
        ${y.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${t.cacheKey};${e.filter((d,m)=>m!==1).map(d=>d.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:e.length},(d,m)=>"rank")},getRunData:()=>({outputs:[{dims:s,dataType:l}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:f}),getShaderSource:p}},T5=(e,t)=>{let r=e.inputs;x4(r,t),e.compute($4(e.inputs,t))},A5=e=>ar({blockSize:e.blockSize,gatherAxis:e.gatherAxis,quantizeAxis:e.quantizeAxis})}),q9=We(()=>{"use strict";Ct(),Ft(),Or(),jt(),E4=e=>{if(!e||e.length!==2)throw new Error("GatherElements requires 2 inputs.");if(e[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(e[0].dims.length!==e[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},S4=(e,t)=>{let r=e[0].dims,n=e[0].dataType,i=r.length,a=e[1].dims,o=e[1].dataType,s=me.normalizeAxis(t.axis,i),u=r[s],l=a.slice(0),c=me.size(l),f=$e("input",n,i),p=$e("indicesInput",o,a.length),d=wt("output",n,l.length),m=[{type:12,data:c},{type:6,data:u},{type:12,data:s}];return m.push(...$t(r,a,l)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:l,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:m}),getShaderSource:g=>`
      ${g.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(f,p,d)}
      ${g.mainStart()}
      ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${d.offsetToIndices("global_idx")};

      var idx = ${p.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${f.type.indices}(outputIndices);
      ${f.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${f.getByIndices("inputIndices")};

      ${d.setByOffset("global_idx","value")};
  }`}},k5=e=>ar({axis:e.axis}),I5=(e,t)=>{let r=e.inputs;E4(r),e.compute(S4(e.inputs,t))}}),X9=We(()=>{"use strict";Ct(),Ft(),jt(),T4=e=>{if(!e)throw new Error("Input is missing");if(e.length<2||e.length>3)throw new Error("Invaid input number.");if(e.length===3&&e[2].dims.length>2)throw new Error("Invalid input shape of C");if(e[0].dataType!==e[1].dataType||e.length===3&&e[0].dataType!==e[2].dataType)throw new Error("Input types are mismatched")},A4=(e,t)=>{let r=e[0].dims.slice(),n=e[1].dims.slice(),[i,a,o]=kk.getShapeOfGemmResult(r,t.transA,n,t.transB,e.length===3?e[2].dims:void 0),s=[i,a];if(!s)throw new Error("Can't use gemm on the given tensors");let u=16,l=Math.ceil(a/u),c=Math.ceil(i/u),f=!0,p=me.size(s),d=[{type:12,data:f?l:p},{type:12,data:i},{type:12,data:a},{type:12,data:o},{type:1,data:t.alpha},{type:1,data:t.beta}],m=["type","type"];e.length===3&&(d.push(...$t(e[2].dims)),m.push("rank")),d.push(...$t(s));let g=b=>{let y="";t.transA&&t.transB?y="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":t.transA&&!t.transB?y="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!t.transA&&t.transB?y="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!t.transA&&!t.transB&&(y="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let E=t.alpha===1?"":"value *= uniforms.alpha;",$=$e("a",e[0].dataType,e[0].dims),k=$e("b",e[1].dataType,e[1].dims),R=$.type.value,C=null,P=[$,k];e.length===3&&(C=$e("c",e[2].dataType,e[2].dims.length),P.push(C));let W=wt("output",e[0].dataType,s.length);P.push(W);let te=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${b.registerUniforms(te).declareVariables(...P)}

  ${b.mainStart()}
    ${b.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${R}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${y}
    }

    ${E}
    ${C!=null?`let cOffset = ${C.broadcastedIndicesToOffset("vec2(m, n)",W)}; value += ${R}(uniforms.beta) * ${C.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},x=b=>{let y=$e("a",e[0].dataType,e[0].dims),E=$e("b",e[1].dataType,e[1].dims),$=null,k=[y,E];e.length===3&&($=$e("c",e[2].dataType,e[2].dims.length),k.push($));let R=wt("output",e[0].dataType,s.length);k.push(R);let C=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],P="",W="";t.transA&&t.transB?(W=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${y.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${E.type.value}(0);
      }
      `,P="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):t.transA&&!t.transB?(W=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${y.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${E.type.value}(0);
      }
      `,P="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!t.transA&&t.transB?(W=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${y.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${E.type.value}(0);
      }
      `,P="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!t.transA&&!t.transB&&(W=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${y.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${E.type.value}(0);
      }
      `,P="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let te=t.alpha===1?"":"value *= uniforms.alpha;";return`
  ${b.registerUniforms(C).declareVariables(...k)}
  var<workgroup> tile_a: array<array<${y.type.storage}, ${u}>, ${u}>;
  var<workgroup> tile_b: array<array<${E.type.storage}, ${u}>, ${u}>;
  ${b.mainStart([u,u,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${u};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${u};
    let num_tiles = (uniforms.K - 1) / ${u} + 1;
    var k_start = 0u;
    var value = ${R.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${W}
      k_start = k_start + ${u};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${u}; k++) {
        ${P}
      }
      workgroupBarrier();
    }

    ${te}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${$!=null?`let cOffset = ${$.broadcastedIndicesToOffset("vec2(m, n)",R)}; value += ${R.type.value}(uniforms.beta) * ${$.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return f?{name:"GemmShared",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:m},getRunData:()=>({outputs:[{dims:s,dataType:e[0].dataType}],dispatchGroup:{x:l*c},programUniforms:d}),getShaderSource:x}:{name:"Gemm",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:m},getRunData:()=>({outputs:[{dims:s,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:d}),getShaderSource:g}},C5=e=>{let t=e.transA,r=e.transB,n=e.alpha,i=e.beta;return{transA:t,transB:r,alpha:n,beta:i,cacheKey:`${e.transA};${e.transB};${e.alpha===1}`}},O5=(e,t)=>{T4(e.inputs),e.compute(A4(e.inputs,t))}}),K9=We(()=>{"use strict";Ct(),Ft(),Or(),jt(),[Zi,wa,is,as]=[0,1,2,3],k4=e=>{if(e[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(e[0].dims.length!==e[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(e[0].dims.length-2!==e[1].dims[e[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${e[0].dims.length-2}`);if(e[0].dims[0]!==e[1].dims[0])throw new Error("grid batch size must match input batch size")},I4=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,C4=e=>`
  fn gs_bicubic_interpolate(p: mat4x4<${e}>, x: f32, y: f32) -> ${e} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${e}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,O4=e=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${e.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,B4=e=>`
  ${e.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,R4=(e,t,r)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${t} {
     var pixel = ${t}(0);
     var indices = vec4<u32>(0);
     indices[${Zi}] = batch;
     indices[${wa}] = channel;`+(()=>{switch(r.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${is}] = u32(r);
            indices[${as}] = u32(c);
          } else {
            return ${t}(0);
          }
        `;case"border":return`
          indices[${is}] = u32(clamp(r, 0, H - 1));
          indices[${as}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${is}] = gs_reflect(r, border[1], border[3]);
          indices[${as}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${r.paddingMode} is not supported`)}})()+`
    return ${e.getByIndices("indices")};
  }
`,z4=(e,t,r)=>(()=>{switch(r.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${Zi}], indices[${wa}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${Zi}], indices[${wa}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${Zi}], indices[${wa}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${Zi}], indices[${wa}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${Zi}], indices[${wa}], border);

          let dx2 = ${t}(f32(x2) - x);
          let dx1 = ${t}(x - f32(x1));
          let dy2 = ${t}(f32(y2) - y);
          let dy1 = ${t}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${t}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${Zi}], indices[${wa}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${r.mode} is not supported`)}})()+`${e.setByOffset("global_idx","result")}`,N4=(e,t)=>{let r=$e("x",e[0].dataType,e[0].dims.length),n=[e[1].dims[0],e[1].dims[1],e[1].dims[2]],i=$e("grid",e[1].dataType,n.length,2),a=[e[0].dims[0],e[0].dims[1],e[1].dims[1],e[1].dims[2]];t.format==="NHWC"&&(a=[e[0].dims[0],e[1].dims[1],e[1].dims[2],e[0].dims[3]],[Zi,wa,is,as]=[0,3,1,2]);let o=wt("output",e[0].dataType,a.length),s=r.type.value,u=me.size(a),l=[{type:12,data:u},...$t(e[0].dims,n,a)],c=f=>`
  ${f.registerUniform("output_size","u32").declareVariables(r,i,o)}
  ${I4}
  ${C4(s)}
  ${O4(t)}
  ${B4(t)}
  ${R4(r,s,t)}

  ${f.mainStart()}
    ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${is}]);
      let W_in = i32(uniforms.x_shape[${as}]);

      ${t.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${o.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${Zi}], indices[${is}], indices[${as}]);
      let nxy = ${i.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${z4(o,s,t)}
  }`;return{name:"GridSample",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:["type","type"]},getRunData:f=>{let p=me.size(a);return{outputs:[{dims:a,dataType:f[0].dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:l}},getShaderSource:c}},B5=(e,t)=>{k4(e.inputs),e.compute(N4(e.inputs,t))},R5=e=>ar({alignCorners:e.align_corners,mode:e.mode,paddingMode:e.padding_mode,format:e.format})}),L5=We(()=>{"use strict";Ct(),Ft(),Or(),Lb(),Pb(),jt(),ao(),En=(e,t)=>e.length>t&&e[t].dims.length>0?e[t]:void 0,L4=(e,t)=>{let r=e[0],n=En(e,1),i=En(e,2),a=En(e,3),o=En(e,4),s=En(e,5),u=En(e,6),l=En(e,7);if(r.dims.length!==3&&r.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let c=r.dims[0],f=r.dims[1],p=r.dims.length===3?r.dims[2]:t.numHeads*r.dims[4],d=f,m=0,g=0,x=Math.floor(p/t.numHeads);if(u&&l&&me.size(u.dims)&&me.size(l.dims)){if(u.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(u.dims[0]!==c||u.dims[1]!==t.numHeads||u.dims[3]!==x)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(l.dims[0]!==c||l.dims[1]!==t.numHeads||l.dims[3]!==x)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(u.dims[2]!==l.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(l.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');m=u.dims[2],g=u.dims[2]}else if(u&&me.size(u.dims)||l&&me.size(l.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let b;if(n&&me.size(n.dims)>0){if(r.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(n.dims.length<3||n.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(r.dims[0]!==n.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(n.dims.length===3){if(n.dims[2]!==r.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');b=2,d=n.dims[1]}else if(n.dims.length===5){if(n.dims[2]!==t.numHeads||n.dims[3]!==2||n.dims[4]!==x)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(i)throw new Error('Expect "value" be none when "key" has packed kv format.');b=5,d=n.dims[1]}else{if(n.dims[1]!==t.numHeads||n.dims[3]!==x)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');b=0,d=n.dims[2]}}else{if(r.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(r.dims[2]!==t.numHeads||r.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');b=3}if(a&&me.size(a.dims)>0){if(a.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(n&&n.dims.length===5&&n.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let y=m+d,E=0;if(o&&me.size(o.dims)>0){E=8;let C=o.dims;throw C.length===1?C[0]===c?E=1:C[0]===3*c+2&&(E=3):C.length===2&&C[0]===c&&C[1]===y&&(E=5),E===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let $=!1,k=p;if(i&&me.size(i.dims)>0){if(i.dims.length!==3&&i.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(r.dims[0]!==i.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(i.dims.length===3){if(d!==i.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');k=i.dims[2]}else{if(d!==i.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');k=i.dims[1]*i.dims[3],$=!0}}let R=!1;if(o&&me.size(o.dims)>0)throw new Error("Key padding mask is not supported");if(s&&me.size(s.dims)>0){if(s.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(s.dims[0]!==c||s.dims[1]!==t.numHeads||s.dims[2]!==f||s.dims[3]!==y)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:c,sequenceLength:f,pastSequenceLength:m,kvSequenceLength:d,totalSequenceLength:y,maxSequenceLength:g,inputHiddenSize:0,hiddenSize:p,vHiddenSize:k,headSize:x,vHeadSize:Math.floor(k/t.numHeads),numHeads:t.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:t.maskFilterValue,maskType:E,scale:t.scale,broadcastResPosBias:R,passPastInKv:$,qkvFormat:b}},z5=e=>ar({...e}),F1=ar({perm:[0,2,1,3]}),D4=(e,t,r,n,i,a,o)=>{let s=[n,i,a],u=me.size(s),l=[{type:12,data:u},{type:12,data:o},{type:12,data:a}],c=f=>{let p=wt("qkv_with_bias",t.dataType,s),d=$e("qkv",t.dataType,s),m=$e("bias",r.dataType,s),g=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${f.registerUniforms(g).declareVariables(d,m,p)}
  ${f.mainStart()}
    ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return e.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:s,dataType:t.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:l}),getShaderSource:c},{inputs:[t,r],outputs:[-1]})[0]},Vc=(e,t,r,n,i,a,o,s)=>{let u=a;if(o&&me.size(o.dims)>0){if(n===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return u=D4(e,a,o,t,n,r*i,s),u=u.reshape([t,n,r,i]),r===1||n===1?u:e.compute(Dn(u,F1.perm),{inputs:[u],outputs:[-1]})[0]}else return a.dims.length===3&&(u=a.reshape([t,n,r,i])),r===1||n===1?u:e.compute(Dn(u,F1.perm),{inputs:[u],outputs:[-1]})[0]},N5=(e,t)=>{let r=L4(e.inputs,t),n=e.inputs[0],i=En(e.inputs,1),a=En(e.inputs,2),o=En(e.inputs,3),s=En(e.inputs,4),u=En(e.inputs,5),l=En(e.inputs,6),c=En(e.inputs,7);if(n.dims.length===5)throw new Error("Packed QKV is not implemented");if(i?.dims.length===5)throw new Error("Packed KV is not implemented");let f=i&&a&&i.dims.length===4&&a.dims.length===4,p=Vc(e,r.batchSize,r.numHeads,r.sequenceLength,r.headSize,n,o,0);if(f)return Xc(e,p,i,a,s,void 0,l,c,u,r);if(!i||!a)throw new Error("key and value must be provided");let d=Vc(e,r.batchSize,r.numHeads,r.kvSequenceLength,r.headSize,i,o,r.hiddenSize),m=Vc(e,r.batchSize,r.numHeads,r.kvSequenceLength,r.vHeadSize,a,o,2*r.hiddenSize);Xc(e,p,d,m,s,void 0,l,c,u,r)}}),P5=We(()=>{"use strict";Ct(),Ft(),Or(),jt(),M4=e=>{if(!e||e.length<1)throw new Error("too few inputs")},P4=(e,t)=>{let r=[],n=t.numOutputs;return e[1].dims[0]>0&&(e[1].getBigInt64Array().forEach(i=>r.push(Number(i))),n=r.length),ar({numOutputs:n,axis:t.axis,splitSizes:r})},U4=e=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${e}u; i += 1u ) {
    if (index < ${_t("uniforms.size_in_split_axis","i",e)}) {
        return i;
    }
    }
    return ${e}u;
}`,F4=e=>{let t=e.length,r=[];for(let n=0;n<t;++n){let i=e[n].setByIndices("indices","input[global_idx]");t===1?r.push(i):n===0?r.push(`if (output_number == ${n}u) { ${i} }`):n===t-1?r.push(`else { ${i} }`):r.push(`else if (output_number == ${n}) { ${i} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${e[0].type.indices}, global_idx: u32) {
        ${r.join(`
`)}
      }`},_b=(e,t)=>{let r=e[0].dims,n=me.size(r),i=e[0].dataType,a=me.normalizeAxis(t.axis,r.length),o=new Array(t.numOutputs),s=$e("input",i,r.length),u=new Array(t.numOutputs),l=[],c=[],f=0,p=[{type:12,data:n}];for(let m=0;m<t.numOutputs;m++){f+=t.splitSizes[m],u[m]=f;let g=r.slice();g[a]=t.splitSizes[m],c.push(g),o[m]=wt(`output${m}`,i,g.length),l.push({dims:c[m],dataType:e[0].dataType})}p.push({type:12,data:u},...$t(r,...c));let d=m=>`
  ${m.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",u.length).declareVariables(s,...o)}
  ${U4(u.length)}
  ${F4(o)}

  ${m.mainStart()}
    ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${s.offsetToIndices("global_idx")};
    var index = ${s.indicesGet("indices",a)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${_t("uniforms.size_in_split_axis","output_number - 1u",u.length)};
      ${s.indicesSet("indices",a,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:t.cacheKey,inputDependencies:["rank"]},getShaderSource:d,getRunData:()=>({outputs:l,dispatchGroup:{x:Math.ceil(n/64)},programUniforms:p})}},D5=(e,t)=>{M4(e.inputs);let r=e.inputs.length===1?t:P4(e.inputs,t);e.compute(_b(e.inputs,r),{inputs:[0]})},M5=e=>{let t=e.axis,r=e.splitSizes,n=e.numOutputs<0?r.length:e.numOutputs;if(n!==r.length)throw new Error("numOutputs and splitSizes lengh must be equal");return ar({axis:t,numOutputs:n,splitSizes:r})}}),F5=We(()=>{"use strict";Ct(),Ft(),Or(),jt(),G4=(e,t)=>{let[r,n,i,a]=e,{numHeads:o,rotaryEmbeddingDim:s}=t;if(r.dims.length!==3&&r.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${r.dims.length}`);if(!me.areEqual(n.dims,[])&&!me.areEqual(n.dims,[1])&&n.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${n.dims.length}`);if(i.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${i.dims.length}`);if(a.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${a.dims.length}`);if(!me.areEqual(i.dims,a.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(s>0&&o===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let u=r.dims[0],l=r.dims[r.dims.length-2],c=i.dims[0],f=me.sizeFromDimension(r.dims,1)/l,p=s===0?i.dims[1]*2:f/o;if(s>p)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(n.dims.length===2){if(u!==n.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${n.dims[0]}`);if(l!==n.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${n.dims[1]}`)}if(p/2!==i.dims[1]&&s/2!==i.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${i.dims[1]}`);if(l>c)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},Bh=(e,t)=>{let{interleaved:r,numHeads:n,rotaryEmbeddingDim:i,scale:a}=t,o=e[0].dims[0],s=me.sizeFromDimension(e[0].dims,1),u=e[0].dims[e[0].dims.length-2],l=s/u,c=e[2].dims[1],f=i===0?c*2:l/n,p=new Array(o,u,l/f,f-c),d=me.computeStrides(p),m=[{type:1,data:a},{type:12,data:p},{type:12,data:d},...e[0].dims.length===3?new Array({type:12,data:[s,l,f,1]}):[],...e[0].dims.length===4?new Array({type:12,data:[s,f,u*f,1]}):[],...$t(e[0].dims,e[1].dims,e[2].dims,e[3].dims,e[0].dims)],g=x=>{let b=$e("input",e[0].dataType,e[0].dims.length),y=$e("position_ids",e[1].dataType,e[1].dims.length),E=$e("cos_cache",e[2].dataType,e[2].dims.length),$=$e("sin_cache",e[3].dataType,e[3].dims.length),k=wt("output",e[0].dataType,e[0].dims.length);return x.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:p.length},{name:"global_strides",type:"u32",length:d.length},{name:"input_output_strides",type:"u32",length:d.length}]),`
        ${x.declareVariables(b,y,E,$,k)}

        ${x.mainStart(Wu)}
          let half_rotary_emb_dim = uniforms.${E.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${x.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${y.broadcastedIndicesToOffset("bsnh.xy",wt("",y.type.tensor,2))};
            let position_id =
                u32(${y.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${r});
            let j = i + select(half_rotary_emb_dim, 1, ${r});
            let re = ${b.getByOffset("i")} * ${E.get("position_id","bsnh[3]")} -
                ${b.getByOffset("j")} * ${$.get("position_id","bsnh[3]")};
            ${k.setByOffset("i","re")}
            let im = ${b.getByOffset("i")} * ${$.get("position_id","bsnh[3]")} +
                ${b.getByOffset("j")} * ${E.get("position_id","bsnh[3]")};
            ${k.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${k.setByOffset("k",b.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:ar({interleaved:r}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:g,getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(me.size(p)/Wu)},programUniforms:m})}},U5=(e,t)=>{G4(e.inputs,t),e.compute(Bh(e.inputs,t))}}),Y9=We(()=>{"use strict";Or(),Ct(),Pb(),L5(),P5(),ao(),F5(),jt(),j4=(e,t)=>{if(t.doRotary&&e.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let r=e[0],n=e[1],i=e[2],a=e[3],o=e[4];if(t.doRotary!==0&&e.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(t.localWindowSize!==-1)throw new Error("Local attention is not supported");if(t.softcap!==0)throw new Error("Softcap is not supported");if(t.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(t.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(r.dims.length!==3&&r.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let s=!1,u=r.dims[0],l=r.dims[1],c=r.dims.length===3?s?r.dims[2]/3:r.dims[2]:t.numHeads*r.dims[4],f=l,p=0,d=!n||n.dims.length===0,m=Math.floor(d?c/(t.numHeads+2*t.kvNumHeads):c/t.numHeads);d&&(c=m*t.numHeads);let g=a&&a.dims.length!==0,x=o&&o.dims.length!==0;if(g&&a.dims.length===4&&a.dims[0]===u&&a.dims[1]!==t.kvNumHeads&&a.dims[2]===t.kvNumHeads&&a.dims[3]===m)throw new Error("BSNH pastKey/pastValue is not supported");if(g&&x){if(a.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(o.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');p=a.dims[2]}else if(g||x)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let b=1;if(n&&n.dims.length>0){if(r.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(n.dims.length<3||n.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(r.dims[0]!==n.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(n.dims.length===3){if(r.dims[2]%n.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');f=n.dims[1]}else if(n.dims.length===5){if(n.dims[2]!==t.numHeads||n.dims[3]!==2||n.dims[4]!==m)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(i)throw new Error('Expect "value" be none when "key" has packed kv format.');f=n.dims[1]}else{if(n.dims[1]!==t.numHeads||n.dims[3]!==m)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');f=n.dims[2]}}else{if(r.dims.length!==3&&r.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(r.dims.length===5&&(r.dims[2]!==t.numHeads||r.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');b=3}let y=0,E=!1,$=t.kvNumHeads?m*t.kvNumHeads:c;if(i&&i.dims.length>0){if(i.dims.length!==3&&i.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(r.dims[0]!==i.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(i.dims.length===3){if(f!==i.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');$=i.dims[2]}else{if(f!==i.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');$=i.dims[1]*i.dims[3],E=!0}}let k=e.length>4?e[5]:void 0;if(k&&k.dims.length!==1&&k.dims[0]!==u)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:u,sequenceLength:l,pastSequenceLength:p,kvSequenceLength:f,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:c,vHiddenSize:$,headSize:m,vHeadSize:Math.floor($/t.kvNumHeads),numHeads:t.numHeads,kvNumHeads:t.kvNumHeads,nReps:t.numHeads/t.kvNumHeads,pastPresentShareBuffer:!1,maskType:y,scale:t.scale,broadcastResPosBias:!1,passPastInKv:E,qkvFormat:b}},V4=ar({perm:[0,2,1,3]}),G1=(e,t,r)=>{let n=t,i=r.kvNumHeads;return t.dims.length===3&&r.kvSequenceLength!==0&&(n=t.reshape([r.batchSize,r.kvSequenceLength,i,r.headSize]),n=e.compute(Dn(n,V4.perm),{inputs:[n],outputs:[-1]})[0]),n},W4=(e,t,r,n)=>{let i=7,a=["type","type"],o=[e*t],s=e*t,u=[{type:12,data:s},{type:12,data:t},{type:12,data:e}],l=c=>{let f=$e("seq_lens",r.dataType,r.dims),p=$e("total_seq_lens",n.dataType,n.dims),d=wt("pos_ids",i,o),m=[{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}];return`
  ${c.registerUniforms(m).declareVariables(f,p,d)}
  ${c.mainStart()}
    ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let total_sequence_length = u32(${p.getByOffset("0")});
    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;
    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;
    let batch_idx = global_idx / uniforms.sequence_length;
    let sequence_idx = i32(global_idx % uniforms.sequence_length);
    var pos_id: i32 = 0;
    let seqlen = ${f.getByOffset("batch_idx")};
    let total_seqlen = seqlen + 1;
    if (is_first_prompt) {
      if (sequence_idx < total_seqlen) {
        pos_id = sequence_idx;
      } else {
        pos_id = 1;
      }
      ${d.setByOffset("global_idx","pos_id")}
    } else if (is_subsequent_prompt) {
      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);
      if (past_seqlen + sequence_idx < total_seqlen) {
        pos_id = past_seqlen + sequence_idx;
      } else {
        pos_id = 1;
      }
      ${d.setByOffset("global_idx","pos_id")}
    } else if (global_idx < uniforms.batch_size) {
      ${d.setByOffset("global_idx","seqlen")}
    };
  }
  `};return{name:"GeneratePositionIds",shaderCache:{hint:`${e};${t}`,inputDependencies:a},getRunData:()=>({outputs:[{dims:o,dataType:i}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:u}),getShaderSource:l}},G5=(e,t)=>{let r=j4(e.inputs,t);if(e.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(e.inputs[1]?.dims.length===5)throw new Error("Packed KV is not implemented");let n=e.inputs[0],i=e.inputs[1]&&e.inputs[1].dims.length>0?e.inputs[1]:void 0,a=e.inputs[2]&&e.inputs[2].dims.length>0?e.inputs[2]:void 0,o=e.inputs[3]&&e.inputs[3].dims.length!==0?e.inputs[3]:void 0,s=e.inputs[4]&&e.inputs[4].dims.length!==0?e.inputs[4]:void 0,u=e.inputs.length>4?e.inputs[5]:void 0,l=e.inputs.length>5?e.inputs[6]:void 0,c=r.kvNumHeads?r.kvNumHeads:r.numHeads,f=ar({axis:2,numOutputs:3,splitSizes:[r.numHeads*r.headSize,c*r.headSize,c*r.headSize]}),[p,d,m]=!i&&!a?e.compute(_b([n],f),{inputs:[n],outputs:[-1,-1,-1]}):[n,i,a],g,x;if(t.doRotary){let $=e.compute(W4(r.batchSize,r.sequenceLength,u,l),{inputs:[u,l],outputs:[-1]})[0],k=e.inputs[7],R=e.inputs[8],C=ar({interleaved:t.rotaryInterleaved!==0,numHeads:r.numHeads,rotaryEmbeddingDim:0,scale:t.scale}),P=[p,$,k,R],W=[-1];g=e.compute(Bh(P,C),{inputs:P,outputs:W})[0],P.splice(0,1,d);let te=ar({interleaved:t.rotaryInterleaved!==0,numHeads:r.kvNumHeads,rotaryEmbeddingDim:0,scale:t.scale});x=e.compute(Bh(P,te),{inputs:P,outputs:W})[0]}let b=Vc(e,r.batchSize,r.numHeads,r.sequenceLength,r.headSize,t.doRotary?g:p,void 0,0),y=G1(e,t.doRotary?x:d,r),E=G1(e,m,r);Xc(e,b,y,E,void 0,void 0,o,s,void 0,r,u,l)}}),Z9=We(()=>{"use strict";Ct(),Ft(),ao(),jt(),j1=(e,t,r,n,i,a,o,s)=>{let u=Tr(a),l=u===1?"f32":`vec${u}f`,c=u===1?"vec2f":`mat2x${u}f`,f=i*o,p=64;f===1&&(p=256);let d=[i,o,a/u],m=[i,o,2],g=["rank","type","type"],x=[];x.push(...$t(d,m));let b=y=>{let E=$e("x",t.dataType,3,u),$=$e("scale",r.dataType,r.dims),k=$e("bias",n.dataType,n.dims),R=wt("output",1,3,2),C=[E,$,k,R];return`
  var<workgroup> workgroup_shared : array<${c}, ${p}>;
  const workgroup_size = ${p}u;
  ${y.declareVariables(...C)}
  ${y.mainStart(p)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${l}(0);
    var squared_sum = ${l}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${l}(${E.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${c}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${io("workgroup_shared[0][0]",u)} / f32(hight * ${u});
      let squared_sum_final = ${io("workgroup_shared[0][1]",u)} / f32(hight * ${u});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${s}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return e.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${u};${s};${p}`,inputDependencies:g},getRunData:()=>({outputs:[{dims:m,dataType:1}],dispatchGroup:{x:f},programUniforms:x}),getShaderSource:b},{inputs:[t,r,n],outputs:[-1]})[0]},H4=(e,t,r)=>{let n=t[0].dims,i=n,a=2,o=n[0],s=n[1],u=me.sizeFromDimension(n,a),l=Tr(u),c=me.size(i)/l,f=j1(e,t[0],t[1],t[2],o,u,s,r.epsilon),p=[o,s,u/l],d=[o,s],m=["type","none"],g=x=>{let b=$e("x",t[0].dataType,p.length,l),y=$e("scale_shift",1,d.length,2),E=wt("output",t[0].dataType,p.length,l),$=[b,y,E];return`
  ${x.registerUniform("output_size","u32").declareVariables(...$)}
  ${x.mainStart()}
  ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${E.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${y.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${b.getByOffset("global_idx")} * ${E.type.value}(scale_shift.x) + ${E.type.value}(scale_shift.y);
      ${E.setByOffset("global_idx","value")};
  }`};e.compute({name:"InstanceNormalization",shaderCache:{hint:`${l}`,inputDependencies:m},getRunData:()=>({outputs:[{dims:i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:[{type:12,data:c},...$t(p,d,p)]}),getShaderSource:g},{inputs:[t[0],f]})},q4=(e,t,r)=>{let n=t[0].dims,i=n,a=n[0],o=n[n.length-1],s=me.sizeFromDimension(n,1)/o,u=Tr(o),l=me.size(i)/u,c=[{type:12,data:s},{type:12,data:Math.floor(o/u)}],f=["type","type"],p=!1,d=[0,n.length-1];for(let b=0;b<n.length-2;b++)p=p||n[b+1]!==1,d.push(b+1);p=p&&n[n.length-1]!==1;let m=p?e.compute(Dn(e.inputs[0],d),{inputs:[e.inputs[0]],outputs:[-1]})[0]:e.inputs[0].reshape(Array.from({length:n.length},(b,y)=>n[d[y]])),g=j1(e,m,t[1],t[2],a,s,o,r.epsilon),x=b=>{let y=Yr(t[0].dataType),E=u===1?"vec2f":`mat${u}x2f`,$=C=>{let P=C===0?"x":"y",W=u===1?"f32":`vec${u}f`;switch(u){case 1:return`${y}(${W}(scale.${P}))`;case 2:return`vec2<${y}>(${W}(scale[0].${P}, scale[1].${P}))`;case 4:return`vec4<${y}>(${W}(scale[0].${P}, scale[1].${P}, scale[2].${P}, scale[3].${P}))`;default:throw new Error(`Not supported compoents ${u}`)}},k=$e("input",t[0].dataType,t[0].dims,u),R=wt("output",t[0].dataType,i,u);return`
  @group(0) @binding(0) var<storage, read> input : array<${k.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${E}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${R.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${b.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${$(0)}, ${$(1)});
  }`};e.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${u}`,inputDependencies:f},getRunData:()=>({outputs:[{dims:i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:c}),getShaderSource:x},{inputs:[t[0],g]})},j5=(e,t)=>{t.format==="NHWC"?q4(e,e.inputs,t):H4(e,e.inputs,t)}}),Q9=We(()=>{"use strict";Ct(),Ft(),jt(),X4=e=>{if(!e||e.length<2)throw new Error("layerNorm requires at least 2 inputs.")},K4=(e,t,r)=>{let n=t.simplified,i=e[0].dims,a=e[1],o=!n&&e[2],s=i,u=me.normalizeAxis(t.axis,i.length),l=me.sizeToDimension(i,u),c=me.sizeFromDimension(i,u),f=me.size(a.dims),p=o?me.size(o.dims):0;if(f!==c||o&&p!==c)throw new Error(`Size of X.shape()[axis:] == ${c}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${f} and bias size of ${p}`);let d=[];for(let k=0;k<i.length;++k)k<u?d.push(i[k]):d.push(1);let m=Tr(c),g=["type","type"],x=[{type:12,data:l},{type:1,data:c},{type:12,data:Math.floor(c/m)},{type:1,data:t.epsilon}];o&&g.push("type");let b=r>1,y=r>2,E=k=>{let R=Yr(e[0].dataType),C=[$e("x",e[0].dataType,e[0].dims,m),$e("scale",a.dataType,a.dims,m)];o&&C.push($e("bias",o.dataType,o.dims,m)),C.push(wt("output",e[0].dataType,s,m)),b&&C.push(wt("mean_data_output",1,d)),y&&C.push(wt("inv_std_output",1,d));let P=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${k.registerUniforms(P).declareVariables(...C)}
  ${k.mainStart()}
    ${k.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${db("f32",m)};
    var mean_square_vector = ${db("f32",m)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${ju(R,m,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${io("mean_vector",m)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${io("mean_square_vector",m)} / uniforms.norm_size ${n?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${ju(R,m,"x[j + offset]")};
      let f32scale = ${ju(R,m,"scale[j]")};
      output[j + offset] = ${C[0].type.value}((f32input ${n?"":"- mean"}) * inv_std_dev * f32scale
        ${o?`+ ${ju(R,m,"bias[j]")}`:""}
      );
    }

    ${b?"mean_data_output[global_idx] = mean":""};
    ${y?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},$=[{dims:s,dataType:e[0].dataType}];return b&&$.push({dims:d,dataType:1}),y&&$.push({dims:d,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${m};${r};${n}`,inputDependencies:g},getRunData:()=>({outputs:$,dispatchGroup:{x:Math.ceil(l/64)},programUniforms:x}),getShaderSource:E}},V5=(e,t)=>{X4(e.inputs),e.compute(K4(e.inputs,t,e.outputCount))}}),J9=We(()=>{"use strict";Ft(),Vb(),Wb(),Y4=e=>{if(!e||e.length!==2)throw new Error("MatMul requires 2 inputs.");if(e[0].dims[e[0].dims.length-1]!==e[1].dims[e[1].dims.length-2])throw new Error("shared dimension does not match.")},W5=e=>{Y4(e.inputs);let t=Vu.calcShape(e.inputs[0].dims,e.inputs[1].dims,!0);if(!t)throw new Error("Can't use matmul on the given tensors");let r=t[t.length-1],n=e.inputs[0].dims[e.inputs[0].dims.length-1];if(r<8&&n<8)e.compute(jb(e.inputs,{activation:""},t));else{let i=t[t.length-2],a=me.size(e.inputs[0].dims.slice(0,-2)),o=me.size(e.inputs[1].dims.slice(0,-2));if(a!==1&&i===1&&o===1){let s=e.inputs[0].reshape([1,a,n]),u=e.inputs[1].reshape([1,n,r]),l=[1,a,r],c=[s,u];e.compute(Oh(c,{activation:""},t,l),{inputs:c})}else e.compute(Oh(e.inputs,{activation:""},t))}}}),eW=We(()=>{"use strict";Ct(),Ft(),Or(),jt(),Z4=(e,t)=>{if(e.length<3||e.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let r=e[0],n=r.dims.length;if(r.dims[n-1]!==t.k)throw new Error("The last dim of input shape does not match the k value");let i=Math.floor((t.k+t.blockSize-1)/t.blockSize),a=t.blockSize/8*t.bits,o=e[1];if(!me.areEqual(o.dims,[t.n,i,a]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let s=e[2].dims;if(me.size(s)!==t.n*i)throw new Error("scales input size error.");if(e.length===4){let u=e[3].dims,l=t.bits>4?t.n*i:t.n*Math.floor((i+1)/2);if(me.size(u)!==l)throw new Error("zeroPoints input size error.")}},Q4=(e,t)=>{let r=e[0].dims,n=r.length,i=r[n-2],a=t.k,o=t.n,s=r.slice(0,n-2),u=me.size(s),l=e[1].dims[2]/4,c=e[0].dataType,f=Tr(t.k),p=Tr(l),d=Tr(o),m=s.concat([i,o]),g=i>1&&o/d%2===0?2:1,x=me.size(m)/d/g,b=64,y=[],E=[u,i,a/f],$=me.convertShape(e[1].dims).slice();$.splice(-1,1,l/p),y.push(...$t(E)),y.push(...$t($)),y.push(...$t(e[2].dims)),e.length===4&&y.push(...$t(me.convertShape(e[3].dims)));let k=[u,i,o/d];y.push(...$t(k));let R=C=>{let P=E.length,W=$e("a",e[0].dataType,P,f),te=$e("b",12,$.length,p),ce=$e("scales",e[2].dataType,e[2].dims.length),pe=[W,te,ce],ge=e.length===4?$e("zero_points",12,e[3].dims.length):void 0;ge&&pe.push(ge);let fe=k.length,Me=wt("output",e[0].dataType,fe,d),Ge=Yr(e[0].dataType),He=(()=>{switch(f){case 1:return`array<${Ge}, 8>`;case 2:return`mat4x2<${Ge}>`;case 4:return`mat2x4<${Ge}>`;default:throw new Error(`${f}-component is not supported.`)}})(),dt=()=>{let ae=`
          // reuse a data
            var input_offset = ${W.indicesToOffset(`${W.type.indices}(batch, row, word_offset)`)};
            var a_data: ${He};
            for (var j: u32 = 0; j < ${8/f}; j++) {
              a_data[j] = ${W.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let we=0;we<d*g;we++)ae+=`
            b_value = ${p===1?`b${we}_data`:`b${we}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${He}(${Array.from({length:4},(Re,ne)=>`${Ge}(b_value_lower[${ne}]), ${Ge}(b_value_upper[${ne}])`).join(", ")});
            b_dequantized_values = ${f===1?`${He}(${Array.from({length:8},(Re,ne)=>`(b_quantized_values[${ne}] - ${ge?`zero_point${we}`:"zero_point"}) * scale${we}`).join(", ")});`:`(b_quantized_values - ${He}(${Array(8).fill(`${ge?`zero_point${we}`:"zero_point"}`).join(",")})) * scale${we};`};
            workgroup_shared[local_id.x * ${g} + ${Math.floor(we/d)}]${d>1?`[${we%d}]`:""} += ${Array.from({length:8/f},(Re,ne)=>`${f===1?`a_data[${ne}] * b_dequantized_values[${ne}]`:`dot(a_data[${ne}], b_dequantized_values[${ne}])`}`).join(" + ")};
          `;return ae},he=()=>{let ae=`
            var col_index = col * ${d};
            ${ge?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${Ge}(8);`}
            `;for(let we=0;we<d*g;we++)ae+=`
            let scale${we} = ${ce.getByOffset("col_index * nBlocksPerCol + block")};
            ${ge?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${ge.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${we} = ${Ge}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return ae},qe=()=>{let ae=`col_index = col * ${d};`;for(let we=0;we<d*g;we++)ae+=`
            let b${we}_data = ${te.getByIndices(`${te.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return ae+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${He};
            var b_dequantized_values: ${He};`,ae};return`
        var<workgroup> workgroup_shared: array<${Me.type.value}, ${g*b}>;
        ${C.declareVariables(...pe,Me)}
        ${C.mainStart([b,1,1])}
          let output_indices = ${Me.offsetToIndices(`(global_idx / ${b}) * ${g}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${b}) {
            //process one block
            var word_offset: u32 = block * ${t.blockSize/f};
            ${he()}
            for (var word: u32 = 0; word < ${l}; word += ${p}) {
              ${qe()}
              for (var i: u32 = 0; i < ${p}; i++) {
                ${dt()}
                word_offset += ${8/f};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${g}) {
            var output_value: ${Me.type.value} = ${Me.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${b}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${g};
            }
            ${Me.setByIndices(`${Me.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${t.blockSize};${t.bits};${f};${p};${d};${g};${b}`,inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:m,dataType:c}],dispatchGroup:{x},programUniforms:y}),getShaderSource:R}},J4=(e,t)=>{let r=e[0].dims,n=r.length,i=r[n-2],a=t.k,o=t.n,s=r.slice(0,n-2),u=me.size(s),l=e[1].dims[2]/4,c=e[0].dataType,f=Tr(t.k),p=Tr(l),d=s.concat([i,o]),m=128,g=o%8===0?8:o%4===0?4:1,x=m/g,b=x*p*8,y=b/f,E=b/t.blockSize,$=me.size(d)/g,k=[],R=[u,i,a/f],C=me.convertShape(e[1].dims).slice();C.splice(-1,1,l/p),k.push(...$t(R)),k.push(...$t(C)),k.push(...$t(e[2].dims)),e.length===4&&k.push(...$t(me.convertShape(e[3].dims)));let P=[u,i,o];k.push(...$t(P));let W=te=>{let ce=R.length,pe=$e("a",e[0].dataType,ce,f),ge=$e("b",12,C.length,p),fe=$e("scales",e[2].dataType,e[2].dims.length),Me=[pe,ge,fe],Ge=e.length===4?$e("zero_points",12,e[3].dims.length):void 0;Ge&&Me.push(Ge);let He=P.length,dt=wt("output",e[0].dataType,He),he=Yr(e[0].dataType),qe=()=>{switch(f){case 1:return`
          let a_data0 = vec4<${he}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${he}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${he}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${he}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${f}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${pe.type.value}, ${y}>;
        var<workgroup> inter_results: array<array<${dt.type.value}, ${x}>, ${g}>;
        ${te.declareVariables(...Me,dt)}
        ${te.mainStart([x,g,1])}
          let output_indices = ${dt.offsetToIndices(`workgroup_index * ${g}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${E} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${y};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${y}; a_offset += ${m})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${pe.getByIndices(`${pe.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${pe.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${E} + local_id.x;
            ${Ge?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${Ge.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${he}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${he}(8);`}
            let scale = ${fe.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${ge.getByIndices(`${ge.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${t.blockSize/f};
            for (var i: u32 = 0; i < ${p}; i++) {
              ${qe()}
              let b_value = ${p===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${he}>(${Array.from({length:4},(ae,we)=>`${he}(b_value_lower[${we}]), ${he}(b_value_upper[${we}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${he}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(ae,we)=>`${`dot(a_data${we}, b_dequantized_values[${we}])`}`).join(" + ")};
              word_offset += ${8/f};
            }
            workgroupBarrier();
          }

          if (local_idx < ${g}) {
            var output_value: ${dt.type.value} = ${dt.type.value}(0);
            for (var b = 0u; b < ${x}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${dt.setByIndices(`${dt.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${t.blockSize};${f};${p};${x};${g}`,inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:d,dataType:c}],dispatchGroup:{x:$},programUniforms:k}),getShaderSource:W}},H5=(e,t)=>{Z4(e.inputs,t),t.blockSize===32&&e.adapterInfo.isVendor("intel")&&e.adapterInfo.isArchitecture("gen-12lp")?e.compute(J4(e.inputs,t)):e.compute(Q4(e.inputs,t))},q5=e=>ar(e)}),tW=We(()=>{"use strict";Ct(),Ft(),jt(),e6=e=>{if(!e||e.length<1)throw new Error("Too few inputs");if(e[0].dataType!==1&&e[0].dataType!==10)throw new Error("Input type must be float or float16.");if(e.length>=2){let t=e[0].dims.length*2===e[1].dims[0];if(e.length===4&&(t=e[3].dims[0]*2===e[1].dims[0]),!t)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},t6=(e,t,r)=>{let n="";for(let i=t-1;i>=0;--i)n+=`
            k = i32(${e.indicesGet("indices",i)}) - ${_t("uniforms.pads",i,r)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${_t("uniforms.x_shape",i,t)})) {
              break;
            }
            offset += k * i32(${_t("uniforms.x_strides",i,t)});
        `;return`
          value = ${e.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${n}
            value = x[offset];
          }
      `},r6=(e,t,r)=>{let n="";for(let i=t-1;i>=0;--i)n+=`
                k = i32(${e.indicesGet("indices",i)}) - ${_t("uniforms.pads",i,r)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${_t("uniforms.x_shape",i,t)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${_t("uniforms.x_shape",i,t)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${_t("uniforms.x_strides",i,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},n6=(e,t,r)=>{let n="";for(let i=t-1;i>=0;--i)n+=`
                k = i32(${e.indicesGet("indices",i)}) - ${_t("uniforms.pads",i,r)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${_t("uniforms.x_shape",i,t)})) {
                  k = i32(${_t("uniforms.x_shape",i,t)}) - 1;
                }
                offset += k * i32(${_t("uniforms.x_strides",i,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},i6=(e,t,r)=>{let n="";for(let i=t-1;i>=0;--i)n+=`
                k = i32(${e.indicesGet("indices",i)}) - ${_t("uniforms.pads",i,r)};
                if (k < 0)  {
                  k += i32(${_t("uniforms.x_shape",i,t)}]);
                }
                if (k >= i32(${_t("uniforms.x_shape",i,t)})) {
                  k -= i32(${_t("uniforms.x_shape",i,t)});
                }
                offset += k * i32(${_t("uniforms.x_strides",i,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},a6=(e,t,r)=>{switch(r.mode){case 0:return t6(e,t,r.pads.length);case 1:return r6(e,t,r.pads.length);case 2:return n6(e,t,r.pads.length);case 3:return i6(e,t,r.pads.length);default:throw new Error("Invalid mode")}},o6=(e,t)=>{let r=me.padShape(e[0].dims.slice(),t.pads),n=e[0].dims,i=me.size(r),a=[{type:12,data:i},{type:6,data:t.pads}],o=e.length>=3&&e[2].data;t.mode===0&&a.push({type:o?e[2].dataType:1,data:t.value}),a.push(...$t(e[0].dims,r));let s=["rank"],u=l=>{let c=wt("output",e[0].dataType,r.length),f=$e("x",e[0].dataType,n.length),p=f.type.value,d=a6(c,n.length,t),m=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:t.pads.length}];return t.mode===0&&m.push({name:"constant_value",type:o?p:"f32"}),`
            ${l.registerUniforms(m).declareVariables(f,c)}
            ${l.mainStart()}
            ${l.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${c.offsetToIndices("global_idx")};

            var value = ${p}(0);
            ${d}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${t.mode}${o}`,inputDependencies:s},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(me.size(r)/64)},programUniforms:a}),getShaderSource:u}},s6=(e,t)=>{if(e.length>1){let r=e[1].getBigInt64Array(),n=e.length>=3&&e[2].data?e[2].dataType===10?e[2].getUint16Array()[0]:e[2].getFloat32Array()[0]:0,i=e[0].dims.length,a=new Int32Array(2*i).fill(0);if(e.length>=4){let s=e[3].getBigInt64Array();for(let u=0;u<s.length;u++)a[Number(s[u])]=Number(r[u]),a[Number(s[u])+i]=Number(r[u+s.length])}else r.forEach((s,u)=>a[Number(u)]=Number(s));let o=[];return a.forEach(s=>o.push(s)),{mode:t.mode,value:n,pads:o}}else return t},X5=(e,t)=>{e6(e.inputs);let r=s6(e.inputs,t);e.compute(o6(e.inputs,r),{inputs:[0]})}}),rW=We(()=>{"use strict";Ai(),Ct(),Ft(),jt(),Dc=e=>{if(vr.webgpu.validateInputContent&&(!e||e.length!==1))throw new Error("Pool ops requires 1 input.")},V1=(e,t,r)=>{let n=t.format==="NHWC",i=e.dims.slice();n&&i.splice(1,0,i.pop());let a=Object.hasOwnProperty.call(t,"dilations"),o=t.kernelShape.slice(),s=t.strides.slice(),u=a?t.dilations.slice():[],l=t.pads.slice();Ih.adjustPoolAttributes(r,i,o,s,u,l);let c=Ih.computePoolOutputShape(r,i,s,u,o,l,t.autoPad),f=Object.assign({},t);a?Object.assign(f,{kernelShape:o,strides:s,pads:l,dilations:u,cacheKey:t.cacheKey}):Object.assign(f,{kernelShape:o,strides:s,pads:l,cacheKey:t.cacheKey});let p=c.slice();return p.push(p.splice(1,1)[0]),[f,n?p:c]},W1=(e,t)=>{let r=t.format==="NHWC",n=me.size(e),i=me.size(t.kernelShape),a=[{type:12,data:n},{type:12,data:i}],o=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(t.kernelShape.length<=2){let s=t.kernelShape[t.kernelShape.length-1],u=t.strides[t.strides.length-1],l=t.pads[t.pads.length/2-1],c=t.pads[t.pads.length-1],f=!!(l+c);a.push({type:12,data:s},{type:12,data:u},{type:12,data:l},{type:12,data:c}),o.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let p=!1;if(t.kernelShape.length===2){let d=t.kernelShape[t.kernelShape.length-2],m=t.strides[t.strides.length-2],g=t.pads[t.pads.length/2-2],x=t.pads[t.pads.length-2];p=!!(g+x),a.push({type:12,data:d},{type:12,data:m},{type:12,data:g},{type:12,data:x}),o.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[a,o,!0,f,p]}else{if(r)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let s=me.computeStrides(t.kernelShape);a.push({type:12,data:s},{type:12,data:t.pads},{type:12,data:t.strides}),o.push({name:"kernelStrides",type:"u32",length:s.length},{name:"pads",type:"u32",length:t.pads.length},{name:"strides",type:"u32",length:t.strides.length});let u=t.pads.reduce((l,c)=>l+c);return[a,o,!!u,!1,!1]}},H1=(e,t,r,n,i,a,o,s,u,l,c,f)=>{let p=i.format==="NHWC",d=t.type.value,m=wt("output",t.type.tensor,n);if(i.kernelShape.length<=2){let g="",x="",b="",y=r-(p?2:1);if(c?g=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${y}] = indices[${y}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${y}] < 0 || xIndices[${y}]
                      >= uniforms.x_shape[${y}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${t.indicesToOffset("xIndices")}];
                  ${a}
                }`:g=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${y}] = indices[${y}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${t.indicesToOffset("xIndices")}];
                  ${a}
                }`,i.kernelShape.length===2){let E=r-(p?3:2);f?x=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${E}] = indices[${E}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${E}] < 0 || xIndices[${E}] >= uniforms.x_shape[${E}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:x=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${E}] = indices[${E}] * uniforms.sh - uniforms.phStart + j;
                `,b=`
              }
            `}return`
            ${e.registerUniforms(u).declareVariables(t,m)}

            ${e.mainStart()}
              ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${m.offsetToIndices("global_idx")};
              var xIndices = ${m.offsetToIndices("global_idx")};

              var value = ${d}(${s});
              var pad = 0;
              ${x}
              ${g}
              ${b}
              ${o}

              output[global_idx] = value;
            }`}else{if(p)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let g=i.kernelShape.length,x=i.pads.length,b="";return l?b=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${t.indicesToOffset("xIndices")}];
                ${a}
              }`:b=`
              }
              let x_val = x[${t.indicesToOffset("xIndices")}];
              ${a}
            `,`
            ${e.registerUniforms(u).declareVariables(t,m)}

            ${e.mainStart()}
              ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${m.offsetToIndices("global_idx")};
              var xIndices = ${m.offsetToIndices("global_idx")};

              var offsets: array<u32, ${g}>;

              var value = ${d}(${s});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${g-1}u; j++) {
                  offsets[j] = offset / ${_t("uniforms.kernelStrides","j",g)};
                  offset -= offsets[j] * ${_t("uniforms.kernelStrides","j",g)};
                }
                offsets[${g-1}] = offset;

                isPad = false;
                for (var j = ${r-g}u; j < ${r}u; j++) {
                  xIndices[j] = indices[j] * ${_t("uniforms.strides",`j - ${r-g}u`,g)}
                    + offsets[j - ${r-g}u] - ${_t("uniforms.pads","j - 2u",x)};
                  ${b}
              }
              ${o}

              output[global_idx] = value;
            }`}},q1=e=>`${e.format};${e.ceilMode};${e.autoPad};${e.kernelShape.length}`,u6=e=>`${q1(e)};${e.countIncludePad}`,l6=e=>`${q1(e)};${e.storageOrder};${e.dilations}`,X1=e=>({format:e.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],ceilMode:e.ceil_mode,kernelShape:e.kernel_shape,strides:e.strides,pads:e.pads}),K1=(e,t,r,n)=>{let[i,a]=V1(t,n,r),o=$e("x",t.dataType,t.dims.length),s=o.type.value,u="value += x_val;",l="";i.countIncludePad?l+=`value /= ${s}(uniforms.kernelSize);`:l+=`value /= ${s}(i32(uniforms.kernelSize) - pad);`;let[c,f,p,d,m]=W1(a,i);c.push(...$t(t.dims,a));let g=["rank"];return{name:e,shaderCache:{hint:`${n.cacheKey};${p};${d};${m}`,inputDependencies:g},getRunData:()=>({outputs:[{dims:a,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(me.size(a)/64)},programUniforms:c}),getShaderSource:x=>H1(x,o,t.dims.length,a.length,i,u,l,0,f,p,d,m)}},K5=e=>{let t=e.count_include_pad!==0,r=X1(e);if(r.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let n={countIncludePad:t,...r,cacheKey:""};return{...n,cacheKey:u6(n)}},Y5=(e,t)=>{Dc(e.inputs),e.compute(K1("AveragePool",e.inputs[0],!1,t))},Y1={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},Z5=e=>{let t=e.format;return{format:t,...Y1,cacheKey:t}},Q5=(e,t)=>{Dc(e.inputs),e.compute(K1("GlobalAveragePool",e.inputs[0],!0,t))},Z1=(e,t,r,n)=>{let[i,a]=V1(t,n,r),o=`
      value = max(x_val, value);
    `,s="",u=$e("x",t.dataType,t.dims.length),l=["rank"],[c,f,p,d,m]=W1(a,i);return c.push(...$t(t.dims,a)),{name:e,shaderCache:{hint:`${n.cacheKey};${p};${d};${m}`,inputDependencies:l},getRunData:()=>({outputs:[{dims:a,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(me.size(a)/64)},programUniforms:c}),getShaderSource:g=>H1(g,u,t.dims.length,a.length,i,o,s,t.dataType===10?-65504:-1e5,f,p,d,m)}},J5=(e,t)=>{Dc(e.inputs),e.compute(Z1("MaxPool",e.inputs[0],!1,t))},eC=e=>{let t=e.storage_order,r=e.dilations,n=X1(e);if(t!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(n.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let i={storageOrder:t,dilations:r,...n,cacheKey:""};return{...i,cacheKey:l6(i)}},tC=e=>{let t=e.format;return{format:t,...Y1,cacheKey:t}},rC=(e,t)=>{Dc(e.inputs),e.compute(Z1("GlobalMaxPool",e.inputs[0],!0,t))}}),nW=We(()=>{"use strict";Ct(),Ft(),Or(),jt(),c6=(e,t)=>{if(e.length<2||e.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(e.length===3&&e[1].dims===e[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(e.length===3&&e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(e[0].dataType===6&&e.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(e[1].dims.length!==0&&e[1].dims.length!==1&&e[1].dims.length!==e[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(e.length>2){if(e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(e[1].dims.length!==e[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!e[1].dims.map((r,n)=>r===e[2].dims[n]).reduce((r,n)=>r&&n,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(t.blockSize>0){if(e[1].dims.length===0||e[1].dims.length===1&&e[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!e[1].dims.map((i,a)=>a===t.axis||i===e[0].dims[a]).reduce((i,a)=>i&&a,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(e[1].dims.length!==e[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let r=e[0].dims[t.axis],n=e[1].dims[t.axis];if(t.blockSize<Math.ceil(r/n)||t.blockSize>Math.ceil(r/(n-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},f6=(e,t)=>{let r=me.normalizeAxis(t.axis,e[0].dims.length),n=e[0].dataType,i=n===3,a=e[0].dims,o=e[1].dataType,s=me.size(a),u=n===3||n===2,l=u?[Math.ceil(me.size(e[0].dims)/4)]:e[0].dims,c=e[1].dims,f=e.length>2?e[2]:void 0,p=f?u?[Math.ceil(me.size(f.dims)/4)]:f.dims:void 0,d=c.length===0||c.length===1&&c[0]===1,m=d===!1&&c.length===1,g=Tr(s),x=d&&(!u||g===4),b=x?g:1,y=x&&!u?g:1,E=$e("input",u?12:n,l.length,y),$=$e("scale",o,c.length),k=f?$e("zero_point",u?12:n,p.length):void 0,R=wt("output",o,a.length,b),C=[E,$];k&&C.push(k);let P=[l,c];f&&P.push(p);let W=[{type:12,data:s/b},{type:12,data:r},{type:12,data:t.blockSize},...$t(...P,a)],te=ce=>{let pe=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${ce.registerUniforms(pe).declareVariables(...C,R)}
      ${ce.mainStart()}
          ${ce.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${R.offsetToIndices("global_idx")};

          // Set input x
          ${u?`
            let input = ${E.getByOffset("global_idx / 4")};
            let x_vec = ${i?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${b===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${E.getByOffset("global_idx")};`};

          // Set scale input
          ${d?`let scale_value= ${$.getByOffset("0")}`:m?`
            let scale_index = ${R.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${$.getByOffset("scale_index")};`:`
            var scale_indices: ${$.type.indices} = output_indices;
            let index = ${$.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${$.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${$.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${k?d?u?`
                let zero_point_input = ${k.getByOffset("0")};
                let zero_point_vec =  ${i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${k.getByOffset("0")}`:m?u?`
                let zero_point_index = ${R.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${k.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${R.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${k.getByOffset("zero_point_index")};`:u?`
                let zero_point_offset = ${$.indicesToOffset("scale_indices")};
                let zero_point_input = ${k.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${k.getByIndices("scale_indices")};`:`let zero_point_value = ${u?i?"i32":"u32":E.type.value}(0);`};
      // Compute and write output
      ${R.setByOffset("global_idx",`${R.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:t.cacheKey,inputDependencies:k?["rank","rank","rank"]:["rank","rank"]},getShaderSource:te,getRunData:()=>({outputs:[{dims:a,dataType:o}],dispatchGroup:{x:Math.ceil(s/b/64),y:1,z:1},programUniforms:W})}},nC=(e,t)=>{c6(e.inputs,t),e.compute(f6(e.inputs,t))},iC=e=>ar({axis:e.axis,blockSize:e.blockSize})}),iW=We(()=>{"use strict";Ai(),Ct(),jt(),d6=(e,t,r)=>{let n=e===t,i=e<t&&r<0,a=e>t&&r>0;if(n||i||a)throw new Error("Range these inputs' contents are invalid.")},p6=(e,t,r,n)=>{let i=Math.abs(Math.ceil((t-e)/r)),a=[i],o=i,s=[{type:12,data:o},{type:n,data:e},{type:n,data:r},...$t(a)],u=l=>{let c=wt("output",n,a.length),f=c.type.value,p=[{name:"outputSize",type:"u32"},{name:"start",type:f},{name:"delta",type:f}];return`
        ${l.registerUniforms(p).declareVariables(c)}
        ${l.mainStart()}
        ${l.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${f}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${n}`},getShaderSource:u,getRunData:()=>({outputs:[{dims:a,dataType:n}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:s})}},aC=e=>{let t=0,r=0,n=0;e.inputs[0].dataType===6?(t=e.inputs[0].getInt32Array()[0],r=e.inputs[1].getInt32Array()[0],n=e.inputs[2].getInt32Array()[0]):e.inputs[0].dataType===1&&(t=e.inputs[0].getFloat32Array()[0],r=e.inputs[1].getFloat32Array()[0],n=e.inputs[2].getFloat32Array()[0]),vr.webgpu.validateInputContent&&d6(t,r,n),e.compute(p6(t,r,n,e.inputs[0].dataType),{inputs:[]})}}),aW=We(()=>{"use strict";Ct(),Ft(),Or(),jt(),h6=(e,t,r,n)=>{if(e!=="none"&&n!=="i32"&&n!=="u32"&&n!=="f32")throw new Error(`Input ${n} is not supported with reduction ${e}.`);let i=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,a=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${t}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(e){case"none":return`${t}=${r};`;case"add":return n==="i32"||n==="u32"?`atomicAdd(&${t}, bitcast<${n}>(${r}));`:`
              ${i}bitcast<${n}>(oldValue) + (${r})${a}`;case"max":return n==="i32"||n==="u32"?`atomicMax(&${t}, bitcast<${n}>(${r}));`:`
                ${i}max(bitcast<f32>(oldValue), (${r}))${a}`;case"min":return n==="i32"||n==="u32"?`atomicMin(&${t}, bitcast<${n}>(${r}));`:`${i}min(bitcast<${n}>(oldValue), (${r}))${a}`;case"mul":return`${i}(bitcast<${n}>(oldValue) * (${r}))${a}`;default:throw new Error(`Reduction ${e} is not supported.`)}},Q1=(e,t)=>`${e===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[${t?"i - indices_start":"i"}];
    let dim_value = uniforms.output_shape[${t?"i - indices_start":"i"} + uniforms.last_index_dimension];`}
    
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));`,J1=(e,t,r)=>`for (var i = 0u; i < uniforms.num_updates_elements; i++) {
        let value = updates[uniforms.num_updates_elements * ${r?"global_idx":"idx"} + i];
        ${h6(e.reduction,"output[data_offset + i]","value",t)}
      }`,m6=(e,t)=>{let r=e[0].dims,n=e[1].dims,i=r,a=1,o=Math.ceil(me.size(n)/a),s=n[n.length-1],u=me.sizeFromDimension(r,s),l=me.sizeFromDimension(n,0)/s,c=[{type:12,data:o},{type:12,data:s},{type:12,data:u},...$t(e[1].dims,e[2].dims,i)],f=p=>{let d=$e("indices",e[1].dataType,e[1].dims.length),m=$e("updates",e[2].dataType,e[2].dims.length,a),g=t.reduction!=="none"&&t.reduction!==""?Nk("output",e[0].dataType,i.length):wt("output",e[0].dataType,i.length,a);return`
      ${p.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(d,m,g)}
      ${p.mainStart()}
        ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var hasDuplicates = false;
  if (${t.reduction==="none"}) {
    for (var i = 0; i < ${l}; i = i + 1) {
      for (var j = i + 1; j < ${l}; j = j + 1) {
        var index_i = i32(indices[i].x);
        var index_j = i32(indices[j].x);
        if (index_i == index_j) {
          hasDuplicates = true;
          break;
        }
      }
      if (hasDuplicates) {
        break;
      }
    }
  }

  if (${t.reduction==="none"} && hasDuplicates) {
    if (global_idx != 0u) {
      return;
    }
    // Process each index-update pair individually when duplicates exist
    for (var idx = 0u; idx < ${l}u; idx++) {
      var data_offset = 0u;
      for (var i = 0u; i < uniforms.last_index_dimension; i++) {
        var index = i32(indices[idx * uniforms.last_index_dimension + i].x);
        ${Q1(r.length,!1)}
      }
      ${J1(t,g.type.value,!1)}
    }
    return;
  }

  var data_offset = 0u;
  var indices_start = uniforms.last_index_dimension * global_idx;
  var indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${Q1(r.length,!0)}
  }
  ${J1(t,g.type.value,!0)}
  }`};return{name:"ScatterND",shaderCache:{hint:`${t.cacheKey}_${t.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:c}),getShaderSource:f}},oC=e=>ar({reduction:e.reduction}),sC=(e,t)=>{e.compute(m6(e.inputs,t),{inputs:[e.inputs[1],e.inputs[2]],outputs:[]})}}),oW=We(()=>{"use strict";Ct(),Ft(),Or(),jt(),g6=(e,t)=>{if(e.every(r=>r>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),e.length>0){if(t.mode==="linear"){if(!(e.length===2||e.length===3||e.length===4&&e[0]===1&&e[1]===1||e.length===4&&e[0]===1&&e[3]===1||e.length===5&&e[0]===1&&e[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(t.mode==="cubic"&&!(e.length===2||e.length===4&&e[0]===1&&e[1]===1||e.length===4&&e[0]===1&&e[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},y6=(e,t,r)=>{t.every(i=>i>=0&&i<r||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let n=new Array(r).fill(1);return t.forEach((i,a)=>n[i]=e[a]),n},b6=(e,t,r,n,i,a)=>{let[o,s,u]=r>10?[1,2,3]:[-1,e.length>1?1:-1,-1],l=e[0].dims.length;if(o>0&&e.length>o&&e[o].dims.length>0)e[o].getFloat32Array().forEach(c=>a.push(c));else if(t.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(s>0&&e.length>s&&e[s].dims.length===1&&e[s].dims[0]>0){if(e[s].getFloat32Array().forEach(c=>n.push(c)),n.length!==0&&n.length!==l&&r>=18&&n.length!==t.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");g6(n,t),t.axes.length>0&&y6(n,t.axes,l).forEach((c,f)=>n[f]=c)}if(u>0&&e.length>u&&e[u].dims.length===1&&e[u].dims[0]>0&&(e[u].getBigInt64Array().forEach(c=>i.push(Number(c))),i.length!==0&&i.length!==l&&r>=18&&i.length!==t.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(t.axes.length>0){if(n.length!==0&&n.length!==t.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(i.length!==0&&i.length!==t.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof n<"u"&&typeof i<"u"&&n.length>0&&i.length>l)throw new Error("Resize requires only of scales or sizes to be specified")},eb=(e,t,r,n)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${e}) * (${t});
  let whole = ${n}(big / (${r}));
  let fract = ${n}(big % (${r})) / ${n}(${r});
  return whole + fract;
`,w6=(e,t)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${t} { `+(()=>{switch(e){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${t}(xResized) / ${t}(xScale);
          } else {
            ${eb("xResized","lengthOriginal","lengthResized",t)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${t}(xResized) + 0.5) / ${t}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${t}(xResized) + 0.5) / ${t}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${eb("xResized","lengthOriginal - 1","lengthResized - 1",t)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${t}(roiStart) * ${t}(lengthOriginal - 1) +
                        (${t}(xResized) * ${t}(roiEnd - roiStart) * ${t}(lengthOriginal - 1)) /
                        ${t}(lengthResized - 1);
                  } else {
                    return 0.5 * ${t}(roiStart + roiEnd) * ${t}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${t}xScale * ${t}(lengthResized);
                  const adjustment = ${t}(lengthResized) / outputWidth;
                  const center = ${t}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${t}(xResized) + 0.5) / ${t}(xScale)) - 0.5;`;case"half_pixel":return`return ((${t}(xResized) + 0.5) / ${t}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${e} is not supported`)}})()+"}",v6=(e,t,r)=>`fn getNearestPixelFromOriginal(xOriginal: ${r}, isDownSample: bool) -> ${r} {`+(()=>{switch(e){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(t<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${e} is not supported`)}})()+"}",_6=(e,t,r)=>{let n=new Array(r).fill(0).concat(new Array(r).fill(1)),i=e.length===0?n:e.slice();return t.length>0?(t.forEach((a,o)=>{n[a]=i[o],n[o+r]=i[t.length+o]}),n):i},x6=(e,t,r,n)=>{let i=[];if(r.length>0)if(n.length>0){if(e.forEach(a=>i.push(a)),Math.max(...n)>e.length)throw new Error("axes is out of bound");n.forEach((a,o)=>i[a]=r[o])}else r.forEach(a=>i.push(a));else{if(t.length===0)throw new Error("Resize requires either scales or sizes.");i=e.map((a,o)=>Math.round(a*t[o]))}return i},$6=(e,t,r)=>{let n=(()=>{switch(r.keepAspectRatioPolicy){case"not_larger":return r.axes.length>0?Math.min(...r.axes.map(a=>t[a]),Number.MAX_VALUE):Math.min(...t,Number.MAX_VALUE);case"not_smaller":return r.axes.length>0?Math.max(...r.axes.map(a=>t[a]),Number.MIN_VALUE):Math.max(...t,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${r.keepAspectRatioPolicy} is not supported`)}})();t.fill(1,0,t.length);let i=e.slice();return r.axes.length>0?(r.axes.forEach(a=>t[a]=n),r.axes.forEach(a=>i[a]=Math.round(e[a]*t[a]))):(t.fill(n,0,t.length),i.forEach((a,o)=>i[o]=Math.round(a*t[o]))),i},E6=(e,t,r,n,i)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${e.type.indices}) -> array<${e.type.value}, ${r.length}> {
      var original_indices: array<${e.type.value}, ${r.length}>;
      for (var i:u32 = 0; i < ${r.length}; i++) {
        var output_index = ${e.indicesGet("output_indices","i")};
        var scale = ${_t("uniforms.scales","i",n)};
        var roi_low = ${_t("uniforms.roi","i",i)};
        var roi_hi = ${_t("uniforms.roi",`i + ${t.length}`,i)};
        if (scale == 1.0) {
          original_indices[i] = ${e.type.value}(output_index);
        } else {
          var input_shape_i = ${_t("uniforms.input_shape","i",t.length)};
          var output_shape_i = ${_t("uniforms.output_shape","i",r.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,S6=(e,t,r,n,i,a,o)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${t.type.indices}) -> ${e.type.indices} {
      var input_indices: ${e.type.indices};
      for (var i:u32 = 0; i < ${n.length}; i++) {
        var output_index = ${t.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${_t("uniforms.scales","i",i)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${_t("uniforms.roi","i",a)};
          var roi_hi = ${_t("uniforms.roi",`i + ${r.length}`,a)};
          var input_shape_i = ${_t("uniforms.input_shape","i",r.length)};
          var output_shape_i = ${_t("uniforms.output_shape","i",n.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${o} || (original_idx >= 0 && original_idx < ${t.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${t.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${e.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,T6=(e,t)=>`
    fn checkInputIndices(input_indices: ${e.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${t.length}; i++) {
        var input_index = ${e.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${_t("uniforms.input_shape","i",t.length)}) {
          return false;
        }
      }
      return true;
    }`,tb=(e,t,r,n)=>e.rank>n?`
    ${e.indicesSet("input_indices",t,"channel")};
    ${e.indicesSet("input_indices",r,"batch")};
`:"",A6=(e,t,r,n,i)=>{let[a,o,s,u]=r.length===2?[-1,0,1,-1]:[0,2,3,1],l=e.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${l} {
      var input_indices: ${e.type.indices};
      ${e.indicesSet("input_indices",o,`max(0, min(row, ${r[o]} - 1))`)};
      ${e.indicesSet("input_indices",s,`max(0, min(col, ${r[s]} - 1))`)};
      ${tb(e,u,a,2)}
      return ${e.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${t.type.indices}) -> ${l} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${l} = originalIndices[${o}];
      var col:${l} = originalIndices[${s}];
      ${n?`if (row < 0 || row > (${r[o]} - 1) || col < 0 || col > (${r[s]} - 1)) {
        return ${i};
      }`:""};
      row = max(0, min(row, ${r[o]} - 1));
      col = max(0, min(col, ${r[s]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${r.length>2?`u32(originalIndices[${u}])`:"0"};
      var batch: u32 =  ${r.length>2?`u32(originalIndices[${a}])`:"0"};
      var x11: ${l} = getInputValue(batch, channel, row1, col1);
      var x12: ${l} = getInputValue(batch, channel, row1, col2);
      var x21: ${l} = getInputValue(batch, channel, row2, col1);
      var x22: ${l} = getInputValue(batch, channel, row2, col2);
      var dx1: ${l} = abs(row - ${l}(row1));
      var dx2: ${l} = abs(${l}(row2) - row);
      var dy1: ${l} = abs(col - ${l}(col1));
      var dy2: ${l} = abs(${l}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},k6=(e,t,r,n,i,a,o,s,u,l)=>{let c=r.length===2,f=!0,[p,d]=c?[0,1]:f?[2,3]:[1,2],m=e.type.value,g=x=>{let b=x===p?"row":"col";return`
      fn ${b}CubicInterpolation(input_indices: ${e.type.indices}, output_indices: ${t.type.indices}) -> ${m} {
        var output_index = ${t.indicesGet("output_indices",x)};
        var originalIdx: ${m} = getOriginalCoordinateFromResizedCoordinate(output_index, ${i[x]},
        ${n[x]}, ${r[x]}, ${a[x]}, ${a[x]} + ${r.length});
        var fractOriginalIdx: ${m} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${s} && (originalIdx < 0 || originalIdx > (${r[x]} - 1))) {
          return ${u};
        }
        var data: array<${m}, 4> = array<${m}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${b}: ${m} = originalIdx + ${m}(i);
          if (${b} < 0 || ${b} >= ${r[x]}) {
            ${l?`coefs[i + 1] = 0.0;
                        continue;`:s?`return ${u};`:`${b} = max(0, min(${b}, ${r[x]} - 1));`};
          }
        var input_indices_copy: ${e.type.indices} = input_indices;
          ${e.indicesSet("input_indices_copy",x,`u32(${b})`)};
          data[i + 1] = ${x===p?e.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${g(p)};
    ${g(d)};
  fn getCubicInterpolationCoefs(s: ${m}) -> array<${m}, 4> {
    var absS = abs(s);
    var coeffs: array<${m}, 4> = array<${m}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${m} = 1.0 - absS;
    var twoMinusAbsS: ${m} = 2.0 - absS;
    var onePlusAbsS: ${m} = 1.0 + absS;
    coeffs[0] = ((${o} * onePlusAbsS - 5 * ${o}) * onePlusAbsS + 8 * ${o}) * onePlusAbsS - 4 * ${o};
    coeffs[1] = ((${o} + 2) * absS - (${o} + 3)) * absS * absS + 1;
    coeffs[2] = ((${o} + 2) * oneMinusAbsS - (${o} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${o} * twoMinusAbsS - 5 * ${o}) * twoMinusAbsS + 8 * ${o}) * twoMinusAbsS - 4 * ${o};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${m}, 4>, coefs: array<${m}, 4>) -> ${m} {
    var coefsSum: ${m} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${t.type.indices}) -> ${m} {
    var input_indices: ${e.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},I6=(e,t,r,n,i)=>{let[a,o,s,u,l]=r.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],c=e.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${c} {
      var input_indices: ${e.type.indices};
      ${e.indicesSet("input_indices",o,`max(0, min(depth, ${r[o]} - 1))`)};
      ${e.indicesSet("input_indices",s,`max(0, min(height, ${r[s]} - 1))`)};
      ${e.indicesSet("input_indices",u,`max(0, min(width, ${r[u]} - 1))`)};
      ${tb(e,l,a,3)}
      return ${e.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${t.type.indices}) -> ${c} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${c} = originalIndices[${o}];
      var height:${c} = originalIndices[${s}];
      var width:${c} = originalIndices[${u}];
      ${n?`if (depth < 0 || depth > (${r[o]} - 1) || height < 0 || height > (${r[s]} - 1) || width < 0 || (width > ${r[u]} - 1)) {
      return ${i};
        }`:""};

    depth = max(0, min(depth, ${r[o]} - 1));
      height = max(0, min(height, ${r[s]} - 1));
      width = max(0, min(width, ${r[u]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${r.length>3?`u32(originalIndices[${l}])`:"0"};
      var batch: u32 =  ${r.length>3?`u32(originalIndices[${a}])`:"0"};

      var x111: ${c} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${c} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${c} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${c} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${c} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${c} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${c} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${c} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${c} = abs(depth - ${c}(depth1));
      var dx2: ${c} = abs(${c}(depth2) - depth);
      var dy1: ${c} = abs(height - ${c}(height1));
      var dy2: ${c} = abs(${c}(height2) - height);
      var dz1: ${c} = abs(width - ${c}(width1));
      var dz2: ${c} = abs(${c}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},C6=(e,t,r,n,i,a)=>{let o=e.dims,s=_6(a,t.axes,o.length),u=x6(o,n,i,t.axes),l=n.slice();n.length===0&&(l=o.map((y,E)=>y===0?1:u[E]/y),t.keepAspectRatioPolicy!=="stretch"&&(u=$6(o,l,t)));let c=wt("output",e.dataType,u.length),f=$e("input",e.dataType,o.length),p=me.size(u),d=o.length===u.length&&o.every((y,E)=>y===u[E]),m=t.coordinateTransformMode==="tf_crop_and_resize",g=t.extrapolationValue,x=f.type.value,b=y=>`
      ${d?"":`
      ${w6(t.coordinateTransformMode,x)};
      ${(()=>{switch(t.mode){case"nearest":return`
              ${T6(f,o)};
              ${v6(t.nearestMode,r,x)};
              ${S6(f,c,o,u,l.length,s.length,m)};
              `;case"linear":return`
              ${E6(c,o,u,l.length,s.length)};
              ${(()=>{if(o.length===2||o.length===4)return`${A6(f,c,o,m,g)}`;if(o.length===3||o.length===5)return`${I6(f,c,o,m,g)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(o.length===2||o.length===4)return`${k6(f,c,o,u,l,s,t.cubicCoeffA,m,t.extrapolationValue,t.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${y.registerUniform("output_size","u32").registerUniform("scales","f32",l.length).registerUniform("roi","f32",s.length).declareVariables(f,c)}
      ${y.mainStart()}
        ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${d?"output[global_idx] = input[global_idx];":`
        let output_indices = ${c.offsetToIndices("global_idx")};
        var input_indices: ${f.type.indices};
        ${(()=>{switch(t.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${f.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${t.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${o.length===2||o.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${t.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${t.cacheKey}|${r}|${l.length>0?t.mode==="cubic"?l:l.length:""}|${i.length>0?i:""}|${s.length>0?s:""}|${d}|${t.mode==="nearest"?o.length:o}`,inputDependencies:["rank"]},getShaderSource:b,getRunData:()=>({outputs:[{dims:u,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:[{type:12,data:p},{type:1,data:l},{type:1,data:s},...$t(o,u)]})}},O6=e=>{let t=e.customDataBuffer;return new Uint32Array(t,t.byteOffset,1)[0]},uC=(e,t)=>{let r=[],n=[],i=[],a=O6(e);if(t.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");b6(e.inputs,t,a,r,n,i),e.compute(C6(e.inputs[0],t,a,r,n,i),{inputs:[0]})},lC=e=>{let t=e.antialias,r=e.axes,n=e.coordinateTransformMode,i=e.cubicCoeffA,a=e.excludeOutside!==0,o=e.extrapolationValue,s=e.keepAspectRatioPolicy,u=e.mode,l=e.nearestMode===""?"simple":e.nearestMode;return ar({antialias:t,axes:r,coordinateTransformMode:n,cubicCoeffA:i,excludeOutside:a,extrapolationValue:o,keepAspectRatioPolicy:s,mode:u,nearestMode:l})}}),sW=We(()=>{"use strict";Ct(),Ft(),jt(),B6=e=>{if(!e||e.length<3)throw new Error("layerNorm requires at least 3 inputs.");let t=e[0],r=e[1],n=e[2];if(t.dataType!==r.dataType||t.dataType!==n.dataType)throw new Error("All inputs must have the same data type");if(t.dims.length!==3&&t.dims.length!==2)throw new Error("Input must be 2D or 3D");if(r.dims.length!==3&&r.dims.length!==2)throw new Error("Skip must be 2D or 3D");let i=t.dims[t.dims.length-1],a=t.dims[t.dims.length-2];if(r.dims[r.dims.length-1]!==i)throw new Error("Skip must have the same hidden size as input");if(r.dims[r.dims.length-2]!==a)throw new Error("Skip must have the same sequence length as input");if(n.dims.length!==1)throw new Error("Gamma must be 1D");if(n.dims[n.dims.length-1]!==i)throw new Error("Gamma must have the same hidden size as input");if(e.length>3){let o=e[3];if(o.dims.length!==1)throw new Error("Beta must be 1D");if(o.dims[o.dims.length-1]!==i)throw new Error("Beta must have the same hidden size as input")}if(e.length>4){let o=e[4];if(o.dims.length!==1)throw new Error("Bias must be 1D");if(o.dims[o.dims.length-1]!==i)throw new Error("Bias must have the same hidden size as input")}},R6=(e,t,r,n)=>{let i=t.simplified,a=e[0].dims,o=me.size(a),s=a,u=o,l=a.slice(-1)[0],c=n?a.slice(0,-1).concat(1):[],f=!i&&e.length>3,p=e.length>4,d=n&&r>1,m=n&&r>2,g=r>3,x=64,b=Tr(l),y=[{type:12,data:u},{type:12,data:b},{type:12,data:l},{type:1,data:t.epsilon}],E=k=>{let R=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],C=[$e("x",e[0].dataType,e[0].dims,b),$e("skip",e[1].dataType,e[1].dims,b),$e("gamma",e[2].dataType,e[2].dims,b)];f&&C.push($e("beta",e[3].dataType,e[3].dims,b)),p&&C.push($e("bias",e[4].dataType,e[4].dims,b)),C.push(wt("output",e[0].dataType,s,b)),d&&C.push(wt("mean_output",1,c)),m&&C.push(wt("inv_std_output",1,c)),g&&C.push(wt("input_skip_bias_sum",e[0].dataType,s,b));let P=Yr(e[0].dataType),W=Yr(1,b);return`

      ${k.registerUniforms(R).declareVariables(...C)}
      var<workgroup> sum_shared : array<${W}, ${x}>;
      var<workgroup> sum_squared_shared : array<${W}, ${x}>;

      ${k.mainStart([x,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${x};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${x};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${x-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${p?"bias[offset1d + i]":P+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${g?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${ju(P,b,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${x};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${io("sum",b)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${io("square_sum",b)} / f32(uniforms.hidden_size) ${i?"":"- mean * mean"} + uniforms.epsilon);
        ${d?"mean_output[global_idx] = mean;":""}
        ${m?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${i?"":`- ${P}(mean)`}) *
            ${P}(inv_std_dev) * gamma[offset1d + i]
            ${f?"+ beta[offset1d + i]":""};
        }
      }`},$=[{dims:s,dataType:e[0].dataType}];return r>1&&$.push({dims:c,dataType:1}),r>2&&$.push({dims:c,dataType:1}),r>3&&$.push({dims:a,dataType:e[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${b};${d};${m};${g}`,inputDependencies:e.map((k,R)=>"type")},getShaderSource:E,getRunData:()=>({outputs:$,dispatchGroup:{x:Math.ceil(u/l)},programUniforms:y})}},cC=(e,t)=>{B6(e.inputs);let r=[0];e.outputCount>1&&r.push(-3),e.outputCount>2&&r.push(-3),e.outputCount>3&&r.push(3),e.compute(R6(e.inputs,t,e.outputCount,!1),{outputs:r})}}),uW=We(()=>{"use strict";Ct(),Ft(),Or(),jt(),z6=(e,t)=>{if(!e||e.length<1)throw new Error("too few inputs");if(t.axes.length!==0){if(t.axes.length!==t.starts.length||t.axes.length!==t.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(t.starts.length!==t.ends.length)throw new Error("starts and ends must have the same length");e.slice(1).forEach((r,n)=>{if(e[n+1].dataType!==6&&e[n+1].dataType!==7)throw new Error(`Input ${n} must be an array of int32 or int64`)})},Mc=(e,t)=>{let r=[];if(e.length>t)if(e[t].dataType===7)e[t].getBigInt64Array().forEach(n=>r.push(Number(n)));else if(e[t].dataType===6)e[t].getInt32Array().forEach(n=>r.push(Number(n)));else throw new Error(`Input ${t} must be an array of int32 or int64`);return r},N6=(e,t)=>{if(e.length>1){let r=Mc(e,1),n=Mc(e,2),i=Mc(e,3);return i.length===0&&(i=[...Array(e[0].dims.length).keys()]),ar({starts:r,ends:n,axes:i})}else return t},rb=(e,t,r,n,i)=>{let a=e;return e<0&&(a+=r[n[t]]),i[t]<0?Math.max(0,Math.min(a,r[n[t]]-1)):Math.max(0,Math.min(a,r[n[t]]))},L6=(e,t,r)=>`fn calculateInputIndices(output_indices: ${t.type.indices}) -> ${e.type.indices} {
          var input_indices: ${e.type.indices};
          var carry = 0u;
          for (var i = ${r.length}; i >= 0; i--) {
            let input_shape_i = ${_t("uniforms.input_shape","i",r.length)};
            let steps_i = ${_t("uniforms.steps","i",r.length)};
            let signs_i = ${_t("uniforms.signs","i",r.length)};
            let starts_i = ${_t("uniforms.starts","i",r.length)};
            var output_index = ${t.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${e.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,D6=(e,t)=>{let r=e[0].dims,n=me.size(r),i=t.axes.length>0?me.normalizeAxes(t.axes,r.length):[...Array(r.length).keys()],a=Mc(e,4);a.forEach(b=>b!==0||(()=>{throw new Error("step cannot be 0")})),a.length===0&&(a=Array(i.length).fill(1));let o=t.starts.map((b,y)=>rb(b,y,r,i,a)),s=t.ends.map((b,y)=>rb(b,y,r,i,a));if(i.length!==o.length||i.length!==s.length)throw new Error("start, ends and axes should have the same number of elements");if(i.length!==r.length)for(let b=0;b<r.length;++b)i.includes(b)||(o.splice(b,0,0),s.splice(b,0,r[b]),a.splice(b,0,1));let u=a.map(b=>Math.sign(b));a.forEach((b,y,E)=>{if(b<0){let $=(s[y]-o[y])/b,k=o[y],R=k+$*a[y];o[y]=R,s[y]=k,E[y]=-b}});let l=r.slice(0);i.forEach((b,y)=>{l[b]=Math.ceil((s[b]-o[b])/a[b])});let c={dims:l,dataType:e[0].dataType},f=wt("output",e[0].dataType,l.length),p=$e("input",e[0].dataType,e[0].dims.length),d=me.size(l),m=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:o.length},{name:"signs",type:"i32",length:u.length},{name:"steps",type:"u32",length:a.length}],g=[{type:12,data:d},{type:12,data:o},{type:6,data:u},{type:12,data:a},...$t(e[0].dims,l)],x=b=>`
      ${b.registerUniforms(m).declareVariables(p,f)}
        ${L6(p,f,r)}
        ${b.mainStart()}
          ${b.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${f.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${f.setByOffset("global_idx",p.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${u.length}_${o.length}_${a.length}`,inputDependencies:["rank"]},getShaderSource:x,getRunData:()=>({outputs:[c],dispatchGroup:{x:Math.ceil(n/64)},programUniforms:g})}},fC=(e,t)=>{z6(e.inputs,t);let r=N6(e.inputs,t);e.compute(D6(e.inputs,r),{inputs:[0]})},dC=e=>{let t=e.starts,r=e.ends,n=e.axes;return ar({starts:t,ends:r,axes:n})}}),lW=We(()=>{"use strict";Ct(),Ft(),Or(),ao(),jt(),M6=e=>{if(!e||e.length!==1)throw new Error("Softmax op requires 1 input.")},P6=(e,t)=>{let r=e.inputs[0],n=r.dims,i=me.size(n),a=n.length,o=me.normalizeAxis(t.axis,a),s=o<n.length-1,u,l=[];s?(l=Array.from({length:a},(C,P)=>P),l[o]=a-1,l[a-1]=o,u=e.compute(Dn(r,l),{inputs:[r],outputs:[-1]})[0]):u=r;let c=u.dims,f=c[a-1],p=i/f,d=Tr(f),m=f/d,g=64;p===1&&(g=256);let x=(C,P)=>P===4?`max(max(${C}.x, ${C}.y), max(${C}.z, ${C}.w))`:P===2?`max(${C}.x, ${C}.y)`:P===3?`max(max(${C}.x, ${C}.y), ${C}.z)`:C,b=$e("x",u.dataType,u.dims,d),y=wt("result",u.dataType,u.dims,d),E=b.type.value,$=Yr(u.dataType)==="f32"?`var threadMax = ${E}(-3.402823e+38f);`:`var threadMax = ${E}(-65504.0h);`,k=C=>`
      var<workgroup> rowMaxShared : ${E};
      var<workgroup> rowSumShared : ${E};
      var<workgroup> threadShared : array<${E}, ${g}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${E} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${E}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${C.registerUniform("packedCols","i32").declareVariables(b,y)}
      ${C.mainStart(g)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${g};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${$}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${E}(${x("threadShared[0]",d)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${E}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${E}(${io("threadShared[0]",d)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          let value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          setValue(row, col, row_stride, value);
        }
      }`,R=e.compute({name:"Softmax",shaderCache:{hint:`${d};${g}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:c,dataType:u.dataType}],dispatchGroup:{x:p},programUniforms:[{type:6,data:m}]}),getShaderSource:k},{inputs:[u],outputs:[s?-1:0]})[0];s&&e.compute(Dn(R,l),{inputs:[R]})},pC=(e,t)=>{M6(e.inputs),P6(e,t)},hC=e=>ar({axis:e.axis})}),cW=We(()=>{"use strict";Ct(),Ft(),jt(),nb=e=>Array.from(e.getBigInt64Array(),Number),U6=e=>{if(!e||e.length!==2)throw new Error("Tile requires 2 inputs.");if(e[0].dataType!==1&&e[0].dataType!==10&&e[0].dataType!==6&&e[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(e[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(e[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(nb(e[1]).length!==e[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},F6=(e,t)=>{let r=[];for(let n=0;n<e.length;++n)r.push(e[n]*t[n]);return r},G6=(e,t)=>{let r=e[0].dims,n=t??nb(e[1]),i=F6(r,n),a=me.size(i),o=e[0].dataType,s=$e("input",o,r.length),u=wt("output",o,i.length),l=c=>`
      const inputShape = ${s.indices(...r)};
      ${c.registerUniform("output_size","u32").declareVariables(s,u)}
      ${c.mainStart()}
      ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${u.offsetToIndices("global_idx")};
      var input_indices: ${s.type.indices};
      for (var i = 0; i < ${r.length}; i++) {
        let input_dim_i = ${s.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${u.indicesGet("output_indices","i")}  % input_dim_i;

        ${s.indicesSet("input_indices","i","input_dim_value")}
      }
      ${u.setByOffset("global_idx",s.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${n}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:[{type:12,data:a},...$t(e[0].dims,i)]}),getShaderSource:l}},mC=e=>{U6(e.inputs),e.compute(G6(e.inputs),{inputs:[0]})}}),fW=We(()=>{"use strict";Ct(),Ft(),jt(),j6=(e,t,r,n,i)=>{let a=wt("output_data",i,r.length,4),o=$e("a_data",t[1].dataType,t[1].dims.length,4),s=$e("b_data",t[2].dataType,t[2].dims.length,4),u=$e("c_data",t[0].dataType,t[0].dims.length,4),l,c=(f,p,d)=>`select(${p}, ${f}, ${d})`;if(!n)l=a.setByOffset("global_idx",c(o.getByOffset("global_idx"),s.getByOffset("global_idx"),u.getByOffset("global_idx")));else{let f=(p,d,m="")=>{let g=`a_data[index_a${d}][component_a${d}]`,x=`b_data[index_b${d}][component_b${d}]`,b=`bool(c_data[index_c${d}] & (0xffu << (component_c${d} * 8)))`;return`
            let output_indices${d} = ${a.offsetToIndices(`global_idx * 4u + ${d}u`)};
            let offset_a${d} = ${o.broadcastedIndicesToOffset(`output_indices${d}`,a)};
            let offset_b${d} = ${s.broadcastedIndicesToOffset(`output_indices${d}`,a)};
            let offset_c${d} = ${u.broadcastedIndicesToOffset(`output_indices${d}`,a)};
            let index_a${d} = offset_a${d} / 4u;
            let index_b${d} = offset_b${d} / 4u;
            let index_c${d} = offset_c${d} / 4u;
            let component_a${d} = offset_a${d} % 4u;
            let component_b${d} = offset_b${d} % 4u;
            let component_c${d} = offset_c${d} % 4u;
            ${p}[${d}] = ${m}(${c(g,x,b)});
          `};i===9?l=`
            var data = vec4<u32>(0);
            ${f("data",0,"u32")}
            ${f("data",1,"u32")}
            ${f("data",2,"u32")}
            ${f("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:l=`
            ${f("output_data[global_idx]",0)}
            ${f("output_data[global_idx]",1)}
            ${f("output_data[global_idx]",2)}
            ${f("output_data[global_idx]",3)}
          `}return`
        ${e.registerUniform("vec_size","u32").declareVariables(u,o,s,a)}
        ${e.mainStart()}
        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${l}
      }`},V6=e=>{let t=e[1].dims,r=e[2].dims,n=e[0].dims,i=e[1].dataType,a=!(me.areEqual(t,r)&&me.areEqual(r,n)),o=t,s=me.size(t);if(a){let l=Vu.calcShape(Vu.calcShape(t,r,!1),n,!1);if(!l)throw new Error("Can't perform where op on the given tensors");o=l,s=me.size(o)}let u=Math.ceil(s/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:l=>j6(l,e,o,a,i),getRunData:()=>({outputs:[{dims:o,dataType:i}],dispatchGroup:{x:Math.ceil(s/64/4)},programUniforms:[{type:12,data:u},...$t(n,t,r,o)]})}},gC=e=>{e.compute(V6(e.inputs))}}),dW=We(()=>{"use strict";T9(),Pb(),A9(),k9(),I9(),C9(),O9(),L9(),M9(),P9(),U9(),F9(),G9(),j9(),V9(),W9(),H9(),q9(),X9(),K9(),Y9(),Z9(),Q9(),J9(),eW(),L5(),tW(),rW(),nW(),iW(),aW(),Mb(),oW(),F5(),sW(),uW(),lW(),P5(),cW(),ao(),Ub(),fW(),yC=new Map([["Abs",[cI]],["Acos",[fI]],["Acosh",[dI]],["Add",[HI]],["ArgMax",[oI,hb]],["ArgMin",[aI,hb]],["Asin",[pI]],["Asinh",[hI]],["Atan",[mI]],["Atanh",[gI]],["Attention",[sI]],["AveragePool",[Y5,K5]],["BatchNormalization",[uI]],["BiasAdd",[lI]],["BiasSplitGelu",[WI]],["Cast",[bI,yI]],["Ceil",[vI]],["Clip",[wI]],["Concat",[r5,n5]],["Conv",[vb,wb]],["ConvTranspose",[p5,d5]],["Cos",[_I]],["Cosh",[xI]],["CumSum",[h5,m5]],["DepthToSpace",[g5,y5]],["DequantizeLinear",[nC,iC]],["Div",[qI]],["Einsum",[b5,w5]],["Elu",[$I,jc]],["Equal",[XI]],["Erf",[EI]],["Exp",[SI]],["Expand",[v5]],["FastGelu",[_5]],["Floor",[TI]],["FusedConv",[vb,wb]],["Gather",[$5,x5]],["GatherElements",[I5,k5]],["GatherBlockQuantized",[T5,A5]],["GatherND",[E5,S5]],["Gelu",[AI]],["Gemm",[O5,C5]],["GlobalAveragePool",[Q5,Z5]],["GlobalMaxPool",[rC,tC]],["Greater",[QI]],["GreaterOrEqual",[e5]],["GridSample",[B5,R5]],["GroupQueryAttention",[G5]],["HardSigmoid",[NI,zI]],["InstanceNormalization",[j5]],["LayerNormalization",[V5]],["LeakyRelu",[kI,jc]],["Less",[JI]],["LessOrEqual",[t5]],["Log",[jI]],["MatMul",[W5]],["MatMulNBits",[H5,q5]],["MaxPool",[J5,eC]],["Mul",[KI]],["MultiHeadAttention",[N5,z5]],["Neg",[CI]],["Not",[II]],["Pad",[X5]],["Pow",[YI]],["QuickGelu",[VI,jc]],["Range",[aC]],["Reciprocal",[OI]],["ReduceMin",[eI]],["ReduceMean",[Kk]],["ReduceMax",[Jk]],["ReduceSum",[rI]],["ReduceProd",[tI]],["ReduceL1",[Yk]],["ReduceL2",[Zk]],["ReduceLogSum",[iI]],["ReduceLogSumExp",[Qk]],["ReduceSumSquare",[nI]],["Relu",[BI]],["Resize",[uC,lC]],["RotaryEmbedding",[U5]],["ScatterND",[sC,oC]],["Sigmoid",[RI]],["Sin",[LI]],["Sinh",[DI]],["Slice",[fC,dC]],["SkipLayerNormalization",[cC]],["Split",[D5,M5]],["Sqrt",[MI]],["Softmax",[pC,hC]],["Sub",[ZI]],["Tan",[PI]],["Tanh",[UI]],["ThresholdedRelu",[GI,jc]],["Tile",[mC]],["Transpose",[Dk,Mk]],["Where",[gC]]])}),pW=We(()=>{"use strict";Ai(),_a(),jt(),bC=class{constructor(e){this.backend=e,this.repo=new Map,this.attributesBound=!1}getArtifact(e){return this.repo.get(e)}setArtifact(e,t){this.repo.set(e,t)}run(e,t,r,n,i){Ti(e.programInfo.name);let a=this.backend.device,o=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let s=[];for(let l of t)s.push({binding:s.length,resource:{buffer:l.buffer}});for(let l of r)s.push({binding:s.length,resource:{buffer:l.buffer}});i&&s.push({binding:s.length,resource:i});let u=a.createBindGroup({layout:e.computePipeline.getBindGroupLayout(0),entries:s,label:e.programInfo.name});if(this.backend.sessionStatus==="capturing"){let l={kernelId:this.backend.currentKernelId,computePipeline:e.computePipeline,bindGroup:u,dispatchGroup:n};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(l)}o.setPipeline(e.computePipeline),o.setBindGroup(0,u),o.dispatchWorkgroups(...n),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),ri(e.programInfo.name)}dispose(){}build(e,t){Ti(e.name);let r=this.backend.device,n=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(l=>{r.features.has(l.feature)&&n.push(`enable ${l.extension};`)});let i=Lk(t,this.backend.device.limits),a=e.getShaderSource(i),o=`${n.join(`
`)}
${i.additionalImplementations}
${a}`,s=r.createShaderModule({code:o,label:e.name});Qt("verbose",()=>`[WebGPU] ${e.name} shader code: ${o}`);let u=r.createComputePipeline({compute:{module:s,entryPoint:"main"},layout:"auto",label:e.name});return ri(e.name),{programInfo:e,computePipeline:u,uniformVariablesInfo:i.variablesInfo}}normalizeDispatchGroupSize(e){let t=typeof e=="number"?e:e.x,r=typeof e=="number"?1:e.y||1,n=typeof e=="number"?1:e.z||1,i=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(t<=i&&r<=i&&n<=i)return[t,r,n];let a=t*r*n,o=Math.ceil(Math.sqrt(a));if(o>i){if(o=Math.ceil(Math.cbrt(a)),o>i)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[o,o,o]}else return[o,o,1]}}}),wC={};Hu(wC,{WebGpuBackend:()=>vC});hW=We(()=>{"use strict";Ai(),Ct(),_a(),Ok(),E9(),dW(),pW(),W6=(e,t)=>{if(t.length!==e.length)throw new Error(`inputDependencies length ${t.length} is not equal to inputTensors length ${e.length}.`);let r=[];for(let n=0;n<e.length;++n){let i=e[n].dataType;switch(t[n]){case"none":{r.push("");break}case"type":{r.push(`${i}`);break}case"rank":{let a=e[n].dims.length;r.push(`${i};${a}`);break}case"dims":{let a=e[n].dims.join(",");r.push(`${i};${a}`);break}default:throw new Error(`unsupported input dependency: ${t[n]}`)}}return r.join("|")},H6=(e,t,r)=>{let n=e.name;return e.shaderCache?.hint&&(n+="["+e.shaderCache.hint+"]"),n+=":"+r+`:${W6(t,e.shaderCache?.inputDependencies??new Array(t.length).fill("dims"))}`,n},q6=class{constructor(e){e&&(this.architecture=e.architecture,this.vendor=e.vendor)}isArchitecture(e){return this.architecture===e}isVendor(e){return this.vendor===e}},vC=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let e=this.kernelCustomData.get(this.currentKernelId);return e||(e={},this.kernelCustomData.set(this.currentKernelId,e)),e}async initialize(e,t){this.env=e;let r=[],n={requiredLimits:{maxComputeWorkgroupStorageSize:t.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:t.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:t.limits.maxStorageBufferBindingSize,maxBufferSize:t.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:t.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:t.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:t.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:t.limits.maxComputeWorkgroupSizeZ},requiredFeatures:r},i=a=>t.features.has(a)&&r.push(a)&&!0;i("chromium-experimental-timestamp-query-inside-passes")||i("timestamp-query"),i("shader-f16"),i("subgroups"),this.device=await t.requestDevice(n),this.adapterInfo=new q6(t.info||await t.requestAdapterInfo()),this.gpuDataManager=zk(this),this.programManager=new bC(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,zb(e.logLevel,!!e.debug),this.device.onuncapturederror=a=>{a.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${a.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:t,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let e=this.getCommandEncoder(),t={};this.queryType==="at-passes"&&(t.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=e.beginComputePass(t)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;Ti(),this.endComputePass();let e;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),e=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(e,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,e,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&e.mapAsync(GPUMapMode.READ).then(()=>{let t=new BigUint64Array(e.getMappedRange()),r=this.pendingQueries.get(e);for(let n=0;n<t.length/2;n++){let i=r[n],a=i.kernelId,o=this.kernels.get(a),s=o.kernelType,u=o.kernelName,l=i.programName,c=i.inputTensorViews,f=i.outputTensorViews,p=t[n*2],d=t[n*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=p);let m=Number(p-this.queryTimeBase),g=Number(d-this.queryTimeBase);if(!Number.isSafeInteger(m)||!Number.isSafeInteger(g))throw new RangeError("incorrect timestamp range");if(this.env.webgpu.profiling?.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:c.map(x=>({dims:x.dims,dataType:va(x.dataType)})),outputsMetadata:f.map(x=>({dims:x.dims,dataType:va(x.dataType)})),kernelId:a,kernelType:s,kernelName:u,programName:l,startTime:m,endTime:g});else{let x="";c.forEach((y,E)=>{x+=`input[${E}]: [${y.dims}] | ${va(y.dataType)}, `});let b="";f.forEach((y,E)=>{b+=`output[${E}]: [${y.dims}] | ${va(y.dataType)}, `}),console.log(`[profiling] kernel "${a}|${s}|${u}|${l}" ${x}${b}execution time: ${g-m} ns`)}qc("GPU",`${l}::${p}::${d}`)}e.unmap(),this.pendingQueries.delete(e)}),ri()}run(e,t,r,n,i,a){Ti(e.name);let o=[];for(let y=0;y<t.length;++y){let E=t[y].data;if(E===0)continue;let $=this.gpuDataManager.get(E);if(!$)throw new Error(`no GPU data for input: ${E}`);o.push($)}let{outputs:s,dispatchGroup:u,programUniforms:l}=e.getRunData(t),c=r.length===0?s.map((y,E)=>E):r;if(c.length!==s.length)throw new Error(`Output size ${c.length} must be equal to ${s.length}.`);let f=[],p=[];for(let y=0;y<s.length;++y){if(!Number.isInteger(c[y])||c[y]<-3||c[y]>=a)throw new Error(`Invalid output index: ${c[y]}`);if(c[y]===-3)continue;let E=c[y]===-1,$=c[y]===-2,k=E||$?i(s[y].dataType,s[y].dims):n(c[y],s[y].dataType,s[y].dims);if(f.push(k),k.data===0)continue;let R=this.gpuDataManager.get(k.data);if(!R)throw new Error(`no GPU data for output: ${k.data}`);if(E&&this.temporaryData.push(R),$){let C=this.kernelPersistentData.get(this.currentKernelId);C||(C=[],this.kernelPersistentData.set(this.currentKernelId,C)),C.push(R)}p.push(R)}if(o.length!==t.length||p.length!==f.length){if(p.length===0)return ri(e.name),f;throw new Error(`Program ${e.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let d;if(l){let y=0,E=[];l.forEach(C=>{let P=typeof C.data=="number"?[C.data]:C.data;if(P.length===0)return;let W=C.type===10?2:4,te,ce;C.type===10?(ce=P.length>4?16:P.length>2?8:P.length*W,te=P.length>4?16:W*P.length):(ce=P.length<=2?P.length*W:16,te=16),y=Math.ceil(y/ce)*ce,E.push(y);let pe=C.type===10?8:4;y+=P.length>4?Math.ceil(P.length/pe)*te:P.length*W});let $=16;y=Math.ceil(y/$)*$;let k=new ArrayBuffer(y);l.forEach((C,P)=>{let W=E[P],te=typeof C.data=="number"?[C.data]:C.data;if(C.type===6)new Int32Array(k,W,te.length).set(te);else if(C.type===12)new Uint32Array(k,W,te.length).set(te);else if(C.type===10)new Uint16Array(k,W,te.length).set(te);else if(C.type===1)new Float32Array(k,W,te.length).set(te);else throw new Error(`Unsupported uniform type: ${va(C.type)}`)});let R=this.gpuDataManager.create(y,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(R.buffer,0,k,0,y),this.gpuDataManager.release(R.id),d={offset:0,size:y,buffer:R.buffer}}let m=this.programManager.normalizeDispatchGroupSize(u),g=m[1]===1&&m[2]===1,x=H6(e,t,g),b=this.programManager.getArtifact(x);if(b||(b=this.programManager.build(e,m),this.programManager.setArtifact(x,b),Qt("info",()=>`[artifact] key: ${x}, programName: ${e.name}`)),l&&b.uniformVariablesInfo){if(l.length!==b.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${b.uniformVariablesInfo.length}, got ${l.length} in program "${b.programInfo.name}".`);for(let y=0;y<l.length;y++){let E=l[y],$=E.type,k=typeof E.data=="number"?1:E.data.length,[R,C]=b.uniformVariablesInfo[y];if($!==R||k!==C)throw new Error(`Uniform variable ${y} mismatch: expect type ${R} with size ${C}, got type ${$} with size ${k} in program "${b.programInfo.name}".`)}}if(Qt("info",()=>`[ProgramManager] run "${e.name}" (key=${x}) with ${m[0]}x${m[1]}x${m[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let y={kernelId:this.currentKernelId,programName:b.programInfo.name,inputTensorViews:t,outputTensorViews:f};this.pendingKernels.push(y),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push(y)}return this.programManager.run(b,o,p,m,d),ri(e.name),f}upload(e,t){this.gpuDataManager.upload(e,t)}memcpy(e,t){this.gpuDataManager.memcpy(e,t)}async download(e,t){await this.gpuDataManager.download(e,t)}alloc(e){return this.gpuDataManager.create(e).id}free(e){return this.gpuDataManager.release(e)}createKernel(e,t,r,n){let i=yC.get(e);if(!i)throw new Error(`kernel not implemented: ${e}`);let a={kernelType:e,kernelName:n,kernelEntry:i[0],attributes:[i[1],r]};this.kernels.set(t,a)}releaseKernel(e){let t=this.kernelPersistentData.get(e);if(t){for(let r of t)this.gpuDataManager.release(r.id);this.kernelPersistentData.delete(e)}this.kernelCustomData.delete(e),this.kernels.delete(e)}computeKernel(e,t,r){let n=this.kernels.get(e);if(!n)throw new Error(`kernel not created: ${e}`);let i=n.kernelType,a=n.kernelName,o=n.kernelEntry,s=n.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${i}] ${a}" is not allowed to be called recursively`);this.currentKernelId=e,s[0]&&(s[1]=s[0](s[1]),s[0]=void 0),Qt("info",()=>`[WebGPU] Start to run kernel "[${i}] ${a}"...`);let u=this.env.debug;this.temporaryData=[];try{return u&&this.device.pushErrorScope("validation"),o(t,s[1]),0}catch(l){return r.push(Promise.resolve(`[WebGPU] Kernel "[${i}] ${a}" failed. ${l}`)),1}finally{u&&r.push(this.device.popErrorScope().then(l=>l?`GPU validation error for kernel "[${i}] ${a}": ${l.message}`:null));for(let l of this.temporaryData)this.gpuDataManager.release(l.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(e,t,r,n){let i=this.sessionExternalDataMapping.get(e);i||(i=new Map,this.sessionExternalDataMapping.set(e,i));let a=i.get(t),o=this.gpuDataManager.registerExternalBuffer(r,n,a);return i.set(t,[o,r]),o}unregisterBuffers(e){let t=this.sessionExternalDataMapping.get(e);t&&(t.forEach(r=>this.gpuDataManager.unregisterExternalBuffer(r[0])),this.sessionExternalDataMapping.delete(e))}getBuffer(e){let t=this.gpuDataManager.get(e);if(!t)throw new Error(`no GPU data for buffer: ${e}`);return t.buffer}createDownloader(e,t,r){return async()=>{let n=await fb(this,e,t);return Nb(n.buffer,r)}}writeTimestamp(e){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,e)}setQueryType(){this.queryType="none",(this.env.webgpu.profiling?.mode==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){Qt("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){Qt("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){Qt("info","replay"),this.sessionStatus="replaying";let e=this.capturedCommandList.get(this.currentSessionId),t=this.capturedPendingKernels.get(this.currentSessionId),r=e.length;this.pendingKernels=[];for(let n=0;n<r;n++){let i=this.getComputePassEncoder(),a=e[n];this.writeTimestamp(this.pendingDispatchNumber*2),i.setPipeline(a.computePipeline),i.setBindGroup(0,a.bindGroup),i.dispatchWorkgroups(...a.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(t[n]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(e){this.unregisterBuffers(e),this.capturedCommandList.has(e)&&this.capturedCommandList.delete(e),this.capturedPendingKernels.has(e)&&this.capturedPendingKernels.delete(e),this.gpuDataManager.onReleaseSession(e)}onRunStart(e){this.currentSessionId=e,this.setQueryType()}}}),_C={};Hu(_C,{init:()=>xC});mW=We(()=>{"use strict";Ct(),_a(),Ft(),$9(),xh=class $C{constructor(t,r,n,i){this.module=t,this.dataType=r,this.data=n,this.dims=i}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let t=me.size(this.dims);return t===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,t)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let t=me.size(this.dims);return t===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,t)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let t=me.size(this.dims);return t===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,t)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let t=me.size(this.dims);return t===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,t)}reshape(t){if(me.size(t)!==me.size(this.dims))throw new Error("Invalid new shape");return new $C(this.module,this.dataType,this.data,t)}},X6=class{constructor(e,t,r){this.module=e,this.backend=t,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=t.adapterInfo;let n=e.PTR_SIZE,i=r/e.PTR_SIZE,a=n===4?"i32":"i64";this.opKernelContext=Number(e.getValue(n*i++,a));let o=Number(e.getValue(n*i++,a));this.outputCount=Number(e.getValue(n*i++,a)),this.customDataOffset=Number(e.getValue(n*i++,"*")),this.customDataSize=Number(e.getValue(n*i++,a));let s=[];for(let u=0;u<o;u++){let l=Number(e.getValue(n*i++,a)),c=Number(e.getValue(n*i++,"*")),f=Number(e.getValue(n*i++,a)),p=[];for(let d=0;d<f;d++)p.push(Number(e.getValue(n*i++,a)));s.push(new xh(e,l,c,p))}this.inputs=s}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(e,t){let r=t?.inputs?.map(o=>typeof o=="number"?this.inputs[o]:o)??this.inputs,n=t?.outputs??[],i=(o,s,u)=>new xh(this.module,s,this.output(o,u),u),a=(o,s)=>{let u=cs(o,s);if(!u)throw new Error(`Unsupported data type: ${o}`);let l=u>0?this.backend.gpuDataManager.create(u).id:0;return new xh(this.module,o,l,s)};return this.backend.run(e,r,n,i,a,this.outputCount)}output(e,t){let r=this.module.stackSave();try{let n=this.module.PTR_SIZE,i=n===4?"i32":"i64",a=this.module.stackAlloc((1+t.length)*n);this.module.setValue(a,t.length,i);for(let o=0;o<t.length;o++)this.module.setValue(a+n*(o+1),t[o],i);return this.module._JsepOutput(this.opKernelContext,e,a)}catch(n){throw new Error(`Failed to generate kernel's output[${e}] with dims [${t}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${n}`)}finally{this.module.stackRestore(r)}}},xC=async(e,t,r,n)=>{let i=t.jsepInit;if(!i)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(e==="webgpu"){let a=(hW(),Hc(wC)).WebGpuBackend,o=new a;await o.initialize(r,n),i("webgpu",[o,s=>o.alloc(Number(s)),s=>o.free(s),(s,u,l,c=!1)=>{if(c)Qt("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(s)}, dst=${Number(u)}, size=${Number(l)}`),o.memcpy(Number(s),Number(u));else{Qt("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(s)}, gpuDataId=${Number(u)}, size=${Number(l)}`);let f=t.HEAPU8.subarray(Number(s>>>0),Number(s>>>0)+Number(l));o.upload(Number(u),f)}},async(s,u,l)=>{Qt("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${s}, dataOffset=${u}, size=${l}`),await o.download(Number(s),()=>t.HEAPU8.subarray(Number(u)>>>0,Number(u+l)>>>0))},(s,u,l)=>o.createKernel(s,Number(u),l,t.UTF8ToString(t._JsepGetNodeName(Number(u)))),s=>o.releaseKernel(s),(s,u,l,c)=>{Qt("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${l}, kernel=${s}, contextDataOffset=${u}`);let f=new X6(t,o,Number(u));return o.computeKernel(Number(s),f,c)},()=>o.captureBegin(),()=>o.captureEnd(),()=>o.replay()])}else{let a=new Rk(r);i("webnn",[a,()=>a.reserveTensorId(),o=>a.releaseTensorId(o),async(o,s,u,l,c)=>a.ensureTensor(o,s,u,l,c),(o,s)=>{a.uploadTensor(o,s)},async(o,s)=>a.downloadTensor(o,s)])}}}),EC=We(()=>{"use strict";v9(),_9(),Ct(),ms(),Cb(),Ak(),K6=(e,t)=>{gr()._OrtInit(e,t)!==0&&ur("Can't initialize onnxruntime.")},Hb=async e=>{K6(e.wasm.numThreads,kh(e.logLevel))},qb=async(e,t)=>{gr().asyncInit?.();{let r=(mW(),Hc(_C)).init;if(t==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");let n=e.webgpu.adapter;if(n){if(typeof n.limits!="object"||typeof n.features!="object"||typeof n.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let i=e.webgpu.powerPreference;if(i!==void 0&&i!=="low-power"&&i!=="high-performance")throw new Error(`Invalid powerPreference setting: "${i}"`);let a=e.webgpu.forceFallbackAdapter;if(a!==void 0&&typeof a!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${a}"`);if(n=await navigator.gpu.requestAdapter({powerPreference:i,forceFallbackAdapter:a}),!n)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}await r("webgpu",gr(),e,n)}if(t==="webnn"){if(typeof navigator>"u"||!navigator.ml)throw new Error("WebNN is not supported in current environment");await r("webnn",gr(),e)}}},ro=new Map,Y6=e=>{let t=gr(),r=t.stackSave();try{let n=t.PTR_SIZE,i=t.stackAlloc(2*n);t._OrtGetInputOutputCount(e,i,i+n)!==0&&ur("Can't get session input/output count.");let a=n===4?"i32":"i64";return[Number(t.getValue(i,a)),Number(t.getValue(i+n,a))]}finally{t.stackRestore(r)}},ib=(e,t)=>{let r=gr(),n=r.stackSave(),i=0;try{let a=r.PTR_SIZE,o=r.stackAlloc(2*a);r._OrtGetInputOutputMetadata(e,t,o,o+a)!==0&&ur("Can't get session input/output metadata.");let s=Number(r.getValue(o,"*"));i=Number(r.getValue(o+a,"*"));let u=r.HEAP32[i/4];if(u===0)return[s,0];let l=r.HEAPU32[i/4+1],c=[];for(let f=0;f<l;f++){let p=Number(r.getValue(i+8+f*a,"*"));c.push(p!==0?r.UTF8ToString(p):Number(r.getValue(i+8+(f+l)*a,"*")))}return[s,u,c]}finally{r.stackRestore(n),i!==0&&r._OrtFree(i)}},Rh=e=>{let t=gr(),r=t._malloc(e.byteLength);if(r===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${e.byteLength}.`);return t.HEAPU8.set(e,r),[r,e.byteLength]},Xb=async(e,t)=>{let r,n,i=gr();Array.isArray(e)?[r,n]=e:e.buffer===i.HEAPU8.buffer?[r,n]=[e.byteOffset,e.byteLength]:[r,n]=Rh(e);let a=0,o=0,s=0,u=[],l=[],c=[];try{if([o,u]=await Tk(t),t?.externalData&&i.mountExternalData){let $=[];for(let k of t.externalData){let R=typeof k=="string"?k:k.path;$.push(Rb(typeof k=="string"?k:k.data).then(C=>{i.mountExternalData(R,C)}))}await Promise.all($)}for(let $ of t?.executionProviders??[])if((typeof $=="string"?$:$.name)==="webnn"){if(i.shouldTransferToMLTensor=!1,typeof $!="string"){let k=$,R=k?.context,C=k?.gpuDevice,P=k?.deviceType,W=k?.powerPreference;R?i.currentContext=R:C?i.currentContext=await i.webnnCreateMLContext(C):i.currentContext=await i.webnnCreateMLContext({deviceType:P,powerPreference:W})}else i.currentContext=await i.webnnCreateMLContext();break}a=await i._OrtCreateSession(r,n,o),i.webgpuOnCreateSession?.(a),a===0&&ur("Can't create a session."),i.jsepOnCreateSession?.(),i.currentContext&&(i.webnnRegisterMLContext(a,i.currentContext),i.currentContext=void 0,i.shouldTransferToMLTensor=!0);let[f,p]=Y6(a),d=!!t?.enableGraphCapture,m=[],g=[],x=[],b=[],y=[];for(let $=0;$<f;$++){let[k,R,C]=ib(a,$);k===0&&ur("Can't get an input name."),l.push(k);let P=i.UTF8ToString(k);m.push(P),x.push(R===0?{name:P,isTensor:!1}:{name:P,isTensor:!0,type:va(R),shape:C})}for(let $=0;$<p;$++){let[k,R,C]=ib(a,$+f);k===0&&ur("Can't get an output name."),c.push(k);let P=i.UTF8ToString(k);g.push(P),b.push(R===0?{name:P,isTensor:!1}:{name:P,isTensor:!0,type:va(R),shape:C});{if(d&&t?.preferredOutputLocation===void 0){y.push("gpu-buffer");continue}let W=typeof t?.preferredOutputLocation=="string"?t.preferredOutputLocation:t?.preferredOutputLocation?.[P]??"cpu",te=i.webnnIsGraphOutput;if(W==="cpu"&&te&&te(a,P)){y.push("ml-tensor-cpu-output");continue}if(W!=="cpu"&&W!=="cpu-pinned"&&W!=="gpu-buffer"&&W!=="ml-tensor")throw new Error(`Not supported preferred output location: ${W}.`);if(d&&W!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${W}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);y.push(W)}}let E=null;return y.some($=>$==="gpu-buffer"||$==="ml-tensor"||$==="ml-tensor-cpu-output")&&(s=i._OrtCreateBinding(a),s===0&&ur("Can't create IO binding."),E={handle:s,outputPreferredLocations:y,outputPreferredLocationsEncoded:y.map($=>$==="ml-tensor-cpu-output"?"ml-tensor":$).map($=>lb($))}),ro.set(a,[a,l,c,E,d,!1]),[a,m,g,x,b]}catch(f){throw l.forEach(p=>i._OrtFree(p)),c.forEach(p=>i._OrtFree(p)),s!==0&&i._OrtReleaseBinding(s)!==0&&ur("Can't release IO binding."),a!==0&&i._OrtReleaseSession(a)!==0&&ur("Can't release session."),f}finally{i._free(r),o!==0&&i._OrtReleaseSessionOptions(o)!==0&&ur("Can't release session options."),u.forEach(f=>i._free(f)),i.unmountExternalData?.()}},Kb=e=>{let t=gr(),r=ro.get(e);if(!r)throw new Error(`cannot release session. invalid session id: ${e}`);let[n,i,a,o,s]=r;o&&(s&&t._OrtClearBoundOutputs(o.handle)!==0&&ur("Can't clear bound outputs."),t._OrtReleaseBinding(o.handle)!==0&&ur("Can't release IO binding.")),t.jsepOnReleaseSession?.(e),t.webnnOnReleaseSession?.(e),t.webgpuOnReleaseSession?.(e),i.forEach(u=>t._OrtFree(u)),a.forEach(u=>t._OrtFree(u)),t._OrtReleaseSession(n)!==0&&ur("Can't release session."),ro.delete(e)},ab=async(e,t,r,n,i,a,o=!1)=>{if(!e){t.push(0);return}let s=gr(),u=s.PTR_SIZE,l=e[0],c=e[1],f=e[3],p=f,d,m;if(l==="string"&&(f==="gpu-buffer"||f==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(o&&f!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${a} when enableGraphCapture is true.`);if(f==="gpu-buffer"){let b=e[2].gpuBuffer;m=cs(ls(l),c);{let y=s.jsepRegisterBuffer;if(!y)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');d=y(n,a,b,m)}}else if(f==="ml-tensor"){let b=e[2].mlTensor;m=cs(ls(l),c);let y=s.webnnRegisterMLTensor;if(!y)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');d=y(n,b,ls(l),c)}else{let b=e[2];if(Array.isArray(b)){m=u*b.length,d=s._malloc(m),r.push(d);for(let y=0;y<b.length;y++){if(typeof b[y]!="string")throw new TypeError(`tensor data at index ${y} is not a string`);s.setValue(d+y*u,Ei(b[y],r),"*")}}else{let y=s.webnnIsGraphInput,E=s.webnnIsGraphOutput;if(l!=="string"&&y&&E){let $=s.UTF8ToString(i);if(y(n,$)||E(n,$)){let k=ls(l);m=cs(k,c),p="ml-tensor";let R=s.webnnCreateTemporaryTensor,C=s.webnnUploadTensor;if(!R||!C)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let P=await R(n,k,c);C(P,new Uint8Array(b.buffer,b.byteOffset,b.byteLength)),d=P}else m=b.byteLength,d=s._malloc(m),r.push(d),s.HEAPU8.set(new Uint8Array(b.buffer,b.byteOffset,m),d)}else m=b.byteLength,d=s._malloc(m),r.push(d),s.HEAPU8.set(new Uint8Array(b.buffer,b.byteOffset,m),d)}}let g=s.stackSave(),x=s.stackAlloc(4*c.length);try{c.forEach((y,E)=>s.setValue(x+E*u,y,u===4?"i32":"i64"));let b=s._OrtCreateTensor(ls(l),d,m,x,c.length,lb(p));b===0&&ur(`Can't create tensor for input/output. session=${n}, index=${a}.`),t.push(b)}finally{s.stackRestore(g)}},Yb=async(e,t,r,n,i,a)=>{let o=gr(),s=o.PTR_SIZE,u=ro.get(e);if(!u)throw new Error(`cannot run inference. invalid session id: ${e}`);let l=u[0],c=u[1],f=u[2],p=u[3],d=u[4],m=u[5],g=t.length,x=n.length,b=0,y=[],E=[],$=[],k=[],R=o.stackSave(),C=o.stackAlloc(g*s),P=o.stackAlloc(g*s),W=o.stackAlloc(x*s),te=o.stackAlloc(x*s);try{[b,y]=Sk(a);for(let fe=0;fe<g;fe++)await ab(r[fe],E,k,e,c[t[fe]],t[fe],d);for(let fe=0;fe<x;fe++)await ab(i[fe],$,k,e,f[n[fe]],g+n[fe],d);for(let fe=0;fe<g;fe++)o.setValue(C+fe*s,E[fe],"*"),o.setValue(P+fe*s,c[t[fe]],"*");for(let fe=0;fe<x;fe++)o.setValue(W+fe*s,$[fe],"*"),o.setValue(te+fe*s,f[n[fe]],"*");if(p&&!m){let{handle:fe,outputPreferredLocations:Me,outputPreferredLocationsEncoded:Ge}=p;if(c.length!==g)throw new Error(`input count from feeds (${g}) is expected to be always equal to model's input count (${c.length}).`);for(let He=0;He<g;He++){let dt=t[He];await o._OrtBindInput(fe,c[dt],E[He])!==0&&ur(`Can't bind input[${He}] for session=${e}.`)}for(let He=0;He<x;He++){let dt=n[He];i[He]?.[3]?o._OrtBindOutput(fe,f[dt],$[He],0)!==0&&ur(`Can't bind pre-allocated output[${He}] for session=${e}.`):o._OrtBindOutput(fe,f[dt],0,Ge[dt])!==0&&ur(`Can't bind output[${He}] to ${Me[He]} for session=${e}.`)}ro.set(e,[l,c,f,p,d,!0])}o.jsepOnRunStart?.(l),o.webnnOnRunStart?.(l);let ce;p?ce=await o._OrtRunWithBinding(l,p.handle,x,W,b):ce=await o._OrtRun(l,P,C,g,te,x,W,b),ce!==0&&ur("failed to call OrtRun().");let pe=[],ge=[];for(let fe=0;fe<x;fe++){let Me=Number(o.getValue(W+fe*s,"*"));if(Me===$[fe]){pe.push(i[fe]);continue}let Ge=o.stackSave(),He=o.stackAlloc(4*s),dt=!1,he,qe=0;try{o._OrtGetTensorData(Me,He,He+s,He+2*s,He+3*s)!==0&&ur(`Can't access output tensor data on index ${fe}.`);let ae=s===4?"i32":"i64",we=Number(o.getValue(He,ae));qe=o.getValue(He+s,"*");let Re=o.getValue(He+s*2,"*"),ne=Number(o.getValue(He+s*3,ae)),at=[];for(let mt=0;mt<ne;mt++)at.push(Number(o.getValue(Re+mt*s,ae)));o._OrtFree(Re)!==0&&ur("Can't free memory for tensor dims.");let kt=at.reduce((mt,gt)=>mt*gt,1);he=va(we);let pt=p?.outputPreferredLocations[n[fe]];if(he==="string"){if(pt==="gpu-buffer"||pt==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let mt=[];for(let gt=0;gt<kt;gt++){let Dt=o.getValue(qe+gt*s,"*"),Bt=o.getValue(qe+(gt+1)*s,"*"),er=gt===kt-1?void 0:Bt-Dt;mt.push(o.UTF8ToString(Dt,er))}pe.push([he,at,mt,"cpu"])}else if(pt==="gpu-buffer"&&kt>0){let mt=o.jsepGetBuffer;if(!mt)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let gt=mt(qe),Dt=cs(we,kt);if(Dt===void 0||!Ob(he))throw new Error(`Unsupported data type: ${he}`);dt=!0,pe.push([he,at,{gpuBuffer:gt,download:o.jsepCreateDownloader(gt,Dt,he),dispose:()=>{o._OrtReleaseTensor(Me)!==0&&ur("Can't release tensor.")}},"gpu-buffer"])}else if(pt==="ml-tensor"&&kt>0){let mt=o.webnnEnsureTensor,gt=o.webnnIsGraphInputOutputTypeSupported;if(!mt||!gt)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(cs(we,kt)===void 0||!Bb(he))throw new Error(`Unsupported data type: ${he}`);if(!gt(e,he,!1))throw new Error(`preferredLocation "ml-tensor" for ${he} output is not supported by current WebNN Context.`);let Dt=await mt(e,qe,we,at,!1);dt=!0,pe.push([he,at,{mlTensor:Dt,download:o.webnnCreateMLTensorDownloader(qe,he),dispose:()=>{o.webnnReleaseTensorId(qe),o._OrtReleaseTensor(Me)}},"ml-tensor"])}else if(pt==="ml-tensor-cpu-output"&&kt>0){let mt=o.webnnCreateMLTensorDownloader(qe,he)(),gt=pe.length;dt=!0,ge.push((async()=>{let Dt=[gt,await mt];return o.webnnReleaseTensorId(qe),o._OrtReleaseTensor(Me),Dt})()),pe.push([he,at,[],"cpu"])}else{let mt=zh(he),gt=new mt(kt);new Uint8Array(gt.buffer,gt.byteOffset,gt.byteLength).set(o.HEAPU8.subarray(qe,qe+gt.byteLength)),pe.push([he,at,gt,"cpu"])}}finally{o.stackRestore(Ge),he==="string"&&qe&&o._free(qe),dt||o._OrtReleaseTensor(Me)}}p&&!d&&(o._OrtClearBoundOutputs(p.handle)!==0&&ur("Can't clear bound outputs."),ro.set(e,[l,c,f,p,d,!1]));for(let[fe,Me]of await Promise.all(ge))pe[fe][2]=Me;return pe}finally{o.webnnOnRunEnd?.(l),o.stackRestore(R),E.forEach(ce=>o._OrtReleaseTensor(ce)),$.forEach(ce=>o._OrtReleaseTensor(ce)),k.forEach(ce=>o._free(ce)),b!==0&&o._OrtReleaseRunOptions(b),y.forEach(ce=>o._free(ce))}},Zb=e=>{let t=gr(),r=ro.get(e);if(!r)throw new Error("invalid session id");let n=r[0],i=t._OrtEndProfiling(n);i===0&&ur("Can't get an profile file name."),t._OrtFree(i)},Qb=e=>{let t=[];for(let r of e){let n=r[2];!Array.isArray(n)&&"buffer"in n&&t.push(n.buffer)}return t}}),BC=We(()=>{"use strict";Ai(),EC(),ms(),kb(),no=()=>!!vr.wasm.proxy&&typeof document<"u",Gu=!1,Pc=!1,Uc=!1,Eh=new Map,os=(e,t)=>{let r=Eh.get(e);r?r.push(t):Eh.set(e,[t])},ss=()=>{if(Gu||!Pc||Uc||!ei)throw new Error("worker not ready")},Z6=e=>{switch(e.data.type){case"init-wasm":Gu=!1,e.data.err?(Uc=!0,ob[1](e.data.err)):(Pc=!0,ob[0]()),$h&&(URL.revokeObjectURL($h),$h=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let t=Eh.get(e.data.type);e.data.err?t.shift()[1](e.data.err):t.shift()[0](e.data.out);break}default:}},SC=async()=>{if(!Pc){if(Gu)throw new Error("multiple calls to 'initWasm()' detected.");if(Uc)throw new Error("previous call to 'initWasm()' failed.");if(Gu=!0,no())return new Promise((e,t)=>{ei?.terminate(),$k().then(([r,n])=>{try{ei=n,ei.onerror=a=>t(a),ei.onmessage=Z6,ob=[e,t];let i={type:"init-wasm",in:vr};!i.in.wasm.wasmPaths&&(r||ub)&&(i.in.wasm.wasmPaths={wasm:new URL("ort-wasm-simd-threaded.jsep.wasm",import.meta.url).href}),ei.postMessage(i),$h=r}catch(i){t(i)}},t)});try{await Ib(vr.wasm),await Hb(vr),Pc=!0}catch(e){throw Uc=!0,e}finally{Gu=!1}}},TC=async e=>{if(no())return ss(),new Promise((t,r)=>{os("init-ep",[t,r]);let n={type:"init-ep",in:{epName:e,env:vr}};ei.postMessage(n)});await qb(vr,e)},AC=async e=>no()?(ss(),new Promise((t,r)=>{os("copy-from",[t,r]);let n={type:"copy-from",in:{buffer:e}};ei.postMessage(n,[e.buffer])})):Rh(e),kC=async(e,t)=>{if(no()){if(t?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return ss(),new Promise((r,n)=>{os("create",[r,n]);let i={type:"create",in:{model:e,options:{...t}}},a=[];e instanceof Uint8Array&&a.push(e.buffer),ei.postMessage(i,a)})}else return Xb(e,t)},IC=async e=>{if(no())return ss(),new Promise((t,r)=>{os("release",[t,r]);let n={type:"release",in:e};ei.postMessage(n)});Kb(e)},CC=async(e,t,r,n,i,a)=>{if(no()){if(r.some(o=>o[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(i.some(o=>o))throw new Error("pre-allocated output tensor is not supported for proxy.");return ss(),new Promise((o,s)=>{os("run",[o,s]);let u=r,l={type:"run",in:{sessionId:e,inputIndices:t,inputs:u,outputIndices:n,options:a}};ei.postMessage(l,Qb(u))})}else return Yb(e,t,r,n,i,a)},OC=async e=>{if(no())return ss(),new Promise((t,r)=>{os("end-profiling",[t,r]);let n={type:"end-profiling",in:e};ei.postMessage(n)});Zb(e)}}),gW=We(()=>{"use strict";Ai(),BC(),Ct(),Ab(),Ak(),sb=(e,t)=>{switch(e.location){case"cpu":return[e.type,e.dims,e.data,"cpu"];case"gpu-buffer":return[e.type,e.dims,{gpuBuffer:e.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[e.type,e.dims,{mlTensor:e.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${e.location} for ${t()}`)}},Q6=e=>{switch(e[3]){case"cpu":return new Si(e[0],e[2],e[1]);case"gpu-buffer":{let t=e[0];if(!Ob(t))throw new Error(`not supported data type: ${t} for deserializing GPU tensor`);let{gpuBuffer:r,download:n,dispose:i}=e[2];return Si.fromGpuBuffer(r,{dataType:t,dims:e[1],download:n,dispose:i})}case"ml-tensor":{let t=e[0];if(!Bb(t))throw new Error(`not supported data type: ${t} for deserializing MLTensor tensor`);let{mlTensor:r,download:n,dispose:i}=e[2];return Si.fromMLTensor(r,{dataType:t,dims:e[1],download:n,dispose:i})}default:throw new Error(`invalid data location: ${e[3]}`)}},RC=class{async fetchModelAndCopyToWasmMemory(e){return AC(await Rb(e))}async loadModel(e,t){Ti();let r;typeof e=="string"?r=await this.fetchModelAndCopyToWasmMemory(e):r=e,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await kC(r,t),ri()}async dispose(){return IC(this.sessionId)}async run(e,t,r){Ti();let n=[],i=[];Object.entries(e).forEach(f=>{let p=f[0],d=f[1],m=this.inputNames.indexOf(p);if(m===-1)throw new Error(`invalid input '${p}'`);n.push(d),i.push(m)});let a=[],o=[];Object.entries(t).forEach(f=>{let p=f[0],d=f[1],m=this.outputNames.indexOf(p);if(m===-1)throw new Error(`invalid output '${p}'`);a.push(d),o.push(m)});let s=n.map((f,p)=>sb(f,()=>`input "${this.inputNames[i[p]]}"`)),u=a.map((f,p)=>f?sb(f,()=>`output "${this.outputNames[o[p]]}"`):null),l=await CC(this.sessionId,i,s,o,u,r),c={};for(let f=0;f<l.length;f++)c[this.outputNames[o[f]]]=a[f]??Q6(l[f]);return ri(),c}startProfiling(){}endProfiling(){OC(this.sessionId)}}}),zC={};Hu(zC,{OnnxruntimeWebAssemblyBackend:()=>$b,initializeFlags:()=>xb,wasmBackend:()=>NC});yW=We(()=>{"use strict";Ai(),BC(),gW(),xb=()=>{(typeof vr.wasm.initTimeout!="number"||vr.wasm.initTimeout<0)&&(vr.wasm.initTimeout=0);let e=vr.wasm.simd;if(typeof e!="boolean"&&e!==void 0&&e!=="fixed"&&e!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${e}". Reset it to \`false\` and ignore SIMD feature checking.`),vr.wasm.simd=!1),typeof vr.wasm.proxy!="boolean"&&(vr.wasm.proxy=!1),typeof vr.wasm.trace!="boolean"&&(vr.wasm.trace=!1),typeof vr.wasm.numThreads!="number"||!Number.isInteger(vr.wasm.numThreads)||vr.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)vr.wasm.numThreads=1;else{let t=typeof navigator>"u"?n9("node:os").cpus().length:navigator.hardwareConcurrency;vr.wasm.numThreads=Math.min(4,Math.ceil((t||1)/2))}},$b=class{async init(e){xb(),await SC(),await TC(e)}async createInferenceSessionHandler(e,t){let r=new RC;return await r.loadModel(e,t),r}},NC=new $b});Ai();Ai();Ai();bW="1.22.0",wW=yk;{let e=(yW(),Hc(zC)).wasmBackend;fs("webgpu",e,5),fs("webnn",e,5),fs("cpu",e,10),fs("wasm",e,10)}Object.defineProperty(vr.versions,"web",{value:bW,enumerable:!0});});function Dh(e){Nh=!!e;try{localStorage.setItem("USE_GPU",Nh?"1":"0")}catch{}qu=null}function Mh(e){Yc=!!e;try{localStorage.setItem("RUN_OFFLINE",Yc?"1":"0")}catch{}}function ew(){return Yc}async function vW(){if(Kc!==void 0)return Kc;if(typeof window>"u")return!1;if(!window.ort)try{await Promise.resolve().then(()=>(DC(),LC))}catch{return Kc=!1,!1}return Kc=!!window.ort,Kc}async function UC(){return Nh&&Lh&&await vW()?"webgpu":"wasm-simd"}async function _W(){if(!qu){Jb.dispatchEvent(new Event(MC));try{let e=await import("../lib/bundle.esm.min.js"),{pipeline:t}=e,r=await UC();if(typeof window<"u"&&(window.LLM_BACKEND=r),window.GPT2_MODEL_BASE64){let n=Uint8Array.from(atob(window.GPT2_MODEL_BASE64),o=>o.charCodeAt(0)),i=new Blob([n]),a=URL.createObjectURL(i);qu=await t("text-generation",a,{backend:r})}else qu=await t("text-generation","./wasm_llm/",{backend:r})}catch{qu=async t=>`[offline] ${t}`}finally{Jb.dispatchEvent(new Event(PC))}}return qu}async function Zc(e){let r=Yc?null:localStorage.getItem("OPENAI_API_KEY");if(r)return(await(await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"user",content:e}]})})).json()).choices[0].message.content.trim();let i=await(await _W())(e);return typeof i=="string"?i:i[0]?.generated_text?.trim()}var qu,Nh,Kc,Jb,MC,PC,Lh,Yc,Qc=tg(()=>{"use strict";Nh=!0,Jb=new EventTarget,MC="llm-load-start",PC="llm-load-end",Lh=typeof navigator<"u"&&!!navigator.gpu,Yc=!1;try{Yc=localStorage.getItem("RUN_OFFLINE")==="1"}catch{}try{let e=localStorage.getItem("USE_GPU");e!==null&&(Nh=e!=="0")}catch{}});var jC={};I2(jC,{LLM_LOAD_END:()=>PC,LLM_LOAD_START:()=>MC,chat:()=>Zc,gpuAvailable:()=>Lh,gpuBackend:()=>UC,isOffline:()=>ew,llmEvents:()=>Jb,setOffline:()=>Mh,setUseGpu:()=>Dh});var VC=tg(()=>{Qc()});var Mi={seed:42,pop:80,gen:60,mutations:["gaussian"],adaptive:!1},$d=500;function rg(e=window.location.hash){if(!e||e==="#")try{let r=localStorage.getItem("insightParams");if(r){let n=JSON.parse(r);return{seed:n.seed??Mi.seed,pop:Math.min(n.pop??Mi.pop,$d),gen:Math.min(n.gen??Mi.gen,$d),mutations:n.mutations??Mi.mutations,adaptive:n.adaptive??Mi.adaptive}}}catch{}let t=new URLSearchParams(e.replace(/^#\/?/,""));return{seed:+(t.get("s")??"")||Mi.seed,pop:Math.min(+(t.get("p")??"")||Mi.pop,$d),gen:Math.min(+(t.get("g")??"")||Mi.gen,$d),mutations:(t.get("m")||Mi.mutations.join(",")).split(",").filter(Boolean),adaptive:t.get("a")==="1"||Mi.adaptive}}function C2(e){let t=new URLSearchParams;return t.set("s",String(e.seed)),t.set("p",String(e.pop)),t.set("g",String(e.gen)),e.mutations&&t.set("m",e.mutations.join(",")),e.adaptive&&t.set("a","1"),"#/"+t.toString()}var O2={seed:"Seed",population:"Population",generations:"Generations",gaussian:"gaussian",swap:"swap",jump:"jump",scramble:"scramble",adaptive:"Adaptive",pause:"Pause",resume:"Resume",export:"Export",drop:"Drop JSON here",csv:"CSV",png:"PNG",share:"Share",theme:"Theme",iframe_copied:"iframe snippet copied",link_copied:"permalink copied",state_loaded:"state loaded",invalid_file:"invalid file",simulation_restarted:"simulation restarted",telemetry_consent:"Allow anonymous telemetry?",download_log:"Download log","summary.debateArena":"Debate Arena","summary.debate":"Debate","label.rank":"Rank","label.score":"Score",score:"Score",novelty:"Novelty",time:"Time",respawn:"Re-spawn",pyodide_unavailable:"Pyodide unavailable; using JS only",pyodide_failed:"Pyodide failed to load; using JS only",archive_disabled:"Archive disabled (no storage access)",archive_full:"Archive full; oldest runs pruned",pin_failed:"pin failed",worker_error:"worker error",error_unknown:"unknown error",disclaimer:"This repository is a conceptual research prototype. References to 'AGI' and 'superintelligence' describe aspirational goals and do not indicate the presence of a real general intelligence. Use at your own risk. Nothing herein constitutes financial advice. MontrealAI and the maintainers accept no liability for losses incurred from using this software."};var Xs=O2,Nl=Xs,Ro="en";async function B2(){let e=localStorage.getItem("lang"),t=navigator.languages||[navigator.language||"en"],r=(e||t[0]||"en").slice(0,2);e||(t.some(n=>n.startsWith("zh"))?r="zh":t.some(n=>n.startsWith("fr"))?r="fr":t.some(n=>n.startsWith("es"))&&(r="es")),Ro=r.startsWith("fr")?"fr":r.startsWith("es")?"es":r.startsWith("zh")?"zh":"en";try{let n=await fetch(`src/i18n/${Ro}.json`);Nl={...Xs,...await n.json()}}catch{Nl=Xs,Ro="en"}}async function R2(e){Ro=e,localStorage.setItem("lang",e);try{let t=await fetch(`src/i18n/${e}.json`);Nl={...Xs,...await t.json()}}catch{Nl=Xs,Ro="en"}}function Ut(e){return Nl[e]||Xs[e]||e}var Ks=500;function z2(e,t){let r=document.getElementById("controls");if(!r)throw new Error("controls element not found");let n=r;n.replaceChildren();function i(C,P){let W=document.createElement("label");W.appendChild(document.createTextNode(C+" ")),W.appendChild(P),n.appendChild(W)}let a=document.createElement("input");a.id="seed",a.type="number",a.min="0",a.setAttribute("aria-label",Ut("seed")),a.tabIndex=1,i(Ut("seed"),a);let o=document.createElement("input");o.id="pop",o.type="number",o.min="1",o.max=String(Ks),o.setAttribute("aria-label",Ut("population")),o.tabIndex=2,i(Ut("population"),o);let s=document.createElement("input");s.id="gen",s.type="number",s.min="1",s.max=String(Ks),s.setAttribute("aria-label",Ut("generations")),s.tabIndex=3,i(Ut("generations"),s);function u(C,P,W){let te=document.createElement("input");return te.id=C,te.type="checkbox",te.setAttribute("aria-label",P),te.tabIndex=W,i(P,te),te}let l=u("gaussian",Ut("gaussian"),4),c=u("swap",Ut("swap"),5),f=u("jump",Ut("jump"),6),p=u("scramble",Ut("scramble"),7),d=u("adaptive",Ut("adaptive"),8),m=document.createElement("button");m.id="pause",m.setAttribute("role","button"),m.setAttribute("aria-label",Ut("pause")),m.tabIndex=9,m.textContent=Ut("pause"),n.appendChild(m);let g=document.createElement("button");g.id="export",g.setAttribute("role","button"),g.setAttribute("aria-label",Ut("export")),g.tabIndex=10,g.textContent=Ut("export"),n.appendChild(g);let x=document.createElement("div");x.id="drop",x.setAttribute("role","button"),x.setAttribute("aria-label",Ut("drop")),x.tabIndex=10,x.textContent=Ut("drop"),n.appendChild(x);let b=document.createElement("select");b.id="lang",b.tabIndex=11;let y=document.createElement("option");y.value="en",y.textContent="English";let E=document.createElement("option");E.value="fr",E.textContent="Fran\xE7ais";let $=document.createElement("option");$.value="es",$.textContent="Espa\xF1ol",b.append(y,E,$),n.appendChild(b);function k(C){a.value=String(C.seed),o.value=String(Math.min(C.pop,Ks)),s.value=String(Math.min(C.gen,Ks));let P=new Set(C.mutations||[]);l.checked=P.has("gaussian"),c.checked=P.has("swap"),f.checked=P.has("jump"),p.checked=P.has("scramble"),d.checked=C.adaptive||!1}k(e);function R(){let C=[l,c,f,p].filter(pe=>pe.checked).map(pe=>pe.id),P=Math.min(+o.value,Ks),W=Math.min(+s.value,Ks),te={popClamped:P!==+o.value,genClamped:W!==+s.value};o.value=String(P),s.value=String(W);let ce={seed:+a.value,pop:P,gen:W,mutations:C,adaptive:d.checked};try{localStorage.setItem("insightParams",JSON.stringify(ce))}catch{}t(ce,te)}return a.addEventListener("change",R),o.addEventListener("change",R),s.addEventListener("change",R),l.addEventListener("change",R),c.addEventListener("change",R),f.addEventListener("change",R),p.addEventListener("change",R),d.addEventListener("change",R),b.value=Ro,b.addEventListener("change",async()=>{await R2(b.value),location.reload()}),{setValues:k,pauseBtn:m,exportBtn:g,dropZone:x}}import{InternSet as hR,rollups as mR}from"d3";import{ascending as VB,descending as WB}from"d3";function Hn(e){return e!=null&&!Number.isNaN(e)}function pn(e,t){return+Hn(t)-+Hn(e)||VB(e,t)}function zo(e,t){return+Hn(t)-+Hn(e)||WB(e,t)}function Ll(e){return e!=null&&`${e}`!=""}function ng(e){return isFinite(e)?e:NaN}function No(e){return e>0&&isFinite(e)?e:NaN}function Ys(e){return e<0&&isFinite(e)?e:NaN}import{quantile as w8,range as Q2}from"d3";function Ed(e,t){if(e instanceof Date||(e=new Date(+e)),isNaN(e))return typeof t=="function"?t(e):t;let r=e.getUTCHours(),n=e.getUTCMinutes(),i=e.getUTCSeconds(),a=e.getUTCMilliseconds();return`${HB(e.getUTCFullYear(),4)}-${oa(e.getUTCMonth()+1,2)}-${oa(e.getUTCDate(),2)}${r||n||i||a?`T${oa(r,2)}:${oa(n,2)}${i||a?`:${oa(i,2)}${a?`.${oa(a,3)}`:""}`:""}Z`:""}`}function HB(e){return e<0?`-${oa(-e,6)}`:e>9999?`+${oa(e,6)}`:oa(e,4)}function oa(e,t){return`${e}`.padStart(t,"0")}var qB=/^(?:[-+]\d{2})?\d{4}(?:-\d{2}(?:-\d{2})?)?(?:T\d{2}:\d{2}(?::\d{2}(?:\.\d{3})?)?(?:Z|[-+]\d{2}:?\d{2})?)?$/;function Dl(e,t){return qB.test(e+="")?new Date(e):typeof t=="function"?t(e):t}import{bisector as KB,max as YB,pairs as ZB,timeFormat as QB,utcFormat as JB}from"d3";import{utcSecond as L2,utcMinute as D2,utcHour as M2,unixDay as P2,utcWeek as e8,utcMonth as U2,utcYear as F2}from"d3";import{utcMonday as t8,utcTuesday as r8,utcWednesday as n8,utcThursday as i8,utcFriday as a8,utcSaturday as o8,utcSunday as s8}from"d3";import{timeSecond as G2,timeMinute as j2,timeHour as V2,timeDay as W2,timeWeek as u8,timeMonth as H2,timeYear as q2}from"d3";import{timeMonday as l8,timeTuesday as c8,timeWednesday as f8,timeThursday as d8,timeFriday as p8,timeSaturday as h8,timeSunday as m8}from"d3";import{descending as XB}from"d3";function sa(e){if(e==null)return;let t=e[0],r=e[e.length-1];return XB(t,r)}var Qs=1e3,Pa=Qs*60,Ua=Pa*60,Ui=Ua*24,Pi=Ui*7,Lo=Ui*30,Ma=Ui*365,ig=[["millisecond",1],["2 milliseconds",2],["5 milliseconds",5],["10 milliseconds",10],["20 milliseconds",20],["50 milliseconds",50],["100 milliseconds",100],["200 milliseconds",200],["500 milliseconds",500],["second",Qs],["5 seconds",5*Qs],["15 seconds",15*Qs],["30 seconds",30*Qs],["minute",Pa],["5 minutes",5*Pa],["15 minutes",15*Pa],["30 minutes",30*Pa],["hour",Ua],["3 hours",3*Ua],["6 hours",6*Ua],["12 hours",12*Ua],["day",Ui],["2 days",2*Ui],["week",Pi],["2 weeks",2*Pi],["month",Lo],["3 months",3*Lo],["6 months",6*Lo],["year",Ma],["2 years",2*Ma],["5 years",5*Ma],["10 years",10*Ma],["20 years",20*Ma],["50 years",50*Ma],["100 years",100*Ma]],ag=new Map([["second",Qs],["minute",Pa],["hour",Ua],["day",Ui],["monday",Pi],["tuesday",Pi],["wednesday",Pi],["thursday",Pi],["friday",Pi],["saturday",Pi],["sunday",Pi],["week",Pi],["month",Lo],["year",Ma]]),X2=new Map([["second",G2],["minute",j2],["hour",V2],["day",W2],["monday",l8],["tuesday",c8],["wednesday",f8],["thursday",d8],["friday",p8],["saturday",h8],["sunday",m8],["week",u8],["month",H2],["year",q2]]),og=new Map([["second",L2],["minute",D2],["hour",M2],["day",P2],["monday",t8],["tuesday",r8],["wednesday",n8],["thursday",i8],["friday",a8],["saturday",o8],["sunday",s8],["week",e8],["month",U2],["year",F2]]),Js=Symbol("intervalDuration"),Td=Symbol("intervalType");for(let[e,t]of X2)t[Js]=ag.get(e),t[Td]="time";for(let[e,t]of og)t[Js]=ag.get(e),t[Td]="utc";var Ml=[["year",F2,"utc"],["month",U2,"utc"],["day",P2,"utc",6*Lo],["hour",M2,"utc",3*Ui],["minute",D2,"utc",6*Ua],["second",L2,"utc",30*Pa]],Sd=[["year",q2,"time"],["month",H2,"time"],["day",W2,"time",6*Lo],["hour",V2,"time",3*Ui],["minute",j2,"time",6*Ua],["second",G2,"time",30*Pa]],g8=[Ml[0],Sd[0],Ml[1],Sd[1],Ml[2],Sd[2],...Ml.slice(3)];function K2(e){let t=`${e}`.toLowerCase();t.endsWith("s")&&(t=t.slice(0,-1));let r=1,n=/^(?:(\d+)\s+)/.exec(t);switch(n&&(t=t.slice(n[0].length),r=+n[1]),t){case"quarter":t="month",r*=3;break;case"half":t="month",r*=6;break}let i=og.get(t);if(!i)throw new Error(`unknown interval: ${e}`);if(r>1&&!i.every)throw new Error(`non-periodic interval: ${t}`);return[t,r]}function sg(e){return Y2(K2(e),"time")}function Pl(e){return Y2(K2(e),"utc")}function Y2([e,t],r){let n=(r==="time"?X2:og).get(e);return t>1&&(n=n.every(t),n[Js]=ag.get(e)*t,n[Td]=r),n}function ug(e,t){if(!(t>1))return;let r=e[Js];if(!ig.some(([,i])=>i===r)||r%Ui===0&&Ui<r&&r<Lo)return;let[n]=ig[KB(([,i])=>Math.log(i)).center(ig,Math.log(r*t))];return(e[Td]==="time"?sg:Pl)(n)}function N2(e,t,r){let n=t==="time"?QB:JB;if(r==null)return n(e==="year"?"%Y":e==="month"?"%Y-%m":e==="day"?"%Y-%m-%d":e==="hour"||e==="minute"?"%Y-%m-%dT%H:%M":e==="second"?"%Y-%m-%dT%H:%M:%S":"%Y-%m-%dT%H:%M:%S.%L");let i=y8(r);switch(e){case"millisecond":return Zs(n(".%L"),n(":%M:%S"),i);case"second":return Zs(n(":%S"),n("%-I:%M"),i);case"minute":return Zs(n("%-I:%M"),n("%p"),i);case"hour":return Zs(n("%-I %p"),n("%b %-d"),i);case"day":return Zs(n("%-d"),n("%b"),i);case"month":return Zs(n("%b"),n("%Y"),i);case"year":return n("%Y")}throw new Error("unable to format time ticks")}function y8(e){return e==="left"||e==="right"?(t,r)=>`
${t}
${r}`:e==="top"?(t,r)=>`${r}
${t}`:(t,r)=>`${t}
${r}`}function b8(e){return e==="time"?Sd:e==="utc"?Ml:g8}function Z2(e,t,r){let n=YB(ZB(t,(i,a)=>Math.abs(a-i)));if(n<1e3)return N2("millisecond","utc",r);for(let[i,a,o,s]of b8(e)){if(n>s||i==="hour"&&!n)break;if(t.every(u=>a.floor(u)>=u))return N2(i,o,r)}}function Zs(e,t,r){return(n,i,a)=>{let o=e(n,i),s=t(n,i),u=i-sa(a);return i!==u&&a[u]!==void 0&&s===t(a[u],u)?o:r(o,s)}}var cg=Object.getPrototypeOf(Uint8Array),v8=Object.prototype.toString;function ci(e){return e instanceof Array||e instanceof cg}function tv(e){return e instanceof cg&&!_8(e)}function rv(e){return e?.prototype instanceof cg&&!x8(e)}function _8(e){return e instanceof BigInt64Array||e instanceof BigUint64Array}function x8(e){return e===BigInt64Array||e===BigUint64Array}var fg=Symbol("reindex");function Er(e,t,r){let n=typeof t;return n==="string"?vv(e)?dg(e.getChild(t),r):J2(e,pg(t),r):n==="function"?J2(e,t,r):n==="number"||t instanceof Date||n==="boolean"?pr(e,Bn(t),r):typeof t?.transform=="function"?lg(t.transform(e),r):$8(lg(t,r),e?.[fg])}function $8(e,t){return e!=null&&t?Id(e,t):e}function J2(e,t,r){return pr(e,rv(r)?(n,i)=>hg(t(n,i)):t,r)}function lg(e,t){return t===void 0?Fi(e):_v(e)?dg(e,t):e instanceof t?e:t.from(e,rv(t)&&!tv(e)?hg:void 0)}function dg(e,t){return e==null?e:(t===void 0||t===Array)&&A8(e.type)?mg(ev(e)):lg(ev(e),t)}function ev(e){return e.nullCount?e.toJSON():e.toArray()}var eu=[null],pg=e=>t=>{let r=t[e];return r===void 0&&t.type==="Feature"?t.properties?.[e]:r},tu={transform:vn},Cr={transform:e=>e};var nv=()=>1,iv=()=>!0,jr=e=>e==null?e:`${e}`,Vr=e=>e==null?e:+e;var Ad=e=>e?e[0]:void 0,Ul=e=>e?e[1]:void 0;var Bn=e=>()=>e;function av(e){let t=+`${e}`.slice(1)/100;return(r,n)=>w8(r,t,n)}function Do(e){return tv(e)?e:pr(e,hg,Float64Array)}function hg(e){return e==null?NaN:Number(e)}function mg(e){return pr(e,gg)}function gg(e){return e instanceof Date&&!isNaN(e)?e:typeof e=="string"?Dl(e):e==null||isNaN(e=Number(e))?void 0:new Date(e)}function kn(e,t){return e===void 0&&(e=t),e===null?[void 0,"none"]:au(e)?[void 0,e]:[e,void 0]}function Nr(e,t){return e===void 0&&(e=t),e===null||typeof e=="number"?[void 0,e]:[e,void 0]}function yg(e,t,r){if(e!=null)return wn(e,t,r)}function wn(e,t,r){let n=`${e}`.toLowerCase();if(!r.includes(n))throw new Error(`invalid ${t}: ${e}`);return n}function ua(e){return vv(e)?e:Fi(e)}function Fi(e){if(e==null||ci(e))return e;if(_v(e))return dg(e);if(ov(e))switch(e.type){case"FeatureCollection":return e.features;case"GeometryCollection":return e.geometries;default:return[e]}return Array.from(e)}function ov(e){switch(e?.type){case"FeatureCollection":case"GeometryCollection":case"Feature":case"LineString":case"MultiLineString":case"MultiPoint":case"MultiPolygon":case"Point":case"Polygon":case"Sphere":return!0;default:return!1}}function pr(e,t,r=Array){return e==null?e:e instanceof r?e.map(t):r.from(e,t)}function Fa(e,t=Array){return e instanceof t?e.slice():t.from(e)}function sv({y:e,y1:t,y2:r}){return e!==void 0||t!==void 0||r!==void 0}function fi(e){return e?.toString===v8}function ru(e){return fi(e)&&(e.type!==void 0||e.domain!==void 0)}function nu(e){return fi(e)&&typeof e.transform!="function"}function Ga(e){return nu(e)&&e.value===void 0&&e.channel===void 0}function uv(e,t,r,n=Cr){return t===void 0&&r===void 0?(t=0,r=e===void 0?n:e):t===void 0?t=e===void 0?0:e:r===void 0&&(r=e===void 0?0:e),[t,r]}function la(e,t){return e===void 0&&t===void 0?[Ad,Ul]:[e,t]}function kd({z:e,fill:t,stroke:r}={}){return e===void 0&&([e]=kn(t)),e===void 0&&([e]=kn(r)),e}function ja(e){return ci(e)?e.length:e?.numRows}function vn(e){let t=ja(e),r=new Uint32Array(t);for(let n=0;n<t;++n)r[n]=n;return r}function Id(e,t){return ci(e)?pr(t,r=>e[r],e.constructor):pr(t,r=>e.at(r))}function lv(e,t,r){return e.subarray?e.subarray(t,r):e.slice(t,r)}function qn(e){return e!==null&&typeof e=="object"?e.valueOf():e}function cv(e,t){if(t[e]!==void 0)return t[e];switch(e){case"x1":case"x2":e="x";break;case"y1":case"y2":e="y";break}return t[e]}function iu(e){let t;return[{transform:()=>t,label:di(e)},r=>t=r]}function Xn(e){return e==null?[e]:iu(e)}function di(e,t){return typeof e=="string"?e:e&&e.label!==void 0?e.label:t}function Fl(e,t){return{transform(r){let n=e.transform(r),i=t.transform(r);return Gr(n)||Gr(i)?pr(n,(a,o)=>new Date((+n[o]+ +i[o])/2)):pr(n,(a,o)=>(+n[o]+ +i[o])/2,Float64Array)},label:e.label}}function Gl(e,t){let r=bg(t?.interval,t?.type);return r?pr(e,r):e}function bg(e,t){let r=Cd(e,t);return r&&(n=>Hn(n)?r.floor(n):n)}function Cd(e,t){if(e!=null){if(typeof e=="number")return E8(e);if(typeof e=="string")return(t==="time"?sg:Pl)(e);if(typeof e.floor!="function")throw new Error("invalid interval; missing floor method");if(typeof e.offset!="function")throw new Error("invalid interval; missing offset method");return e}}function E8(e){e=+e,0<e&&e<1&&Number.isInteger(1/e)&&(e=-1/e);let t=Math.abs(e);return e<0?{floor:r=>Math.floor(r*t)/t,offset:(r,n=1)=>(r*t+Math.floor(n))/t,range:(r,n)=>Q2(Math.ceil(r*t),n*t).map(i=>i/t)}:{floor:r=>Math.floor(r/t)*t,offset:(r,n=1)=>r+t*Math.floor(n),range:(r,n)=>Q2(Math.ceil(r/t),n/t).map(i=>i*t)}}function Gi(e,t){if(e=Cd(e,t),e&&typeof e.range!="function")throw new Error("invalid interval: missing range method");return e}function fv(e,t){if(e=Gi(e,t),e&&typeof e.ceil!="function")throw new Error("invalid interval: missing ceil method");return e}function dv(e){return Va(e)&&typeof e?.floor=="function"&&e.floor()instanceof Date}function Va(e){return typeof e?.range=="function"}function ji(e){return e===void 0||nu(e)?e:{value:e}}function pv(e){return e==null?null:{transform:t=>Er(t,e,Float64Array),label:di(e)}}function In(e){return e&&typeof e[Symbol.iterator]=="function"}function Od(e){for(let t of e)if(t!=null)return typeof t!="object"||t instanceof Date}function wg(e){for(let t of e){if(t==null)continue;let r=typeof t;return r==="string"||r==="boolean"}}function Gr(e){for(let t of e)if(t!=null)return t instanceof Date}function hv(e){for(let t of e)if(t!=null)return typeof t=="string"&&isNaN(t)&&Dl(t)}function mv(e){for(let t of e)if(t!=null){if(typeof t!="string")return!1;if(t.trim())return!isNaN(t)}}function gv(e){for(let t of e)if(t!=null)return typeof t=="number"}function Bd(e,t){let r;for(let n of e)if(n!=null){if(!t(n))return!1;r=!0}return r}var S8=new Set("none,currentcolor,transparent,aliceblue,antiquewhite,aqua,aquamarine,azure,beige,bisque,black,blanchedalmond,blue,blueviolet,brown,burlywood,cadetblue,chartreuse,chocolate,coral,cornflowerblue,cornsilk,crimson,cyan,darkblue,darkcyan,darkgoldenrod,darkgray,darkgreen,darkgrey,darkkhaki,darkmagenta,darkolivegreen,darkorange,darkorchid,darkred,darksalmon,darkseagreen,darkslateblue,darkslategray,darkslategrey,darkturquoise,darkviolet,deeppink,deepskyblue,dimgray,dimgrey,dodgerblue,firebrick,floralwhite,forestgreen,fuchsia,gainsboro,ghostwhite,gold,goldenrod,gray,green,greenyellow,grey,honeydew,hotpink,indianred,indigo,ivory,khaki,lavender,lavenderblush,lawngreen,lemonchiffon,lightblue,lightcoral,lightcyan,lightgoldenrodyellow,lightgray,lightgreen,lightgrey,lightpink,lightsalmon,lightseagreen,lightskyblue,lightslategray,lightslategrey,lightsteelblue,lightyellow,lime,limegreen,linen,magenta,maroon,mediumaquamarine,mediumblue,mediumorchid,mediumpurple,mediumseagreen,mediumslateblue,mediumspringgreen,mediumturquoise,mediumvioletred,midnightblue,mintcream,mistyrose,moccasin,navajowhite,navy,oldlace,olive,olivedrab,orange,orangered,orchid,palegoldenrod,palegreen,paleturquoise,palevioletred,papayawhip,peachpuff,peru,pink,plum,powderblue,purple,rebeccapurple,red,rosybrown,royalblue,saddlebrown,salmon,sandybrown,seagreen,seashell,sienna,silver,skyblue,slateblue,slategray,slategrey,snow,springgreen,steelblue,tan,teal,thistle,tomato,turquoise,violet,wheat,white,whitesmoke,yellow".split(","));function au(e){return typeof e!="string"?!1:(e=e.toLowerCase().trim(),/^#[0-9a-f]{3,8}$/.test(e)||/^(?:url|var|rgb|rgba|hsl|hsla|hwb|lab|lch|oklab|oklch|color|color-mix)\(.*\)$/.test(e)||S8.has(e))}function yv(e){return typeof e=="number"&&(0<=e&&e<=1||isNaN(e))}function en(e){return e==null||Mo(e)}function Mo(e){return/^\s*none\s*$/i.test(e)}function bv(e){return/^\s*round\s*$/i.test(e)}function Rd(e,t){return yg(e,t,["middle","top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"])}function Wa(e="middle"){return Rd(e,"frameAnchor")}function wv(e={},...t){let r=e;for(let n of t)for(let i in n)if(r[i]===void 0){let a=n[i];r===e?r={...r,[i]:a}:r[i]=a}return r}function T8(e){console.warn("named iterables are deprecated; please use an object instead");let t=new Set;return Object.fromEntries(Array.from(e,r=>{let{name:n}=r;if(n==null)throw new Error("missing name");let i=`${n}`;if(i==="__proto__")throw new Error(`illegal name: ${i}`);if(t.has(i))throw new Error(`duplicate name: ${i}`);return t.add(i),[n,r]}))}function vg(e){return In(e)?T8(e):e}function zd(e){return e===!0?e="frame":e===!1?e=null:!ov(e)&&e!=null&&(e=wn(e,"clip",["frame","sphere"]),e==="sphere"&&(e={type:"Sphere"})),e}function vv(e){return e&&typeof e.getChild=="function"&&typeof e.toArray=="function"&&e.schema&&Array.isArray(e.schema.fields)}function _v(e){return e&&typeof e.toArray=="function"&&e.type}function A8(e){return e&&(e.typeId===8||e.typeId===10)&&e.unit===1}var Kn=Symbol("position"),Rn=Symbol("color"),Po=Symbol("radius"),Uo=Symbol("length"),Fo=Symbol("opacity"),ou=Symbol("symbol"),xv=Symbol("projection"),hr=new Map([["x",Kn],["y",Kn],["fx",Kn],["fy",Kn],["r",Po],["color",Rn],["opacity",Fo],["symbol",ou],["length",Uo],["projection",xv]]);function $v(e){return e===Kn||e===xv}function Ev(e){return e===Kn||e===Po||e===Uo||e===Fo}import{symbolAsterisk as k8,symbolDiamond2 as I8,symbolPlus as C8,symbolSquare2 as O8,symbolTriangle2 as B8,symbolTimes as R8}from"d3";import{symbolCircle as z8,symbolCross as N8,symbolDiamond as L8,symbolSquare as D8,symbolStar as M8,symbolTriangle as P8,symbolWye as U8}from"d3";var F8=Math.sqrt(3),G8=2/F8,j8={draw(e,t){let r=Math.sqrt(t/Math.PI),n=r*G8,i=n/2;e.moveTo(0,n),e.lineTo(r,i),e.lineTo(r,-i),e.lineTo(0,-n),e.lineTo(-r,-i),e.lineTo(-r,i),e.closePath()}},_g=new Map([["asterisk",k8],["circle",z8],["cross",N8],["diamond",L8],["diamond2",I8],["hexagon",j8],["plus",C8],["square",D8],["square2",O8],["star",M8],["times",R8],["triangle",P8],["triangle2",B8],["wye",U8]]);function xg(e){return e&&typeof e.draw=="function"}function Sv(e){return xg(e)?!0:typeof e!="string"?!1:_g.has(e.toLowerCase())}function su(e){if(e==null||xg(e))return e;let t=_g.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid symbol: ${e}`)}function Tv(e){if(e==null||xg(e))return[void 0,e];if(typeof e=="string"){let t=_g.get(`${e}`.toLowerCase());if(t)return[void 0,t]}return[e,void 0]}import{InternSet as q8,group as X8,rollup as K8,sort as Y8}from"d3";import{deviation as Z8,max as Q8,maxIndex as J8,mean as eR,median as tR,min as rR,minIndex as nR,mode as iR,sum as Tg,variance as aR}from"d3";import{randomLcg as xH}from"d3";function Go({filter:e,sort:t,reverse:r,transform:n,initializer:i,...a}={},o){if(n===void 0&&(e!=null&&(n=Av(e)),t!=null&&!Ga(t)&&(n=$g(n,Sg(t))),r&&(n=$g(n,kv))),o!=null&&i!=null)throw new Error("transforms cannot be applied after initializers");return{...a,...(t===null||Ga(t))&&{sort:t},transform:$g(n,o)}}function ca({filter:e,sort:t,reverse:r,initializer:n,...i}={},a){return n===void 0&&(e!=null&&(n=Av(e)),t!=null&&!Ga(t)&&(n=Eg(n,Sg(t))),r&&(n=Eg(n,kv))),{...i,...(t===null||Ga(t))&&{sort:t},initializer:Eg(n,a)}}function $g(e,t){return e==null?t===null?void 0:t:t==null?e===null?void 0:e:function(r,n,i){return{data:r,facets:n}=e.call(this,r,n,i),t.call(this,ua(r),n,i)}}function Eg(e,t){return e==null?t===null?void 0:t:t==null?e===null?void 0:e:function(r,n,i,...a){let o,s,u,l,c,f;return{data:s=r,facets:u=n,channels:o}=e.call(this,r,n,i,...a),{data:c=s,facets:f=u,channels:l}=t.call(this,s,u,{...i,...o},...a),{data:c,facets:f,channels:{...o,...l}}}}function V8(e,t){return(e.initializer!=null?ca:Go)(e,t)}function Av(e){return(t,r)=>{let n=Er(t,e);return{data:t,facets:r.map(i=>i.filter(a=>n[a]))}}}function kv(e,t){return{data:e,facets:t.map(r=>r.slice().reverse())}}function Iv(e,{sort:t,...r}={}){return{...(nu(e)&&e.channel!==void 0?ca:V8)(r,Sg(e)),sort:Ga(t)?t:null}}function Sg(e){return(typeof e=="function"&&e.length!==1?W8:H8)(e)}function W8(e){return(t,r)=>{let n=ci(t)?(i,a)=>e(t[i],t[a]):(i,a)=>e(t.get(i),t.get(a));return{data:t,facets:r.map(i=>i.slice().sort(n))}}}function H8(e){let t,r;({channel:t,value:e,order:r}={...ji(e)});let n=t?.startsWith("-");if(n&&(t=t.slice(1)),r===void 0&&(r=n?zo:pn),typeof r!="function")switch(`${r}`.toLowerCase()){case"ascending":r=pn;break;case"descending":r=zo;break;default:throw new Error(`invalid order: ${r}`)}return(i,a,o)=>{let s;if(t===void 0)s=Er(i,e);else{if(o===void 0)throw new Error("channel sort requires an initializer");if(s=o[t],!s)return{};s=s.value}let u=(l,c)=>r(s[l],s[c]);return{data:i,facets:a.map(l=>l.slice().sort(u))}}}function Vl(e,...t){for(let{name:r}of e)if(t.includes(r))return!0;return!1}function Bv(e,t,r=Ag){let n=Object.entries(e);return t.title!=null&&e.title===void 0&&n.push(["title",cR]),t.href!=null&&e.href===void 0&&n.push(["href",Nd]),n.filter(([,i])=>i!==void 0).map(([i,a])=>a===null?oR(i):r(i,a,t))}function Ag(e,t,r,n=kg){let i;fi(t)&&"reduce"in t&&(i=t.scale,t=t.reduce);let a=n(e,t,r),[o,s]=iu(a.label),u;return{name:e,output:i===void 0?o:{value:o,scale:i},initialize(l){a.initialize(l),u=s([])},scope(l,c){a.scope(l,c)},reduce(l,c){u.push(a.reduce(l,c))}}}function oR(e){return{name:e,initialize(){},scope(){},reduce(){}}}function kg(e,t,r,n=Wl){let i=cv(e,r),a=n(t,i),o,s;return{label:di(a===jl?null:i,a.label),initialize(u){o=i===void 0?u:Er(u,i),a.scope==="data"&&(s=a.reduceIndex(vn(u),o))},scope(u,l){a.scope===u&&(s=a.reduceIndex(l,o))},reduce(u,l){return a.scope==null?a.reduceIndex(u,o,l):a.reduceIndex(u,o,s,l)}}}function Ig(e,t){return t?X8(e,r=>t[r]):[[,e]]}function Wl(e,t,r=sR){if(e==null)return r(e);if(typeof e.reduceIndex=="function")return e;if(typeof e.reduce=="function"&&fi(e))return uR(e);if(typeof e=="function")return lR(e);if(/^p\d{2}$/i.test(e))return fa(av(e));switch(`${e}`.toLowerCase()){case"first":return Nd;case"last":return fR;case"identity":return Cg;case"count":return jl;case"distinct":return dR;case"sum":return t==null?jl:pR;case"proportion":return Ov(t,"data");case"proportion-facet":return Ov(t,"facet");case"deviation":return fa(Z8);case"min":return fa(rR);case"min-index":return fa(nR);case"max":return fa(Q8);case"max-index":return fa(J8);case"mean":return Cv(eR);case"median":return Cv(tR);case"variance":return fa(aR);case"mode":return fa(iR)}return r(e)}function sR(e){throw new Error(`invalid reduce: ${e}`)}function Rv(e,t){for(let r in t){let n=t[r];if(n!==void 0&&!e.some(i=>i.name===r))return n}}function zv(e,t,r){if(t){let n=t.output.transform(),i=(a,o)=>pn(n[a],n[o]);e.forEach(a=>a.sort(i))}r&&e.forEach(n=>n.reverse())}function uR(e){return console.warn("deprecated reduce interface; implement reduceIndex instead."),{...e,reduceIndex:e.reduce.bind(e)}}function lR(e){return{reduceIndex(t,r,n){return e(Id(r,t),n)}}}function fa(e){return{reduceIndex(t,r){return e(t,n=>r[n])}}}function Cv(e){return{reduceIndex(t,r){let n=e(t,i=>r[i]);return Gr(r)?new Date(n):n}}}var Cg={reduceIndex(e,t){return Id(t,e)}},Nd={reduceIndex(e,t){return t[e[0]]}},cR={reduceIndex(e,t){let n=Y8(K8(e,a=>a.length,a=>t[a]),Ul),i=n.slice(-5).reverse();if(i.length<n.length){let a=n.slice(0,-4);i[4]=[`\u2026 ${a.length.toLocaleString("en-US")} more`,Tg(a,Ul)]}return i.map(([a,o])=>`${a} (${o.toLocaleString("en-US")})`).join(`
`)}},fR={reduceIndex(e,t){return t[e[e.length-1]]}},jl={label:"Frequency",reduceIndex(e){return e.length}},dR={label:"Distinct",reduceIndex(e,t){let r=new q8;for(let n of e)r.add(t[n]);return r.size}},pR=fa(Tg);function Ov(e,t){return e==null?{scope:t,label:"Frequency",reduceIndex:(r,n,i=1)=>r.length/i}:{scope:t,reduceIndex:(r,n,i=1)=>Tg(r,a=>n[a])/i}}var Nv={reduceIndex(e,t,{z:r}){return r}};function uu(e,{scale:t,type:r,value:n,filter:i,hint:a,label:o=di(n)},s){return a===void 0&&typeof n?.transform=="function"&&(a=n.hint),Bg(s,{scale:t,type:r,value:Er(e,n),label:o,filter:i,hint:a})}function Dv(e,t){return Object.fromEntries(Object.entries(e).map(([r,n])=>[r,uu(t,n,r)]))}function Mv(e,t){let r=Object.fromEntries(Object.entries(e).map(([n,{scale:i,value:a}])=>{let o=i==null?null:t[i];return[n,o==null?a:pr(a,o)]}));return r.channels=e,r}function Bg(e,t){let{scale:r,value:n}=t;if(r===!0||r==="auto")switch(e){case"fill":case"stroke":case"color":t.scale=r!==!0&&Bd(n,au)?null:"color",t.defaultScale="color";break;case"fillOpacity":case"strokeOpacity":case"opacity":t.scale=r!==!0&&Bd(n,yv)?null:"opacity",t.defaultScale="opacity";break;case"symbol":r!==!0&&Bd(n,Sv)?(t.scale=null,t.value=pr(n,su)):t.scale="symbol",t.defaultScale="symbol";break;default:t.scale=hr.has(e)?e:null;break}else if(r===!1)t.scale=null;else if(r!=null&&!hr.has(r))throw new Error(`unknown scale: ${r}`);return t}function Pv(e,t,r,n,i){let{order:a,reverse:o,reduce:s=!0,limit:u}=i;for(let l in i){if(!hr.has(l))continue;let{value:c,order:f=a,reverse:p=o,reduce:d=s,limit:m=u}=ji(i[l]),g=c?.startsWith("-");if(g&&(c=c.slice(1)),f=f===void 0?g!==(c==="width"||c==="height")?Fv:Uv:bR(f),d==null||d===!1)continue;let x=l==="fx"||l==="fy"?yR(t,n[l]):gR(r,l);if(!x)throw new Error(`missing channel for scale: ${l}`);let b=x.value,[y=0,E=1/0]=In(m)?m:m<0?[m]:[0,m];if(c==null)x.domain=()=>{let $=Array.from(new hR(b));return p&&($=$.reverse()),(y!==0||E!==1/0)&&($=$.slice(y,E)),$};else{let $=c==="data"?e:c==="height"?Lv(r,"y1","y2"):c==="width"?Lv(r,"x1","x2"):Og(r,c,c==="y"?"y2":c==="x"?"x2":void 0),k=Wl(d===!0?"max":d,$);x.domain=()=>{let R=mR(vn(b),C=>k.reduceIndex(C,$),C=>b[C]);return f&&R.sort(f),p&&R.reverse(),(y!==0||E!==1/0)&&(R=R.slice(y,E)),R.map(Ad)}}}}function gR(e,t){for(let r in e){let n=e[r];if(n.scale===t)return n}}function yR(e,t){let r=e.original;if(r===e)return t;let n=t.value,i=t.value=[];for(let a=0;a<r.length;++a){let o=n[r[a][0]];for(let s of e[a])i[s]=o}return t}function Lv(e,t,r){let n=Og(e,t),i=Og(e,r);return pr(i,(a,o)=>Math.abs(a-n[o]),Float64Array)}function Og(e,t,r){let n=e[t];if(!n&&r!==void 0&&(n=e[r]),n)return n.value;throw new Error(`missing channel: ${t}`)}function bR(e){if(e==null||typeof e=="function")return e;switch(`${e}`.toLowerCase()){case"ascending":return Uv;case"descending":return Fv}throw new Error(`invalid order: ${e}`)}function Uv([e,t],[r,n]){return pn(t,n)||pn(e,r)}function Fv([e,t],[r,n]){return zo(t,n)||pn(e,r)}function Rg(e,t){let r=e[t];if(r){for(;r.source;)r=r.source;return r.source===null?null:r}}import{InternMap as iN,cross as aN,rollup as Xg,sum as oN}from"d3";import{descending as rz,extent as P_,interpolateHcl as nz,interpolateHsl as iz,interpolateLab as az,interpolateNumber as Dg,interpolateRgb as U_,interpolateRound as oz,max as cu,median as z_,min as N_,piecewise as sz,quantile as L_,quantize as Md,reverse as Lg,scaleIdentity as uz,scaleLinear as lz,scaleLog as cz,scalePow as fz,scaleQuantile as dz,scaleSymlog as pz,scaleThreshold as hz,ticks as mz}from"d3";import{interpolateBlues as Xv,interpolateBrBG as Kv,interpolateBuGn as Yv,interpolateBuPu as Zv,interpolateGnBu as Qv,interpolateGreens as Jv,interpolateGreys as e_,interpolateOranges as t_,interpolateOrRd as r_,interpolatePiYG as n_,interpolatePRGn as i_,interpolatePuBu as a_,interpolatePuBuGn as o_,interpolatePuOr as s_,interpolatePuRd as u_,interpolatePurples as l_,interpolateRdBu as Ld,interpolateRdGy as c_,interpolateRdPu as f_,interpolateRdYlBu as Dd,interpolateRdYlGn as d_,interpolateReds as p_,interpolateSpectral as h_,interpolateYlGn as m_,interpolateYlGnBu as g_,interpolateYlOrBr as y_,interpolateYlOrRd as b_,interpolateTurbo as w_,interpolateViridis as v_,interpolateMagma as __,interpolateInferno as x_,interpolatePlasma as $_,interpolateCividis as E_,interpolateCubehelixDefault as S_,interpolateWarm as T_,interpolateCool as A_,interpolateRainbow as k_,interpolateSinebow as I_,quantize as Hl,schemeAccent as wR,schemeBlues as vR,schemeBrBG as _R,schemeBuGn as xR,schemeBuPu as $R,schemeCategory10 as ER,schemeDark2 as SR,schemeGnBu as TR,schemeGreens as AR,schemeGreys as kR,schemeObservable10 as IR,schemeOranges as CR,schemeOrRd as OR,schemePaired as BR,schemePastel1 as RR,schemePastel2 as zR,schemePiYG as NR,schemePRGn as LR,schemePuBu as DR,schemePuBuGn as MR,schemePuOr as PR,schemePuRd as UR,schemePurples as FR,schemeRdBu as Gv,schemeRdGy as GR,schemeRdPu as jR,schemeRdYlBu as jv,schemeRdYlGn as VR,schemeReds as WR,schemeSet1 as HR,schemeSet2 as qR,schemeSet3 as XR,schemeSpectral as KR,schemeTableau10 as YR,schemeYlGn as ZR,schemeYlGnBu as QR,schemeYlOrBr as JR,schemeYlOrRd as ez}from"d3";var C_=new Map([["accent",wR],["category10",ER],["dark2",SR],["observable10",IR],["paired",BR],["pastel1",RR],["pastel2",zR],["set1",HR],["set2",qR],["set3",XR],["tableau10",YR]]);function O_(e){return e!=null&&C_.has(`${e}`.toLowerCase())}var Vv=new Map([...C_,["brbg",da(_R,Kv)],["prgn",da(LR,i_)],["piyg",da(NR,n_)],["puor",da(PR,s_)],["rdbu",da(Gv,Ld)],["rdgy",da(GR,c_)],["rdylbu",da(jv,Dd)],["rdylgn",da(VR,d_)],["spectral",da(KR,h_)],["burd",Wv(Gv,Ld)],["buylrd",Wv(jv,Dd)],["blues",tn(vR,Xv)],["greens",tn(AR,Jv)],["greys",tn(kR,e_)],["oranges",tn(CR,t_)],["purples",tn(FR,l_)],["reds",tn(WR,p_)],["turbo",pa(w_)],["viridis",pa(v_)],["magma",pa(__)],["inferno",pa(x_)],["plasma",pa($_)],["cividis",pa(E_)],["cubehelix",pa(S_)],["warm",pa(T_)],["cool",pa(A_)],["bugn",tn(xR,Yv)],["bupu",tn($R,Zv)],["gnbu",tn(TR,Qv)],["orrd",tn(OR,r_)],["pubu",tn(DR,a_)],["pubugn",tn(MR,o_)],["purd",tn(UR,u_)],["rdpu",tn(jR,f_)],["ylgn",tn(ZR,m_)],["ylgnbu",tn(QR,g_)],["ylorbr",tn(JR,y_)],["ylorrd",tn(ez,b_)],["rainbow",Hv(k_)],["sinebow",Hv(I_)]]);function tn(e,t){return({length:r})=>r===1?[e[3][1]]:r===2?[e[3][1],e[3][2]]:(r=Math.max(3,Math.floor(r)),r>9?Hl(t,r):e[r])}function da(e,t){return({length:r})=>r===2?[e[3][0],e[3][2]]:(r=Math.max(3,Math.floor(r)),r>11?Hl(t,r):e[r])}function Wv(e,t){return({length:r})=>r===2?[e[3][2],e[3][0]]:(r=Math.max(3,Math.floor(r)),r>11?Hl(n=>t(1-n),r):e[r].slice().reverse())}function pa(e){return({length:t})=>Hl(e,Math.max(2,Math.floor(t)))}function Hv(e){return({length:t})=>Hl(e,Math.floor(t)+1).slice(0,-1)}function zg(e){let t=`${e}`.toLowerCase();if(!Vv.has(t))throw new Error(`unknown ordinal scheme: ${t}`);return Vv.get(t)}function ql(e,t){let r=zg(e),n=typeof r=="function"?r({length:t}):r;return n.length!==t?n.slice(0,t):n}function B_(e,t="greys"){let r=new Set,[n,i]=ql(t,2);for(let a of e)if(a!=null)if(a===!0)r.add(i);else if(a===!1)r.add(n);else return;return[...r]}var qv=new Map([["brbg",Kv],["prgn",i_],["piyg",n_],["puor",s_],["rdbu",Ld],["rdgy",c_],["rdylbu",Dd],["rdylgn",d_],["spectral",h_],["burd",e=>Ld(1-e)],["buylrd",e=>Dd(1-e)],["blues",Xv],["greens",Jv],["greys",e_],["purples",l_],["reds",p_],["oranges",t_],["turbo",w_],["viridis",v_],["magma",__],["inferno",x_],["plasma",$_],["cividis",E_],["cubehelix",S_],["warm",T_],["cool",A_],["bugn",Yv],["bupu",Zv],["gnbu",Qv],["orrd",r_],["pubugn",o_],["pubu",a_],["purd",u_],["rdpu",f_],["ylgnbu",g_],["ylgn",m_],["ylorbr",y_],["ylorrd",b_],["rainbow",k_],["sinebow",I_]]);function lu(e){let t=`${e}`.toLowerCase();if(!qv.has(t))throw new Error(`unknown quantitative scheme: ${t}`);return qv.get(t)}var tz=new Set(["brbg","prgn","piyg","puor","rdbu","rdgy","rdylbu","rdylgn","spectral","burd","buylrd"]);function R_(e){return e!=null&&tz.has(`${e}`.toLowerCase())}var Mg=e=>t=>e(1-t),Ng=[0,1],D_=new Map([["number",Dg],["rgb",U_],["hsl",iz],["hcl",nz],["lab",az]]);function Pg(e){let t=`${e}`.toLowerCase();if(!D_.has(t))throw new Error(`unknown interpolator: ${t}`);return D_.get(t)}function du(e,t,r,{type:n,nice:i,clamp:a,zero:o,domain:s=X_(e,r),unknown:u,round:l,scheme:c,interval:f,range:p=hr.get(e)===Po?wz(r,s):hr.get(e)===Uo?vz(r,s):hr.get(e)===Fo?Ng:void 0,interpolate:d=hr.get(e)===Rn?c==null&&p!==void 0?U_:lu(c!==void 0?c:n==="cyclical"?"rainbow":"turbo"):l?oz:Dg,reverse:m}){if(s=M_(s),f=Gi(f,n),(n==="cyclical"||n==="sequential")&&(n="linear"),typeof d!="function"&&(d=Pg(d)),m=!!m,p!==void 0){let g=s.length,x=(p=M_(p)).length;if(g!==x){if(d.length===1)throw new Error("invalid piecewise interpolator");d=sz(d,p),p=void 0}}if(d.length===1?(m&&(d=Mg(d),m=!1),p===void 0&&(p=Float64Array.from(s,(g,x)=>x/(s.length-1)),p.length===2&&(p=Ng)),t.interpolate((p===Ng?Bn:Xl)(d))):t.interpolate(d),o){let[g,x]=P_(s);(g>0||x<0)&&(s=Fa(s),(sa(s)||1)===Math.sign(g)?s[0]=0:s[s.length-1]=0)}return m&&(s=Lg(s)),t.domain(s).unknown(u),i&&(t.nice(gz(i,n)),s=t.domain()),p!==void 0&&t.range(p),a&&t.clamp(a),{type:n,domain:s,range:p,scale:t,interpolate:d,interval:f}}function M_(e){return e=Fi(e),e.length>=2?e:[e[0],e[0]]}function gz(e,t){return e===!0?void 0:typeof e=="number"?e:fv(e,t)}function F_(e,t,r){return du(e,lz(),t,r)}function G_(e,t,r){return Ug(e,t,{...r,exponent:.5})}function Ug(e,t,{exponent:r=1,...n}){return du(e,fz().exponent(r),t,{...n,type:"pow"})}function j_(e,t,{base:r=10,domain:n=_z(t),...i}){return du(e,cz().base(r),t,{...i,domain:n})}function V_(e,t,{constant:r=1,...n}){return du(e,pz().constant(r),t,n)}function W_(e,t,{range:r,quantiles:n=r===void 0?5:(r=[...r]).length,n:i=n,scheme:a="rdylbu",domain:o=xz(t),unknown:s,interpolate:u,reverse:l}){return r===void 0&&(r=u!==void 0?Md(u,i):hr.get(e)===Rn?ql(a,i):void 0),o.length>0&&(o=dz(o,r===void 0?{length:i}:r).quantiles()),Pd(e,t,{domain:o,range:r,reverse:l,unknown:s})}function H_(e,t,{range:r,n=r===void 0?5:(r=[...r]).length,scheme:i="rdylbu",domain:a=X_(e,t),unknown:o,interpolate:s,reverse:u}){let[l,c]=P_(a),f;return r===void 0?(f=mz(l,c,n),f[0]<=l&&f.splice(0,1),f[f.length-1]>=c&&f.pop(),n=f.length+1,r=s!==void 0?Md(s,n):hr.get(e)===Rn?ql(i,n):void 0):(f=Md(Dg(l,c),n+1).slice(1,-1),l instanceof Date&&(f=f.map(p=>new Date(p)))),sa(Fi(a))<0&&f.reverse(),Pd(e,t,{domain:f,range:r,reverse:u,unknown:o})}function Pd(e,t,{domain:r=[0],unknown:n,scheme:i="rdylbu",interpolate:a,range:o=a!==void 0?Md(a,r.length+1):hr.get(e)===Rn?ql(i,r.length+1):void 0,reverse:s}){r=Fi(r);let u=sa(r);if(!isNaN(u)&&!yz(r,u))throw new Error(`the ${e} scale has a non-monotonic domain`);return s&&(o=Lg(o)),{type:"threshold",scale:hz(u<0?Lg(r):r,o===void 0?[]:o).unknown(n),domain:r,range:o}}function yz(e,t){for(let r=1,n=e.length,i=e[0];r<n;++r){let a=rz(i,i=e[r]);if(a!==0&&a!==t)return!1}return!0}function q_(e){return{type:"identity",scale:Ev(hr.get(e))?uz():t=>t}}function fu(e,t=ng){return e.length?[N_(e,({value:r})=>r===void 0?r:N_(r,t)),cu(e,({value:r})=>r===void 0?r:cu(r,t))]:[0,1]}function X_(e,t){let r=hr.get(e);return(r===Po||r===Fo||r===Uo?bz:fu)(t)}function bz(e){return[0,e.length?cu(e,({value:t})=>t===void 0?t:cu(t,ng)):1]}function wz(e,t){let r=e.find(({radius:o})=>o!==void 0);if(r!==void 0)return[0,r.radius];let n=L_(e,.5,({value:o})=>o===void 0?NaN:L_(o,.25,No)),i=t.map(o=>3*Math.sqrt(o/n)),a=30/cu(i);return a<1?i.map(o=>o*a):i}function vz(e,t){let r=z_(e,({value:a})=>a===void 0?NaN:z_(a,Math.abs)),n=t.map(a=>12*a/r),i=60/cu(n);return i<1?n.map(a=>a*i):n}function _z(e){for(let{value:t}of e)if(t!==void 0)for(let r of t){if(r>0)return fu(e,No);if(r<0)return fu(e,Ys)}return[1,10]}function xz(e){let t=[];for(let{value:r}of e)if(r!==void 0)for(let n of r)t.push(n);return t}function Xl(e){return(t,r)=>n=>e(t+n*(r-t))}import{descending as $z,interpolateNumber as Ez,interpolateRgb as Sz,piecewise as Tz,scaleDiverging as Az,scaleDivergingLog as kz,scaleDivergingPow as Iz,scaleDivergingSymlog as Cz}from"d3";var Fg=0,Gg;function K_(){let e=Fg;return Fg=0,Gg=void 0,e}function Cn(e){e!==Gg&&(Gg=e,console.warn(e),++Fg)}function Ud(e,t,r,n,{type:i,nice:a,clamp:o,domain:s=fu(n),unknown:u,pivot:l=0,scheme:c,range:f,symmetric:p=!0,interpolate:d=hr.get(e)===Rn?c==null&&f!==void 0?Sz:lu(c!==void 0?c:"rdbu"):Ez,reverse:m}){l=+l,s=Fi(s);let[g,x]=s;if(s.length>2&&Cn(`Warning: the diverging ${e} scale domain contains extra elements.`),$z(g,x)<0&&([g,x]=[x,g],m=!m),g=Math.min(g,l),x=Math.max(x,l),typeof d!="function"&&(d=Pg(d)),f!==void 0&&(d=d.length===1?Xl(d)(...f):Tz(d,f)),m&&(d=Mg(d)),p){let b=r.apply(l),y=b-r.apply(g),E=r.apply(x)-b;y<E?g=r.invert(b-E):y>E&&(x=r.invert(b+y))}return t.domain([g,l,x]).unknown(u).interpolator(d),o&&t.clamp(o),a&&t.nice(a),{type:i,domain:[g,x],pivot:l,interpolate:d,scale:t}}function Y_(e,t,r){return Ud(e,Az(),Oz,t,r)}function Z_(e,t,r){return jg(e,t,{...r,exponent:.5})}function jg(e,t,{exponent:r=1,...n}){return Ud(e,Iz().exponent(r=+r),zz(r),t,{...n,type:"diverging-pow"})}function Q_(e,t,{base:r=10,pivot:n=1,domain:i=fu(t,n<0?Ys:No),...a}){return Ud(e,kz().base(r=+r),Bz,t,{domain:i,pivot:n,...a})}function J_(e,t,{constant:r=1,...n}){return Ud(e,Cz().constant(r=+r),Nz(r),t,n)}var Oz={apply(e){return e},invert(e){return e}},Bz={apply:Math.log,invert:Math.exp},Rz={apply(e){return Math.sign(e)*Math.sqrt(Math.abs(e))},invert(e){return Math.sign(e)*(e*e)}};function zz(e){return e===.5?Rz:{apply(t){return Math.sign(t)*Math.pow(Math.abs(t),e)},invert(t){return Math.sign(t)*Math.pow(Math.abs(t),1/e)}}}function Nz(e){return{apply(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))},invert(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}}import{scaleTime as Lz,scaleUtc as Dz}from"d3";function ex(e,t,r,n){return du(e,t,r,n)}function tx(e,t,r){return ex(e,Lz(),t,r)}function rx(e,t,r){return ex(e,Dz(),t,r)}import{InternSet as Mz,extent as Pz,quantize as Uz,reverse as Fz,sort as Gz,symbolsFill as jz,symbolsStroke as Vz}from"d3";import{scaleBand as Wz,scaleOrdinal as Hz,scalePoint as qz,scaleImplicit as Xz}from"d3";var pu=Symbol("ordinal");function ix(e,t,r,{type:n,interval:i,domain:a,range:o,reverse:s,hint:u}){return i=Gi(i,n),a===void 0&&(a=lx(r,i,e)),(n==="categorical"||n===pu)&&(n="ordinal"),s&&(a=Fz(a)),a=t.domain(a).domain(),o!==void 0&&(typeof o=="function"&&(o=o(a)),t.range(o)),{type:n,domain:a,range:o,scale:t,hint:u,interval:i}}function ax(e,t,{type:r,interval:n,domain:i,range:a,scheme:o,unknown:s,...u}){n=Gi(n,r),i===void 0&&(i=lx(t,n,e));let l;if(hr.get(e)===ou)l=Kz(t),a=a===void 0?Yz(l):pr(a,su);else if(hr.get(e)===Rn&&(a===void 0&&(r==="ordinal"||r===pu)&&(a=B_(i,o),a!==void 0&&(o=void 0)),o===void 0&&a===void 0&&(o=r==="ordinal"?"turbo":"observable10"),o!==void 0))if(a!==void 0){let c=lu(o),f=a[0],p=a[1]-a[0];a=({length:d})=>Uz(m=>c(f+p*m),d)}else a=zg(o);if(s===Xz)throw new Error(`implicit unknown on ${e} scale is not supported`);return ix(e,Hz().unknown(s),t,{...u,type:r,domain:i,range:a,hint:l})}function ox(e,t,{align:r=.5,padding:n=.5,...i}){return ux(qz().align(r).padding(n),t,i,e)}function sx(e,t,{align:r=.5,padding:n=.1,paddingInner:i=n,paddingOuter:a=e==="fx"||e==="fy"?0:n,...o}){return ux(Wz().align(r).paddingInner(i).paddingOuter(a),t,o,e)}function ux(e,t,r,n){let{round:i}=r;return i!==void 0&&e.round(i=!!i),e=ix(n,e,t,r),e.round=i,e}function lx(e,t,r){let n=new Mz;for(let{value:i,domain:a}of e){if(a!==void 0)return a();if(i!==void 0)for(let o of i)n.add(o)}if(t!==void 0){let[i,a]=Pz(n).map(t.floor,t);return t.range(i,t.offset(a))}if(n.size>1e4&&hr.get(r)===Kn)throw new Error(`implicit ordinal domain of ${r} scale has more than 10,000 values`);return Gz(n,pn)}function nx(e,t){let r;for(let{hint:n}of e){let i=n?.[t];if(i!==void 0){if(r===void 0)r=i;else if(r!==i)return}}return r}function Kz(e){return{fill:nx(e,"fill"),stroke:nx(e,"stroke")}}function Yz(e){return en(e.fill)?Vz:jz}function Kl(e,{label:t,inset:r=0,insetTop:n=r,insetRight:i=r,insetBottom:a=r,insetLeft:o=r,round:s,nice:u,clamp:l,zero:c,align:f,padding:p,projection:d,facet:{label:m=t}={},...g}={}){let x={};for(let[b,y]of e){let E=g[b],$=Jz(b,y,{round:hr.get(b)===Kn?s:void 0,nice:u,clamp:l,zero:c,align:f,padding:p,projection:d,...E});if($){let{label:k=b==="fx"||b==="fy"?m:t,percent:R,transform:C,inset:P,insetTop:W=P!==void 0?P:b==="y"?n:0,insetRight:te=P!==void 0?P:b==="x"?i:0,insetBottom:ce=P!==void 0?P:b==="y"?a:0,insetLeft:pe=P!==void 0?P:b==="x"?o:0}=E||{};if(C==null)C=void 0;else if(typeof C!="function")throw new Error("invalid scale transform; not a function");$.percent=!!R,$.label=k===void 0?Zz(y,$):k,$.transform=C,b==="x"||b==="fx"?($.insetLeft=+pe,$.insetRight=+te):(b==="y"||b==="fy")&&($.insetTop=+W,$.insetBottom=+ce),x[b]=$}}return x}function Wg(e){let t={},r={scales:t};for(let[n,i]of Object.entries(e)){let{scale:a,type:o,interval:s,label:u}=i;t[n]=nN(i),r[n]=a,a.type=o,s!=null&&(a.interval=s),u!=null&&(a.label=u)}return r}function hx(e,t){let{x:r,y:n,fx:i,fy:a}=e,o=i||a?Gd(t):t;i&&cx(i,o),a&&fx(a,o);let s=i||a?Hg(e,t):t;r&&cx(r,s),n&&fx(n,s)}function Zz(e=[],t){let r;for(let{label:n}of e)if(n!==void 0){if(r===void 0)r=n;else if(r!==n)return}if(r!==void 0)return!Vi(t)&&t.percent&&(r=`${r} (%)`),{inferred:!0,toString:()=>r}}function mx(e){return Math.sign(sa(e.domain()))*Math.sign(sa(e.range()))}function Gd(e){let{marginTop:t,marginRight:r,marginBottom:n,marginLeft:i,width:a,height:o,facet:{marginTop:s,marginRight:u,marginBottom:l,marginLeft:c}}=e;return{marginTop:Math.max(t,s),marginRight:Math.max(r,u),marginBottom:Math.max(n,l),marginLeft:Math.max(i,c),width:a,height:o}}function Hg({fx:e,fy:t},r){let{marginTop:n,marginRight:i,marginBottom:a,marginLeft:o,width:s,height:u}=Gd(r);return{marginTop:n,marginRight:i,marginBottom:a,marginLeft:o,width:e?e.scale.bandwidth()+o+i:s,height:t?t.scale.bandwidth()+n+a:u,facet:{width:s,height:u}}}function cx(e,t){if(e.range===void 0){let{insetLeft:r,insetRight:n}=e,{width:i,marginLeft:a=0,marginRight:o=0}=t,s=a+r,u=i-o-n;e.range=[s,Math.max(s,u)],Vi(e)||(e.range=yx(e)),e.scale.range(e.range)}gx(e)}function fx(e,t){if(e.range===void 0){let{insetTop:r,insetBottom:n}=e,{height:i,marginTop:a=0,marginBottom:o=0}=t,s=a+r,u=i-o-n;e.range=[Math.max(s,u),s],Vi(e)?e.range.reverse():e.range=yx(e),e.scale.range(e.range)}gx(e)}function gx(e){e.round===void 0&&tN(e)&&Qz(e)<=30&&e.scale.round(!0)}function Qz({scale:e}){let t=e.domain().length,[r,n]=e.range(),i=e.paddingInner?e.paddingInner():1,a=e.paddingOuter?e.paddingOuter():e.padding(),o=t-i,s=Math.abs(n-r)/Math.max(1,o+a*2);return(s-Math.floor(s))*o}function yx(e){let t=e.scale.domain().length+qg(e);if(!(t>2))return e.range;let[r,n]=e.range;return Array.from({length:t},(i,a)=>r+a/(t-1)*(n-r))}function Jz(e,t=[],r={}){let n=eN(e,t,r);if(r.type===void 0&&r.domain===void 0&&r.range===void 0&&r.interval==null&&e!=="fx"&&e!=="fy"&&Vi({type:n})){let i=t.map(({value:a})=>a).filter(a=>a!==void 0);i.some(Gr)?Cn(`Warning: some data associated with the ${e} scale are dates. Dates are typically associated with a "utc" or "time" scale rather than a "${hu(n)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can specify the interval of the ${e} scale (e.g., d3.utcDay), or you can suppress this warning by setting the type of the ${e} scale to "${hu(n)}".`):i.some(hv)?Cn(`Warning: some data associated with the ${e} scale are strings that appear to be dates (e.g., YYYY-MM-DD). If these strings represent dates, you should parse them to Date objects. Dates are typically associated with a "utc" or "time" scale rather than a "${hu(n)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can suppress this warning by setting the type of the ${e} scale to "${hu(n)}".`):i.some(mv)&&Cn(`Warning: some data associated with the ${e} scale are strings that appear to be numbers. If these strings represent numbers, you should parse or coerce them to numbers. Numbers are typically associated with a "linear" scale rather than a "${hu(n)}" scale. If you want to treat this data as ordinal, you can specify the interval of the ${e} scale (e.g., 1 for integers), or you can suppress this warning by setting the type of the ${e} scale to "${hu(n)}".`)}switch(r.type=n,n){case"diverging":case"diverging-sqrt":case"diverging-pow":case"diverging-log":case"diverging-symlog":case"cyclical":case"sequential":case"linear":case"sqrt":case"threshold":case"quantile":case"pow":case"log":case"symlog":r=Fd(t,r,Do);break;case"identity":switch(hr.get(e)){case Kn:r=Fd(t,r,Do);break;case ou:r=Fd(t,r,rN);break}break;case"utc":case"time":r=Fd(t,r,mg);break}switch(n){case"diverging":return Y_(e,t,r);case"diverging-sqrt":return Z_(e,t,r);case"diverging-pow":return jg(e,t,r);case"diverging-log":return Q_(e,t,r);case"diverging-symlog":return J_(e,t,r);case"categorical":case"ordinal":case pu:return ax(e,t,r);case"cyclical":case"sequential":case"linear":return F_(e,t,r);case"sqrt":return G_(e,t,r);case"threshold":return Pd(e,t,r);case"quantile":return W_(e,t,r);case"quantize":return H_(e,t,r);case"pow":return Ug(e,t,r);case"log":return j_(e,t,r);case"symlog":return V_(e,t,r);case"utc":return rx(e,t,r);case"time":return tx(e,t,r);case"point":return ox(e,t,r);case"band":return sx(e,t,r);case"identity":return q_(e);case void 0:return;default:throw new Error(`unknown scale type: ${n}`)}}function hu(e){return typeof e=="symbol"?e.description:e}function dx(e){return typeof e=="string"?`${e}`.toLowerCase():e}var px={toString:()=>"projection"};function eN(e,t,{type:r,domain:n,range:i,scheme:a,pivot:o,projection:s}){if(r=dx(r),e==="fx"||e==="fy")return"band";(e==="x"||e==="y")&&s!=null&&(r=px);for(let c of t){let f=dx(c.type);if(f!==void 0){if(r===void 0)r=f;else if(r!==f)throw new Error(`scale incompatible with channel: ${r} !== ${f}`)}}if(r===px)return;if(r!==void 0)return r;if(n===void 0&&!t.some(({value:c})=>c!==void 0))return;let u=hr.get(e);if(u===Po)return"sqrt";if(u===Fo||u===Uo)return"linear";if(u===ou)return"ordinal";let l=(n??i)?.length;if(l<2||l>2)return Vg(u);if(n!==void 0){if(wg(n))return Vg(u);if(Gr(n))return"utc"}else{let c=t.map(({value:f})=>f).filter(f=>f!==void 0);if(c.some(wg))return Vg(u);if(c.some(Gr))return"utc"}if(u===Rn){if(o!=null||R_(a))return"diverging";if(O_(a))return"categorical"}return"linear"}function Vg(e){switch(e){case Kn:return"point";case Rn:return pu;default:return"ordinal"}}function Vi({type:e}){return e==="ordinal"||e==="point"||e==="band"||e===pu}function qg({type:e}){return e==="threshold"}function tN({type:e}){return e==="point"||e==="band"}function Yl(e){if(e===void 0)return!0;let t=e.domain(),r=e(t[0]);for(let n=1,i=t.length;n<i;++n)if(e(t[n])-r)return!1;return!0}function Fd(e,{domain:t,...r},n){for(let i of e)i.value!==void 0&&(t===void 0&&(t=i.value?.domain),i.value=n(i.value));return{domain:t===void 0?t:n(t),...r}}function rN(e){return pr(e,su)}function bx(e){return t=>{if(!hr.has(t=`${t}`))throw new Error(`unknown scale: ${t}`);return e[t]}}function nN({scale:e,type:t,domain:r,range:n,interpolate:i,interval:a,transform:o,percent:s,pivot:u}){if(t==="identity")return{type:"identity",apply:c=>c,invert:c=>c};let l=e.unknown?e.unknown():void 0;return{type:t,domain:Fa(r),...n!==void 0&&{range:Fa(n)},...o!==void 0&&{transform:o},...s&&{percent:s},...l!==void 0&&{unknown:l},...a!==void 0&&{interval:a},...i!==void 0&&{interpolate:i},...e.clamp&&{clamp:e.clamp()},...u!==void 0&&{pivot:u,symmetric:!1},...e.base&&{base:e.base()},...e.exponent&&{exponent:e.exponent()},...e.constant&&{constant:e.constant()},...e.align&&{align:e.align(),round:e.round()},...e.padding&&(e.paddingInner?{paddingInner:e.paddingInner(),paddingOuter:e.paddingOuter()}:{padding:e.padding()}),...e.bandwidth&&{bandwidth:e.bandwidth(),step:e.step()},apply:c=>e(c),...e.invert&&{invert:c=>e.invert(c)}}}function vx(e,t){let{fx:r,fy:n}=Kl(e,t),i=r?.scale.domain(),a=n?.scale.domain();return i&&a?aN(i,a).map(([o,s],u)=>({x:o,y:s,i:u})):i?i.map((o,s)=>({x:o,i:s})):a?a.map((o,s)=>({y:o,i:s})):void 0}function _x(e,{x:t,y:r}){return t&&(t=Jg(t)),r&&(r=Jg(r)),e.filter(t&&r?n=>t.has(n.x)&&r.has(n.y):t?n=>t.has(n.x):n=>r.has(n.y)).sort(t&&r?(n,i)=>t.get(n.x)-t.get(i.x)||r.get(n.y)-r.get(i.y):t?(n,i)=>t.get(n.x)-t.get(i.x):(n,i)=>r.get(n.y)-r.get(i.y))}function Vd(e,{fx:t,fy:r}){let n=vn(e),i=t?.value,a=r?.value;return t&&r?Xg(n,o=>(o.fx=i[o[0]],o.fy=a[o[0]],o),o=>i[o],o=>a[o]):t?Xg(n,o=>(o.fx=i[o[0]],o),o=>i[o]):Xg(n,o=>(o.fy=a[o[0]],o),o=>a[o])}function xx(e,t,{marginTop:r,marginLeft:n}){let i=e?({x:o})=>e(o)-n:()=>0,a=t?({y:o})=>t(o)-r:()=>0;return function(o){this.tagName==="svg"?(this.setAttribute("x",i(o)),this.setAttribute("y",a(o))):this.setAttribute("transform",`translate(${i(o)},${a(o)})`)}}function $x(e){let t=[],r=new Uint32Array(oN(e,n=>n.length));for(let n of e){let i=0;for(let a of e)n!==a&&(r.set(a,i),i+=a.length);t.push(r.slice(0,i))}return t}var sN=new Map([["top",Kg],["right",Qg],["bottom",Yg],["left",Zg],["top-left",jd(Kg,Zg)],["top-right",jd(Kg,Qg)],["bottom-left",jd(Yg,Zg)],["bottom-right",jd(Yg,Qg)],["top-empty",lN],["right-empty",dN],["bottom-empty",cN],["left-empty",fN],["empty",pN]]);function Ex(e){if(e==null)return null;let t=sN.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid facet anchor: ${e}`)}var wx=new WeakMap;function Jg(e){let t=wx.get(e);return t||wx.set(e,t=new iN(pr(e,(r,n)=>[r,n]))),t}function Ha(e,t){return Jg(e).get(t)}function uN(e,t,r){return t=qn(t),r=qn(r),e.find(n=>Object.is(qn(n.x),t)&&Object.is(qn(n.y),r))}function Wd(e,t,r){return uN(e,t,r)?.empty}function Kg(e,{y:t},{y:r}){return t?Ha(t,r)===0:!0}function Yg(e,{y:t},{y:r}){return t?Ha(t,r)===t.length-1:!0}function Zg(e,{x:t},{x:r}){return t?Ha(t,r)===0:!0}function Qg(e,{x:t},{x:r}){return t?Ha(t,r)===t.length-1:!0}function lN(e,{y:t},{x:r,y:n,empty:i}){if(i)return!1;if(!t)return;let a=Ha(t,n);if(a>0)return Wd(e,r,t[a-1])}function cN(e,{y:t},{x:r,y:n,empty:i}){if(i)return!1;if(!t)return;let a=Ha(t,n);if(a<t.length-1)return Wd(e,r,t[a+1])}function fN(e,{x:t},{x:r,y:n,empty:i}){if(i)return!1;if(!t)return;let a=Ha(t,r);if(a>0)return Wd(e,t[a-1],n)}function dN(e,{x:t},{x:r,y:n,empty:i}){if(i)return!1;if(!t)return;let a=Ha(t,r);if(a<t.length-1)return Wd(e,t[a+1],n)}function pN(e,t,{empty:r}){return r}function jd(e,t){return function(){return e.apply(null,arguments)&&t.apply(null,arguments)}}function Hd(e,{channels:{fx:t,fy:r},groups:n}){return t&&r?e.map(({x:i,y:a})=>n.get(i)?.get(a)??[]):t?e.map(({x:i})=>n.get(i)??[]):e.map(({y:i})=>n.get(i)??[])}import{geoAlbers as hN,geoAlbersUsa as mN,geoAzimuthalEqualArea as gN,geoAzimuthalEquidistant as yN,geoClipRectangle as bN,geoConicConformal as wN,geoConicEqualArea as vN,geoConicEquidistant as _N,geoEqualEarth as xN,geoEquirectangular as $N,geoGnomonic as EN,geoMercator as SN,geoOrthographic as TN,geoPath as Sx,geoStereographic as AN,geoStream as kN,geoTransform as Xd,geoTransverseMercator as IN}from"d3";var Tx=Math.PI,ha=2*Tx,e0=.618;function Ax({projection:e,inset:t=0,insetTop:r=t,insetRight:n=t,insetBottom:i=t,insetLeft:a=t}={},o){if(e==null)return;if(typeof e.stream=="function")return e;let s,u,l="frame";if(fi(e)){let k;if({type:e,domain:u,inset:k,insetTop:r=k!==void 0?k:r,insetRight:n=k!==void 0?k:n,insetBottom:i=k!==void 0?k:i,insetLeft:a=k!==void 0?k:a,clip:l=l,...s}=e,e==null)return}typeof e!="function"&&({type:e}=t0(e));let{width:c,height:f,marginLeft:p,marginRight:d,marginTop:m,marginBottom:g}=o,x=c-p-d-a-n,b=f-m-g-r-i;if(e=e?.({width:x,height:b,clip:l,...s}),e==null)return;l=CN(l,p,m,c-d,f-g);let y=p+a,E=m+r,$;if(u!=null){let[[k,R],[C,P]]=Sx(e).bounds(u),W=Math.min(x/(C-k),b/(P-R));W>0?(y-=(W*(k+C)-x)/2,E-=(W*(R+P)-b)/2,$=Xd({point(te,ce){this.stream.point(te*W+y,ce*W+E)}})):Cn("Warning: the projection could not be fit to the specified domain; using the default scale.")}return $??($=y===0&&E===0?kx():Xd({point(k,R){this.stream.point(k+y,R+E)}})),{stream:k=>e.stream($.stream(l(k)))}}function t0(e){switch(`${e}`.toLowerCase()){case"albers-usa":return pi(mN,.7463,.4673);case"albers":return qd(hN,.7463,.4673);case"azimuthal-equal-area":return pi(gN,4,4);case"azimuthal-equidistant":return pi(yN,ha,ha);case"conic-conformal":return qd(wN,ha,ha);case"conic-equal-area":return qd(vN,6.1702,2.9781);case"conic-equidistant":return qd(_N,7.312,3.6282);case"equal-earth":return pi(xN,5.4133,2.6347);case"equirectangular":return pi($N,ha,Tx);case"gnomonic":return pi(EN,3.4641,3.4641);case"identity":return{type:kx};case"reflect-y":return{type:ON};case"mercator":return pi(SN,ha,ha);case"orthographic":return pi(TN,2,2);case"stereographic":return pi(AN,2,2);case"transverse-mercator":return pi(IN,ha,ha);default:throw new Error(`unknown projection type: ${e}`)}}function CN(e,t,r,n,i){if(e===!1||e==null||typeof e=="number")return a=>a;switch(e===!0&&(e="frame"),`${e}`.toLowerCase()){case"frame":return bN(t,r,n,i);default:throw new Error(`unknown projection clip type: ${e}`)}}function pi(e,t,r){return{type:({width:n,height:i,rotate:a,precision:o=.15,clip:s})=>{let u=e();return o!=null&&u.precision?.(o),a!=null&&u.rotate?.(a),typeof s=="number"&&u.clipAngle?.(s),n!=null&&(u.scale(Math.min(n/t,i/r)),u.translate([n/2,i/2])),u},aspectRatio:r/t}}function qd(e,t,r){let{type:n,aspectRatio:i}=pi(e,t,r);return{type:a=>{let{parallels:o,domain:s,width:u,height:l}=a,c=n(a);return o!=null&&(c.parallels(o),s===void 0&&u!=null&&c.fitSize([u,l],{type:"Sphere"})),c},aspectRatio:i}}var kx=Bn({stream:e=>e}),ON=Bn(Xd({point(e,t){this.stream.point(e,-t)}}));function Ix(e,t,r,n){let i=r[e],a=r[t],o=i.length,s=r[e]=new Float64Array(o).fill(NaN),u=r[t]=new Float64Array(o).fill(NaN),l,c=n.stream({point(f,p){s[l]=f,u[l]=p}});for(l=0;l<o;++l)c.point(i[l],a[l])}function Cx({projection:e}={}){return e==null?!1:typeof e.stream=="function"?!0:(fi(e)&&(e=e.type),e!=null)}function Ox(e){if(typeof e?.stream=="function")return e0;if(fi(e)){let t,r;if({domain:t,type:e,...r}=e,t!=null&&e!=null){let n=typeof e=="string"?t0(e).type:e,[[i,a],[o,s]]=Sx(n({...r,width:100,height:100})).bounds(t),u=(s-a)/(o-i);return u&&isFinite(u)?u<.2?.2:u>5?5:u:e0}}if(e!=null){if(typeof e!="function"){let{aspectRatio:t}=t0(e);if(t)return t}return e0}}function Bx(e){let t=[],r=[],n={scale:"x",value:t},i={scale:"y",value:r},a={point(o,s){t.push(o),r.push(s)},lineStart(){},lineEnd(){},polygonStart(){},polygonEnd(){},sphere(){}};for(let o of e.value)kN(o,a);return[n,i]}function Rx({x:e,y:t}){if(e||t)return e??(e=r=>r),t??(t=r=>r),Xd({point(r,n){this.stream.point(e(r),t(n))}})}import{group as UN,namespaces as zx,select as Lx}from"d3";import{creator as BN,select as RN}from"d3";function mu(e={}){let{document:t=typeof window<"u"?window.document:void 0,clip:r}=e;return{document:t,clip:zd(r)}}function wr(e,{document:t}){return RN(BN(e).call(t.documentElement))}var Kd=Symbol("unset");function Yd(e){return(e.length===1?zN:NN)(e)}function zN(e){let t,r=Kd;return n=>(Object.is(r,n)||(r=n,t=e(n)),t)}function NN(e){let t,r;return(...n)=>((r?.length!==n.length||r.some((i,a)=>!Object.is(i,n[a])))&&(r=n,t=e(...n)),t)}var LN=Yd(e=>new Intl.NumberFormat(e)),Gq=Yd((e,t)=>new Intl.DateTimeFormat(e,{timeZone:"UTC",...t&&{month:t}})),jq=Yd((e,t)=>new Intl.DateTimeFormat(e,{timeZone:"UTC",...t&&{weekday:t}}));function DN(e="en-US"){let t=LN(e);return r=>r!=null&&!isNaN(r)?t.format(r):void 0}function MN(e){return Ed(e,"Invalid Date")}function PN(e="en-US"){let t=DN(e);return r=>(r instanceof Date?MN:typeof r=="number"?t:jr)(r)}var Wi=PN();var on=(typeof window<"u"?window.devicePixelRatio>1:typeof it>"u")?0:.5,FN=0;function Dx(){return`plot-clip-${++FN}`}function Mx(e,{title:t,href:r,ariaLabel:n,ariaDescription:i,ariaHidden:a,target:o,fill:s,fillOpacity:u,stroke:l,strokeWidth:c,strokeOpacity:f,strokeLinejoin:p,strokeLinecap:d,strokeMiterlimit:m,strokeDasharray:g,strokeDashoffset:x,opacity:b,mixBlendMode:y,imageFilter:E,paintOrder:$,pointerEvents:k,shapeRendering:R,channels:C},{ariaLabel:P,fill:W="currentColor",fillOpacity:te,stroke:ce="none",strokeOpacity:pe,strokeWidth:ge,strokeLinecap:fe,strokeLinejoin:Me,strokeMiterlimit:Ge,paintOrder:He}){W===null&&(s=null,u=null),ce===null&&(l=null,f=null),en(W)?!en(ce)&&(!en(s)||C?.fill)&&(ce="none"):en(ce)&&(!en(l)||C?.stroke)&&(W="none");let[dt,he]=kn(s,W),[qe,ae]=Nr(u,te),[we,Re]=kn(l,ce),[ne,at]=Nr(f,pe),[kt,pt]=Nr(b);Mo(Re)||(c===void 0&&(c=ge),d===void 0&&(d=fe),p===void 0&&(p=Me),m===void 0&&!bv(p)&&(m=Ge),!Mo(he)&&$===void 0&&($=He));let[mt,gt]=Nr(c);return W!==null&&(e.fill=Lr(he,"currentColor"),e.fillOpacity=Zl(ae,1)),ce!==null&&(e.stroke=Lr(Re,"none"),e.strokeWidth=Zl(gt,1),e.strokeOpacity=Zl(at,1),e.strokeLinejoin=Lr(p,"miter"),e.strokeLinecap=Lr(d,"butt"),e.strokeMiterlimit=Zl(m,4),e.strokeDasharray=Lr(g,"none"),e.strokeDashoffset=Lr(x,"0")),e.target=jr(o),e.ariaLabel=jr(P),e.ariaDescription=jr(i),e.ariaHidden=jr(a),e.opacity=Zl(pt,1),e.mixBlendMode=Lr(y,"normal"),e.imageFilter=Lr(E,"none"),e.paintOrder=Lr($,"normal"),e.pointerEvents=Lr(k,"auto"),e.shapeRendering=Lr(R,"auto"),{title:{value:t,optional:!0,filter:null},href:{value:r,optional:!0,filter:null},ariaLabel:{value:n,optional:!0,filter:null},fill:{value:dt,scale:"auto",optional:!0},fillOpacity:{value:qe,scale:"auto",optional:!0},stroke:{value:we,scale:"auto",optional:!0},strokeOpacity:{value:ne,scale:"auto",optional:!0},strokeWidth:{value:mt,optional:!0},opacity:{value:kt,scale:"auto",optional:!0}}}function GN(e,t){t&&e.filter(r=>Ll(t[r])).append("title").call(VN,t)}function jN(e,t){t&&e.filter(([r])=>Ll(t[r])).append("title").call(WN,t)}function VN(e,t){t&&e.text(r=>Wi(t[r]))}function WN(e,t){t&&e.text(([r])=>Wi(t[r]))}function hi(e,{target:t,tip:r},{ariaLabel:n,title:i,fill:a,fillOpacity:o,stroke:s,strokeOpacity:u,strokeWidth:l,opacity:c,href:f}){n&&Xt(e,"aria-label",p=>n[p]),a&&Xt(e,"fill",p=>a[p]),o&&Xt(e,"fill-opacity",p=>o[p]),s&&Xt(e,"stroke",p=>s[p]),u&&Xt(e,"stroke-opacity",p=>u[p]),l&&Xt(e,"stroke-width",p=>l[p]),c&&Xt(e,"opacity",p=>c[p]),f&&Fx(e,p=>f[p],t),r||GN(e,i)}function Px(e,{target:t,tip:r},{ariaLabel:n,title:i,fill:a,fillOpacity:o,stroke:s,strokeOpacity:u,strokeWidth:l,opacity:c,href:f}){n&&Xt(e,"aria-label",([p])=>n[p]),a&&Xt(e,"fill",([p])=>a[p]),o&&Xt(e,"fill-opacity",([p])=>o[p]),s&&Xt(e,"stroke",([p])=>s[p]),u&&Xt(e,"stroke-opacity",([p])=>u[p]),l&&Xt(e,"stroke-width",([p])=>l[p]),c&&Xt(e,"opacity",([p])=>c[p]),f&&Fx(e,([p])=>f[p],t),r||jN(e,i)}function HN({ariaLabel:e,title:t,fill:r,fillOpacity:n,stroke:i,strokeOpacity:a,strokeWidth:o,opacity:s,href:u},{tip:l}){return[e,l?void 0:t,r,n,i,a,o,s,u].filter(c=>c!==void 0)}function qN(e,t,r){let n=UN(e,i=>t[i]);return r===void 0&&n.size>1+e.length>>1&&Cn("Warning: the implicit z channel has high cardinality. This may occur when the fill or stroke channel is associated with quantitative data rather than ordinal or categorical data. You can suppress this warning by setting the z option explicitly; if this data represents a single series, set z to null."),n.values()}function*Ux(e,t,r,n){let{z:i}=r,{z:a}=n,o=HN(n,r),s=[...t,...o];for(let u of a?qN(e,a,i):[e]){let l,c;e:for(let f of u){for(let p of s)if(!Hn(p[f])){c&&c.push(-1);continue e}if(l===void 0){c&&(yield c),l=o.map(p=>qn(p[f])),c=[f];continue}c.push(f);for(let p=0;p<o.length;++p)if(qn(o[p][f])!==l[p]){yield c,l=o.map(m=>qn(m[f])),c=[f];continue e}}c&&(yield c)}}function XN(e,t,r,n){let i,{clip:a=n.clip}=t;a==="frame"?(e=wr("svg:g",n).each(function(){this.appendChild(e.node()),e.node=()=>this}),i=YN(n,r)):a&&(i=QN(a,n)),Xt(e,"aria-label",t.ariaLabel),Xt(e,"aria-description",t.ariaDescription),Xt(e,"aria-hidden",t.ariaHidden),Xt(e,"clip-path",i)}function KN(e){let t=new WeakMap;return(r,n)=>{let i=t.get(r);if(!i){let a=Dx();Lx(r.ownerSVGElement).append("clipPath").attr("id",a).call(e,r,n),t.set(r,i=`url(#${a})`)}return i}}var YN=KN((e,t,r)=>{let{width:n,height:i,marginLeft:a,marginRight:o,marginTop:s,marginBottom:u}=r;e.append("rect").attr("x",a).attr("y",s).attr("width",n-o-a).attr("height",i-s-u)}),Nx=new WeakMap,ZN={type:"Sphere"};function QN(e,t){let r,n;if((r=Nx.get(t))||Nx.set(t,r=new WeakMap),e.type==="Sphere"&&(e=ZN),!(n=r.get(e))){let i=Dx();Lx(t.ownerSVGElement).append("clipPath").attr("id",i).append("path").attr("d",t.path()(e)),r.set(e,n=`url(#${i})`)}return n}function _n(e,t,r,n){XN(e,t,r,n),Xt(e,"class",t.className),Xt(e,"fill",t.fill),Xt(e,"fill-opacity",t.fillOpacity),Xt(e,"stroke",t.stroke),Xt(e,"stroke-width",t.strokeWidth),Xt(e,"stroke-opacity",t.strokeOpacity),Xt(e,"stroke-linejoin",t.strokeLinejoin),Xt(e,"stroke-linecap",t.strokeLinecap),Xt(e,"stroke-miterlimit",t.strokeMiterlimit),Xt(e,"stroke-dasharray",t.strokeDasharray),Xt(e,"stroke-dashoffset",t.strokeDashoffset),Xt(e,"shape-rendering",t.shapeRendering),Xt(e,"filter",t.imageFilter),Xt(e,"paint-order",t.paintOrder);let{pointerEvents:i=n.pointerSticky===!1?"none":void 0}=t;Xt(e,"pointer-events",i)}function xn(e,t){JN(e,"mix-blend-mode",t.mixBlendMode),Xt(e,"opacity",t.opacity)}function Fx(e,t,r){e.each(function(n){let i=t(n);if(i!=null){let a=this.ownerDocument.createElementNS(zx.svg,"a");a.setAttribute("fill","inherit"),a.setAttributeNS(zx.xlink,"href",i),r!=null&&a.setAttribute("target",r),this.parentNode.insertBefore(a,this).appendChild(this)}})}function Xt(e,t,r){r!=null&&e.attr(t,r)}function JN(e,t,r){r!=null&&e.style(t,r)}function $n(e,t,{x:r,y:n},i=on,a=on){i+=t.dx,a+=t.dy,r?.bandwidth&&(i+=r.bandwidth()/2),n?.bandwidth&&(a+=n.bandwidth()/2),(i||a)&&e.attr("transform",`translate(${i},${a})`)}function Lr(e,t){if((e=jr(e))!==t)return e}function Zl(e,t){if((e=Vr(e))!==t)return e}var eL=/^-?([_a-z]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])([_a-z0-9-]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])*$/i;function gu(e){if(e===void 0)return"plot-d6a7b5";if(e=`${e}`,!eL.test(e))throw new Error(`invalid class name: ${e}`);return e}function yu(e,t){if(typeof t=="string")e.property("style",t);else if(t!=null)for(let r of e)Object.assign(r.style,t)}function Hi({frameAnchor:e},{width:t,height:r,marginTop:n,marginRight:i,marginBottom:a,marginLeft:o}){return[/left$/.test(e)?o:/right$/.test(e)?t-i:(o+t-i)/2,/^top/.test(e)?n:/^bottom/.test(e)?r-a:(n+r-a)/2]}var Dr=class{constructor(t,r={},n={},i){let{facet:a="auto",facetAnchor:o,fx:s,fy:u,sort:l,dx:c=0,dy:f=0,margin:p=0,marginTop:d=p,marginRight:m=p,marginBottom:g=p,marginLeft:x=p,className:b,clip:y=i?.clip,channels:E,tip:$,render:k}=n;if(this.data=t,this.sort=Ga(l)?l:null,this.initializer=ca(n).initializer,this.transform=this.initializer?n.transform:Go(n).transform,a===null||a===!1?this.facet=null:(this.facet=wn(a===!0?"include":a,"facet",["auto","include","exclude","super"]),this.fx=t===eu&&typeof s=="string"?[s]:s,this.fy=t===eu&&typeof u=="string"?[u]:u),this.facetAnchor=Ex(o),r=vg(r),E!==void 0&&(r={...tL(E),...r}),i!==void 0&&(r={...Mx(this,n,i),...r}),this.channels=Object.fromEntries(Object.entries(r).map(([R,C])=>{if(nu(C.value)){let{value:P,label:W=C.label,scale:te=C.scale}=C.value;C={...C,label:W,scale:te,value:P}}if(t===eu&&typeof C.value=="string"){let{value:P}=C;C={...C,value:[P]}}return[R,C]}).filter(([R,{value:C,optional:P}])=>{if(C!=null)return!0;if(P)return!1;throw new Error(`missing channel value: ${R}`)})),this.dx=+c,this.dy=+f,this.marginTop=+d,this.marginRight=+m,this.marginBottom=+g,this.marginLeft=+x,this.clip=zd(y),this.tip=rL($),this.className=jr(b),this.facet==="super"){if(s||u)throw new Error("super-faceting cannot use fx or fy");for(let R in this.channels){let{scale:C}=r[R];if(!(C!=="x"&&C!=="y"))throw new Error("super-faceting cannot use x or y")}}k!=null&&(this.render=n0(k,this.render))}initialize(t,r,n){let i=ua(this.data);t===void 0&&i!=null&&(t=[vn(i)]);let a=t;this.transform!=null&&({facets:t,data:i}=this.transform(i,t,n),i=ua(i)),t!==void 0&&(t.original=a);let o=Dv(this.channels,i);return this.sort!=null&&Pv(i,t,o,r,this.sort),{data:i,facets:t,channels:o}}filter(t,r,n){for(let i in r){let{filter:a=Hn}=r[i];if(a!==null){let o=n[i];t=t.filter(s=>a(o[s]))}}return t}project(t,r,n){for(let i in t)if(t[i].scale==="x"&&/^x|x$/.test(i)){let a=i.replace(/^x|x$/,"y");a in t&&t[a].scale==="y"&&Ix(i,a,r,n.projection)}}scale(t,r,n){let i=Mv(t,r);return n.projection&&this.project(t,i,n),i}};function r0(...e){return e.plot=Dr.prototype.plot,e}function n0(e,t){if(e==null)return t===null?void 0:t;if(t==null)return e===null?void 0:e;if(typeof e!="function")throw new TypeError(`invalid render transform: ${e}`);if(typeof t!="function")throw new TypeError(`invalid render transform: ${t}`);return function(r,n,i,a,o,s){return e.call(this,r,n,i,a,o,(u,l,c,f,p)=>t.call(this,u,l,c,f,p,s))}}function tL(e){return Object.fromEntries(Object.entries(vg(e)).map(([t,r])=>(r=typeof r=="string"?{value:r,label:t}:ji(r),r.filter===void 0&&r.scale==null&&(r={...r,filter:null}),[t,r])))}function rL(e){return e===!0?"xy":e===!1||e==null?null:typeof e=="string"?wn(e,"tip",["x","y","xy"]):e}function jo(e,t){return e?.tip===!0?{...e,tip:t}:fi(e?.tip)&&e.tip.pointer===void 0?{...e,tip:{...e.tip,pointer:t}}:e}import{creator as SD,geoPath as TD,select as O0}from"d3";import{extent as nL}from"d3";function jx(e,t,r={}){let n=.5-on,i=.5+on,a=.5+on,o=.5-on;for(let{marginTop:g,marginRight:x,marginBottom:b,marginLeft:y}of t)g>n&&(n=g),x>i&&(i=x),b>a&&(a=b),y>o&&(o=y);let{margin:s,marginTop:u=s!==void 0?s:n,marginRight:l=s!==void 0?s:i,marginBottom:c=s!==void 0?s:a,marginLeft:f=s!==void 0?s:o}=r;u=+u,l=+l,c=+c,f=+f;let{width:p=640,height:d=iL(e,r,{width:p,marginTopDefault:n,marginRightDefault:i,marginBottomDefault:a,marginLeftDefault:o})+Math.max(0,u-n+c-a)}=r;p=+p,d=+d;let m={width:p,height:d,marginTop:u,marginRight:l,marginBottom:c,marginLeft:f};if(e.fx||e.fy){let{margin:g,marginTop:x=g!==void 0?g:u,marginRight:b=g!==void 0?g:l,marginBottom:y=g!==void 0?g:c,marginLeft:E=g!==void 0?g:f}=r.facet??{};x=+x,b=+b,y=+y,E=+E,m.facet={marginTop:x,marginRight:b,marginBottom:y,marginLeft:E}}return m}function iL({x:e,y:t,fy:r,fx:n},{projection:i,aspectRatio:a},{width:o,marginTopDefault:s,marginRightDefault:u,marginBottomDefault:l,marginLeftDefault:c}){let f=r&&r.scale.domain().length||1,p=Ox(i);if(p){let m=n?n.scale.domain().length:1,g=(1.1*f-.1)/(1.1*m-.1)*p,x=Math.max(.1,Math.min(10,g));return Math.round((o-c-u)*x+s+l)}let d=t?Vi(t)?t.scale.domain().length||1:Math.max(7,17/f):1;if(a!=null){if(a=+a,!(isFinite(a)&&a>0))throw new Error(`invalid aspectRatio: ${a}`);let m=Gx("y",t)/(Gx("x",e)*a),g=n?n.scale.bandwidth():1,x=r?r.scale.bandwidth():1,b=g*(o-c-u)-e.insetLeft-e.insetRight;return(m*b+t.insetTop+t.insetBottom)/x+s+l}return!!(t||r)*Math.max(1,Math.min(60,d*f))*20+!!n*30+60}function Gx(e,t){if(!t)throw new Error(`aspectRatio requires ${e} scale`);let{type:r,domain:n}=t,i;switch(r){case"linear":case"utc":case"time":i=Number;break;case"pow":{let s=t.scale.exponent();i=u=>Math.pow(u,s);break}case"log":i=Math.log;break;case"point":case"band":return n.length;default:throw new Error(`unsupported ${e} scale for aspectRatio: ${r}`)}let[a,o]=nL(n);return Math.abs(i(o)-i(a))}import{pointer as aL}from"d3";var Vx=new WeakMap;function i0(e,t,{x:r,y:n,px:i,py:a,maxRadius:o=40,channels:s,render:u,...l}={}){return o=+o,i!=null&&(r??(r=null),s={...s,px:{value:i,scale:"x"}}),a!=null&&(n??(n=null),s={...s,py:{value:a,scale:"y"}}),{x:r,y:n,channels:s,...l,render:n0(function(c,f,p,d,m,g){m={...m,pointerSticky:!1};let x=m.ownerSVGElement,{data:b}=m.getMarkState(this),y=Vx.get(x);y||Vx.set(x,y={sticky:!1,roots:[],renders:[]});let E=y.renders.push(Re)-1,{x:$,y:k,fx:R,fy:C}=f,P=R?R(c.fx)-d.marginLeft:0,W=C?C(c.fy)-d.marginTop:0;$?.bandwidth&&(P+=$.bandwidth()/2),k?.bandwidth&&(W+=k.bandwidth()/2);let te=c.fi!=null,ce;if(te){let pt=y.facetStates;pt||(y.facetStates=pt=new Map),ce=pt.get(this),ce||pt.set(this,ce=new Map)}let[pe,ge]=Hi(this,d),{px:fe,py:Me}=p,Ge=fe?pt=>fe[pt]:o0(p,pe),He=Me?pt=>Me[pt]:s0(p,ge),dt,he,qe,ae;function we(pt,mt){if(te)if(ae&&(ae=cancelAnimationFrame(ae)),pt==null)ce.delete(c.fi);else{ce.set(c.fi,mt),ae=requestAnimationFrame(()=>{ae=null;for(let[gt,Dt]of ce)if(Dt<mt||Dt===mt&&gt<c.fi){pt=null;break}Re(pt)});return}Re(pt)}function Re(pt){if(dt===pt&&qe===y.sticky)return;dt=pt,qe=m.pointerSticky=y.sticky;let mt=dt==null?[]:[dt];te&&(mt.fx=c.fx,mt.fy=c.fy,mt.fi=c.fi);let gt=g(mt,f,p,d,m);if(he){if(te){let Dt=he.parentNode,Bt=he.getAttribute("transform"),er=gt.getAttribute("transform");Bt?gt.setAttribute("transform",Bt):gt.removeAttribute("transform"),er?Dt.setAttribute("transform",er):Dt.removeAttribute("transform"),gt.removeAttribute("aria-label"),gt.removeAttribute("aria-description"),gt.removeAttribute("aria-hidden")}he.replaceWith(gt)}if(y.roots[E]=he=gt,!(dt==null&&ce?.size>1)){let Dt=dt==null?null:ci(b)?b[dt]:b.get(dt);m.dispatchValue(Dt)}return gt}function ne(pt){if(y.sticky||pt.pointerType==="mouse"&&pt.buttons===1)return;let[mt,gt]=aL(pt);mt-=P,gt-=W;let Dt=mt<d.marginLeft||mt>d.width-d.marginRight?1:e,Bt=gt<d.marginTop||gt>d.height-d.marginBottom?1:t,er=null,yr=o*o;for(let Kt of c){let br=Dt*(Ge(Kt)-mt),w=Bt*(He(Kt)-gt),T=br*br+w*w;T<=yr&&(er=Kt,yr=T)}if(er!=null&&(e!==1||t!==1)){let Kt=Ge(er)-mt,br=He(er)-gt;yr=Kt*Kt+br*br}we(er,yr)}function at(pt){pt.pointerType==="mouse"&&dt!=null&&(y.sticky&&y.roots.some(mt=>mt?.contains(pt.target))||(y.sticky?(y.sticky=!1,y.renders.forEach(mt=>mt(null))):(y.sticky=!0,Re(dt)),pt.stopImmediatePropagation()))}function kt(pt){pt.pointerType==="mouse"&&(y.sticky||we(null))}return x.addEventListener("pointerenter",ne),x.addEventListener("pointermove",ne),x.addEventListener("pointerdown",at),x.addEventListener("pointerleave",kt),Re(null)},u)}}function Wx(e){return i0(1,1,e)}function Hx(e){return i0(1,.01,e)}function a0(e){return i0(.01,1,e)}function o0({x1:e,x2:t,x:r=e},n){return e&&t?i=>(e[i]+t[i])/2:r?i=>r[i]:()=>n}function s0({y1:e,y2:t,y:r=e},n){return e&&t?i=>(e[i]+t[i])/2:r?i=>r[i]:()=>n}import{rgb as S0}from"d3";import{quantize as oL,interpolateNumber as sL,piecewise as uL,format as lL,scaleBand as cL,scaleLinear as fL,axisBottom as dL}from"d3";function Zd(e){return Vi(e)&&e.interval===void 0?void 0:"tabular-nums"}function qx(e,t){let{label:r=e.label,tickSize:n=6,width:i=240,height:a=44+n,marginTop:o=18,marginRight:s=0,marginBottom:u=16+n,marginLeft:l=0,style:c,ticks:f=(i-l-s)/64,tickFormat:p,fontVariant:d=Zd(e),round:m=!0,opacity:g,className:x}=t,b=mu(t);x=gu(x),g=Nr(g)[1],p===null&&(p=()=>null);let y=wr("svg",b).attr("class",`${x}-ramp`).attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("width",i).attr("height",a).attr("viewBox",`0 0 ${i} ${a}`).call(pe=>pe.append("style").text(`:where(.${x}-ramp) {
  display: block;
  height: auto;
  height: intrinsic;
  max-width: 100%;
  overflow: visible;
}
:where(.${x}-ramp text) {
  white-space: pre;
}`)).call(yu,c),E=pe=>pe.selectAll(".tick line").attr("y1",o+u-a),$,k=m?(pe,ge)=>pe.rangeRound(ge):(pe,ge)=>pe.range(ge),{type:R,domain:C,range:P,interpolate:W,scale:te,pivot:ce}=e;if(W){let pe=P===void 0?W:uL(W.length===1?Xl(W):W,P);$=k(te.copy(),oL(sL(l,i-s),Math.min(C.length+(ce!==void 0),P===void 0?1/0:P.length)));let ge=256,fe=b.document.createElement("canvas");fe.width=ge,fe.height=1;let Me=fe.getContext("2d");for(let Ge=0,He=ge-1;Ge<ge;++Ge)Me.fillStyle=pe(Ge/He),Me.fillRect(Ge,0,1,1);y.append("image").attr("opacity",g).attr("x",l).attr("y",o).attr("width",i-l-s).attr("height",a-o-u).attr("preserveAspectRatio","none").attr("xlink:href",fe.toDataURL())}else if(R==="threshold"){let pe=C,ge=p===void 0?fe=>fe:typeof p=="string"?lL(p):p;$=k(fL().domain([-1,P.length-1]),[l,i-s]),y.append("g").attr("fill-opacity",g).selectAll().data(P).enter().append("rect").attr("x",(fe,Me)=>$(Me-1)).attr("y",o).attr("width",(fe,Me)=>$(Me)-$(Me-1)).attr("height",a-o-u).attr("fill",fe=>fe),f=pr(pe,(fe,Me)=>Me),p=fe=>ge(pe[fe],fe)}else $=k(cL().domain(C),[l,i-s]),y.append("g").attr("fill-opacity",g).selectAll().data(C).enter().append("rect").attr("x",$).attr("y",o).attr("width",Math.max(0,$.bandwidth()-1)).attr("height",a-o-u).attr("fill",te),E=()=>{};return y.append("g").attr("transform",`translate(0,${a-u})`).call(dL($).ticks(Array.isArray(f)?null:f,typeof p=="string"?p:void 0).tickFormat(typeof p=="function"?p:void 0).tickSize(n).tickValues(Array.isArray(f)?f:null)).attr("font-size",null).attr("font-family",null).attr("font-variant",Lr(d,"normal")).call(E).call(pe=>pe.select(".domain").remove()),r!==void 0&&y.append("text").attr("x",l).attr("y",o-6).attr("fill","currentColor").attr("font-weight","bold").text(r),y.node()}import{pathRound as qL}from"d3";import{InternSet as NL,extent as rp,format as LL,utcFormat as DL}from"d3";var u0=Math.PI/180;function d0(e,{marker:t,markerStart:r=t,markerMid:n=t,markerEnd:i=t}={}){e.markerStart=l0(r),e.markerMid=l0(n),e.markerEnd=l0(i)}function l0(e){if(e==null||e===!1)return null;if(e===!0)return Kx;if(typeof e=="function")return e;switch(`${e}`.toLowerCase()){case"none":return null;case"arrow":return Xx("auto");case"arrow-reverse":return Xx("auto-start-reverse");case"dot":return pL;case"circle":case"circle-fill":return Kx;case"circle-stroke":return hL;case"tick":return c0("auto");case"tick-x":return c0(90);case"tick-y":return c0(0)}throw new Error(`invalid marker: ${e}`)}function Xx(e){return(t,r)=>wr("svg:marker",r).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("orient",e).attr("fill","none").attr("stroke",t).attr("stroke-width",1.5).attr("stroke-linecap","round").attr("stroke-linejoin","round").call(n=>n.append("path").attr("d","M-1.5,-3l3,3l-3,3")).node()}function pL(e,t){return wr("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",e).attr("stroke","none").call(r=>r.append("circle").attr("r",2.5)).node()}function Kx(e,t){return wr("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",e).attr("stroke","var(--plot-background)").attr("stroke-width",1.5).call(r=>r.append("circle").attr("r",3)).node()}function hL(e,t){return wr("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill","var(--plot-background)").attr("stroke",e).attr("stroke-width",1.5).call(r=>r.append("circle").attr("r",3)).node()}function c0(e){return(t,r)=>wr("svg:marker",r).attr("viewBox","-3 -3 6 6").attr("markerWidth",6).attr("markerHeight",6).attr("orient",e).attr("stroke",t).call(n=>n.append("path").attr("d","M0,-3v6")).node()}var mL=0;function p0(e,t,{stroke:r},n){return yL(e,t,r&&(i=>r[i]),null,n)}var f0=1,Yx=2;function gL(e,t){let r=new Uint8Array(t.length),n=e.data().filter(a=>a.length>1),i=n.length;for(let a=0,o=Kd;a<i;++a){let s=n[a];if(s.length>1){let u=s[0];o!==(o=qn(t[u]))&&(r[u]|=f0)}}for(let a=i-1,o=Kd;a>=0;--a){let s=n[a];if(s.length>1){let u=s[0];o!==(o=qn(t[u]))&&(r[u]|=Yx)}}return([a])=>r[a]}function yL(e,{markerStart:t,markerMid:r,markerEnd:n,stroke:i},a=()=>i,o,s){if(!t&&!r&&!n)return;let u=new Map,l=o&&gL(e,o);function c(f,p,d){return function(m){if(d&&!d(m))return;let g=a(m),x=u.get(p);x||u.set(p,x=new Map);let b=x.get(g);if(!b){let y=this.parentNode.insertBefore(p(g,s),this),E=`plot-marker-${++mL}`;y.setAttribute("id",E),x.set(g,b=`url(#${E})`)}this.setAttribute(f,b)}}t&&e.each(c("marker-start",t,l&&(f=>l(f)&f0))),r&&l&&e.each(c("marker-start",r,f=>!(l(f)&f0))),r&&e.each(c("marker-mid",r)),n&&e.each(c("marker-end",n,l&&(f=>l(f)&Yx)))}function Ql({inset:e,insetLeft:t,insetRight:r,...n}={}){return[t,r]=Zx(e,t,r),{inset:e,insetLeft:t,insetRight:r,...n}}function Qd({inset:e,insetTop:t,insetBottom:r,...n}={}){return[t,r]=Zx(e,t,r),{inset:e,insetTop:t,insetBottom:r,...n}}function Zx(e,t,r){return e===void 0&&t===void 0&&r===void 0?on?[1,0]:[.5,.5]:[t,r]}function Qx(e,{interval:t}){return e={...ji(e)},e.interval=Cd(e.interval===void 0?t:e.interval),e}function Jx(e,t,r,n){let{[e]:i,[`${e}1`]:a,[`${e}2`]:o}=r,{value:s,interval:u}=Qx(i,r);if(s==null||u==null&&!n)return r;let l=di(i);if(u==null){let d,m={transform:g=>d||(d=Er(g,s)),label:l};return{...r,[e]:void 0,[`${e}1`]:a===void 0?m:a,[`${e}2`]:o===void 0&&!(a===o&&n)?m:o}}let c,f;function p(d){return f!==void 0&&d===c?f:f=pr(Er(c=d,s),m=>u.floor(m))}return t({...r,[e]:void 0,[`${e}1`]:a===void 0?{transform:p,label:l}:a,[`${e}2`]:o===void 0?{transform:d=>p(d).map(m=>u.offset(m)),label:l}:o})}function e3(e,t,r){let{[e]:n}=r,{value:i,interval:a}=Qx(n,r);return i==null||a==null?r:t({...r,[e]:{label:di(n),transform:o=>{let s=pr(Er(o,i),l=>a.floor(l)),u=s.map(l=>a.offset(l));return s.map(Gr(s)?(l,c)=>l==null||isNaN(l=+l)||(c=u[c],c==null)||isNaN(c=+c)?void 0:new Date((l+c)/2):(l,c)=>l==null||(c=u[c],c==null)?NaN:(+l+ +c)/2)}}})}function t3(e={}){return Jx("x",Ql,e)}function r3(e={}){return Jx("y",Qd,e)}function n3(e={}){return e3("x",Ql,e)}function i3(e={}){return e3("y",Qd,e)}var a3={ariaLabel:"rule",fill:null,stroke:"currentColor"},h0=class extends Dr{constructor(t,r={}){let{x:n,y1:i,y2:a,inset:o=0,insetTop:s=o,insetBottom:u=o}=r;super(t,{x:{value:n,scale:"x",optional:!0},y1:{value:i,scale:"y",optional:!0},y2:{value:a,scale:"y",optional:!0}},jo(r,"x"),a3),this.insetTop=Vr(s),this.insetBottom=Vr(u),d0(this,r)}render(t,r,n,i,a){let{x:o,y:s}=r,{x:u,y1:l,y2:c}=n,{width:f,height:p,marginTop:d,marginRight:m,marginLeft:g,marginBottom:x}=i,{insetTop:b,insetBottom:y}=this;return wr("svg:g",a).call(_n,this,i,a).call($n,this,{x:u&&o},on,0).call(E=>E.selectAll().data(t).enter().append("line").call(xn,this).attr("x1",u?$=>u[$]:(g+f-m)/2).attr("x2",u?$=>u[$]:(g+f-m)/2).attr("y1",l&&!Yl(s)?$=>l[$]+b:d+b).attr("y2",c&&!Yl(s)?s.bandwidth?$=>c[$]+s.bandwidth()-y:$=>c[$]-y:p-x-y).call(hi,this,n).call(p0,this,n,a)).node()}},m0=class extends Dr{constructor(t,r={}){let{x1:n,x2:i,y:a,inset:o=0,insetRight:s=o,insetLeft:u=o}=r;super(t,{y:{value:a,scale:"y",optional:!0},x1:{value:n,scale:"x",optional:!0},x2:{value:i,scale:"x",optional:!0}},jo(r,"y"),a3),this.insetRight=Vr(s),this.insetLeft=Vr(u),d0(this,r)}render(t,r,n,i,a){let{x:o,y:s}=r,{y:u,x1:l,x2:c}=n,{width:f,height:p,marginTop:d,marginRight:m,marginLeft:g,marginBottom:x}=i,{insetLeft:b,insetRight:y}=this;return wr("svg:g",a).call(_n,this,i,a).call($n,this,{y:u&&s},0,on).call(E=>E.selectAll().data(t).enter().append("line").call(xn,this).attr("x1",l&&!Yl(o)?$=>l[$]+b:g+b).attr("x2",c&&!Yl(o)?o.bandwidth?$=>c[$]+o.bandwidth()-y:$=>c[$]-y:f-m-y).attr("y1",u?$=>u[$]:(d+p-x)/2).attr("y2",u?$=>u[$]:(d+p-x)/2).call(hi,this,n).call(p0,this,n,a)).node()}};function o3(e,t){let{x:r=Cr,y:n,y1:i,y2:a,...o}=r3(t);return[i,a]=u3(n,i,a),new h0(e,{...o,x:r,y1:i,y2:a})}function s3(e,t){let{y:r=Cr,x:n,x1:i,x2:a,...o}=t3(t);return[i,a]=u3(n,i,a),new m0(e,{...o,y:r,x1:i,x2:a})}function u3(e,t,r){if(e==null){if(t===void 0){if(r!==void 0)return[0,r]}else if(r===void 0)return[0,t]}else{if(t===void 0)return r===void 0?[0,e]:[e,r];if(r===void 0)return[e,t]}return[t,r]}import{namespaces as l3}from"d3";function bu(e,...t){let r=t.length;for(let n=0,i=!0;n<r;++n)typeof t[n]!="function"&&(i&&(e=e.slice(),i=!1),e.splice(n,2,e[n]+t[n]+e[n+1]),t.splice(n,1),--n,--r);return n=>{let i=e[0];for(let a=0;a<r;++a)i+=t[a](n)+e[a+1];return i}}var bL={ariaLabel:"text",strokeLinejoin:"round",strokeWidth:3,paintOrder:"stroke"},m3="\xAD",Jl=class extends Dr{constructor(t,r={}){let{x:n,y:i,text:a=In(t)&&Od(t)?Cr:tu,frameAnchor:o,textAnchor:s=/right$/i.test(o)?"end":/left$/i.test(o)?"start":"middle",lineAnchor:u=/^top/i.test(o)?"top":/^bottom/i.test(o)?"bottom":"middle",lineHeight:l=1,lineWidth:c=1/0,textOverflow:f,monospace:p,fontFamily:d=p?"ui-monospace, monospace":void 0,fontSize:m,fontStyle:g,fontVariant:x,fontWeight:b,rotate:y}=r,[E,$]=Nr(y,0),[k,R]=xL(m);if(super(t,{x:{value:n,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},fontSize:{value:k,optional:!0},rotate:{value:pv(E),optional:!0},text:{value:a,filter:Ll,optional:!0}},r,bL),this.rotate=$,this.textAnchor=Lr(s,"middle"),this.lineAnchor=wn(u,"lineAnchor",["top","middle","bottom"]),this.lineHeight=+l,this.lineWidth=+c,this.textOverflow=y0(f),this.monospace=!!p,this.fontFamily=jr(d),this.fontSize=R,this.fontStyle=jr(g),this.fontVariant=jr(x),this.fontWeight=jr(b),this.frameAnchor=Wa(o),!(this.lineWidth>=0))throw new Error(`invalid lineWidth: ${c}`);this.splitLines=v0(this),this.clipLine=_0(this)}render(t,r,n,i,a){let{x:o,y:s}=r,{x:u,y:l,rotate:c,text:f,title:p,fontSize:d}=n,{rotate:m}=this,[g,x]=Hi(this,i);return wr("svg:g",a).call(_n,this,i,a).call(w0,this,f,i).call($n,this,{x:u&&o,y:l&&s}).call(b=>b.selectAll().data(t).enter().append("text").call(xn,this).call(wL,this,f,p).attr("transform",bu`translate(${u?y=>u[y]:g},${l?y=>l[y]:x})${c?y=>` rotate(${c[y]})`:m?` rotate(${m})`:""}`).call(Xt,"font-size",d&&(y=>d[y])).call(hi,this,n)).node()}};function y0(e){return e==null?null:wn(e,"textOverflow",["clip","ellipsis","clip-start","clip-end","ellipsis-start","ellipsis-middle","ellipsis-end"]).replace(/^(clip|ellipsis)$/,"$1-end")}function wL(e,t,r,n){if(!r)return;let{lineAnchor:i,lineHeight:a,textOverflow:o,splitLines:s,clipLine:u}=t;e.each(function(l){let c=s(Wi(r[l])??"").map(u),f=c.length,p=i==="top"?.71:i==="bottom"?1-f:(164-f*100)/200;if(f>1){let d=0;for(let m=0;m<f;++m){if(++d,!c[m])continue;let g=this.ownerDocument.createElementNS(l3.svg,"tspan");g.setAttribute("x",0),m===d-1?g.setAttribute("y",`${(p+m)*a}em`):g.setAttribute("dy",`${d*a}em`),g.textContent=c[m],this.appendChild(g),d=0}}else p&&this.setAttribute("y",`${p*a}em`),this.textContent=c[0];if(o&&!n&&c[0]!==r[l]){let d=this.ownerDocument.createElementNS(l3.svg,"title");d.textContent=r[l],this.appendChild(d)}})}function b0(e,{x:t,y:r,...n}={}){return n.frameAnchor===void 0&&([t,r]=la(t,r)),new Jl(e,{...n,x:t,y:r})}function g3(e,{x:t=Cr,...r}={}){return new Jl(e,i3({...r,x:t}))}function y3(e,{y:t=Cr,...r}={}){return new Jl(e,n3({...r,y:t}))}function w0(e,t,r){Xt(e,"text-anchor",t.textAnchor),Xt(e,"font-family",t.fontFamily),Xt(e,"font-size",t.fontSize),Xt(e,"font-style",t.fontStyle),Xt(e,"font-variant",t.fontVariant===void 0?vL(r):t.fontVariant),Xt(e,"font-weight",t.fontWeight)}function vL(e){return e&&(gv(e)||Gr(e))?"tabular-nums":void 0}var _L=new Set(["inherit","initial","revert","unset","xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large","larger","smaller"]);function xL(e){return e==null||typeof e=="number"?[void 0,e]:typeof e!="string"?[e,void 0]:(e=e.trim().toLowerCase(),_L.has(e)||/^[+-]?\d*\.?\d+(e[+-]?\d+)?(\w*|%)$/.test(e)?[void 0,e]:[e,void 0])}function $L(e,t,r){let n=[],i,a=0;for(let[o,s,u]of EL(e)){if(i===void 0&&(i=o),a>i&&r(e,i,s)>t&&(n.push(e.slice(i,a)+(e[a-1]===m3?"-":"")),i=o),u){n.push(e.slice(i,s)),i=void 0;continue}a=s}return n}function*EL(e){let t=0,r=0,n=e.length;for(;r<n;){let i=1;switch(e[r]){case m3:case"-":++r,yield[t,r,!1],t=r;break;case" ":for(yield[t,r,!1];e[++r]===" ";);t=r;break;case"\r":e[r+1]===`
`&&++i;case`
`:yield[t,r,!0],r+=i,t=r;break;default:++r;break}}yield[t,r,!0]}var c3={a:56,b:63,c:57,d:63,e:58,f:37,g:62,h:60,i:26,j:26,k:55,l:26,m:88,n:60,o:60,p:62,q:62,r:39,s:54,t:38,u:60,v:55,w:79,x:54,y:55,z:55,A:69,B:67,C:73,D:74,E:61,F:58,G:76,H:75,I:28,J:55,K:67,L:58,M:89,N:75,O:78,P:65,Q:78,R:67,S:65,T:65,U:75,V:69,W:98,X:69,Y:67,Z:67,0:64,1:48,2:62,3:64,4:66,5:63,6:65,7:58,8:65,9:65," ":29,"!":32,'"':49,"'":31,"(":39,")":39,",":31,"-":48,".":31,"/":32,":":31,";":31,"?":52,"\u2018":31,"\u2019":31,"\u201C":47,"\u201D":47,"\u2026":82};function Jd(e,t=0,r=e.length){let n=0;for(let i=t;i<r;i=wu(e,i))n+=c3[e[i]]??(w3(e,i)?120:c3.e);return n}function ep(e,t=0,r=e.length){let n=0;for(let i=t;i<r;i=wu(e,i))n+=w3(e,i)?126:63;return n}function v0({monospace:e,lineWidth:t,textOverflow:r}){if(r!=null||t==1/0)return a=>a.split(/\r\n?|\n/g);let n=e?ep:Jd,i=t*100;return a=>$L(a,i,n)}function _0({monospace:e,lineWidth:t,textOverflow:r}){if(r==null||t==1/0)return a=>a;let n=e?ep:Jd,i=t*100;switch(r){case"clip-start":return a=>p3(a,i,n,"");case"clip-end":return a=>f3(a,i,n,"");case"ellipsis-start":return a=>p3(a,i,n,Vo);case"ellipsis-middle":return a=>SL(a,i,n,Vo);case"ellipsis-end":return a=>f3(a,i,n,Vo)}}var Vo="\u2026";function Wo(e,t,r,n){let i=[],a=0;for(let o=0,s=0,u=e.length;o<u;o=s){s=wu(e,o);let l=r(e,o,s);if(a+l>t){for(a+=n;a>t&&o>0;)s=o,o=i.pop(),a-=r(e,o,s);return[o,t-a]}a+=l,i.push(o)}return[-1,0]}function f3(e,t,r,n){e=e.trim();let i=r(n),[a]=Wo(e,t,r,i);return a<0?e:e.slice(0,a).trimEnd()+n}function SL(e,t,r,n){e=e.trim();let i=r(e);if(i<=t)return e;let a=r(n)/2,[o,s]=Wo(e,t/2,r,a),[u]=Wo(e,i-t/2-s+a,r,-a);return u<0?n:e.slice(0,o).trimEnd()+n+e.slice(wu(e,u)).trimStart()}function p3(e,t,r,n){e=e.trim();let i=r(e);if(i<=t)return e;let a=r(n),[o]=Wo(e,i-t+a,r,-a);return o<0?n:n+e.slice(wu(e,o)).trimStart()}var g0=/[\p{Combining_Mark}\p{Emoji_Modifier}]+/uy,h3=/\p{Extended_Pictographic}/uy;function wu(e,t){return t+=TL(e,t)?2:1,kL(e,t)&&(t=g0.lastIndex),AL(e,t)?wu(e,t+1):t}function b3(e,t){return e.charCodeAt(t)<128}function TL(e,t){let r=e.charCodeAt(t);if(r>=55296&&r<56320){let n=e.charCodeAt(t+1);return n>=56320&&n<57344}return!1}function AL(e,t){return e.charCodeAt(t)===8205}function kL(e,t){return b3(e,t)?!1:(g0.lastIndex=t,g0.test(e))}function w3(e,t){return b3(e,t)?!1:(h3.lastIndex=t,h3.test(e))}import{pathRound as v3}from"d3";var IL={ariaLabel:"vector",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinejoin:"round",strokeLinecap:"round"},_3=3.5,CL=_3*5,x3={draw(e,t,r){let n=t*r/CL;e.moveTo(0,0),e.lineTo(0,-t),e.moveTo(-n,n-t),e.lineTo(0,-t),e.lineTo(n,n-t)}},OL={draw(e,t,r){e.moveTo(-r,0),e.lineTo(0,-t),e.lineTo(r,0)}},BL=new Map([["arrow",x3],["spike",OL]]);function RL(e){return e&&typeof e.draw=="function"}function zL(e){if(RL(e))return e;let t=BL.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid shape: ${e}`)}var tp=class extends Dr{constructor(t,r={}){let{x:n,y:i,r:a=_3,length:o,rotate:s,shape:u=x3,anchor:l="middle",frameAnchor:c}=r,[f,p]=Nr(o,12),[d,m]=Nr(s,0);super(t,{x:{value:n,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},length:{value:f,scale:"length",optional:!0},rotate:{value:d,optional:!0}},r,IL),this.r=+a,this.length=p,this.rotate=m,this.shape=zL(u),this.anchor=wn(l,"anchor",["start","middle","end"]),this.frameAnchor=Wa(c)}render(t,r,n,i,a){let{x:o,y:s}=r,{x:u,y:l,length:c,rotate:f}=n,{length:p,rotate:d,anchor:m,shape:g,r:x}=this,[b,y]=Hi(this,i);return wr("svg:g",a).call(_n,this,i,a).call($n,this,{x:u&&o,y:l&&s}).call(E=>E.selectAll().data(t).enter().append("path").call(xn,this).attr("transform",bu`translate(${u?$=>u[$]:b},${l?$=>l[$]:y})${f?$=>` rotate(${f[$]})`:d?` rotate(${d})`:""}${m==="start"?"":m==="end"?c?$=>` translate(0,${c[$]})`:` translate(0,${p})`:c?$=>` translate(0,${c[$]/2})`:` translate(0,${p/2})`}`).attr("d",c?$=>{let k=v3();return g.draw(k,c[$],x),k}:(()=>{let $=v3();return g.draw($,p,x),$})()).call(hi,this,n)).node()}};function $3(e,t={}){let{x:r=Cr,...n}=t;return new tp(e,{...n,x:r})}function E3(e,t={}){let{y:r=Cr,...n}=t;return new tp(e,{...n,y:r})}function qa(e,t){return arguments.length<2&&!In(e)&&(t=e,e=null),t===void 0&&(t={}),[e,t]}function np({anchor:e}={},t){return e===void 0?t[0]:wn(e,"anchor",t)}function S3(e){return np(e,["left","right"])}function T3(e){return np(e,["right","left"])}function A3(e){return np(e,["bottom","top"])}function k3(e){return np(e,["top","bottom"])}function $0(){let[e,t]=qa(...arguments);return O3("y",S3(t),e,t)}function I3(){let[e,t]=qa(...arguments);return O3("fy",T3(t),e,t)}function E0(){let[e,t]=qa(...arguments);return B3("x",A3(t),e,t)}function C3(){let[e,t]=qa(...arguments);return B3("fx",k3(t),e,t)}function O3(e,t,r,{color:n="currentColor",opacity:i=1,stroke:a=n,strokeOpacity:o=i,strokeWidth:s=1,fill:u=n,fillOpacity:l=i,textAnchor:c,textStroke:f,textStrokeOpacity:p,textStrokeWidth:d,tickSize:m=e==="y"?6:0,tickPadding:g,tickRotate:x,x:b,margin:y,marginTop:E=y===void 0?20:y,marginRight:$=y===void 0?t==="right"?40:0:y,marginBottom:k=y===void 0?20:y,marginLeft:R=y===void 0?t==="left"?40:0:y,label:C,labelAnchor:P,labelArrow:W,labelOffset:te,ariaLabel:ce=`${e}-axis`,...pe}){return m=Vr(m),g=Vr(g),x=Vr(x),P!==void 0&&(P=wn(P,"labelAnchor",["center","top","bottom"])),W=V3(W),r0(m&&!en(a)?ML(e,t,r,{stroke:a,strokeOpacity:o,strokeWidth:s,tickSize:m,tickPadding:g,tickRotate:x,x:b,ariaLabel:ce,...pe}):null,en(u)?null:UL(e,t,r,{fill:u,fillOpacity:l,stroke:f,strokeOpacity:p,strokeWidth:d,textAnchor:c,tickSize:m,tickPadding:g,tickRotate:x,x:b,marginTop:E,marginRight:$,marginBottom:k,marginLeft:R,ariaLabel:ce,...pe}),!en(u)&&C!==null?b0([],U3({fill:u,fillOpacity:l,...pe},function(ge,fe,Me,Ge,He){let dt=Ge[e],{marginTop:he,marginRight:qe,marginBottom:ae,marginLeft:we}=e==="y"&&He.inset||He,Re=P??(dt.bandwidth?"center":"top"),ne=te??(t==="right"?qe:we)-3;return Re==="center"?(this.textAnchor=void 0,this.lineAnchor=t==="right"?"bottom":"top",this.frameAnchor=t,this.rotate=-90):(this.textAnchor=t==="right"?"end":"start",this.lineAnchor=Re,this.frameAnchor=`${Re}-${t}`,this.rotate=0),this.dy=Re==="top"?3-he:Re==="bottom"?ae-3:0,this.dx=t==="right"?ne:-ne,this.ariaLabel=`${ce} label`,{facets:[[0]],channels:{text:{value:[j3(e,dt,{anchor:t,label:C,labelAnchor:Re,labelArrow:W})]}}}})):null)}function B3(e,t,r,{color:n="currentColor",opacity:i=1,stroke:a=n,strokeOpacity:o=i,strokeWidth:s=1,fill:u=n,fillOpacity:l=i,textAnchor:c,textStroke:f,textStrokeOpacity:p,textStrokeWidth:d,tickSize:m=e==="x"?6:0,tickPadding:g,tickRotate:x,y:b,margin:y,marginTop:E=y===void 0?t==="top"?30:0:y,marginRight:$=y===void 0?20:y,marginBottom:k=y===void 0?t==="bottom"?30:0:y,marginLeft:R=y===void 0?20:y,label:C,labelAnchor:P,labelArrow:W,labelOffset:te,ariaLabel:ce=`${e}-axis`,...pe}){return m=Vr(m),g=Vr(g),x=Vr(x),P!==void 0&&(P=wn(P,"labelAnchor",["center","left","right"])),W=V3(W),r0(m&&!en(a)?PL(e,t,r,{stroke:a,strokeOpacity:o,strokeWidth:s,tickSize:m,tickPadding:g,tickRotate:x,y:b,ariaLabel:ce,...pe}):null,en(u)?null:FL(e,t,r,{fill:u,fillOpacity:l,stroke:f,strokeOpacity:p,strokeWidth:d,textAnchor:c,tickSize:m,tickPadding:g,tickRotate:x,y:b,marginTop:E,marginRight:$,marginBottom:k,marginLeft:R,ariaLabel:ce,...pe}),!en(u)&&C!==null?b0([],U3({fill:u,fillOpacity:l,...pe},function(ge,fe,Me,Ge,He){let dt=Ge[e],{marginTop:he,marginRight:qe,marginBottom:ae,marginLeft:we}=e==="x"&&He.inset||He,Re=P??(dt.bandwidth?"center":"right"),ne=te??(t==="top"?he:ae)-3;return Re==="center"?(this.frameAnchor=t,this.textAnchor=void 0):(this.frameAnchor=`${t}-${Re}`,this.textAnchor=Re==="right"?"end":"start"),this.lineAnchor=t,this.dy=t==="top"?-ne:ne,this.dx=Re==="right"?qe-3:Re==="left"?3-we:0,this.ariaLabel=`${ce} label`,{facets:[[0]],channels:{text:{value:[j3(e,dt,{anchor:t,label:C,labelAnchor:Re,labelArrow:W})]}}}})):null)}function ML(e,t,r,{strokeWidth:n=1,strokeLinecap:i=null,strokeLinejoin:a=null,facetAnchor:o=t+(e==="y"?"-empty":""),frameAnchor:s=t,tickSize:u,inset:l=0,insetLeft:c=l,insetRight:f=l,dx:p=0,y:d=e==="y"?void 0:null,ariaLabel:m,...g}){return vu(E3,e,r,{ariaLabel:`${m} tick`,ariaHidden:!0},{strokeWidth:n,strokeLinecap:i,strokeLinejoin:a,facetAnchor:o,frameAnchor:s,y:d,...g,dx:t==="left"?+p-on+ +c:+p+on-f,anchor:"start",length:u,shape:t==="left"?WL:HL})}function PL(e,t,r,{strokeWidth:n=1,strokeLinecap:i=null,strokeLinejoin:a=null,facetAnchor:o=t+(e==="x"?"-empty":""),frameAnchor:s=t,tickSize:u,inset:l=0,insetTop:c=l,insetBottom:f=l,dy:p=0,x:d=e==="x"?void 0:null,ariaLabel:m,...g}){return vu($3,e,r,{ariaLabel:`${m} tick`,ariaHidden:!0},{strokeWidth:n,strokeLinejoin:a,strokeLinecap:i,facetAnchor:o,frameAnchor:s,x:d,...g,dy:t==="bottom"?+p-on-f:+p+on+ +c,anchor:"start",length:u,shape:t==="bottom"?jL:VL})}function UL(e,t,r,{facetAnchor:n=t+(e==="y"?"-empty":""),frameAnchor:i=t,tickSize:a,tickRotate:o=0,tickPadding:s=Math.max(3,9-a)+(Math.abs(o)>60?4*Math.cos(o*u0):0),text:u,textAnchor:l=Math.abs(o)>60?"middle":t==="left"?"end":"start",lineAnchor:c=o>60?"top":o<-60?"bottom":"middle",fontVariant:f,inset:p=0,insetLeft:d=p,insetRight:m=p,dx:g=0,ariaLabel:x,y:b=e==="y"?void 0:null,...y}){return vu(y3,e,r,{ariaLabel:`${x} tick label`},{facetAnchor:n,frameAnchor:i,text:u,textAnchor:l,lineAnchor:c,fontVariant:f,rotate:o,y:b,...y,dx:t==="left"?+g-a-s+ +d:+g+ +a+ +s-m},function(E,$,k,R,C){f===void 0&&(this.fontVariant=G3(E)),u===void 0&&(C.text=F3(E,$,k,R,t))})}function FL(e,t,r,{facetAnchor:n=t+(e==="x"?"-empty":""),frameAnchor:i=t,tickSize:a,tickRotate:o=0,tickPadding:s=Math.max(3,9-a)+(Math.abs(o)>=10?4*Math.cos(o*u0):0),text:u,textAnchor:l=Math.abs(o)>=10?o<0^t==="bottom"?"start":"end":"middle",lineAnchor:c=Math.abs(o)>=10?"middle":t==="bottom"?"top":"bottom",fontVariant:f,inset:p=0,insetTop:d=p,insetBottom:m=p,dy:g=0,x=e==="x"?void 0:null,ariaLabel:b,...y}){return vu(g3,e,r,{ariaLabel:`${b} tick label`},{facetAnchor:n,frameAnchor:i,text:u===void 0?null:u,textAnchor:l,lineAnchor:c,fontVariant:f,rotate:o,x,...y,dy:t==="bottom"?+g+ +a+ +s-m:+g-a-s+ +d},function(E,$,k,R,C){f===void 0&&(this.fontVariant=G3(E)),u===void 0&&(C.text=F3(E,$,k,R,t))})}function R3(){let[e,t]=qa(...arguments);return D3("y",S3(t),e,t)}function z3(){let[e,t]=qa(...arguments);return D3("fy",T3(t),e,t)}function N3(){let[e,t]=qa(...arguments);return M3("x",A3(t),e,t)}function L3(){let[e,t]=qa(...arguments);return M3("fx",k3(t),e,t)}function D3(e,t,r,{y:n=e==="y"?void 0:null,x:i=null,x1:a=t==="left"?i:null,x2:o=t==="right"?i:null,ariaLabel:s=`${e}-grid`,ariaHidden:u=!0,...l}){return vu(s3,e,r,{ariaLabel:s,ariaHidden:u},{y:n,x1:a,x2:o,...P3(l)})}function M3(e,t,r,{x:n=e==="x"?void 0:null,y:i=null,y1:a=t==="top"?i:null,y2:o=t==="bottom"?i:null,ariaLabel:s=`${e}-grid`,ariaHidden:u=!0,...l}){return vu(o3,e,r,{ariaLabel:s,ariaHidden:u},{x:n,y1:a,y2:o,...P3(l)})}function P3({color:e="currentColor",opacity:t=.1,stroke:r=e,strokeOpacity:n=t,strokeWidth:i=1,...a}){return{stroke:r,strokeOpacity:n,strokeWidth:i,...a}}function U3({fill:e,fillOpacity:t,fontFamily:r,fontSize:n,fontStyle:i,fontVariant:a,fontWeight:o,monospace:s,pointerEvents:u,shapeRendering:l,clip:c=!1},f){return[,e]=kn(e),[,t]=Nr(t),{facet:"super",x:null,y:null,fill:e,fillOpacity:t,fontFamily:r,fontSize:n,fontStyle:i,fontVariant:a,fontWeight:o,monospace:s,pointerEvents:u,shapeRendering:l,clip:c,initializer:f}}function vu(e,t,r,n,i,a){let o;function s(c,f,p,d,m,g){let x=c==null&&(t==="fx"||t==="fy"),{[t]:b}=d;if(!b)throw new Error(`missing scale: ${t}`);let y=b.domain(),{interval:E,ticks:$,tickFormat:k,tickSpacing:R=t==="x"?80:35}=i;if(typeof $=="string"&&W3(b)&&(E=$,$=void 0),$===void 0&&($=Gi(E,b.type)??GL(b,R)),c==null){if(In($))c=Fi($);else if(Va($))c=x0($,...rp(y));else if(b.interval){let P=b.interval;if(b.ticks){let[W,te]=rp(y),ce=(te-W)/P[Js];P=ug(P,ce/$)??P,c=x0(P,W,te)}else{c=y;let W=c.length;P=ug(P,W/$)??P,P!==b.interval&&(c=x0(P,...rp(c)))}if(P===b.interval){let W=Math.round(c.length/$);W>1&&(c=c.filter((te,ce)=>ce%W===0))}}else b.ticks?c=b.ticks($):c=y;if(!b.ticks&&c.length&&c!==y){let P=new NL(y);c=c.filter(W=>P.has(W)),c.length||Cn(`Warning: the ${t}-axis ticks appear to not align with the scale domain, resulting in no ticks. Try different ticks?`)}t==="y"||t==="x"?f=[vn(c)]:o[t]={scale:t,value:Cr}}a?.call(this,b,c,$,k,o);let C=Object.fromEntries(Object.entries(o).map(([P,W])=>[P,{...W,value:Er(c,W.value)}]));return x&&(f=g.filterFacets(c,C)),{data:c,facets:f,channels:C}}let u=ca(i).initializer,l=e(r,ca({...i,initializer:s},u));return r==null?(o=l.channels,l.channels={}):o={},n!==void 0&&Object.assign(l,n),l.clip===void 0&&(l.clip=!1),l}function GL(e,t){let[r,n]=rp(e.range());return(n-r)/t}function F3(e,t,r,n,i){return{value:ec(e,t,r,n,i)}}function ec(e,t,r,n,i){return typeof n=="function"&&!(e.type==="log"&&e.tickFormat)?n:n===void 0&&t&&Gr(t)?Z2(e.type,t,i)??Wi:e.tickFormat?e.tickFormat(typeof r=="number"?r:null,n):typeof n=="string"&&e.domain().length>0?(Gr(e.domain())?DL:LL)(n):n===void 0?Wi:Bn(n)}function x0(e,t,r){return e.range(t,e.offset(e.floor(r)))}var jL={draw(e,t){e.moveTo(0,0),e.lineTo(0,t)}},VL={draw(e,t){e.moveTo(0,0),e.lineTo(0,-t)}},WL={draw(e,t){e.moveTo(0,0),e.lineTo(-t,0)}},HL={draw(e,t){e.moveTo(0,0),e.lineTo(t,0)}};function G3(e){return e.bandwidth&&!e.interval?void 0:"tabular-nums"}function j3(e,t,{anchor:r,label:n=t.label,labelAnchor:i,labelArrow:a}={}){if(!(n==null||n.inferred&&W3(t)&&/^(date|time|year)$/i.test(n))){if(n=String(n),a==="auto"&&(a=(!t.bandwidth||t.interval)&&!/[↑↓→←]/.test(n)),!a)return n;if(a===!0){let o=mx(t);o&&(a=/x$/.test(e)||i==="center"?/x$/.test(e)===o<0?"left":"right":o<0?"up":"down")}switch(a){case"left":return`\u2190 ${n}`;case"right":return`${n} \u2192`;case"up":return r==="right"?`${n} \u2191`:`\u2191 ${n}`;case"down":return r==="right"?`${n} \u2193`:`\u2193 ${n}`}return n}}function V3(e="auto"){return en(e)?!1:typeof e=="boolean"?e:wn(e,"labelArrow",["auto","up","right","down","left"])}function W3(e){return Gr(e.domain())}function H3(e,t){if(t==null)return t;let r=e(t);if(!r)throw new Error(`scale not found: ${t}`);return r}function q3(e,{opacity:t,...r}={}){if(!Vi(e)&&!qg(e))throw new Error(`swatches legend requires ordinal or threshold color scale (not ${e.type})`);return K3(e,r,(n,i,a,o)=>n.append("svg").attr("width",a).attr("height",o).attr("fill",i.scale).attr("fill-opacity",Nr(t)[1]).append("rect").attr("width","100%").attr("height","100%"))}function X3(e,{fill:t=e.hint?.fill!==void 0?e.hint.fill:"none",fillOpacity:r=1,stroke:n=e.hint?.stroke!==void 0?e.hint.stroke:en(t)?"currentColor":"none",strokeOpacity:i=1,strokeWidth:a=1.5,r:o=4.5,...s}={},u){let[l,c]=kn(t),[f,p]=kn(n),d=H3(u,l),m=H3(u,f),g=o*o*Math.PI;return r=Nr(r)[1],i=Nr(i)[1],a=Nr(a)[1],K3(e,s,(x,b,y,E)=>x.append("svg").attr("viewBox","-8 -8 16 16").attr("width",y).attr("height",E).attr("fill",l==="color"?$=>d.scale($):c).attr("fill-opacity",r).attr("stroke",f==="color"?$=>m.scale($):p).attr("stroke-opacity",i).attr("stroke-width",a).append("path").attr("d",$=>{let k=qL();return e.scale($).draw(k,g),k}))}function K3(e,t={},r){let{columns:n,tickFormat:i,fontVariant:a=Zd(e),swatchSize:o=15,swatchWidth:s=o,swatchHeight:u=o,marginLeft:l=0,className:c,style:f,width:p}=t,d=mu(t);c=gu(c),i=ec(e.scale,e.domain,void 0,i);let m=wr("div",d).attr("class",`${c}-swatches ${c}-swatches-${n!=null?"columns":"wrap"}`),g;return n!=null?(g=`:where(.${c}-swatches-columns .${c}-swatch) {
  display: flex;
  align-items: center;
  break-inside: avoid;
  padding-bottom: 1px;
}
:where(.${c}-swatches-columns .${c}-swatch::before) {
  flex-shrink: 0;
}
:where(.${c}-swatches-columns .${c}-swatch-label) {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}`,m.style("columns",n).selectAll().data(e.domain).enter().append("div").attr("class",`${c}-swatch`).call(r,e,s,u).call(x=>x.append("div").attr("class",`${c}-swatch-label`).attr("title",i).text(i))):(g=`:where(.${c}-swatches-wrap) {
  display: flex;
  align-items: center;
  min-height: 33px;
  flex-wrap: wrap;
}
:where(.${c}-swatches-wrap .${c}-swatch) {
  display: inline-flex;
  align-items: center;
  margin-right: 1em;
}`,m.selectAll().data(e.domain).enter().append("span").attr("class",`${c}-swatch`).call(r,e,s,u).append(function(){return this.ownerDocument.createTextNode(i.apply(this,arguments))})),m.call(x=>x.insert("style","*").text(`:where(.${c}-swatches) {
  font-family: system-ui, sans-serif;
  font-size: 10px;
  margin-bottom: 0.5em;
}
:where(.${c}-swatch > svg) {
  margin-right: 0.5em;
  overflow: visible;
}
${g}`)).style("margin-left",l?`${+l}px`:null).style("width",p===void 0?null:`${+p}px`).style("font-variant",Lr(a,"normal")).call(yu,f).node()}var T0=new Map([["symbol",X3],["color",Q3],["opacity",XL]]);function Y3(e,t,r={}){return(n,i)=>{if(!T0.has(n))throw new Error(`unknown legend type: ${n}`);if(n in e)return T0.get(n)(e[n],Z3(t,r[n],i),a=>e[a])}}function Z3({className:e,...t},{label:r,ticks:n,tickFormat:i}={},a){return wv(a,{className:e,...t},{label:r,ticks:n,tickFormat:i})}function Q3(e,{legend:t=!0,...r}){if(t===!0&&(t=e.type==="ordinal"?"swatches":"ramp"),e.domain!==void 0)switch(`${t}`.toLowerCase()){case"swatches":return q3(e,r);case"ramp":return qx(e,r);default:throw new Error(`unknown legend type: ${t}`)}}function XL({type:e,interpolate:t,...r},{legend:n=!0,color:i=S0(0,0,0),...a}){if(!t)throw new Error(`${e} opacity scales are not supported`);if(n===!0&&(n="ramp"),`${n}`.toLowerCase()!=="ramp")throw new Error(`${n} opacity legends are not supported`);return Q3({type:e,...r,interpolate:KL(i)},{legend:n,...a})}function KL(e){let{r:t,g:r,b:n}=S0(e)||S0(0,0,0);return i=>`rgba(${t},${r},${n},${i})`}function J3(e,t,r){let n=[];for(let[i,a]of T0){let o=r[i];if(o?.legend&&i in e){let s=a(e[i],Z3(t,e[i],o),u=>e[u]);s!=null&&n.push(s)}}return n}function e$(e={},t="y"){return sv(e)?e:{...e,[t]:Cr}}import{InternMap as i$,cumsum as YL,greatest as a$,group as ZL,groupSort as A0,max as QL,min as ip,rollup as JL,sum as ap}from"d3";function t$(e,t){if(t.length===1)return{data:e,facets:t};let r=ja(e),n=new Uint8Array(r),i=0;for(let s of t)for(let u of s)n[u]&&++i,n[u]=1;if(i===0)return{data:e,facets:t};e=Fa(e);let a=e[fg]=new Uint32Array(r+i);t=t.map(s=>Fa(s,Uint32Array));let o=r;n.fill(0);for(let s of t)for(let u=0,l=s.length;u<l;++u){let c=s[u];n[c]?(s[u]=o,e[o]=e[c],a[o]=c,++o):a[c]=c,n[c]=1}return{data:e,facets:t}}function eD(e={},t={}){arguments.length===1&&([e,t]=tD(e));let{x1:r,x:n=r,y:i,...a}=t,[o,s,u,l]=nD(n,i,"x","y",e,a);return{...o,x1:r,x:s,y1:u,y2:l,y:Fl(u,l)}}function o$({y:e,y1:t,y2:r,...n}={}){return n=jo(n,"x"),t===void 0&&r===void 0?eD({y:e,...n}):([t,r]=uv(e,t,r),{...n,y1:t,y2:r})}function tD(e){let{offset:t,order:r,reverse:n,...i}=e;return[{offset:t,order:r,reverse:n},i]}var rD={length:!0};function nD(e,t=nv,r,n,{offset:i,order:a,reverse:o},s){if(t===null)throw new Error(`stack requires ${n}`);let u=kd(s),[l,c]=Xn(e),[f,p]=iu(t),[d,m]=iu(t);return f.hint=d.hint=rD,i=iD(i),a=sD(a,i,n),[Go(s,(g,x,b)=>{({data:g,facets:x}=t$(g,x));let y=e==null?void 0:c(Gl(Er(g,e),b?.[r])),E=Er(g,t,Float64Array),$=Er(g,u),k=a&&a(g,y,E,$),R=ja(g),C=p(new Float64Array(R)),P=m(new Float64Array(R)),W=[];for(let te of x){let ce=y?Array.from(ZL(te,pe=>y[pe]).values()):[te];if(k)for(let pe of ce)pe.sort(k);for(let pe of ce){let ge=0,fe=0;o&&pe.reverse();for(let Me of pe){let Ge=E[Me];Ge<0?ge=P[Me]=(C[Me]=ge)+Ge:Ge>0?fe=P[Me]=(C[Me]=fe)+Ge:P[Me]=C[Me]=fe}}W.push(ce)}return i&&i(W,C,P,$),{data:g,facets:x}}),l,f,d]}function iD(e){if(e!=null){if(typeof e=="function")return e;switch(`${e}`.toLowerCase()){case"expand":case"normalize":return aD;case"center":case"silhouette":return oD;case"wiggle":return u$}throw new Error(`unknown offset: ${e}`)}}function s$(e,t){let r=0,n=0;for(let i of e){let a=t[i];a<r&&(r=a),a>n&&(n=a)}return[r,n]}function aD(e,t,r){for(let n of e)for(let i of n){let[a,o]=s$(i,r);for(let s of i){let u=1/(o-a||1);t[s]=u*(t[s]-a),r[s]=u*(r[s]-a)}}}function oD(e,t,r){for(let n of e){for(let i of n){let[a,o]=s$(i,r);for(let s of i){let u=(o+a)/2;t[s]-=u,r[s]-=u}}l$(n,t,r)}c$(e,t,r)}function u$(e,t,r,n){for(let i of e){let a=new i$,o=0;for(let s of i){let u=-1,l=s.map(d=>Math.abs(r[d]-t[d])),c=s.map(d=>{u=n?n[d]:++u;let m=r[d]-t[d],g=a.has(u)?m-a.get(u):0;return a.set(u,m),g}),f=[0,...YL(c)];for(let d of s)t[d]+=o,r[d]+=o;let p=ap(l);p&&(o-=ap(l,(d,m)=>(c[m]/2+f[m])*d)/p)}l$(i,t,r)}c$(e,t,r)}function l$(e,t,r){let n=ip(e,i=>ip(i,a=>t[a]));for(let i of e)for(let a of i)t[a]-=n,r[a]-=n}function c$(e,t,r){let n=e.length;if(n===1)return;let i=e.map(s=>s.flat()),a=i.map(s=>(ip(s,u=>t[u])+QL(s,u=>r[u]))/2),o=ip(a);for(let s=0;s<n;s++){let u=o-a[s];for(let l of i[s])t[l]+=u,r[l]+=u}}function sD(e,t,r){if(e===void 0&&t===u$)return r$(pn);if(e!=null){if(typeof e=="string"){let n=e.startsWith("-"),i=n?zo:pn;switch((n?e.slice(1):e).toLowerCase()){case"value":case r:return uD(i);case"z":return lD(i);case"sum":return cD(i);case"appearance":return fD(i);case"inside-out":return r$(i)}return n$(pg(e))}if(typeof e=="function")return(e.length===1?n$:dD)(e);if(ci(e))return pD(e);throw new Error(`invalid order: ${e}`)}}function uD(e){return(t,r,n)=>(i,a)=>e(n[i],n[a])}function lD(e){return(t,r,n,i)=>(a,o)=>e(i[a],i[o])}function cD(e){return op(e,(t,r,n,i)=>A0(vn(t),a=>ap(a,o=>n[o]),a=>i[a]))}function fD(e){return op(e,(t,r,n,i)=>A0(vn(t),a=>r[a$(a,o=>n[o])],a=>i[a]))}function r$(e){return op(e,(t,r,n,i)=>{let a=vn(t),o=A0(a,f=>r[a$(f,p=>n[p])],f=>i[f]),s=JL(a,f=>ap(f,p=>n[p]),f=>i[f]),u=[],l=[],c=0;for(let f of o)c<0?(c+=s.get(f),u.push(f)):(c-=s.get(f),l.push(f));return l.reverse().concat(u)})}function n$(e){return t=>{let r=Er(t,e);return(n,i)=>pn(r[n],r[i])}}function dD(e){return t=>ci(t)?(r,n)=>e(t[r],t[n]):(r,n)=>e(t.get(r),t.get(n))}function pD(e){return op(pn,()=>e)}function op(e,t){return(r,n,i,a)=>{if(!a)throw new Error("missing channel: z");let o=new i$(t(r,n,i,a).map((s,u)=>[s,u]));return(s,u)=>e(o.get(a[s]),o.get(a[u]))}}function f$(e,{inset:t=0,insetTop:r=t,insetRight:n=t,insetBottom:i=t,insetLeft:a=t}={}){e.insetTop=Vr(r),e.insetRight=Vr(n),e.insetBottom=Vr(i),e.insetLeft=Vr(a)}function d$(e,{r:t,rx:r,ry:n,rx1:i=t,ry1:a=t,rx2:o=t,ry2:s=t,rx1y1:u=i!==void 0?+i:a!==void 0?+a:0,rx1y2:l=i!==void 0?+i:s!==void 0?+s:0,rx2y1:c=o!==void 0?+o:a!==void 0?+a:0,rx2y2:f=o!==void 0?+o:s!==void 0?+s:0}={}){u||l||c||f?(e.rx1y1=u,e.rx1y2=l,e.rx2y1=c,e.rx2y2=f):(e.rx=Lr(r,"auto"),e.ry=Lr(n,"auto"))}function p$(e,t,r,n,i,a){let{rx1y1:o,rx1y2:s,rx2y1:u,rx2y2:l}=a;typeof t!="function"&&(t=Bn(t)),typeof r!="function"&&(r=Bn(r)),typeof n!="function"&&(n=Bn(n)),typeof i!="function"&&(i=Bn(i));let c=Math.max(Math.abs(o+u),Math.abs(s+l)),f=Math.max(Math.abs(o+s),Math.abs(u+l));e.attr("d",p=>{let d=t(p),m=r(p),g=n(p),x=i(p),b=d>g,y=m>x,E=b?g:d,$=b?d:g,k=y?x:m,R=y?m:x,C=Math.min(1,($-E)/c,(R-k)/f),P=C*(b?y?l:u:y?s:o),W=C*(b?y?s:o:y?l:u),te=C*(b?y?o:s:y?u:l),ce=C*(b?y?u:l:y?o:s);return`M${E},${k+up(P,ce)}A${P},${P} 0 0 ${P<0?0:1} ${E+sp(P,ce)},${k}H${$-sp(W,te)}A${W},${W} 0 0 ${W<0?0:1} ${$},${k+up(W,te)}V${R-up(te,W)}A${te},${te} 0 0 ${te<0?0:1} ${$-sp(te,W)},${R}H${E+sp(ce,P)}A${ce},${ce} 0 0 ${ce<0?0:1} ${E},${R-up(ce,P)}Z`})}function sp(e,t){return t<0?e:Math.abs(e)}function up(e,t){return t<0?Math.abs(e):e}var hD={ariaLabel:"frame",fill:"none",stroke:"currentColor",clip:!1},mD={ariaLabel:"frame",fill:null,stroke:"currentColor",strokeLinecap:"square",clip:!1},k0=class extends Dr{constructor(t={}){let{anchor:r=null}=t;super(eu,void 0,t,r==null?hD:mD),this.anchor=yg(r,"anchor",["top","right","bottom","left"]),f$(this,t),r||d$(this,t)}render(t,r,n,i,a){let{marginTop:o,marginRight:s,marginBottom:u,marginLeft:l,width:c,height:f}=i,{anchor:p,insetTop:d,insetRight:m,insetBottom:g,insetLeft:x}=this,{rx:b,ry:y,rx1y1:E,rx1y2:$,rx2y1:k,rx2y2:R}=this,C=l+x,P=c-s-m,W=o+d,te=f-u-g;return wr(p?"svg:line":E||$||k||R?"svg:path":"svg:rect",a).datum(0).call(_n,this,i,a).call(xn,this).call(hi,this,n).call($n,this,{}).call(p==="left"?ce=>ce.attr("x1",C).attr("x2",C).attr("y1",W).attr("y2",te):p==="right"?ce=>ce.attr("x1",P).attr("x2",P).attr("y1",W).attr("y2",te):p==="top"?ce=>ce.attr("x1",C).attr("x2",P).attr("y1",W).attr("y2",W):p==="bottom"?ce=>ce.attr("x1",C).attr("x2",P).attr("y1",te).attr("y2",te):E||$||k||R?ce=>ce.call(p$,C,W,P,te,this):ce=>ce.attr("x",C).attr("y",W).attr("width",P-C).attr("height",te-W).attr("rx",b).attr("ry",y)).node()}};function h$(e){return new k0(e)}import{select as gD,format as yD,utcFormat as bD}from"d3";var I0={ariaLabel:"tip",fill:"var(--plot-background)",stroke:"currentColor"},wD=new Set(["geometry","href","src","ariaLabel","scales"]),C0=class extends Dr{constructor(t,r={}){r.tip&&(r={...r,tip:!1}),r.title===void 0&&In(t)&&Od(t)&&(r={...r,title:Cr});let{x:n,y:i,x1:a,x2:o,y1:s,y2:u,anchor:l,preferredAnchor:c="bottom",monospace:f,fontFamily:p=f?"ui-monospace, monospace":void 0,fontSize:d,fontStyle:m,fontVariant:g,fontWeight:x,lineHeight:b=1,lineWidth:y=20,frameAnchor:E,format:$,textAnchor:k="start",textOverflow:R,textPadding:C=8,title:P,pointerSize:W=12,pathFilter:te="drop-shadow(0 3px 4px rgba(0,0,0,0.2))"}=r;super(t,{x:{value:a!=null&&o!=null?null:n,scale:"x",optional:!0},y:{value:s!=null&&u!=null?null:i,scale:"y",optional:!0},x1:{value:a,scale:"x",optional:o==null},y1:{value:s,scale:"y",optional:u==null},x2:{value:o,scale:"x",optional:a==null},y2:{value:u,scale:"y",optional:s==null},title:{value:P,optional:!0}},r,I0),this.anchor=Rd(l,"anchor"),this.preferredAnchor=Rd(c,"preferredAnchor"),this.frameAnchor=Wa(E),this.textAnchor=Lr(k,"middle"),this.textPadding=+C,this.pointerSize=+W,this.pathFilter=jr(te),this.lineHeight=+b,this.lineWidth=+y,this.textOverflow=y0(R),this.monospace=!!f,this.fontFamily=jr(p),this.fontSize=Vr(d),this.fontStyle=jr(m),this.fontVariant=jr(g),this.fontWeight=jr(x);for(let ce in I0)ce in this.channels&&(this[ce]=I0[ce]);this.splitLines=v0(this),this.clipLine=_0(this),this.format=typeof $=="string"||typeof $=="function"?{title:$}:{...$}}render(t,r,n,i,a){let o=this,{x:s,y:u,fx:l,fy:c}=r,{ownerSVGElement:f,document:p}=a,{anchor:d,monospace:m,lineHeight:g,lineWidth:x}=this,{textPadding:b,pointerSize:y,pathFilter:E}=this,{marginTop:$,marginLeft:k}=i,{x1:R,y1:C,x2:P,y2:W,x:te=R??P,y:ce=C??W}=n,pe=l?l(t.fx)-k:0,ge=c?c(t.fy)-$:0,[fe,Me]=Hi(this,i),Ge=o0(n,fe),He=s0(n,Me),dt=m?ep:Jd,he=dt(Vo),qe,ae;"title"in n?(qe=m$.call(this,{title:n.channels.title},r),ae=$D):(qe=m$.call(this,n.channels,r),ae=ED);let we=wr("svg:g",a).call(_n,this,i,a).call(w0,this).call($n,this,{x:te&&s,y:ce&&u}).call(at=>at.selectAll().data(t).enter().append("g").attr("transform",kt=>`translate(${Math.round(Ge(kt))},${Math.round(He(kt))})`).call(xn,this).call(kt=>kt.append("path").attr("filter",E)).call(kt=>kt.append("text").each(function(pt){let mt=gD(this);this.setAttribute("fill","currentColor"),this.setAttribute("fill-opacity",1),this.setAttribute("stroke","none");let gt=ae.call(o,pt,t,qe,r,n);if(typeof gt=="string")for(let Dt of o.splitLines(gt))Re(mt,{value:o.clipLine(Dt)});else{let Dt=new Set;for(let Bt of gt){let{label:er=""}=Bt;er&&Dt.has(er)||(Dt.add(er),Re(mt,Bt))}}})));function Re(at,{label:kt,value:pt,color:mt,opacity:gt}){kt??(kt=""),pt??(pt="");let Dt=mt!=null||gt!=null,Bt,er=x*100,[yr]=Wo(kt,er,dt,he);if(yr>=0)kt=kt.slice(0,yr).trimEnd()+Vo,Bt=pt.trim(),pt="";else{(kt||!pt&&!Dt)&&(pt=" "+pt);let[br]=Wo(pt,er-dt(kt),dt,he);br>=0&&(Bt=pt.trim(),pt=pt.slice(0,br).trimEnd()+Vo)}let Kt=at.append("tspan").attr("x",0).attr("dy",`${g}em`).text("\u200B");kt&&Kt.append("tspan").attr("font-weight","bold").text(kt),pt&&Kt.append(()=>p.createTextNode(pt)),Dt&&Kt.append("tspan").text(" \u25A0").attr("fill",mt).attr("fill-opacity",gt).style("user-select","none"),Bt&&Kt.append("title").text(Bt)}function ne(){let{width:at,height:kt}=i.facet??i;we.selectChildren().each(function(pt){let{x:mt,width:gt,height:Dt}=this.getBBox();gt=Math.round(gt),Dt=Math.round(Dt);let Bt=d;if(Bt===void 0){let Kt=Ge(pt)+pe,br=He(pt)+ge,w=Kt+gt+y+b*2<at,T=Kt-gt-y-b*2>0,O=br+Dt+y+b*2<kt,q=br-Dt-y-b*2>0;Bt=w&&T?O&&q?o.preferredAnchor:q?"bottom":"top":O&&q?w?"left":"right":(w||T)&&(O||q)?`${q?"bottom":"top"}-${w?"left":"right"}`:o.preferredAnchor}let er=this.firstChild,yr=this.lastChild;if(er.setAttribute("d",xD(Bt,y,b,gt,Dt)),mt)for(let Kt of yr.childNodes)Kt.setAttribute("x",-mt);yr.setAttribute("y",`${+vD(Bt,yr.childNodes.length,g).toFixed(6)}em`),yr.setAttribute("transform",`translate(${_D(Bt,y,b,gt,Dt)})`)}),we.attr("visibility",null)}return t.length&&(we.attr("visibility","hidden"),f.isConnected?Promise.resolve().then(ne):typeof requestAnimationFrame<"u"&&requestAnimationFrame(ne)),we.node()}};function w$(e,{x:t,y:r,...n}={}){return n.frameAnchor===void 0&&([t,r]=la(t,r)),new C0(e,{...n,x:t,y:r})}function vD(e,t,r){return/^top(?:-|$)/.test(e)?.94-r:-.29-t*r}function _D(e,t,r,n,i){switch(e){case"middle":return[-n/2,i/2];case"top-left":return[r,t+r];case"top":return[-n/2,t/2+r];case"top-right":return[-n-r,t+r];case"right":return[-t/2-n-r,i/2];case"bottom-left":return[r,-t-r];case"bottom":return[-n/2,-t/2-r];case"bottom-right":return[-n-r,-t-r];case"left":return[r+t/2,i/2]}}function xD(e,t,r,n,i){let a=n+r*2,o=i+r*2;switch(e){case"middle":return`M${-a/2},${-o/2}h${a}v${o}h${-a}z`;case"top-left":return`M0,0l${t},${t}h${a-t}v${o}h${-a}z`;case"top":return`M0,0l${t/2},${t/2}h${(a-t)/2}v${o}h${-a}v${-o}h${(a-t)/2}z`;case"top-right":return`M0,0l${-t},${t}h${t-a}v${o}h${a}z`;case"right":return`M0,0l${-t/2},${-t/2}v${t/2-o/2}h${-a}v${o}h${a}v${t/2-o/2}z`;case"bottom-left":return`M0,0l${t},${-t}h${a-t}v${-o}h${-a}z`;case"bottom":return`M0,0l${t/2},${-t/2}h${(a-t)/2}v${-o}h${-a}v${o}h${(a-t)/2}z`;case"bottom-right":return`M0,0l${-t},${-t}h${t-a}v${-o}h${a}z`;case"left":return`M0,0l${t/2},${-t/2}v${t/2-o/2}h${a}v${o}h${-a}v${t/2-o/2}z`}}function m$(e,t){let r={},n=this.format;n=g$(n,e,"x"),n=g$(n,e,"y"),this.format=n;for(let i in n){let a=n[i];if(!(a===null||a===!1))if(i==="fx"||i==="fy")r[i]=!0;else{let o=Rg(e,i);o&&(r[i]=o)}}for(let i in e){if(i in r||i in n||wD.has(i)||(i==="x"||i==="y")&&e.geometry)continue;let a=Rg(e,i);if(a){if(a.scale==null&&a.defaultScale==="color")continue;r[i]=a}}this.facet&&(t.fx&&!("fx"in n)&&(r.fx=!0),t.fy&&!("fy"in n)&&(r.fy=!0));for(let i in r){let a=this.format[i];if(typeof a=="string"){let o=r[i]?.value??t[i]?.domain()??[];this.format[i]=(Gr(o)?bD:yD)(a)}else if(a===void 0||a===!0){let o=t[i];this.format[i]=o?.bandwidth?ec(o,o.domain()):Wi}}return r}function g$(e,t,r){if(!(r in e))return e;let n=`${r}1`,i=`${r}2`;if((n in e||!(n in t))&&(i in e||!(i in t)))return e;let a=Object.entries(e),o=e[r];return a.splice(a.findIndex(([s])=>s===r)+1,0,[n,o],[i,o]),Object.fromEntries(a)}function $D(e,t,{title:r}){return this.format.title(r.value[e],e)}function*ED(e,t,r,n,i){for(let a in r){if(a==="fx"||a==="fy"){yield{label:lp(n,r,a),value:this.format[a](t[a],e)};continue}if(a==="x1"&&"x2"in r||a==="y1"&&"y2"in r)continue;let o=r[a];if(a==="x2"&&"x1"in r)yield{label:b$(n,r,"x"),value:y$(this.format.x2,r.x1,o,e)};else if(a==="y2"&&"y1"in r)yield{label:b$(n,r,"y"),value:y$(this.format.y2,r.y1,o,e)};else{let s=o.value[e],u=o.scale;if(!Hn(s)&&u==null)continue;yield{label:lp(n,r,a),value:this.format[a](s,e),color:u==="color"?i[a][e]:null,opacity:u==="opacity"?i[a][e]:null}}}}function y$(e,t,r,n){return r.hint?.length?`${e(r.value[n]-t.value[n],n)}`:`${e(t.value[n],n)}\u2013${e(r.value[n],n)}`}function b$(e,t,r){let n=lp(e,t,`${r}1`,r),i=lp(e,t,`${r}2`,r);return n===i?n:`${n}\u2013${i}`}function lp(e,t,r,n=r){let i=t[r],a=e[i?.scale??r];return String(a?.label??i?.label??n)}function rc(e={}){let{facet:t,style:r,title:n,subtitle:i,caption:a,ariaLabel:o,ariaDescription:s}=e,u=gu(e.className),l=e.marks===void 0?[]:_$(e.marks);l.push(...BD(l));let c=CD(t,e),f=new Map;for(let he of l){let qe=x$(he,c,e);qe&&f.set(he,qe)}let p=new Map;c&&tc(p,[c],e),tc(p,f,e);let d=_$(RD(l,p,e));for(let he of d){let qe=x$(he,c,e);qe&&f.set(he,qe)}l.unshift(...d);let m=vx(p,e);if(m!==void 0){let he=c?Hd(m,c):void 0;for(let ae of l){if(ae.facet===null||ae.facet==="super")continue;let we=f.get(ae);we!==void 0&&(we.facetsIndex=ae.fx!=null||ae.fy!=null?Hd(m,we):he)}let qe=new Set;for(let{facetsIndex:ae}of f.values())ae?.forEach((we,Re)=>{we?.length>0&&qe.add(Re)});m.forEach(0<qe.size&&qe.size<m.length?(ae,we)=>ae.empty=!qe.has(we):ae=>ae.empty=!1);for(let ae of l)if(ae.facet==="exclude"){let we=f.get(ae);we!==void 0&&(we.facetsIndex=$x(we.facetsIndex))}}for(let he of hr.keys())ru(e[he])&&he!=="fx"&&he!=="fy"&&p.set(he,[]);let g=new Map;for(let he of l){if(g.has(he))throw new Error("duplicate mark; each mark must be unique");let{facetsIndex:qe,channels:ae}=f.get(he)??{},{data:we,facets:Re,channels:ne}=he.initialize(qe,ae,e);z0(ne,e),g.set(he,{data:we,facets:Re,channels:ne})}let x=Kl(tc(p,g,e),e),b=jx(x,l,e);hx(x,b);let y=Wg(x),{fx:E,fy:$}=y,k=E||$?Hg(x,b):b,R=E||$?UD(y,b):b,C=mu(e),P=C.document,W=SD("svg").call(P.documentElement),te=W;C.ownerSVGElement=W,C.className=u,C.projection=Ax(e,k),C.path=function(){return TD(this.projection??Rx(y))},C.filterFacets=(he,qe)=>Hd(m,{channels:qe,groups:Vd(he,qe)}),C.getMarkState=he=>{let qe=g.get(he),ae=f.get(he);return{...qe,channels:{...qe.channels,...ae?.channels}}},C.dispatchValue=he=>{te.value!==he&&(te.value=he,te.dispatchEvent(new C.document.defaultView.Event("input",{bubbles:!0})))};let ce=new Set;for(let[he,qe]of g)if(he.initializer!=null){let ae=he.facet==="super"?R:k,we=he.initializer(qe.data,qe.facets,qe.channels,y,ae,C);if(we.data!==void 0&&(qe.data=we.data),we.facets!==void 0&&(qe.facets=we.facets),we.channels!==void 0){let{fx:Re,fy:ne,...at}=we.channels;ID(at),Object.assign(qe.channels,at);for(let kt of Object.values(at)){let{scale:pt}=kt;pt!=null&&!$v(hr.get(pt))&&(S$(kt,e),ce.add(pt))}(Re!=null||ne!=null)&&f.set(he,!0)}}if(ce.size){let he=new Map;tc(he,g,e,Re=>ce.has(Re)),tc(p,g,e,Re=>ce.has(Re));let qe=PD(Kl(he,e),x),{scales:ae,...we}=Wg(qe);Object.assign(x,qe),Object.assign(y,we),Object.assign(y.scales,ae)}let pe,ge;m!==void 0&&(pe={x:E?.domain(),y:$?.domain()},m=_x(m,pe),ge=xx(E,$,b));for(let[he,qe]of g)qe.values=he.scale(qe.channels,y,C);let{width:fe,height:Me}=b;O0(W).attr("class",u).attr("fill","currentColor").attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("text-anchor","middle").attr("width",fe).attr("height",Me).attr("viewBox",`0 0 ${fe} ${Me}`).attr("aria-label",o).attr("aria-description",s).call(he=>he.append("style").text(`:where(.${u}) {
  --plot-background: white;
  display: block;
  height: auto;
  height: intrinsic;
  max-width: 100%;
}
:where(.${u} text),
:where(.${u} tspan) {
  white-space: pre;
}`)).call(yu,r);for(let he of l){let{channels:qe,values:ae,facets:we}=g.get(he);if(m===void 0||he.facet==="super"){let Re=null;if(we&&(Re=we[0],Re=he.filter(Re,qe,ae),Re.length===0))continue;let ne=he.render(Re,y,ae,R,C);if(ne==null)continue;W.appendChild(ne)}else{let Re;for(let ne of m){if(!(he.facetAnchor?.(m,pe,ne)??!ne.empty))continue;let at=null;if(we){let pt=f.has(he);if(at=we[pt?ne.i:0],at=he.filter(at,qe,ae),at.length===0)continue;!pt&&at===we[0]&&(at=lv(at)),at.fx=ne.x,at.fy=ne.y,at.fi=ne.i}let kt=he.render(at,y,ae,k,C);if(kt!=null){(Re??(Re=O0(W).append("g"))).append(()=>kt).datum(ne);for(let pt of["aria-label","aria-description","aria-hidden","transform"])kt.hasAttribute(pt)&&(Re.attr(pt,kt.getAttribute(pt)),kt.removeAttribute(pt))}}Re?.selectChildren().each(ge)}}let Ge=J3(x,C,e),{figure:He=n!=null||i!=null||a!=null||Ge.length>0}=e;He&&(te=P.createElement("figure"),te.className=`${u}-figure`,te.style.maxWidth="initial",n!=null&&te.append(v$(P,n,"h2")),i!=null&&te.append(v$(P,i,"h3")),te.append(...Ge,W),a!=null&&te.append(AD(P,a)),"value"in W&&(te.value=W.value,delete W.value)),te.scale=bx(y.scales),te.legend=Y3(x,C,e);let dt=K_();return dt>0&&O0(W).append("text").attr("x",fe).attr("y",20).attr("dy","-1em").attr("text-anchor","end").attr("font-family","initial").text("\u26A0\uFE0F").append("title").text(`${dt.toLocaleString("en-US")} warning${dt===1?"":"s"}. Please check the console.`),te}function v$(e,t,r){if(t.ownerDocument)return t;let n=e.createElement(r);return n.append(t),n}function AD(e,t){let r=e.createElement("figcaption");return r.append(t),r}function _$(e){return e.flat(1/0).filter(t=>t!=null).map(kD)}function kD(e){return typeof e.render=="function"?e:new R0(e)}var R0=class extends Dr{constructor(t){if(typeof t!="function")throw new TypeError("invalid mark; missing render function");super(),this.render=t}render(){}};function z0(e,t){for(let r in e)S$(e[r],t);return e}function S$(e,t){let{scale:r,transform:n=!0}=e;if(r==null||!n)return;let{type:i,percent:a,interval:o,transform:s=a?u=>u==null?NaN:u*100:bg(o,i)}=t[r]??{};s!=null&&(e.value=pr(e.value,s),e.transform=!1)}function ID(e){for(let t in e)Bg(t,e[t])}function tc(e,t,r,n=iv){for(let{channels:i}of t.values())for(let a in i){let o=i[a],{scale:s}=o;if(s!=null&&n(s))if(s==="projection"){if(!Cx(r)){let u=r.x?.domain===void 0,l=r.y?.domain===void 0;if(u||l){let[c,f]=Bx(o);u&&B0(e,"x",c),l&&B0(e,"y",f)}}}else B0(e,s,o)}return e}function B0(e,t,r){let n=e.get(t);n!==void 0?n.push(r):e.set(t,[r])}function CD(e,t){if(e==null)return;let{x:r,y:n}=e;if(r==null&&n==null)return;let i=ua(e.data);if(i==null)throw new Error("missing facet data");let a={};r!=null&&(a.fx=uu(i,{value:r,scale:"fx"})),n!=null&&(a.fy=uu(i,{value:n,scale:"fy"})),z0(a,t);let o=Vd(i,a);return{channels:a,groups:o,data:e.data}}function x$(e,t,r){if(e.facet===null||e.facet==="super")return;let{fx:n,fy:i}=e;if(n!=null||i!=null){let u=ua(e.data??n??i);if(u===void 0)throw new Error(`missing facet data in ${e.ariaLabel}`);if(u===null)return;let l={};return n!=null&&(l.fx=uu(u,{value:n,scale:"fx"})),i!=null&&(l.fy=uu(u,{value:i,scale:"fy"})),z0(l,r),{channels:l,groups:Vd(u,l)}}if(t===void 0)return;let{channels:a,groups:o,data:s}=t;if(e.facet!=="auto"||e.data===s)return{channels:a,groups:o};s.length>0&&(o.size>1||o.size===1&&a.fx&&a.fy&&[...o][0][1].size>1)&&ja(ua(e.data))===ja(s)&&Cn(`Warning: the ${e.ariaLabel} mark appears to use faceted data, but isn\u2019t faceted. The mark data has the same length as the facet data and the mark facet option is "auto", but the mark data and facet data are distinct. If this mark should be faceted, set the mark facet option to true; otherwise, suppress this warning by setting the mark facet option to false.`)}function OD(e,t={}){return ca({...t,x:null,y:null},(r,n,i,a,o,s)=>s.getMarkState(e))}function BD(e){let t=[];for(let r of e){let n=r.tip;if(n){n===!0?n={}:typeof n=="string"&&(n={pointer:n});let{pointer:i,preferredAnchor:a}=n;i=/^x$/i.test(i)?Hx:/^y$/i.test(i)?a0:Wx,n=i(OD(r,n)),n.title=null,a===void 0&&(n.preferredAnchor=i===a0?"left":"bottom");let o=w$(r.data,n);o.facet=r.facet,o.facetAnchor=r.facetAnchor,t.push(o)}}return t}function RD(e,t,r){let{projection:n,x:i={},y:a={},fx:o={},fy:s={},axis:u,grid:l,facet:c={},facet:{axis:f=u,grid:p}=c,x:{axis:d=u,grid:m=d===null?null:l}=i,y:{axis:g=u,grid:x=g===null?null:l}=a,fx:{axis:b=f,grid:y=b===null?null:p}=o,fy:{axis:E=f,grid:$=E===null?null:p}=s}=r;(n||!ru(i)&&!$$("x",e))&&(d=m=null),(n||!ru(a)&&!$$("y",e))&&(g=x=null),t.has("fx")||(b=y=null),t.has("fy")||(E=$=null),d===void 0&&(d=!dp(e,"x")),g===void 0&&(g=!dp(e,"y")),b===void 0&&(b=!dp(e,"fx")),E===void 0&&(E=!dp(e,"fy")),d===!0&&(d="bottom"),g===!0&&(g="left"),b===!0&&(b=d==="top"||d===null?"bottom":"top"),E===!0&&(E=g==="right"||g===null?"left":"right");let k=[];return fp(k,$,z3,s),cp(k,E,I3,"right","left",c,s),fp(k,y,L3,o),cp(k,b,C3,"top","bottom",c,o),fp(k,x,R3,a),cp(k,g,$0,"left","right",r,a),fp(k,m,N3,i),cp(k,d,E0,"bottom","top",r,i),k}function cp(e,t,r,n,i,a,o){if(!t)return;let s=zD(t);o=ND(s?n:t,a,o);let{line:u}=o;(r===$0||r===E0)&&u&&!Mo(u)&&e.push(h$(LD(o))),e.push(r(o)),s&&e.push(r({...o,anchor:i,label:null}))}function fp(e,t,r,n){!t||Mo(t)||e.push(r(DD(t,n)))}function zD(e){return/^\s*both\s*$/i.test(e)}function ND(e,t,{line:r=t.line,ticks:n,tickSize:i,tickSpacing:a,tickPadding:o,tickFormat:s,tickRotate:u,fontVariant:l,ariaLabel:c,ariaDescription:f,label:p=t.label,labelAnchor:d,labelArrow:m=t.labelArrow,labelOffset:g}){return{anchor:e,line:r,ticks:n,tickSize:i,tickSpacing:a,tickPadding:o,tickFormat:s,tickRotate:u,fontVariant:l,ariaLabel:c,ariaDescription:f,label:p,labelAnchor:d,labelArrow:m,labelOffset:g}}function LD(e){let{anchor:t,line:r}=e;return{anchor:t,facetAnchor:t+"-empty",stroke:r===!0?void 0:r}}function DD(e,{stroke:t=au(e)?e:void 0,ticks:r=MD(e)?e:void 0,tickSpacing:n,ariaLabel:i,ariaDescription:a}){return{stroke:t,ticks:r,tickSpacing:n,ariaLabel:i,ariaDescription:a}}function MD(e){switch(typeof e){case"number":return!0;case"string":return!au(e)}return In(e)||typeof e?.range=="function"}function dp(e,t){let r=`${t}-axis `;return e.some(n=>n.ariaLabel?.startsWith(r))}function $$(e,t){for(let r of t)for(let n in r.channels){let{scale:i}=r.channels[n];if(i===e||i==="projection")return!0}return!1}function PD(e,t){for(let r in e){let n=e[r],i=t[r];n.label===void 0&&i&&(n.label=i.label)}return e}function UD({fx:e,fy:t},r){let{marginTop:n,marginRight:i,marginBottom:a,marginLeft:o,width:s,height:u}=Gd(r),l=e&&E$(e),c=t&&E$(t);return{marginTop:t?c[0]:n,marginRight:e?s-l[1]:i,marginBottom:t?u-c[1]:a,marginLeft:e?l[0]:o,inset:{marginTop:r.marginTop,marginRight:r.marginRight,marginBottom:r.marginBottom,marginLeft:r.marginLeft},width:s,height:u}}function E$(e){let t=e.domain();if(t.length===0)return[0,e.bandwidth()];let r=e(t[0]),n=e(t[t.length-1]);return n<r&&([r,n]=[n,r]),[r,n+e.bandwidth()]}import{area as OM}from"d3";import{curveBasis as FD,curveBasisClosed as GD,curveBasisOpen as jD,curveBundle as VD,curveBumpX as WD,curveBumpY as HD,curveCardinal as qD,curveCardinalClosed as XD,curveCardinalOpen as KD,curveCatmullRom as YD,curveCatmullRomClosed as ZD,curveCatmullRomOpen as QD,curveLinear as T$,curveLinearClosed as JD,curveMonotoneX as eM,curveMonotoneY as tM,curveNatural as rM,curveStep as nM,curveStepAfter as iM,curveStepBefore as aM}from"d3";var oM=new Map([["basis",FD],["basis-closed",GD],["basis-open",jD],["bundle",VD],["bump-x",WD],["bump-y",HD],["cardinal",qD],["cardinal-closed",XD],["cardinal-open",KD],["catmull-rom",YD],["catmull-rom-closed",ZD],["catmull-rom-open",QD],["linear",T$],["linear-closed",JD],["monotone-x",eM],["monotone-y",tM],["natural",rM],["step",nM],["step-after",iM],["step-before",aM]]);function A$(e=T$,t){if(typeof e=="function")return e;let r=oM.get(`${e}`.toLowerCase());if(!r)throw new Error(`unknown curve: ${e}`);if(t!==void 0){if("beta"in r)return r.beta(t);if("tension"in r)return r.tension(t);if("alpha"in r)return r.alpha(t)}return r}import{bisect as sM,extent as pp,thresholdFreedmanDiaconis as uM,thresholdScott as C$,thresholdSturges as lM,tickIncrement as cM,ticks as fM,utcTickInterval as dM}from"d3";function pM(e={y:"count"},t={}){[e,t]=gM(e,t);let{x:r,y:n}=t;return mM(yM(r,t,Cr),null,null,n,e,Ql(t))}function hM(e,t,r={}){if(r?.interval==null)return r;let{reduce:n=Nd}=r,i={filter:null};return r[t]!=null&&(i[t]=n),r[`${t}1`]!=null&&(i[`${t}1`]=n),r[`${t}2`]!=null&&(i[`${t}2`]=n),e(i,r)}function O$(e={}){return hM(pM,"y",jo(e,"x"))}function mM(e,t,r,n,{data:i=Cg,filter:a=jl,sort:o,reverse:s,...u}={},l={}){e=k$(e),t=k$(t),u=wM(u,l),i=z$(i,Cr),o=o==null?void 0:B$("sort",o,l),a=a==null?void 0:R$("filter",a,l),r!=null&&Vl(u,"x","x1","x2")&&(r=null),n!=null&&Vl(u,"y","y1","y2")&&(n=null);let[c,f]=Xn(e),[p,d]=Xn(e),[m,g]=Xn(t),[x,b]=Xn(t),[y,E]=r!=null?[r,"x"]:n!=null?[n,"y"]:[],[$,k]=Xn(y),{x:R,y:C,z:P,fill:W,stroke:te,x1:ce,x2:pe,y1:ge,y2:fe,domain:Me,cumulative:Ge,thresholds:He,interval:dt,...he}=l,[qe,ae]=Xn(P),[we]=kn(W),[Re]=kn(te),[ne,at]=Xn(we),[kt,pt]=Xn(Re);return{..."z"in l&&{z:qe||P},..."fill"in l&&{fill:ne||W},..."stroke"in l&&{stroke:kt||te},...Go(he,(mt,gt,Dt)=>{let Bt=Gl(Er(mt,y),Dt?.[E]),er=Er(mt,P),yr=Er(mt,we),Kt=Er(mt,Re),br=Rv(u,{z:er,fill:yr,stroke:Kt}),w=[],T=[],O=Bt&&k([]),q=er&&ae([]),ie=yr&&at([]),S=Kt&&pt([]),ze=e&&f([]),Mt=e&&d([]),qt=t&&g([]),fr=t&&b([]),Lt=xM(e,t,mt),Rt=0;for(let cn of u)cn.initialize(mt);o&&o.initialize(mt),a&&a.initialize(mt);for(let cn of gt){let Ea=[];for(let Pn of u)Pn.scope("facet",cn);o&&o.scope("facet",cn),a&&a.scope("facet",cn);for(let[Pn,Un]of Ig(cn,br))for(let[ki,Mr]of Ig(Un,Bt))for(let[Br,yn]of Lt(Mr))if(br&&(yn.z=Pn),!(a&&!a.reduce(Br,yn))){Ea.push(Rt++),T.push(i.reduceIndex(Br,mt,yn)),Bt&&O.push(ki),er&&q.push(br===er?Pn:er[(Br.length>0?Br:Mr)[0]]),yr&&ie.push(br===yr?Pn:yr[(Br.length>0?Br:Mr)[0]]),Kt&&S.push(br===Kt?Pn:Kt[(Br.length>0?Br:Mr)[0]]),ze&&(ze.push(yn.x1),Mt.push(yn.x2)),qt&&(qt.push(yn.y1),fr.push(yn.y2));for(let vs of u)vs.reduce(Br,yn);o&&o.reduce(Br,yn)}w.push(Ea)}return zv(w,o,s),{data:T,facets:w}}),...!Vl(u,"x")&&(c?{x1:c,x2:p,x:Fl(c,p)}:{x:R,x1:ce,x2:pe}),...!Vl(u,"y")&&(m?{y1:m,y2:x,y:Fl(m,x)}:{y:C,y1:ge,y2:fe}),...$&&{[E]:$},...Object.fromEntries(u.map(({name:mt,output:gt})=>[mt,gt]))}}function gM({cumulative:e,domain:t,thresholds:r,interval:n,...i},a){return[i,{cumulative:e,domain:t,thresholds:r,interval:n,...a}]}function yM(e,{cumulative:t,domain:r,thresholds:n,interval:i},a){return e={...ji(e)},e.domain===void 0&&(e.domain=r),e.cumulative===void 0&&(e.cumulative=t),e.thresholds===void 0&&(e.thresholds=n),e.interval===void 0&&(e.interval=i),e.value===void 0&&(e.value=a),e.thresholds=bM(e.thresholds,e.interval),e}function k$(e){if(e==null)return;let{value:t,cumulative:r,domain:n=pp,thresholds:i}=e,a=o=>{let s=Er(o,t),u;if(Gr(s)||_M(i)){s=pr(s,gg,Float64Array);let[c,f]=typeof n=="function"?n(s):n,p=typeof i=="function"&&!Va(i)?i(s,c,f):i;typeof p=="number"&&(p=dM(c,f,p)),Va(p)&&(n===pp&&(c=p.floor(c),f=p.offset(p.floor(f))),p=p.range(c,p.offset(f))),u=p}else{s=Do(s);let[c,f]=typeof n=="function"?n(s):n,p=typeof i=="function"&&!Va(i)?i(s,c,f):i;if(typeof p=="number")if(n===pp){let d=cM(c,f,p);if(isFinite(d))if(d>0){let m=Math.round(c/d),g=Math.round(f/d);m*d<=c||--m,g*d>f||++g;let x=g-m+1;p=new Float64Array(x);for(let b=0;b<x;++b)p[b]=(m+b)*d}else if(d<0){d=-d;let m=Math.round(c*d),g=Math.round(f*d);m/d<=c||--m,g/d>f||++g;let x=g-m+1;p=new Float64Array(x);for(let b=0;b<x;++b)p[b]=(m+b)/d}else p=[c];else p=[c]}else p=fM(c,f,p);else Va(p)&&(n===pp&&(c=p.floor(c),f=p.offset(p.floor(f))),p=p.range(c,p.offset(f)));u=p}let l=[];if(u.length===1)l.push([u[0],u[0]]);else for(let c=1;c<u.length;++c)l.push([u[c-1],u[c]]);return l.bin=(r<0?EM:r>0?$M:N0)(l,u,s),l};return a.label=di(t),a}function bM(e,t,r=I$){if(e===void 0)return t===void 0?r:Gi(t);if(typeof e=="string"){switch(e.toLowerCase()){case"freedman-diaconis":return uM;case"scott":return C$;case"sturges":return lM;case"auto":return I$}return Pl(e)}return e}function wM(e,t){return Bv(e,t,B$)}function B$(e,t,r){return Ag(e,t,r,R$)}function R$(e,t,r){return kg(e,t,r,z$)}function z$(e,t){return Wl(e,t,vM)}function vM(e){switch(`${e}`.toLowerCase()){case"x":return SM;case"x1":return AM;case"x2":return kM;case"y":return TM;case"y1":return IM;case"y2":return CM;case"z":return Nv}throw new Error(`invalid bin reduce: ${e}`)}function I$(e,t,r){return Math.min(200,C$(e,t,r))}function _M(e){return dv(e)||In(e)&&Gr(e)}function xM(e,t,r){let n=e?.(r),i=t?.(r);return n&&i?function*(a){let o=n.bin(a);for(let[s,[u,l]]of n.entries()){let c=i.bin(o[s]);for(let[f,[p,d]]of i.entries())yield[c[f],{data:r,x1:u,y1:p,x2:l,y2:d}]}}:n?function*(a){let o=n.bin(a);for(let[s,[u,l]]of n.entries())yield[o[s],{data:r,x1:u,x2:l}]}:function*(a){let o=i.bin(a);for(let[s,[u,l]]of i.entries())yield[o[s],{data:r,y1:u,y2:l}]}}function N0(e,t,r){return t=Do(t),n=>{let i=e.map(()=>[]);for(let a of n)i[sM(t,r[a])-1]?.push(a);return i}}function $M(e,t,r){let n=N0(e,t,r);return i=>{let a=n(i);for(let o=1,s=a.length;o<s;++o){let u=a[o-1],l=a[o];for(let c of u)l.push(c)}return a}}function EM(e,t,r){let n=N0(e,t,r);return i=>{let a=n(i);for(let o=a.length-2;o>=0;--o){let s=a[o+1],u=a[o];for(let l of s)u.push(l)}return a}}function N$(e,t){let r=(+e+ +t)/2;return e instanceof Date?new Date(r):r}var SM={reduceIndex(e,t,{x1:r,x2:n}){return N$(r,n)}},TM={reduceIndex(e,t,{y1:r,y2:n}){return N$(r,n)}},AM={reduceIndex(e,t,{x1:r}){return r}},kM={reduceIndex(e,t,{x2:r}){return r}},IM={reduceIndex(e,t,{y1:r}){return r}},CM={reduceIndex(e,t,{y2:r}){return r}};var BM={ariaLabel:"area",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:1},hp=class extends Dr{constructor(t,r={}){let{x1:n,y1:i,x2:a,y2:o,z:s,curve:u,tension:l}=r;super(t,{x1:{value:n,scale:"x"},y1:{value:i,scale:"y"},x2:{value:a,scale:"x",optional:!0},y2:{value:o,scale:"y",optional:!0},z:{value:kd(r),optional:!0}},r,BM),this.z=s,this.curve=A$(u,l)}filter(t){return t}render(t,r,n,i,a){let{x1:o,y1:s,x2:u=o,y2:l=s}=n;return wr("svg:g",a).call(_n,this,i,a).call($n,this,r,0,0).call(c=>c.selectAll().data(Ux(t,[o,s,u,l],this,n)).enter().append("path").call(xn,this).call(Px,this,n).attr("d",OM().curve(this.curve).defined(f=>f>=0).x0(f=>o[f]).y0(f=>s[f]).x1(f=>u[f]).y1(f=>l[f]))).node()}};function L0(e,t){let{x:r=tu,...n}=O$(t);return new hp(e,o$(e$({...n,x1:r,x2:void 0},r===tu?"y2":"y")))}import{pathRound as mp,symbolCircle as L$}from"d3";var RM={ariaLabel:"dot",fill:"none",stroke:"currentColor",strokeWidth:1.5};function zM(e){return e.sort===void 0&&e.reverse===void 0?Iv({channel:"-r"},e):e}var gp=class extends Dr{constructor(t,r={}){let{x:n,y:i,r:a,rotate:o,symbol:s=L$,frameAnchor:u}=r,[l,c]=Nr(o,0),[f,p]=Tv(s),[d,m]=Nr(a,f==null?3:4.5);super(t,{x:{value:n,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},r:{value:d,scale:"r",filter:No,optional:!0},rotate:{value:l,optional:!0},symbol:{value:f,scale:"auto",optional:!0}},zM(r),RM),this.r=m,this.rotate=c,this.symbol=p,this.frameAnchor=Wa(u);let{channels:g}=this,{symbol:x}=g;if(x){let{fill:b,stroke:y}=g;x.hint={fill:b?b.value===x.value?"color":"currentColor":this.fill??"currentColor",stroke:y?y.value===x.value?"color":"currentColor":this.stroke??"none"}}}render(t,r,n,i,a){let{x:o,y:s}=r,{x:u,y:l,r:c,rotate:f,symbol:p}=n,{r:d,rotate:m,symbol:g}=this,[x,b]=Hi(this,i),y=g===L$,E=c?void 0:d*d*Math.PI;return Ys(d)&&(t=[]),wr("svg:g",a).call(_n,this,i,a).call($n,this,{x:u&&o,y:l&&s}).call($=>$.selectAll().data(t).enter().append(y?"circle":"path").call(xn,this).call(y?k=>{k.attr("cx",u?R=>u[R]:x).attr("cy",l?R=>l[R]:b).attr("r",c?R=>c[R]:d)}:k=>{k.attr("transform",bu`translate(${u?R=>u[R]:x},${l?R=>l[R]:b})${f?R=>` rotate(${f[R]})`:m?` rotate(${m})`:""}`).attr("d",c&&p?R=>{let C=mp();return p[R].draw(C,c[R]*c[R]*Math.PI),C}:c?R=>{let C=mp();return g.draw(C,c[R]*c[R]*Math.PI),C}:p?R=>{let C=mp();return p[R].draw(C,E),C}:(()=>{let R=mp();return g.draw(R,E),R})())}).call(hi,this,n)).node()}};function D0(e,{x:t,y:r,...n}={}){return n.frameAnchor===void 0&&([t,r]=la(t,r)),new gp(e,{...n,x:t,y:r})}Dr.prototype.plot=function({marks:e=[],...t}={}){return rc({...t,marks:[...e,this]})};import*as j$ from"d3";var P$=GB(D$(),1),M$=new WeakMap;function LM(e){let r=document.createElement("canvas").getContext("2d");r.fillStyle=e;let n=r.fillStyle;if(n.startsWith("#")){let a=parseInt(n.slice(1),16),o=a>>16&255,s=a>>8&255,u=a&255;return[o/255,s/255,u/255,1]}let i=n.match(/\d+(\.\d+)?/g);return i?[Number(i[0])/255,Number(i[1])/255,Number(i[2])/255,i[3]?Number(i[3]):1]:[0,0,0,1]}function DM(e){let t="node"in e?e.node():e,r=t.querySelector("canvas.webgl-layer");if(!r){let i="ownerSVGElement"in t&&t.ownerSVGElement||t,a=i.viewBox?.baseVal,o=a&&a.width?a.width:i.clientWidth,s=a&&a.height?a.height:i.clientHeight;r=document.createElement("canvas"),r.className="webgl-layer",r.width=o,r.height=s,r.style.position="absolute",r.style.left="0",r.style.top="0",r.style.pointerEvents="none",t.appendChild(r)}let n=M$.get(r);return n||(n=(0,P$.default)({canvas:r}),M$.set(r,n)),[r,n]}function U$(e,t,r,n,i){let[a,o]=DM(e),s=t.map(f=>[r(f),n(f)]),u=t.map(f=>LM(i(f))),l=o({attributes:{position:s,color:u},uniforms:{pointSize:6},vert:`
    precision mediump float;
    attribute vec2 position;
    attribute vec4 color;
    uniform float pointSize;
    varying vec4 vColor;
    void main() {
      vColor = color;
      gl_PointSize = pointSize;
      gl_Position = vec4(
        position.x / ${a.width}.0 * 2.0 - 1.0,
        1.0 - position.y / ${a.height}.0 * 2.0,
        0.0,
        1.0);
    }`,frag:`
    precision mediump float;
    varying vec4 vColor;
    void main() {
      gl_FragColor = vColor;
    }`,count:s.length});function c(){o.clear({color:[0,0,0,0],depth:1}),l(),requestAnimationFrame(c)}c()}function Ho(e){if(e.length===0)return[];let t=[...e].sort((i,a)=>a.logic-i.logic||a.feasible-i.feasible),r=[],n=-1/0;for(let i of t)i.feasible>=n&&(r.push(i),n=i.feasible);return r}var F$={gaussian:"#ff7f0e",swap:"#2ca02c",jump:"#d62728",scramble:"#9467bd",front:"#00afff",base:"#666"};function U0(e,t){let r=Math.max(1,t??e??1);return`rgba(0,175,255,${1-Math.min(e??0,r)/r})`}function MM(e){let t=e.node?e.node():e,r=t.querySelector("foreignObject#canvas-layer");if(!r){let i=t.ownerSVGElement||t,a=i.viewBox?.baseVal,o=a&&a.width?a.width:i.clientWidth,s=a&&a.height?a.height:i.clientHeight;r=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"),r.setAttribute("id","canvas-layer"),r.setAttribute("x",0),r.setAttribute("y",0),r.setAttribute("width",o),r.setAttribute("height",s),r.style.pointerEvents="none",r.style.overflow="visible";let u=document.createElement("canvas");return u.width=o,u.height=s,r.appendChild(u),t.appendChild(r),u.getContext("2d")}return r.querySelector("canvas").getContext("2d")}function G$(e,t,r,n){let i=MM(e);i.clearRect(0,0,i.canvas.width,i.canvas.height);let a=20,o=Array.from({length:a},()=>Array(a).fill(0));for(let c of t){let f=Math.max(0,Math.min(a-1,Math.floor(r(c.logic)/i.canvas.width*a))),p=Math.max(0,Math.min(a-1,Math.floor(n(c.feasible)/i.canvas.height*a)));o[p][f]+=1}let s=Math.max(...o.flat(),1),u=i.canvas.width/a,l=i.canvas.height/a;for(let c=0;c<a;c++)for(let f=0;f<a;f++){let p=o[c][f];p&&(i.fillStyle=`rgba(255,0,0,${p/s*.3})`,i.fillRect(f*u,c*l,u,l))}return i}function yp(e,t,r){let n=Ho(t).sort((l,c)=>l.logic-c.logic),i=t.reduce((l,c)=>Math.max(l,c.depth??0),0),a={x:"logic",y:"feasible",r:3,fill:l=>U0(l.depth??0,i),title:l=>`${l.summary??""}
${l.critic??""}`},o=[L0(n,{x:"logic",y:"feasible",fill:"rgba(0,175,255,0.2)",stroke:null})];t.length<=1e4&&o.push(D0(t,a));let s=rc({width:500,height:500,x:{domain:[0,1]},y:{domain:[0,1]},marks:o});e.innerHTML="",e.append(s);let u=s.querySelector("svg")||s;t.length>1e4&&U$(u,t,l=>l.logic*500,l=>(1-l.feasible)*500,l=>U0(l.depth??0,i)),G$(u,t,l=>l.logic*500,l=>(1-l.feasible)*500),r&&j$.select(s).selectAll("circle").on("click",function(l,c){r(c,this)})}function V$(){let e=document.createElement("div");e.id="critic-panel",e.setAttribute("role","region"),e.setAttribute("aria-label","Critic"),Object.assign(e.style,{position:"fixed",top:"10px",right:"10px",background:"rgba(0,0,0,0.7)",color:"#fff",padding:"8px",font:"14px sans-serif",display:"none",zIndex:1e3});let t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width","200"),t.setAttribute("height","200"),t.id="critic-chart";let r=document.createElement("table");r.id="critic-table",r.style.marginTop="4px",r.style.fontSize="12px",e.appendChild(t),e.appendChild(r),document.body.appendChild(e);let n=null;function i(o){let s=Object.keys(o),u=Object.values(o),c=200/2,f=c-20,p=Math.PI*2/s.length;t.innerHTML="";let d=[];s.forEach((g,x)=>{let b=x*p-Math.PI/2,y=f*(u[x]??0),E=c+y*Math.cos(b),$=c+y*Math.sin(b);d.push(`${E},${$}`);let k=c+f*Math.cos(b),R=c+f*Math.sin(b),C=c+(f+12)*Math.cos(b),P=c+(f+12)*Math.sin(b),W=document.createElementNS("http://www.w3.org/2000/svg","line");W.setAttribute("x1",String(c)),W.setAttribute("y1",String(c)),W.setAttribute("x2",String(k)),W.setAttribute("y2",String(R)),W.setAttribute("stroke","#ccc"),t.appendChild(W);let te=document.createElementNS("http://www.w3.org/2000/svg","text");te.setAttribute("x",String(C)),te.setAttribute("y",String(P)),te.setAttribute("font-size","10"),te.setAttribute("text-anchor","middle"),te.setAttribute("dominant-baseline","middle"),te.textContent=g,t.appendChild(te)});let m=document.createElementNS("http://www.w3.org/2000/svg","polygon");m.setAttribute("points",d.join(" ")),m.setAttribute("fill","rgba(0,100,250,0.3)"),m.setAttribute("stroke","blue"),t.appendChild(m)}function a(o,s){n&&n.removeAttribute("stroke"),s&&(s.setAttribute("stroke","yellow"),n=s),i(o),r.innerHTML=Object.entries(o).map(([u,l])=>`<tr><th>${u}</th><td>${l.toFixed(2)}</td></tr>`).join(""),e.style.display="block"}return{show:a}}function nc(e,t){let r={dbp:Promise.resolve(null),storeName:t,memory:null};return typeof indexedDB>"u"?(r.dbp=Promise.resolve(null),r.memory=new Map,r):(r.dbp=new Promise(n=>{try{let i=indexedDB.open(e,1);i.onupgradeneeded=()=>i.result.createObjectStore(t),i.onsuccess=()=>n(i.result),i.onerror=()=>{r.memory=new Map,n(null)}}catch{r.memory=new Map,n(null)}}),r)}async function F0(e,t,r){if(t.memory)return Promise.resolve(r(t.memory));let n=await t.dbp;return n?new Promise((i,a)=>{let o=n.transaction(t.storeName,e),s=o.objectStore(t.storeName),u=r(s);o.oncomplete=()=>i(u?.result),o.onerror=()=>a(o.error)}):(t.memory=new Map,Promise.resolve(r(t.memory)))}function _u(e,t,r){return F0("readwrite",r,n=>n instanceof Map?n.set(e,t):n.put(t,e))}function G0(e,t){return F0("readwrite",t,r=>(r instanceof Map,r.delete(e)))}function xu(e){return F0("readonly",e,t=>t instanceof Map?Array.from(t.values()):t.getAll())}async function W$(e="./data/critics/innovations.txt"){try{let t=await fetch(e);return t.ok?(await t.text()).split(/\n/).map(n=>n.trim()).filter(Boolean):[]}catch{return[]}}var ic=class{constructor(t=[],r="judge logic"){An(this,"examples");An(this,"prompt");An(this,"index");An(this,"scale");this.examples=t,this.prompt=r,this.index={},this.examples.forEach((n,i)=>{this.index[n.toLowerCase()]=i}),this.scale=Math.max(this.examples.length-1,1)}score(t){let r=String(t).toLowerCase(),n=this.index[r]??-1,i=n>=0?(n+1)/(this.scale+1):0,a=Math.random()*.001,o=i+a;return Math.min(1,Math.max(0,o))}},$u=class e{constructor(t=[],r="judge feasibility"){An(this,"examples");An(this,"prompt");this.examples=t,this.prompt=r}static jaccard(t,r){let n=new Set(t),i=new Set(r);if(!n.size||!i.size)return 0;let a=0;for(let s of n)i.has(s)&&a++;let o=new Set([...t,...r]).size;return a/o}score(t){let r=String(t).toLowerCase().split(/\s+/),n=0;for(let o of this.examples){let s=e.jaccard(r,o.toLowerCase().split(/\s+/));s>n&&(n=s)}let i=Math.random()*.001,a=n+i;return Math.min(1,Math.max(0,a))}},j0=class{constructor(t="critic-judgments"){An(this,"store");this.store=nc(t,"judgments")}async add(t,r){await _u(String(Date.now()+Math.random()),{genome:t,scores:r},this.store)}async querySimilar(t){let r=await xu(this.store),n=String(t).toLowerCase().split(/\s+/),i=null,a=-1;for(let o of r){let s=$u.jaccard(n,o.genome.toLowerCase().split(/\s+/));s>a&&(a=s,i=o)}return i}};function PM(e,t=Math.random){let r=["insightful","detailed","robust","novel"],n=e.split(/\s+/);if(t()<.5&&n.length>1)n.splice(Math.floor(t()*n.length),1);else{let i=r[Math.floor(t()*r.length)];n.splice(Math.floor(t()*(n.length+1)),0,i)}return n.join(" ")}function H$(e){let t=Object.values(e),r=t.reduce((i,a)=>i+a,0)/t.length;return 1-Math.sqrt(t.reduce((i,a)=>i+(a-r)**2,0)/t.length)}async function UM(e,t,r,n=.6){let i={};for(let s of t)i[s.constructor.name]=s.score(e);let a=r?await r.querySimilar(e):null;if(a)for(let s of Object.keys(i))a.scores[s]!==void 0&&(i[s]=(i[s]+a.scores[s])/2);r&&await r.add(e,i);let o=H$(i);if(o<n){for(let s of t)s.prompt&&(s.prompt=PM(s.prompt));typeof window<"u"&&(window.recordedPrompts=t.map(s=>s.prompt||""))}return{scores:i,cons:o}}typeof window<"u"&&(window.JudgmentDB=j0,window.consilience=H$,window.scoreGenome=UM,window.LogicCritic=ic,window.FeasibilityCritic=$u);function V0(e,t){let r={gen:e.gen??0,pop:Array.from(e,n=>({logic:n.logic,feasible:n.feasible,front:n.front,strategy:n.strategy})),rngState:t};return JSON.stringify(r)}function q$(e){let t;try{t=JSON.parse(e)}catch(o){throw new Error(`Malformed JSON: ${o.message}`)}if(t===null||typeof t!="object")throw new Error("Invalid data");let r=new Set(["gen","pop","rngState"]);for(let o of Object.keys(t))if(!r.has(o))throw new Error(`Unexpected key: ${o}`);if(!Array.isArray(t.pop))throw new Error("Invalid population");let n=new Set(["logic","feasible","front","strategy"]),i=t.pop.map(o=>{if(o===null||typeof o!="object")throw new Error("Invalid population item");for(let s of Object.keys(o))if(!n.has(s))throw new Error(`Invalid key in population item: ${s}`);if(typeof o.logic!="number"||typeof o.feasible!="number")throw new Error("Population items require numeric logic and feasible");return{logic:o.logic,feasible:o.feasible,front:o.front,strategy:o.strategy}}),a=typeof t.gen=="number"?t.gen:0;return i.gen=a,{pop:i,rngState:t.rngState,gen:a}}function X$(e,t){function r(a){a.preventDefault(),e.classList.add("drag")}function n(){e.classList.remove("drag")}function i(a){a.preventDefault(),e.classList.remove("drag");let o=a.dataTransfer,s=o&&o.files&&o.files[0];if(!s)return;let u=new FileReader;u.onload=()=>t(u.result),u.readAsText(s)}e.addEventListener("dragover",r),e.addEventListener("dragleave",n),e.addEventListener("drop",i)}function K$(e,t){if(!e.length)return"";let r=t||Object.keys(e[0]),n=a=>`"${String(a).replace(/"/g,'""')}"`,i=[r.join(",")];for(let a of e)i.push(r.map(o=>n(a[o])).join(","));return i.join(`
`)}async function Y$(e){let t=new XMLSerializer().serializeToString(e),r=new Blob([t],{type:"image/svg+xml"}),n=URL.createObjectURL(r),i=new Image;await new Promise((l,c)=>{i.onload=()=>l(),i.onerror=c,i.src=n});let o=document.createElement("canvas"),s=e.viewBox.baseVal;return o.width=s&&s.width?s.width:e.clientWidth,o.height=s&&s.height?s.height:e.clientHeight,o.getContext("2d").drawImage(i,0,0),URL.revokeObjectURL(n),new Promise(l=>o.toBlob(c=>l(c),"image/png"))}function FM(e){if(typeof e.next=="function")return e;if(typeof e[Symbol.iterator]=="function")return e[Symbol.iterator]();if(typeof e[Symbol.asyncIterator]=="function")return e[Symbol.asyncIterator]();throw new TypeError('"values" does not to conform to any of the iterator or iterable protocols')}function GM(){let e,t;return{promise:new Promise((r,n)=>{t=r,e=n}),reject:e,resolve:t}}function jM(e,t,r){let n=FM(r),i=[],a=[],o=!1,s=!1,u=0,l=null;function c(){for(;a.length>0&&i.length>0;){let{resolve:d}=a.shift();d({done:!1,value:i.shift()})}for(;a.length>0&&u===0&&o;){let{resolve:d,reject:m}=a.shift();l?(m(l),l=null):d({done:!0,value:void 0})}}async function f(){if(o)c();else if(!(s||u+i.length>=e)){s=!0,u++;try{let{done:d,value:m}=await n.next();d?(o=!0,u--,c()):async function(g){try{let x=await t(g);i.push(x)}catch(x){o=!0,l=x}u--,c(),f()}(m)}catch(d){o=!0,u--,l=d,c()}s=!1,f()}}let p={next:async function(){if(i.length===0){let m=GM();return a.push(m),f(),m.promise}let d=i.shift();return f(),{done:!1,value:d}},[Symbol.asyncIterator]:()=>p};return p}function kp(e,t,r){return t===void 0?(n,i)=>i?kp(e,n,i):kp(e,n):r===void 0?n=>kp(e,t,n):jM(e,t,r)}var Ya=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function VM(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function XE(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach(function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}),t}var Lp={exports:{}},KE={};function Yn(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var WM=Yn;Yn.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},Yn.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},Yn.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(r===void 0){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},r),this._options.unref&&this._timer.unref(),!0},Yn.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},Yn.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},Yn.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},Yn.prototype.start=Yn.prototype.try,Yn.prototype.errors=function(){return this._errors},Yn.prototype.attempts=function(){return this._attempts},Yn.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var i=this._errors[n],a=i.message,o=(e[a]||0)+1;e[a]=o,o>=r&&(t=i,r=o)}return t},function(e){var t=WM;e.operation=function(r){var n=e.timeouts(r);return new t(n,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})},e.timeouts=function(r){if(r instanceof Array)return[].concat(r);var n={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var i in r)n[i]=r[i];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var a=[],o=0;o<n.retries;o++)a.push(this.createTimeout(o,n));return r&&r.forever&&!a.length&&a.push(this.createTimeout(o,n)),a.sort(function(s,u){return s-u}),a},e.createTimeout=function(r,n){var i=n.randomize?Math.random()+1:1,a=Math.round(i*Math.max(n.minTimeout,1)*Math.pow(n.factor,r));return a=Math.min(a,n.maxTimeout)},e.wrap=function(r,n,i){if(n instanceof Array&&(i=n,n=null),!i)for(var a in i=[],r)typeof r[a]=="function"&&i.push(a);for(var o=0;o<i.length;o++){var s=i[o],u=r[s];r[s]=function(l){var c=e.operation(n),f=Array.prototype.slice.call(arguments,1),p=f.pop();f.push(function(d){c.retry(d)||(d&&(arguments[0]=c.mainError()),p.apply(this,arguments))}),c.attempt(function(){l.apply(r,f)})}.bind(r,u),r[s].options=n}}}(KE);var HM=KE,qM=HM,XM=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],Dp=class extends Error{constructor(t){super(),t instanceof Error?(this.originalError=t,{message:t}=t):(this.originalError=new Error(t),this.originalError.stack=this.stack),this.name="AbortError",this.message=t}},KM=(e,t,r)=>{let n=r.retries-(t-1);return e.attemptNumber=t,e.retriesLeft=n,e},YM=e=>XM.includes(e),Z$=(e,t)=>new Promise((r,n)=>{t={onFailedAttempt:()=>{},retries:10,...t};let i=qM.operation(t);i.attempt(async a=>{try{r(await e(a))}catch(o){if(!(o instanceof Error))return void n(new TypeError(`Non-error was thrown: "${o}". You should only throw errors.`));if(o instanceof Dp)i.stop(),n(o.originalError);else if(o instanceof TypeError&&!YM(o.message))i.stop(),n(o);else{KM(o,a,t);try{await t.onFailedAttempt(o)}catch(s){return void n(s)}i.retry(o)||n(i.mainError())}}})});Lp.exports=Z$,Lp.exports.default=Z$;var ZM=Lp.exports.AbortError=Dp,QM=Lp.exports,JM=async e=>{let t;for await(let r of e)t=r;return t},YE=JM,ku={exports:{}},ZE=(...e)=>{let t;for(;e.length;)t=e.shift()(t);return t},Gy=e=>e&&(typeof e[Symbol.asyncIterator]=="function"||typeof e[Symbol.iterator]=="function"||typeof e.next=="function"),Ip=e=>e&&typeof e.sink=="function"&&Gy(e.source),eP=e=>t=>(e.sink(t),e.source),Q$=(...e)=>{if(Ip(e[0])){let t=e[0];e[0]=()=>t.source}else if(Gy(e[0])){let t=e[0];e[0]=()=>t}if(e.length>1&&Ip(e[e.length-1])&&(e[e.length-1]=e[e.length-1].sink),e.length>2)for(let t=1;t<e.length-1;t++)Ip(e[t])&&(e[t]=eP(e[t]));return ZE(...e)};ku.exports=Q$,ku.exports.pipe=Q$,ku.exports.rawPipe=ZE,ku.exports.isIterable=Gy,ku.exports.isDuplex=Ip;var tP=ku.exports,rP=ay,J$=128,nP=127,iP=~nP,aP=Math.pow(2,31);function ay(e,t,r){if(Number.MAX_SAFE_INTEGER&&e>Number.MAX_SAFE_INTEGER)throw ay.bytes=0,new RangeError("Could not encode varint");t=t||[];for(var n=r=r||0;e>=aP;)t[r++]=255&e|J$,e/=128;for(;e&iP;)t[r++]=255&e|J$,e>>>=7;return t[r]=0|e,ay.bytes=r-n+1,t}var oP=oy,sP=128,eE=127;function oy(e,t){var r,n=0,i=0,a=t=t||0,o=e.length;do{if(a>=o||i>49)throw oy.bytes=0,new RangeError("Could not decode varint");r=e[a++],n+=i<28?(r&eE)<<i:(r&eE)*Math.pow(2,i),i+=7}while(r>=sP);return oy.bytes=a-t,n}var uP=Math.pow(2,7),lP=Math.pow(2,14),cP=Math.pow(2,21),fP=Math.pow(2,28),dP=Math.pow(2,35),pP=Math.pow(2,42),hP=Math.pow(2,49),mP=Math.pow(2,56),gP=Math.pow(2,63),yP=function(e){return e<uP?1:e<lP?2:e<cP?3:e<fP?4:e<dP?5:e<pP?6:e<hP?7:e<mP?8:e<gP?9:10},ba={encode:rP,decode:oP,encodingLength:yP},bP=QE,tE=128,wP=127,vP=~wP,_P=Math.pow(2,31);function QE(e,t,r){t=t||[];for(var n=r=r||0;e>=_P;)t[r++]=255&e|tE,e/=128;for(;e&vP;)t[r++]=255&e|tE,e>>>=7;return t[r]=0|e,QE.bytes=r-n+1,t}var xP=sy,$P=128,rE=127;function sy(e,t){var r,n=0,i=0,a=t=t||0,o=e.length;do{if(a>=o)throw sy.bytes=0,new RangeError("Could not decode varint");r=e[a++],n+=i<28?(r&rE)<<i:(r&rE)*Math.pow(2,i),i+=7}while(r>=$P);return sy.bytes=a-t,n}var EP=Math.pow(2,7),SP=Math.pow(2,14),TP=Math.pow(2,21),AP=Math.pow(2,28),kP=Math.pow(2,35),IP=Math.pow(2,42),CP=Math.pow(2,49),OP=Math.pow(2,56),BP=Math.pow(2,63),RP=function(e){return e<EP?1:e<SP?2:e<TP?3:e<AP?4:e<kP?5:e<IP?6:e<CP?7:e<OP?8:e<BP?9:10},zP={encode:bP,decode:xP,encodingLength:RP},Mp=zP,uy=(e,t=0)=>[Mp.decode(e,t),Mp.decode.bytes],Pp=(e,t,r=0)=>(Mp.encode(e,t,r),t),Up=e=>Mp.encodingLength(e),NP=new Uint8Array(0),LP=e=>{let t=e.match(/../g);return t?new Uint8Array(t.map(r=>parseInt(r,16))):NP},DP=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},Lu=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},MP=e=>new TextEncoder().encode(e),PP=e=>new TextDecoder().decode(e),Fp=(e,t)=>{let r=t.byteLength,n=Up(e),i=n+Up(r),a=new Uint8Array(i+r);return Pp(e,a,0),Pp(r,a,n),a.set(t,i),new hc(e,r,t,a)},Gp=e=>{let t=Lu(e),[r,n]=uy(t),[i,a]=uy(t.subarray(n)),o=t.subarray(n+a);if(o.byteLength!==i)throw new Error("Incorrect length");return new hc(r,i,o,t)},UP=(e,t)=>e===t||e.code===t.code&&e.size===t.size&&DP(e.bytes,t.bytes),hc=class{constructor(t,r,n,i){this.code=t,this.size=r,this.digest=n,this.bytes=i}};function FP(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var a=e.charAt(i),o=a.charCodeAt(0);if(r[o]!==255)throw new TypeError(a+" is ambiguous");r[o]=i}var s=e.length,u=e.charAt(0),l=Math.log(s)/Math.log(256),c=Math.log(256)/Math.log(s);function f(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var d=0;if(p[d]!==" "){for(var m=0,g=0;p[d]===u;)m++,d++;for(var x=(p.length-d)*l+1>>>0,b=new Uint8Array(x);p[d];){var y=r[p.charCodeAt(d)];if(y===255)return;for(var E=0,$=x-1;(y!==0||E<g)&&$!==-1;$--,E++)y+=s*b[$]>>>0,b[$]=y%256>>>0,y=y/256>>>0;if(y!==0)throw new Error("Non-zero carry");g=E,d++}if(p[d]!==" "){for(var k=x-g;k!==x&&b[k]===0;)k++;for(var R=new Uint8Array(m+(x-k)),C=m;k!==x;)R[C++]=b[k++];return R}}}return{encode:function(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var d=0,m=0,g=0,x=p.length;g!==x&&p[g]===0;)g++,d++;for(var b=(x-g)*c+1>>>0,y=new Uint8Array(b);g!==x;){for(var E=p[g],$=0,k=b-1;(E!==0||$<m)&&k!==-1;k--,$++)E+=256*y[k]>>>0,y[k]=E%s>>>0,E=E/s>>>0;if(E!==0)throw new Error("Non-zero carry");m=$,g++}for(var R=b-m;R!==b&&y[R]===0;)R++;for(var C=u.repeat(d);R<b;++R)C+=e.charAt(y[R]);return C},decodeUnsafe:f,decode:function(p){var d=f(p);if(d)return d;throw new Error(`Non-${t} character`)}}}var GP=FP,jP=GP,ly=class{constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},cy=class{constructor(t,r,n){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(t){return JE(this,t)}},fy=class{constructor(t){this.decoders=t}or(t){return JE(this,t)}decode(t){let r=t[0],n=this.decoders[r];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},JE=(e,t)=>new fy({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}}),dy=class{constructor(t,r,n,i){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new ly(t,r,n),this.decoder=new cy(t,r,i)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}},oh=({name:e,prefix:t,encode:r,decode:n})=>new dy(e,t,r,n),Ec=({prefix:e,name:t,alphabet:r})=>{let{encode:n,decode:i}=jP(r,t);return oh({prefix:e,name:t,encode:n,decode:a=>Lu(i(a))})},VP=(e,t,r,n)=>{let i={};for(let c=0;c<t.length;++c)i[t[c]]=c;let a=e.length;for(;e[a-1]==="=";)--a;let o=new Uint8Array(a*r/8|0),s=0,u=0,l=0;for(let c=0;c<a;++c){let f=i[e[c]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);u=u<<r|f,s+=r,s>=8&&(s-=8,o[l++]=255&u>>s)}if(s>=r||255&u<<8-s)throw new SyntaxError("Unexpected end of data");return o},WP=(e,t,r)=>{let n=t[t.length-1]==="=",i=(1<<r)-1,a="",o=0,s=0;for(let u=0;u<e.length;++u)for(s=s<<8|e[u],o+=8;o>r;)o-=r,a+=t[i&s>>o];if(o&&(a+=t[i&s<<r-o]),n)for(;a.length*r&7;)a+="=";return a},ln=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>oh({prefix:t,name:e,encode:i=>WP(i,n,r),decode:i=>VP(i,n,r,e)}),ya=Ec({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),HP=Ec({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),qP=Object.freeze({__proto__:null,base58btc:ya,base58flickr:HP}),fc=ln({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),XP=ln({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),KP=ln({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),YP=ln({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ZP=ln({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),QP=ln({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),JP=ln({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),eU=ln({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),tU=ln({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),rU=Object.freeze({__proto__:null,base32:fc,base32upper:XP,base32pad:KP,base32padupper:YP,base32hex:ZP,base32hexupper:QP,base32hexpad:JP,base32hexpadupper:eU,base32z:tU}),mr=class e{constructor(t,r,n,i){this.code=r,this.version=t,this.multihash=n,this.bytes=i,this.byteOffset=i.byteOffset,this.byteLength=i.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:wp,byteLength:wp,code:bp,version:bp,multihash:bp,bytes:bp,_baseCache:wp,asCID:wp})}toV0(){if(this.version===0)return this;{let{code:t,multihash:r}=this;if(t!==ac)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==oU)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return e.createV0(r)}}toV1(){switch(this.version){case 0:{let{code:t,digest:r}=this.multihash,n=Fp(t,r);return e.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(t){return t&&this.code===t.code&&this.version===t.version&&UP(this.multihash,t.multihash)}toString(t){let{bytes:r,version:n,_baseCache:i}=this;return n===0?iU(r,i,t||ya.encoder):aU(r,i,t||fc.encoder)}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(t){return uU(/^0\.0/,lU),!(!t||!t[iE]&&t.asCID!==t)}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(t){if(t instanceof e)return t;if(t!=null&&t.asCID===t){let{version:r,code:n,multihash:i,bytes:a}=t;return new e(r,n,i,a||nE(r,n,i.bytes))}if(t!=null&&t[iE]===!0){let{version:r,multihash:n,code:i}=t,a=Gp(n);return e.create(r,i,a)}return null}static create(t,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");switch(t){case 0:if(r!==ac)throw new Error(`Version 0 CID must use dag-pb (code: ${ac}) block encoding`);return new e(t,r,n,n.bytes);case 1:{let i=nE(t,r,n.bytes);return new e(t,r,n,i)}default:throw new Error("Invalid version")}}static createV0(t){return e.create(0,ac,t)}static createV1(t,r){return e.create(1,t,r)}static decode(t){let[r,n]=e.decodeFirst(t);if(n.length)throw new Error("Incorrect length");return r}static decodeFirst(t){let r=e.inspectBytes(t),n=r.size-r.multihashSize,i=Lu(t.subarray(n,n+r.multihashSize));if(i.byteLength!==r.multihashSize)throw new Error("Incorrect length");let a=i.subarray(r.multihashSize-r.digestSize),o=new hc(r.multihashCode,r.digestSize,a,i);return[r.version===0?e.createV0(o):e.createV1(r.codec,o),t.subarray(r.size)]}static inspectBytes(t){let r=0,n=()=>{let[c,f]=uy(t.subarray(r));return r+=f,c},i=n(),a=ac;if(i===18?(i=0,r=0):i===1&&(a=n()),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let o=r,s=n(),u=n(),l=r+u;return{version:i,codec:a,multihashCode:s,digestSize:u,multihashSize:l-o,size:l}}static parse(t,r){let[n,i]=nU(t,r),a=e.decode(i);return a._baseCache.set(n,t),a}},nU=(e,t)=>{switch(e[0]){case"Q":{let r=t||ya;return[ya.prefix,r.decode(`${ya.prefix}${e}`)]}case ya.prefix:{let r=t||ya;return[ya.prefix,r.decode(e)]}case fc.prefix:{let r=t||fc;return[fc.prefix,r.decode(e)]}default:if(t==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},iU=(e,t,r)=>{let{prefix:n}=r;if(n!==ya.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let i=t.get(n);if(i==null){let a=r.encode(e).slice(1);return t.set(n,a),a}return i},aU=(e,t,r)=>{let{prefix:n}=r,i=t.get(n);if(i==null){let a=r.encode(e);return t.set(n,a),a}return i},ac=112,oU=18,nE=(e,t,r)=>{let n=Up(e),i=n+Up(t),a=new Uint8Array(i+r.byteLength);return Pp(e,a,0),Pp(t,a,n),a.set(r,i),a},iE=Symbol.for("@ipld/js-cid/CID"),bp={writable:!1,configurable:!1,enumerable:!0},wp={writable:!1,enumerable:!1,configurable:!1},sU="0.0.0-dev",uU=(e,t)=>{if(!e.test(sU))throw new Error(t);console.warn(t)},lU=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`,cU=["string","number","bigint","symbol"],fU=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function dU(e){if(e===null)return"null";if(e===void 0)return"undefined";if(e===!0||e===!1)return"boolean";let t=typeof e;return cU.includes(t)?t:t==="function"?"Function":Array.isArray(e)?"Array":pU(e)?"Buffer":hU(e)||"Object"}function pU(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}function hU(e){let t=Object.prototype.toString.call(e).slice(8,-1);if(fU.includes(t))return t}var ke=class{constructor(t,r,n){this.major=t,this.majorEncoded=t<<5,this.name=r,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(t){return this.major<t.major?-1:this.major>t.major?1:0}};ke.uint=new ke(0,"uint",!0),ke.negint=new ke(1,"negint",!0),ke.bytes=new ke(2,"bytes",!0),ke.string=new ke(3,"string",!0),ke.array=new ke(4,"array",!1),ke.map=new ke(5,"map",!1),ke.tag=new ke(6,"tag",!1),ke.float=new ke(7,"float",!0),ke.false=new ke(7,"false",!0),ke.true=new ke(7,"true",!0),ke.null=new ke(7,"null",!0),ke.undefined=new ke(7,"undefined",!0),ke.break=new ke(7,"break",!0);var Tt=class{constructor(t,r,n){this.type=t,this.value=r,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}},Du=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",mU=new TextDecoder,gU=new TextEncoder;function jp(e){return Du&&globalThis.Buffer.isBuffer(e)}function eS(e){return e instanceof Uint8Array?jp(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}var yU=Du?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):oE(e,t,r):(e,t,r)=>r-t>64?mU.decode(e.subarray(t,r)):oE(e,t,r),bU=Du?e=>e.length>64?globalThis.Buffer.from(e):aE(e):e=>e.length>64?gU.encode(e):aE(e),ma=e=>Uint8Array.from(e),jy=Du?(e,t,r)=>jp(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),wU=Du?(e,t)=>(e=e.map(r=>r instanceof Uint8Array?r:globalThis.Buffer.from(r)),eS(globalThis.Buffer.concat(e,t))):(e,t)=>{let r=new Uint8Array(t),n=0;for(let i of e)n+i.length>r.length&&(i=i.subarray(0,r.length-n)),r.set(i,n),n+=i.length;return r},vU=Du?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function _U(e,t){if(jp(e)&&jp(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}function aE(e,t=1/0){let r,n=e.length,i=null,a=[];for(let o=0;o<n;++o){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function oE(e,t,r){let n=[];for(;t<r;){let i=e[t],a=null,o=i>239?4:i>223?3:i>191?2:1;if(t+o<=r){let s,u,l,c;switch(o){case 1:i<128&&(a=i);break;case 2:s=e[t+1],(192&s)==128&&(c=(31&i)<<6|63&s,c>127&&(a=c));break;case 3:s=e[t+1],u=e[t+2],(192&s)==128&&(192&u)==128&&(c=(15&i)<<12|(63&s)<<6|63&u,c>2047&&(c<55296||c>57343)&&(a=c));break;case 4:s=e[t+1],u=e[t+2],l=e[t+3],(192&s)==128&&(192&u)==128&&(192&l)==128&&(c=(15&i)<<18|(63&s)<<12|(63&u)<<6|63&l,c>65535&&c<1114112&&(a=c))}}a===null?(a=65533,o=1):a>65535&&(a-=65536,n.push(a>>>10&1023|55296),a=56320|1023&a),n.push(a),t+=o}return xU(n)}var sE=4096;function xU(e){let t=e.length;if(t<=sE)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=sE));return r}var $U=256,Vp=class{constructor(t=$U){this.chunkSize=t,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(t){let r=this.chunks[this.chunks.length-1];if(this.cursor+t.length<=this.maxCursor+1){let n=r.length-(this.maxCursor-this.cursor)-1;r.set(t,n)}else{if(r){let n=r.length-(this.maxCursor-this.cursor)-1;n<r.length&&(this.chunks[this.chunks.length-1]=r.subarray(0,n),this.maxCursor=this.cursor-1)}t.length<64&&t.length<this.chunkSize?(r=vU(this.chunkSize),this.chunks.push(r),this.maxCursor+=r.length,this._initReuseChunk===null&&(this._initReuseChunk=r),r.set(t,0)):(this.chunks.push(t),this.maxCursor+=t.length)}this.cursor+=t.length}toBytes(t=!1){let r;if(this.chunks.length===1){let n=this.chunks[0];t&&this.cursor>n.length/2?(r=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):r=jy(n,0,this.cursor)}else r=wU(this.chunks,this.cursor);return t&&this.reset(),r}},tr="CBOR decode error:",tS="CBOR encode error:";function Mu(e,t,r){if(e.length-t<r)throw new Error(`${tr} not enough data for type`)}var un=[24,256,65536,4294967296,BigInt("18446744073709551616")];function es(e,t,r){Mu(e,t,1);let n=e[t];if(r.strict===!0&&n<un[0])throw new Error(`${tr} integer encoded in more bytes than necessary (strict decode)`);return n}function ts(e,t,r){Mu(e,t,2);let n=e[t]<<8|e[t+1];if(r.strict===!0&&n<un[1])throw new Error(`${tr} integer encoded in more bytes than necessary (strict decode)`);return n}function rs(e,t,r){Mu(e,t,4);let n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(r.strict===!0&&n<un[2])throw new Error(`${tr} integer encoded in more bytes than necessary (strict decode)`);return n}function ns(e,t,r){Mu(e,t,8);let n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],i=16777216*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],a=(BigInt(n)<<BigInt(32))+BigInt(i);if(r.strict===!0&&a<un[3])throw new Error(`${tr} integer encoded in more bytes than necessary (strict decode)`);if(a<=Number.MAX_SAFE_INTEGER)return Number(a);if(r.allowBigInt===!0)return a;throw new Error(`${tr} integers outside of the safe integer range are not supported`)}function EU(e,t,r,n){return new Tt(ke.uint,es(e,t+1,n),2)}function SU(e,t,r,n){return new Tt(ke.uint,ts(e,t+1,n),3)}function TU(e,t,r,n){return new Tt(ke.uint,rs(e,t+1,n),5)}function AU(e,t,r,n){return new Tt(ke.uint,ns(e,t+1,n),9)}function Yo(e,t){return Jn(e,0,t.value)}function Jn(e,t,r){if(r<un[0]){let n=Number(r);e.push([t|n])}else if(r<un[1]){let n=Number(r);e.push([24|t,n])}else if(r<un[2]){let n=Number(r);e.push([25|t,n>>>8,255&n])}else if(r<un[3]){let n=Number(r);e.push([26|t,n>>>24&255,n>>>16&255,n>>>8&255,255&n])}else{let n=BigInt(r);if(!(n<un[4]))throw new Error(`${tr} encountered BigInt larger than allowable range`);{let i=[27|t,0,0,0,0,0,0,0],a=Number(n&BigInt(4294967295)),o=Number(n>>BigInt(32)&BigInt(4294967295));i[8]=255&a,a>>=8,i[7]=255&a,a>>=8,i[6]=255&a,a>>=8,i[5]=255&a,i[4]=255&o,o>>=8,i[3]=255&o,o>>=8,i[2]=255&o,o>>=8,i[1]=255&o,e.push(i)}}}function kU(e,t,r,n){return new Tt(ke.negint,-1-es(e,t+1,n),2)}function IU(e,t,r,n){return new Tt(ke.negint,-1-ts(e,t+1,n),3)}function CU(e,t,r,n){return new Tt(ke.negint,-1-rs(e,t+1,n),5)}Yo.encodedSize=function(e){return Jn.encodedSize(e.value)},Jn.encodedSize=function(e){return e<un[0]?1:e<un[1]?2:e<un[2]?3:e<un[3]?5:9},Yo.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};var Vy=BigInt(-1),rS=BigInt(1);function OU(e,t,r,n){let i=ns(e,t+1,n);if(typeof i!="bigint"){let a=-1-i;if(a>=Number.MIN_SAFE_INTEGER)return new Tt(ke.negint,a,9)}if(n.allowBigInt!==!0)throw new Error(`${tr} integers outside of the safe integer range are not supported`);return new Tt(ke.negint,Vy-BigInt(i),9)}function py(e,t){let r=t.value,n=typeof r=="bigint"?r*Vy-rS:-1*r-1;Jn(e,t.type.majorEncoded,n)}function Sc(e,t,r,n){Mu(e,t,r+n);let i=jy(e,t+r,t+r+n);return new Tt(ke.bytes,i,r+n)}function BU(e,t,r,n){return Sc(e,t,1,r)}function RU(e,t,r,n){return Sc(e,t,2,es(e,t+1,n))}function zU(e,t,r,n){return Sc(e,t,3,ts(e,t+1,n))}function NU(e,t,r,n){return Sc(e,t,5,rs(e,t+1,n))}function LU(e,t,r,n){let i=ns(e,t+1,n);if(typeof i=="bigint")throw new Error(`${tr} 64-bit integer bytes lengths not supported`);return Sc(e,t,9,i)}function Cp(e){return e.encodedBytes===void 0&&(e.encodedBytes=e.type===ke.string?bU(e.value):e.value),e.encodedBytes}function Wp(e,t){let r=Cp(t);Jn(e,t.type.majorEncoded,r.length),e.push(r)}function DU(e,t){return e.length<t.length?-1:e.length>t.length?1:_U(e,t)}function Tc(e,t,r,n,i){let a=r+n;Mu(e,t,a);let o=new Tt(ke.string,yU(e,t+r,t+a),a);return i.retainStringBytes===!0&&(o.byteValue=jy(e,t+r,t+a)),o}function MU(e,t,r,n){return Tc(e,t,1,r,n)}function PU(e,t,r,n){return Tc(e,t,2,es(e,t+1,n),n)}function UU(e,t,r,n){return Tc(e,t,3,ts(e,t+1,n),n)}function FU(e,t,r,n){return Tc(e,t,5,rs(e,t+1,n),n)}function GU(e,t,r,n){let i=ns(e,t+1,n);if(typeof i=="bigint")throw new Error(`${tr} 64-bit integer string lengths not supported`);return Tc(e,t,9,i,n)}py.encodedSize=function(e){let t=e.value,r=typeof t=="bigint"?t*Vy-rS:-1*t-1;return r<un[0]?1:r<un[1]?2:r<un[2]?3:r<un[3]?5:9},py.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0},Wp.encodedSize=function(e){let t=Cp(e);return Jn.encodedSize(t.length)+t.length},Wp.compareTokens=function(e,t){return DU(Cp(e),Cp(t))};var jU=Wp;function Pu(e,t,r,n){return new Tt(ke.array,n,r)}function VU(e,t,r,n){return Pu(e,t,1,r)}function WU(e,t,r,n){return Pu(e,t,2,es(e,t+1,n))}function HU(e,t,r,n){return Pu(e,t,3,ts(e,t+1,n))}function qU(e,t,r,n){return Pu(e,t,5,rs(e,t+1,n))}function XU(e,t,r,n){let i=ns(e,t+1,n);if(typeof i=="bigint")throw new Error(`${tr} 64-bit integer array lengths not supported`);return Pu(e,t,9,i)}function KU(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${tr} indefinite length items not allowed`);return Pu(e,t,1,1/0)}function hy(e,t){Jn(e,ke.array.majorEncoded,t.value)}function Uu(e,t,r,n){return new Tt(ke.map,n,r)}function YU(e,t,r,n){return Uu(e,t,1,r)}function ZU(e,t,r,n){return Uu(e,t,2,es(e,t+1,n))}function QU(e,t,r,n){return Uu(e,t,3,ts(e,t+1,n))}function JU(e,t,r,n){return Uu(e,t,5,rs(e,t+1,n))}function eF(e,t,r,n){let i=ns(e,t+1,n);if(typeof i=="bigint")throw new Error(`${tr} 64-bit integer map lengths not supported`);return Uu(e,t,9,i)}function tF(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${tr} indefinite length items not allowed`);return Uu(e,t,1,1/0)}function my(e,t){Jn(e,ke.map.majorEncoded,t.value)}function rF(e,t,r,n){return new Tt(ke.tag,r,1)}function nF(e,t,r,n){return new Tt(ke.tag,es(e,t+1,n),2)}function iF(e,t,r,n){return new Tt(ke.tag,ts(e,t+1,n),3)}function aF(e,t,r,n){return new Tt(ke.tag,rs(e,t+1,n),5)}function oF(e,t,r,n){return new Tt(ke.tag,ns(e,t+1,n),9)}function gy(e,t){Jn(e,ke.tag.majorEncoded,t.value)}hy.compareTokens=Yo.compareTokens,hy.encodedSize=function(e){return Jn.encodedSize(e.value)},my.compareTokens=Yo.compareTokens,my.encodedSize=function(e){return Jn.encodedSize(e.value)},gy.compareTokens=Yo.compareTokens,gy.encodedSize=function(e){return Jn.encodedSize(e.value)};var sF=20,uF=21,lF=22,cF=23;function fF(e,t,r,n){if(n.allowUndefined===!1)throw new Error(`${tr} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new Tt(ke.null,null,1):new Tt(ke.undefined,void 0,1)}function dF(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${tr} indefinite length items not allowed`);return new Tt(ke.break,void 0,1)}function Wy(e,t,r){if(r){if(r.allowNaN===!1&&Number.isNaN(e))throw new Error(`${tr} NaN values are not supported`);if(r.allowInfinity===!1&&(e===1/0||e===-1/0))throw new Error(`${tr} Infinity values are not supported`)}return new Tt(ke.float,e,t)}function pF(e,t,r,n){return Wy(qy(e,t+1),3,n)}function hF(e,t,r,n){return Wy(Xy(e,t+1),5,n)}function mF(e,t,r,n){return Wy(oS(e,t+1),9,n)}function Hy(e,t,r){let n=t.value;if(n===!1)e.push([ke.float.majorEncoded|sF]);else if(n===!0)e.push([ke.float.majorEncoded|uF]);else if(n===null)e.push([ke.float.majorEncoded|lF]);else if(n===void 0)e.push([ke.float.majorEncoded|cF]);else{let i,a=!1;r&&r.float64===!0||(iS(n),i=qy(gi,1),n===i||Number.isNaN(n)?(gi[0]=249,e.push(gi.slice(0,3)),a=!0):(aS(n),i=Xy(gi,1),n===i&&(gi[0]=250,e.push(gi.slice(0,5)),a=!0))),a||(gF(n),i=oS(gi,1),gi[0]=251,e.push(gi.slice(0,9)))}}Hy.encodedSize=function(e,t){let r=e.value;if(r===!1||r===!0||r==null)return 1;if(!t||t.float64!==!0){iS(r);let n=qy(gi,1);if(r===n||Number.isNaN(r))return 3;if(aS(r),n=Xy(gi,1),r===n)return 5}return 9};var nS=new ArrayBuffer(9),Zn=new DataView(nS,1),gi=new Uint8Array(nS,0);function iS(e){if(e===1/0)Zn.setUint16(0,31744,!1);else if(e===-1/0)Zn.setUint16(0,64512,!1);else if(Number.isNaN(e))Zn.setUint16(0,32256,!1);else{Zn.setFloat32(0,e);let t=Zn.getUint32(0),r=(2139095040&t)>>23,n=8388607&t;if(r===255)Zn.setUint16(0,31744,!1);else if(r===0)Zn.setUint16(0,(2147483648&e)>>16|n>>13,!1);else{let i=r-127;i<-24?Zn.setUint16(0,0):i<-14?Zn.setUint16(0,(2147483648&t)>>16|1<<24+i,!1):Zn.setUint16(0,(2147483648&t)>>16|i+15<<10|n>>13,!1)}}}function qy(e,t){if(e.length-t<2)throw new Error(`${tr} not enough data for float16`);let r=(e[t]<<8)+e[t+1];if(r===31744)return 1/0;if(r===64512)return-1/0;if(r===32256)return NaN;let n=r>>10&31,i=1023&r,a;return a=n===0?i*2**-24:n!==31?(i+1024)*2**(n-25):i===0?1/0:NaN,32768&r?-a:a}function aS(e){Zn.setFloat32(0,e,!1)}function Xy(e,t){if(e.length-t<4)throw new Error(`${tr} not enough data for float32`);let r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function gF(e){Zn.setFloat64(0,e,!1)}function oS(e,t){if(e.length-t<8)throw new Error(`${tr} not enough data for float64`);let r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,8).getFloat64(0,!1)}function sr(e,t,r){throw new Error(`${tr} encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function sh(e){return()=>{throw new Error(`${tr} ${e}`)}}Hy.compareTokens=Yo.compareTokens;var ht=[];for(let e=0;e<=23;e++)ht[e]=sr;ht[24]=EU,ht[25]=SU,ht[26]=TU,ht[27]=AU,ht[28]=sr,ht[29]=sr,ht[30]=sr,ht[31]=sr;for(let e=32;e<=55;e++)ht[e]=sr;ht[56]=kU,ht[57]=IU,ht[58]=CU,ht[59]=OU,ht[60]=sr,ht[61]=sr,ht[62]=sr,ht[63]=sr;for(let e=64;e<=87;e++)ht[e]=BU;ht[88]=RU,ht[89]=zU,ht[90]=NU,ht[91]=LU,ht[92]=sr,ht[93]=sr,ht[94]=sr,ht[95]=sh("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)ht[e]=MU;ht[120]=PU,ht[121]=UU,ht[122]=FU,ht[123]=GU,ht[124]=sr,ht[125]=sr,ht[126]=sr,ht[127]=sh("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)ht[e]=VU;ht[152]=WU,ht[153]=HU,ht[154]=qU,ht[155]=XU,ht[156]=sr,ht[157]=sr,ht[158]=sr,ht[159]=KU;for(let e=160;e<=183;e++)ht[e]=YU;ht[184]=ZU,ht[185]=QU,ht[186]=JU,ht[187]=eF,ht[188]=sr,ht[189]=sr,ht[190]=sr,ht[191]=tF;for(let e=192;e<=215;e++)ht[e]=rF;ht[216]=nF,ht[217]=iF,ht[218]=aF,ht[219]=oF,ht[220]=sr,ht[221]=sr,ht[222]=sr,ht[223]=sr;for(let e=224;e<=243;e++)ht[e]=sh("simple values are not supported");ht[244]=sr,ht[245]=sr,ht[246]=sr,ht[247]=fF,ht[248]=sh("simple values are not supported"),ht[249]=pF,ht[250]=hF,ht[251]=mF,ht[252]=sr,ht[253]=sr,ht[254]=sr,ht[255]=dF;var qi=[];for(let e=0;e<24;e++)qi[e]=new Tt(ke.uint,e,1);for(let e=-1;e>=-24;e--)qi[31-e]=new Tt(ke.negint,e,1);function yF(e){switch(e.type){case ke.false:return ma([244]);case ke.true:return ma([245]);case ke.null:return ma([246]);case ke.bytes:return e.value.length?void 0:ma([64]);case ke.string:return e.value===""?ma([96]):void 0;case ke.array:return e.value===0?ma([128]):void 0;case ke.map:return e.value===0?ma([160]):void 0;case ke.uint:return e.value<24?ma([Number(e.value)]):void 0;case ke.negint:if(e.value>=-24)return ma([31-Number(e.value)])}}qi[64]=new Tt(ke.bytes,new Uint8Array(0),1),qi[96]=new Tt(ke.string,"",1),qi[128]=new Tt(ke.array,0,1),qi[160]=new Tt(ke.map,0,1),qi[244]=new Tt(ke.false,!1,1),qi[245]=new Tt(ke.true,!0,1),qi[246]=new Tt(ke.null,null,1);var bF={float64:!1,mapSorter:_F,quickEncodeToken:yF};function wF(){let e=[];return e[ke.uint.major]=Yo,e[ke.negint.major]=py,e[ke.bytes.major]=Wp,e[ke.string.major]=jU,e[ke.array.major]=hy,e[ke.map.major]=my,e[ke.tag.major]=gy,e[ke.float.major]=Hy,e}var sS=wF(),W0=new Vp,Hp=class e{constructor(t,r){this.obj=t,this.parent=r}includes(t){let r=this;do if(r.obj===t)return!0;while(r=r.parent);return!1}static createCheck(t,r){if(t&&t.includes(r))throw new Error(`${tS} object contains circular references`);return new e(r,t)}},Xa={null:new Tt(ke.null,null),undefined:new Tt(ke.undefined,void 0),true:new Tt(ke.true,!0),false:new Tt(ke.false,!1),emptyArray:new Tt(ke.array,0),emptyMap:new Tt(ke.map,0)},Qa={number:(e,t,r,n)=>Number.isInteger(e)&&Number.isSafeInteger(e)?new Tt(e>=0?ke.uint:ke.negint,e):new Tt(ke.float,e),bigint:(e,t,r,n)=>e>=BigInt(0)?new Tt(ke.uint,e):new Tt(ke.negint,e),Uint8Array:(e,t,r,n)=>new Tt(ke.bytes,e),string:(e,t,r,n)=>new Tt(ke.string,e),boolean:(e,t,r,n)=>e?Xa.true:Xa.false,null:(e,t,r,n)=>Xa.null,undefined:(e,t,r,n)=>Xa.undefined,ArrayBuffer:(e,t,r,n)=>new Tt(ke.bytes,new Uint8Array(e)),DataView:(e,t,r,n)=>new Tt(ke.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,r,n){if(!e.length)return r.addBreakTokens===!0?[Xa.emptyArray,new Tt(ke.break)]:Xa.emptyArray;n=Hp.createCheck(n,e);let i=[],a=0;for(let o of e)i[a++]=Op(o,r,n);return r.addBreakTokens?[new Tt(ke.array,e.length),i,new Tt(ke.break)]:[new Tt(ke.array,e.length),i]},Object(e,t,r,n){let i=t!=="Object",a=i?e.keys():Object.keys(e),o=i?e.size:a.length;if(!o)return r.addBreakTokens===!0?[Xa.emptyMap,new Tt(ke.break)]:Xa.emptyMap;n=Hp.createCheck(n,e);let s=[],u=0;for(let l of a)s[u++]=[Op(l,r,n),Op(i?e.get(l):e[l],r,n)];return vF(s,r),r.addBreakTokens?[new Tt(ke.map,o),s,new Tt(ke.break)]:[new Tt(ke.map,o),s]}};Qa.Map=Qa.Object,Qa.Buffer=Qa.Uint8Array;for(let e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Qa[`${e}Array`]=Qa.DataView;function Op(e,t={},r){let n=dU(e),i=t&&t.typeEncoders&&t.typeEncoders[n]||Qa[n];if(typeof i=="function"){let o=i(e,n,t,r);if(o!=null)return o}let a=Qa[n];if(!a)throw new Error(`${tS} unsupported type: ${n}`);return a(e,n,t,r)}function vF(e,t){t.mapSorter&&e.sort(t.mapSorter)}function _F(e,t){let r=Array.isArray(e[0])?e[0][0]:e[0],n=Array.isArray(t[0])?t[0][0]:t[0];if(r.type!==n.type)return r.type.compare(n.type);let i=r.type.major,a=sS[i].compareTokens(r,n);return a===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),a}function uS(e,t,r,n){if(Array.isArray(t))for(let i of t)uS(e,i,r,n);else r[t.type.major](e,t,n)}function xF(e,t,r){let n=Op(e,r);if(!Array.isArray(n)&&r.quickEncodeToken){let i=r.quickEncodeToken(n);if(i)return i;let a=t[n.type.major];if(a.encodedSize){let o=a.encodedSize(n,r),s=new Vp(o);if(a(s,n,r),s.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return eS(s.chunks[0])}}return W0.reset(),uS(W0,n,t,r),W0.toBytes(!0)}function lS(e,t){return t=Object.assign({},bF,t),xF(e,sS,t)}var $F={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0},yy=class{constructor(t,r={}){this.pos=0,this.data=t,this.options=r}done(){return this.pos>=this.data.length}next(){let t=this.data[this.pos],r=qi[t];if(r===void 0){let n=ht[t];if(!n)throw new Error(`${tr} no decoder for major type ${t>>>5} (byte 0x${t.toString(16).padStart(2,"0")})`);let i=31&t;r=n(this.data,this.pos,i,this.options)}return this.pos+=r.encodedLength,r}},mc=Symbol.for("DONE"),uh=Symbol.for("BREAK");function EF(e,t,r){let n=[];for(let i=0;i<e.value;i++){let a=gc(t,r);if(a===uh){if(e.value===1/0)break;throw new Error(`${tr} got unexpected break to lengthed array`)}if(a===mc)throw new Error(`${tr} found array but not enough entries (got ${i}, expected ${e.value})`);n[i]=a}return n}function SF(e,t,r){let n=r.useMaps===!0,i=n?void 0:{},a=n?new Map:void 0;for(let o=0;o<e.value;o++){let s=gc(t,r);if(s===uh){if(e.value===1/0)break;throw new Error(`${tr} got unexpected break to lengthed map`)}if(s===mc)throw new Error(`${tr} found map but not enough entries (got ${o} [no key], expected ${e.value})`);if(n!==!0&&typeof s!="string")throw new Error(`${tr} non-string keys not supported (got ${typeof s})`);let u=gc(t,r);if(u===mc)throw new Error(`${tr} found map but not enough entries (got ${o} [no value], expected ${e.value})`);n?a.set(s,u):i[s]=u}return n?a:i}function gc(e,t){if(e.done())return mc;let r=e.next();if(r.type===ke.break)return uh;if(r.type.terminal)return r.value;if(r.type===ke.array)return EF(r,e,t);if(r.type===ke.map)return SF(r,e,t);if(r.type===ke.tag){if(t.tags&&typeof t.tags[r.value]=="function"){let n=gc(e,t);return t.tags[r.value](n)}throw new Error(`${tr} tag not supported (${r.value})`)}throw new Error("unsupported")}function Ky(e,t){if(!(e instanceof Uint8Array))throw new Error(`${tr} data to decode must be a Uint8Array`);let r=(t=Object.assign({},$F,t)).tokenizer||new yy(e,t),n=gc(r,t);if(n===mc)throw new Error(`${tr} did not find any content to decode`);if(n===uh)throw new Error(`${tr} got unexpected break`);if(!r.done())throw new Error(`${tr} too many terminals, data makes no sense`);return n}var cS=42;function TF(e){if(e.asCID!==e)return null;let t=mr.asCID(e);if(!t)return null;let r=new Uint8Array(t.bytes.byteLength+1);return r.set(t.bytes,1),[new Tt(ke.tag,cS),new Tt(ke.bytes,r)]}function AF(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function kF(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var IF={float64:!0,typeEncoders:{Object:TF,undefined:AF,number:kF}};function CF(e){if(e[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return mr.decode(e.subarray(1))}var fS={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,tags:[]};fS.tags[cS]=CF;var OF=e=>lS(e,IF),BF=e=>Ky(e,fS),H0={SHA2_256:18,LENGTH:32,DAG_PB:112};async function qp(e){let t=await e.upTo(8),r=ba.decode(t);return e.seek(ba.decode.bytes),r}async function dS(e){let t=await qp(e);if(t===0)throw new Error("Invalid CAR header (zero length)");let r=await e.exactly(t);e.seek(t);let n=BF(r);if(n==null||Array.isArray(n)||typeof n!="object")throw new Error("Invalid CAR header format");if(n.version!==1)throw typeof n.version=="string"?new Error(`Invalid CAR version: "${n.version}"`):new Error(`Invalid CAR version: ${n.version}`);if(!Array.isArray(n.roots))throw new Error("Invalid CAR header format");if(Object.keys(n).filter(i=>i!=="roots"&&i!=="version").length)throw new Error("Invalid CAR header format");return n}async function RF(e){let t=await e.upTo(8);ba.decode(t);let r=ba.decode.bytes,n=ba.decode(t.subarray(ba.decode.bytes)),i=r+ba.decode.bytes+n,a=await e.exactly(i);return e.seek(i),a}async function zF(e){let t=await e.exactly(2);if(t[0]===H0.SHA2_256&&t[1]===H0.LENGTH){let o=await e.exactly(34);e.seek(34);let s=Gp(o);return mr.create(0,H0.DAG_PB,s)}let r=await qp(e);if(r!==1)throw new Error(`Unexpected CID version (${r})`);let n=await qp(e),i=await RF(e),a=Gp(i);return mr.create(r,n,a)}async function pS(e){let t=e.pos,r=await qp(e);if(r===0)throw new Error("Invalid CAR section (zero length)");return r+=e.pos-t,{cid:await zF(e),length:r,blockLength:r-(e.pos-t)}}async function NF(e){let{cid:t,blockLength:r}=await pS(e),n=await e.exactly(r);return e.seek(r),{bytes:n,cid:t}}async function LF(e){let t=e.pos,{cid:r,length:n,blockLength:i}=await pS(e),a={cid:r,length:n,blockLength:i,offset:t,blockOffset:e.pos};return e.seek(a.blockLength),a}function hS(e){let t=dS(e);return{header:()=>t,async*blocks(){for(await t;(await e.upTo(8)).length>0;)yield await NF(e)},async*blocksIndex(){for(await t;(await e.upTo(8)).length>0;)yield await LF(e)}}}function Yy(e){let t=0;return{upTo:async r=>e.subarray(t,t+Math.min(r,e.length-t)),async exactly(r){if(r>e.length-t)throw new Error("Unexpected end of data");return e.subarray(t,t+r)},seek(r){t+=r},get pos(){return t}}}function DF(e){let t=0,r=0,n=0,i=new Uint8Array(0),a=async o=>{r=i.length-n;let s=[i.subarray(n)];for(;r<o;){let l=await e();if(l==null)break;r<0?l.length>r&&s.push(l.subarray(-r)):s.push(l),r+=l.length}i=new Uint8Array(s.reduce((l,c)=>l+c.length,0));let u=0;for(let l of s)i.set(l,u),u+=l.length;n=0};return{upTo:async o=>(i.length-n<o&&await a(o),i.subarray(n,n+Math.min(i.length-n,o))),async exactly(o){if(i.length-n<o&&await a(o),i.length-n<o)throw new Error("Unexpected end of data");return i.subarray(n,n+o)},seek(o){t+=o,n+=o},get pos(){return t}}}function mS(e){let t=e[Symbol.asyncIterator]();return DF(async function(){let r=await t.next();return r.done?null:r.value})}var Bu=class{constructor(t,r,n){this._version=t,this._roots=r,this._blocks=n,this._keys=n.map(i=>i.cid.toString())}get version(){return this._version}async getRoots(){return this._roots}async has(t){return this._keys.indexOf(t.toString())>-1}async get(t){let r=this._keys.indexOf(t.toString());return r>-1?this._blocks[r]:void 0}async*blocks(){for(let t of this._blocks)yield t}async*cids(){for(let t of this._blocks)yield t.cid}static async fromBytes(t){if(!(t instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return uE(Yy(t))}static async fromIterable(t){if(!t||typeof t[Symbol.asyncIterator]!="function")throw new TypeError("fromIterable() requires an async iterable");return uE(mS(t))}};async function uE(e){let t=hS(e),{version:r,roots:n}=await t.header(),i=[];for await(let a of t.blocks())i.push(a);return new Bu(r,n,i)}var by=class{constructor(t,r,n){this._version=t,this._roots=r,this._iterable=n,this._decoded=!1}get version(){return this._version}async getRoots(){return this._roots}},wy=class e extends by{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");return this._decoded=!0,this._iterable[Symbol.asyncIterator]()}static async fromBytes(t){let{version:r,roots:n,iterator:i}=await MF(t);return new e(r,n,i)}static async fromIterable(t){let{version:r,roots:n,iterator:i}=await PF(t);return new e(r,n,i)}};async function MF(e){if(!(e instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return gS(Yy(e))}async function PF(e){if(!e||typeof e[Symbol.asyncIterator]!="function")throw new TypeError("fromIterable() requires an async iterable");return gS(mS(e))}async function gS(e){let t=hS(e),{version:r,roots:n}=await t.header();return{version:r,roots:n,iterator:t.blocks()}}function yS(e){let t=OF({version:1,roots:e}),r=ba.encode(t.length),n=new Uint8Array(r.length+t.length);return n.set(r,0),n.set(t,r.length),n}function UF(e){return{async setRoots(t){let r=yS(t);await e.write(r)},async writeBlock(t){let{cid:r,bytes:n}=t;await e.write(new Uint8Array(ba.encode(r.bytes.length+n.length))),await e.write(r.bytes),n.length&&await e.write(n)},close:async()=>e.end()}}function vp(){}function FF(){let e=[],t=null,r=vp,n=!1,i=null,a=vp,o=()=>(t||(t=new Promise(l=>{r=()=>{t=null,r=vp,l()}})),t),s={write(l){e.push(l);let c=o();return a(),c},async end(){n=!0;let l=o();return a(),l}},u={async next(){let l=e.shift();return l?(e.length===0&&r(),{done:!1,value:l}):n?(r(),{done:!0,value:void 0}):(i||(i=new Promise(c=>{a=()=>(i=null,a=vp,c(u.next()))})),i)}};return{writer:s,iterator:u}}var yc=class e{constructor(t,r){this._encoder=r,this._mutex=r.setRoots(t),this._ended=!1}async put(t){if(!(t.bytes instanceof Uint8Array&&t.cid))throw new TypeError("Can only write {cid, bytes} objects");if(this._ended)throw new Error("Already closed");let r=mr.asCID(t.cid);if(!r)throw new TypeError("Can only write {cid, bytes} objects");return this._mutex=this._mutex.then(()=>this._encoder.writeBlock({cid:r,bytes:t.bytes})),this._mutex}async close(){if(this._ended)throw new Error("Already closed");return await this._mutex,this._ended=!0,this._encoder.close()}static create(t){t=GF(t);let{encoder:r,iterator:n}=lE();return{writer:new e(t,r),out:new Xp(n)}}static createAppender(){let{encoder:t,iterator:r}=lE();return t.setRoots=()=>Promise.resolve(),{writer:new e([],t),out:new Xp(r)}}static async updateRootsInBytes(t,r){let n=Yy(t);await dS(n);let i=yS(r);if(n.pos!==i.length)throw new Error(`updateRoots() can only overwrite a header of the same length (old header is ${n.pos} bytes, new header is ${i.length} bytes)`);return t.set(i,0),t}},Xp=class{constructor(t){this._iterator=t}[Symbol.asyncIterator](){if(this._iterating)throw new Error("Multiple iterator not supported");return this._iterating=!0,this._iterator}};function lE(){let e=FF(),{writer:t,iterator:r}=e;return{encoder:UF(t),iterator:r}}function GF(e){if(e===void 0)return[];if(!Array.isArray(e)){let r=mr.asCID(e);if(!r)throw new TypeError("roots must be a single CID or an array of CIDs");return[r]}let t=[];for(let r of e){let n=mr.asCID(r);if(!n)throw new TypeError("roots must be a single CID or an array of CIDs");t.push(n)}return t}async function*jF(e,t=1){let r=[];t<1&&(t=1);for await(let n of e)for(r.push(n);r.length>=t;)yield r.slice(0,t),r=r.slice(t);for(;r.length;)yield r.slice(0,t),r=r.slice(t)}var Zy=jF,VF=Zy;async function*WF(e,t=1){for await(let r of VF(e,t)){let n=r.map(i=>i().then(a=>({ok:!0,value:a}),a=>({ok:!1,err:a})));for(let i=0;i<n.length;i++){let a=await n[i];if(!a.ok)throw a.err;yield a.value}}}var bS=WF,HF=e=>{if(Object.prototype.toString.call(e)!=="[object Object]")return!1;let t=Object.getPrototypeOf(e);return t===null||t===Object.prototype},Kp=HF,{hasOwnProperty:wS}=Object.prototype,{propertyIsEnumerable:qF}=Object,bc=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0}),XF=Ya,cE={concatArrays:!1,ignoreUndefined:!1},lh=e=>{let t=[];for(let r in e)wS.call(e,r)&&t.push(r);if(Object.getOwnPropertySymbols){let r=Object.getOwnPropertySymbols(e);for(let n of r)qF.call(e,n)&&t.push(n)}return t};function Fu(e){return Array.isArray(e)?KF(e):Kp(e)?YF(e):e}function KF(e){let t=e.slice(0,0);return lh(e).forEach(r=>{bc(t,r,Fu(e[r]))}),t}function YF(e){let t=Object.getPrototypeOf(e)===null?Object.create(null):{};return lh(e).forEach(r=>{bc(t,r,Fu(e[r]))}),t}var vS=(e,t,r,n)=>(r.forEach(i=>{t[i]===void 0&&n.ignoreUndefined||(i in e&&e[i]!==Object.getPrototypeOf(e)?bc(e,i,vy(e[i],t[i],n)):bc(e,i,Fu(t[i])))}),e),ZF=(e,t,r)=>{let n=e.slice(0,0),i=0;return[e,t].forEach(a=>{let o=[];for(let s=0;s<a.length;s++)wS.call(a,s)&&(o.push(String(s)),bc(n,i++,a===e?a[s]:Fu(a[s])));n=vS(n,a,lh(a).filter(s=>!o.includes(s)),r)}),n};function vy(e,t,r){return r.concatArrays&&Array.isArray(e)&&Array.isArray(t)?ZF(e,t,r):Kp(t)&&Kp(e)?vS(e,t,lh(t),r):Fu(t)}var QF=function(...e){let t=vy(Fu(cE),this!==XF&&this||{},cE),r={_:{}};for(let n of e)if(n!==void 0){if(!Kp(n))throw new TypeError("`"+n+"` is not an Option Object");r=vy(r,{_:n},t)}return r._},ch=({name:e,code:t,encode:r})=>new _y(e,t,r),_y=class{constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){let r=this.encode(t);return r instanceof Uint8Array?Fp(this.code,r):r.then(n=>Fp(this.code,n))}throw Error("Unknown type, must be binary type")}},_S=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Ru=ch({name:"sha2-256",code:18,encode:_S("SHA-256")}),JF=ch({name:"sha2-512",code:19,encode:_S("SHA-512")}),YZ=Object.freeze({__proto__:null,sha256:Ru,sha512:JF}),xy={exports:{}},q0,X0;q0=xy,X0=xy.exports,function(e,t){var r={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function n(d){if(!Array.isArray(d)&&!ArrayBuffer.isView(d))return!1;for(var m=0;m<d.length;m++)if(!Number.isInteger(d[m])||d[m]<0||d[m]>255)return!1;return!0}function i(d,m){return(65535&d)*m+(((d>>>16)*m&65535)<<16)}function a(d,m){return d<<m|d>>>32-m}function o(d){return d=i(d^=d>>>16,2246822507),d=i(d^=d>>>13,3266489909),d^=d>>>16}function s(d,m){d=[d[0]>>>16,65535&d[0],d[1]>>>16,65535&d[1]],m=[m[0]>>>16,65535&m[0],m[1]>>>16,65535&m[1]];var g=[0,0,0,0];return g[3]+=d[3]+m[3],g[2]+=g[3]>>>16,g[3]&=65535,g[2]+=d[2]+m[2],g[1]+=g[2]>>>16,g[2]&=65535,g[1]+=d[1]+m[1],g[0]+=g[1]>>>16,g[1]&=65535,g[0]+=d[0]+m[0],g[0]&=65535,[g[0]<<16|g[1],g[2]<<16|g[3]]}function u(d,m){d=[d[0]>>>16,65535&d[0],d[1]>>>16,65535&d[1]],m=[m[0]>>>16,65535&m[0],m[1]>>>16,65535&m[1]];var g=[0,0,0,0];return g[3]+=d[3]*m[3],g[2]+=g[3]>>>16,g[3]&=65535,g[2]+=d[2]*m[3],g[1]+=g[2]>>>16,g[2]&=65535,g[2]+=d[3]*m[2],g[1]+=g[2]>>>16,g[2]&=65535,g[1]+=d[1]*m[3],g[0]+=g[1]>>>16,g[1]&=65535,g[1]+=d[2]*m[2],g[0]+=g[1]>>>16,g[1]&=65535,g[1]+=d[3]*m[1],g[0]+=g[1]>>>16,g[1]&=65535,g[0]+=d[0]*m[3]+d[1]*m[2]+d[2]*m[1]+d[3]*m[0],g[0]&=65535,[g[0]<<16|g[1],g[2]<<16|g[3]]}function l(d,m){return(m%=64)==32?[d[1],d[0]]:m<32?[d[0]<<m|d[1]>>>32-m,d[1]<<m|d[0]>>>32-m]:(m-=32,[d[1]<<m|d[0]>>>32-m,d[0]<<m|d[1]>>>32-m])}function c(d,m){return(m%=64)==0?d:m<32?[d[0]<<m|d[1]>>>32-m,d[1]<<m]:[d[1]<<m-32,0]}function f(d,m){return[d[0]^m[0],d[1]^m[1]]}function p(d){return d=f(d,[0,d[0]>>>1]),d=f(d=u(d,[4283543511,3981806797]),[0,d[0]>>>1]),d=f(d=u(d,[3301882366,444984403]),[0,d[0]>>>1])}r.x86.hash32=function(d,m){if(r.inputValidation&&!n(d))return t;m=m||0;for(var g=d.length%4,x=d.length-g,b=m,y=0,E=3432918353,$=461845907,k=0;k<x;k+=4)y=i(y=d[k]|d[k+1]<<8|d[k+2]<<16|d[k+3]<<24,E),y=i(y=a(y,15),$),b=i(b=a(b^=y,13),5)+3864292196;switch(y=0,g){case 3:y^=d[k+2]<<16;case 2:y^=d[k+1]<<8;case 1:y=i(y^=d[k],E),b^=y=i(y=a(y,15),$)}return(b=o(b^=d.length))>>>0},r.x86.hash128=function(d,m){if(r.inputValidation&&!n(d))return t;m=m||0;for(var g=d.length%16,x=d.length-g,b=m,y=m,E=m,$=m,k=0,R=0,C=0,P=0,W=597399067,te=2869860233,ce=951274213,pe=2716044179,ge=0;ge<x;ge+=16)k=d[ge]|d[ge+1]<<8|d[ge+2]<<16|d[ge+3]<<24,R=d[ge+4]|d[ge+5]<<8|d[ge+6]<<16|d[ge+7]<<24,C=d[ge+8]|d[ge+9]<<8|d[ge+10]<<16|d[ge+11]<<24,P=d[ge+12]|d[ge+13]<<8|d[ge+14]<<16|d[ge+15]<<24,k=a(k=i(k,W),15),b=a(b^=k=i(k,te),19),b=i(b+=y,5)+1444728091,R=a(R=i(R,te),16),y=a(y^=R=i(R,ce),17),y=i(y+=E,5)+197830471,C=a(C=i(C,ce),17),E=a(E^=C=i(C,pe),15),E=i(E+=$,5)+2530024501,P=a(P=i(P,pe),18),$=a($^=P=i(P,W),13),$=i($+=b,5)+850148119;switch(k=0,R=0,C=0,P=0,g){case 15:P^=d[ge+14]<<16;case 14:P^=d[ge+13]<<8;case 13:P=i(P^=d[ge+12],pe),$^=P=i(P=a(P,18),W);case 12:C^=d[ge+11]<<24;case 11:C^=d[ge+10]<<16;case 10:C^=d[ge+9]<<8;case 9:C=i(C^=d[ge+8],ce),E^=C=i(C=a(C,17),pe);case 8:R^=d[ge+7]<<24;case 7:R^=d[ge+6]<<16;case 6:R^=d[ge+5]<<8;case 5:R=i(R^=d[ge+4],te),y^=R=i(R=a(R,16),ce);case 4:k^=d[ge+3]<<24;case 3:k^=d[ge+2]<<16;case 2:k^=d[ge+1]<<8;case 1:k=i(k^=d[ge],W),b^=k=i(k=a(k,15),te)}return b^=d.length,b+=y^=d.length,b+=E^=d.length,y+=b+=$^=d.length,E+=b,$+=b,b=o(b),b+=y=o(y),b+=E=o(E),y+=b+=$=o($),E+=b,$+=b,("00000000"+(b>>>0).toString(16)).slice(-8)+("00000000"+(y>>>0).toString(16)).slice(-8)+("00000000"+(E>>>0).toString(16)).slice(-8)+("00000000"+($>>>0).toString(16)).slice(-8)},r.x64.hash128=function(d,m){if(r.inputValidation&&!n(d))return t;m=m||0;for(var g=d.length%16,x=d.length-g,b=[0,m],y=[0,m],E=[0,0],$=[0,0],k=[2277735313,289559509],R=[1291169091,658871167],C=0;C<x;C+=16)E=[d[C+4]|d[C+5]<<8|d[C+6]<<16|d[C+7]<<24,d[C]|d[C+1]<<8|d[C+2]<<16|d[C+3]<<24],$=[d[C+12]|d[C+13]<<8|d[C+14]<<16|d[C+15]<<24,d[C+8]|d[C+9]<<8|d[C+10]<<16|d[C+11]<<24],E=l(E=u(E,k),31),b=s(b=l(b=f(b,E=u(E,R)),27),y),b=s(u(b,[0,5]),[0,1390208809]),$=l($=u($,R),33),y=s(y=l(y=f(y,$=u($,k)),31),b),y=s(u(y,[0,5]),[0,944331445]);switch(E=[0,0],$=[0,0],g){case 15:$=f($,c([0,d[C+14]],48));case 14:$=f($,c([0,d[C+13]],40));case 13:$=f($,c([0,d[C+12]],32));case 12:$=f($,c([0,d[C+11]],24));case 11:$=f($,c([0,d[C+10]],16));case 10:$=f($,c([0,d[C+9]],8));case 9:$=u($=f($,[0,d[C+8]]),R),y=f(y,$=u($=l($,33),k));case 8:E=f(E,c([0,d[C+7]],56));case 7:E=f(E,c([0,d[C+6]],48));case 6:E=f(E,c([0,d[C+5]],40));case 5:E=f(E,c([0,d[C+4]],32));case 4:E=f(E,c([0,d[C+3]],24));case 3:E=f(E,c([0,d[C+2]],16));case 2:E=f(E,c([0,d[C+1]],8));case 1:E=u(E=f(E,[0,d[C]]),k),b=f(b,E=u(E=l(E,31),R))}return b=s(b=f(b,[0,d.length]),y=f(y,[0,d.length])),y=s(y,b),b=s(b=p(b),y=p(y)),y=s(y,b),("00000000"+(b[0]>>>0).toString(16)).slice(-8)+("00000000"+(b[1]>>>0).toString(16)).slice(-8)+("00000000"+(y[0]>>>0).toString(16)).slice(-8)+("00000000"+(y[1]>>>0).toString(16)).slice(-8)},q0.exports&&(X0=q0.exports=r),X0.murmurHash3=r}();var xS=xy.exports;function eG(e){let t=new Array(4);for(let r=0;r<4;r++)t[r]=255&e,e>>=8;return new Uint8Array(t)}ch({name:"murmur3-32",code:35,encode:e=>eG(xS.x86.hash32(e))});var $S=ch({name:"murmur3-128",code:34,encode:e=>LP(xS.x64.hash128(e))});async function tG(e){return(await $S.encode(e)).slice(0,8).reverse()}var rG={chunker:"fixed",strategy:"balanced",rawLeaves:!1,onlyHash:!1,reduceSingleLeafToSelf:!0,hasher:Ru,leafType:"file",cidVersion:0,progress:()=>()=>{},shardSplitThreshold:1e3,fileImportConcurrency:50,blockWriteConcurrency:10,minChunkSize:262144,maxChunkSize:262144,avgChunkSize:262144,window:16,polynomial:0x3df305dfb2a804,maxChildrenPerNode:174,layerRepeat:4,wrapWithDirectory:!1,recursive:!1,hidden:!1,timeout:void 0,hamtHashFn:tG,hamtHashCode:34,hamtBucketBits:8},nG=(e={})=>QF.bind({ignoreUndefined:!0})(rG,e);function fE(e,t){for(let r in t)Object.defineProperty(e,r,{value:t[r],enumerable:!0,configurable:!0});return e}function iG(e,t,r){if(!e||typeof e=="string")throw new TypeError("Please pass an Error to err-code");r||(r={}),typeof t=="object"&&(r=t,t=""),t&&(r.code=t);try{return fE(e,r)}catch{r.message=e.message,r.stack=e.stack;let i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(e)),fE(new i,r)}}var rr=iG,ES={},eo={},aG=oG;function oG(e,t){for(var r=new Array(arguments.length-1),n=0,i=2,a=!0;i<arguments.length;)r[n++]=arguments[i++];return new Promise(function(o,s){r[n]=function(u){if(a)if(a=!1,u)s(u);else{for(var l=new Array(arguments.length-1),c=0;c<l.length;)l[c++]=arguments[c];o.apply(null,l)}};try{e.apply(t||null,r)}catch(u){a&&(a=!1,s(u))}})}var SS={};(function(e){var t=SS;t.length=function(o){var s=o.length;if(!s)return 0;for(var u=0;--s%4>1&&o.charAt(s)==="=";)++u;return Math.ceil(3*o.length)/4-u};for(var r=new Array(64),n=new Array(123),i=0;i<64;)n[r[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;t.encode=function(o,s,u){for(var l,c=null,f=[],p=0,d=0;s<u;){var m=o[s++];switch(d){case 0:f[p++]=r[m>>2],l=(3&m)<<4,d=1;break;case 1:f[p++]=r[l|m>>4],l=(15&m)<<2,d=2;break;case 2:f[p++]=r[l|m>>6],f[p++]=r[63&m],d=0}p>8191&&((c||(c=[])).push(String.fromCharCode.apply(String,f)),p=0)}return d&&(f[p++]=r[l],f[p++]=61,d===1&&(f[p++]=61)),c?(p&&c.push(String.fromCharCode.apply(String,f.slice(0,p))),c.join("")):String.fromCharCode.apply(String,f.slice(0,p))};var a="invalid encoding";t.decode=function(o,s,u){for(var l,c=u,f=0,p=0;p<o.length;){var d=o.charCodeAt(p++);if(d===61&&f>1)break;if((d=n[d])===void 0)throw Error(a);switch(f){case 0:l=d,f=1;break;case 1:s[u++]=l<<2|(48&d)>>4,l=d,f=2;break;case 2:s[u++]=(15&l)<<4|(60&d)>>2,l=d,f=3;break;case 3:s[u++]=(3&l)<<6|d,f=0}}if(f===1)throw Error(a);return u-c},t.test=function(o){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(o)}})();var sG=Bp;function Bp(){this._listeners={}}Bp.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},Bp.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},Bp.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this};var uG=dE(dE);function dE(e){return typeof Float32Array<"u"?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=r[3]===128;function i(u,l,c){t[0]=u,l[c]=r[0],l[c+1]=r[1],l[c+2]=r[2],l[c+3]=r[3]}function a(u,l,c){t[0]=u,l[c]=r[3],l[c+1]=r[2],l[c+2]=r[1],l[c+3]=r[0]}function o(u,l){return r[0]=u[l],r[1]=u[l+1],r[2]=u[l+2],r[3]=u[l+3],t[0]}function s(u,l){return r[3]=u[l],r[2]=u[l+1],r[1]=u[l+2],r[0]=u[l+3],t[0]}e.writeFloatLE=n?i:a,e.writeFloatBE=n?a:i,e.readFloatLE=n?o:s,e.readFloatBE=n?s:o}():function(){function t(n,i,a,o){var s=i<0?1:0;if(s&&(i=-i),i===0)n(1/i>0?0:2147483648,a,o);else if(isNaN(i))n(2143289344,a,o);else if(i>34028234663852886e22)n((s<<31|2139095040)>>>0,a,o);else if(i<11754943508222875e-54)n((s<<31|Math.round(i/1401298464324817e-60))>>>0,a,o);else{var u=Math.floor(Math.log(i)/Math.LN2);n((s<<31|u+127<<23|8388607&Math.round(i*Math.pow(2,-u)*8388608))>>>0,a,o)}}function r(n,i,a){var o=n(i,a),s=2*(o>>31)+1,u=o>>>23&255,l=8388607&o;return u===255?l?NaN:s*(1/0):u===0?1401298464324817e-60*s*l:s*Math.pow(2,u-150)*(l+8388608)}e.writeFloatLE=t.bind(null,pE),e.writeFloatBE=t.bind(null,hE),e.readFloatLE=r.bind(null,mE),e.readFloatBE=r.bind(null,gE)}(),typeof Float64Array<"u"?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=r[7]===128;function i(u,l,c){t[0]=u,l[c]=r[0],l[c+1]=r[1],l[c+2]=r[2],l[c+3]=r[3],l[c+4]=r[4],l[c+5]=r[5],l[c+6]=r[6],l[c+7]=r[7]}function a(u,l,c){t[0]=u,l[c]=r[7],l[c+1]=r[6],l[c+2]=r[5],l[c+3]=r[4],l[c+4]=r[3],l[c+5]=r[2],l[c+6]=r[1],l[c+7]=r[0]}function o(u,l){return r[0]=u[l],r[1]=u[l+1],r[2]=u[l+2],r[3]=u[l+3],r[4]=u[l+4],r[5]=u[l+5],r[6]=u[l+6],r[7]=u[l+7],t[0]}function s(u,l){return r[7]=u[l],r[6]=u[l+1],r[5]=u[l+2],r[4]=u[l+3],r[3]=u[l+4],r[2]=u[l+5],r[1]=u[l+6],r[0]=u[l+7],t[0]}e.writeDoubleLE=n?i:a,e.writeDoubleBE=n?a:i,e.readDoubleLE=n?o:s,e.readDoubleBE=n?s:o}():function(){function t(n,i,a,o,s,u){var l=o<0?1:0;if(l&&(o=-o),o===0)n(0,s,u+i),n(1/o>0?0:2147483648,s,u+a);else if(isNaN(o))n(0,s,u+i),n(2146959360,s,u+a);else if(o>17976931348623157e292)n(0,s,u+i),n((l<<31|2146435072)>>>0,s,u+a);else{var c;if(o<22250738585072014e-324)n((c=o/5e-324)>>>0,s,u+i),n((l<<31|c/4294967296)>>>0,s,u+a);else{var f=Math.floor(Math.log(o)/Math.LN2);f===1024&&(f=1023),n(4503599627370496*(c=o*Math.pow(2,-f))>>>0,s,u+i),n((l<<31|f+1023<<20|1048576*c&1048575)>>>0,s,u+a)}}}function r(n,i,a,o,s){var u=n(o,s+i),l=n(o,s+a),c=2*(l>>31)+1,f=l>>>20&2047,p=4294967296*(1048575&l)+u;return f===2047?p?NaN:c*(1/0):f===0?5e-324*c*p:c*Math.pow(2,f-1075)*(p+4503599627370496)}e.writeDoubleLE=t.bind(null,pE,0,4),e.writeDoubleBE=t.bind(null,hE,4,0),e.readDoubleLE=r.bind(null,mE,0,4),e.readDoubleBE=r.bind(null,gE,4,0)}(),e}function pE(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function hE(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function mE(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function gE(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var lG=cG;function cG(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}var TS={};(function(e){var t=TS;t.length=function(r){for(var n=0,i=0,a=0;a<r.length;++a)(i=r.charCodeAt(a))<128?n+=1:i<2048?n+=2:(64512&i)==55296&&(64512&r.charCodeAt(a+1))==56320?(++a,n+=4):n+=3;return n},t.read=function(r,n,i){if(i-n<1)return"";for(var a,o=null,s=[],u=0;n<i;)(a=r[n++])<128?s[u++]=a:a>191&&a<224?s[u++]=(31&a)<<6|63&r[n++]:a>239&&a<365?(a=((7&a)<<18|(63&r[n++])<<12|(63&r[n++])<<6|63&r[n++])-65536,s[u++]=55296+(a>>10),s[u++]=56320+(1023&a)):s[u++]=(15&a)<<12|(63&r[n++])<<6|63&r[n++],u>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),u=0);return o?(u&&o.push(String.fromCharCode.apply(String,s.slice(0,u))),o.join("")):String.fromCharCode.apply(String,s.slice(0,u))},t.write=function(r,n,i){for(var a,o,s=i,u=0;u<r.length;++u)(a=r.charCodeAt(u))<128?n[i++]=a:a<2048?(n[i++]=a>>6|192,n[i++]=63&a|128):(64512&a)==55296&&(64512&(o=r.charCodeAt(u+1)))==56320?(a=65536+((1023&a)<<10)+(1023&o),++u,n[i++]=a>>18|240,n[i++]=a>>12&63|128,n[i++]=a>>6&63|128,n[i++]=63&a|128):(n[i++]=a>>12|224,n[i++]=a>>6&63|128,n[i++]=63&a|128);return i-s}})();var fG=dG;function dG(e,t,r){var n=r||8192,i=n>>>1,a=null,o=n;return function(s){if(s<1||s>i)return e(s);o+s>n&&(a=e(n),o=0);var u=t.call(a,o,o+=s);return 7&o&&(o=1+(7|o)),u}}var pG=rn,oc=eo;function rn(e,t){this.lo=e>>>0,this.hi=t>>>0}var Xo=rn.zero=new rn(0,0);Xo.toNumber=function(){return 0},Xo.zzEncode=Xo.zzDecode=function(){return this},Xo.length=function(){return 1};var hG=rn.zeroHash="\0\0\0\0\0\0\0\0";rn.fromNumber=function(e){if(e===0)return Xo;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new rn(r,n)},rn.from=function(e){if(typeof e=="number")return rn.fromNumber(e);if(oc.isString(e)){if(!oc.Long)return rn.fromNumber(parseInt(e,10));e=oc.Long.fromString(e)}return e.low||e.high?new rn(e.low>>>0,e.high>>>0):Xo},rn.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},rn.prototype.toLong=function(e){return oc.Long?new oc.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var Ka=String.prototype.charCodeAt;rn.fromHash=function(e){return e===hG?Xo:new rn((Ka.call(e,0)|Ka.call(e,1)<<8|Ka.call(e,2)<<16|Ka.call(e,3)<<24)>>>0,(Ka.call(e,4)|Ka.call(e,5)<<8|Ka.call(e,6)<<16|Ka.call(e,7)<<24)>>>0)},rn.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},rn.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},rn.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},rn.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10},function(e){var t=eo;function r(i,a,o){for(var s=Object.keys(a),u=0;u<s.length;++u)i[s[u]]!==void 0&&o||(i[s[u]]=a[s[u]]);return i}function n(i){function a(o,s){if(!(this instanceof a))return new a(o,s);Object.defineProperty(this,"message",{get:function(){return o}}),Error.captureStackTrace?Error.captureStackTrace(this,a):Object.defineProperty(this,"stack",{value:new Error().stack||""}),s&&r(this,s)}return(a.prototype=Object.create(Error.prototype)).constructor=a,Object.defineProperty(a.prototype,"name",{get:function(){return i}}),a.prototype.toString=function(){return this.name+": "+this.message},a}t.asPromise=aG,t.base64=SS,t.EventEmitter=sG,t.float=uG,t.inquire=lG,t.utf8=TS,t.pool=fG,t.LongBits=pG,t.isNode=!!(Ya!==void 0&&Ya&&Ya.process&&Ya.process.versions&&Ya.process.versions.node),t.global=t.isNode&&Ya||typeof window<"u"&&window||typeof self<"u"&&self||Ya,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(i){return typeof i=="number"&&isFinite(i)&&Math.floor(i)===i},t.isString=function(i){return typeof i=="string"||i instanceof String},t.isObject=function(i){return i&&typeof i=="object"},t.isset=t.isSet=function(i,a){var o=i[a];return!(o==null||!i.hasOwnProperty(a))&&(typeof o!="object"||(Array.isArray(o)?o.length:Object.keys(o).length)>0)},t.Buffer=function(){try{var i=t.inquire("buffer").Buffer;return i.prototype.utf8Write?i:null}catch{return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(i){return typeof i=="number"?t.Buffer?t._Buffer_allocUnsafe(i):new t.Array(i):t.Buffer?t._Buffer_from(i):typeof Uint8Array>"u"?i:new Uint8Array(i)},t.Array=typeof Uint8Array<"u"?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(i){return i?t.LongBits.from(i).toHash():t.LongBits.zeroHash},t.longFromHash=function(i,a){var o=t.LongBits.fromHash(i);return t.Long?t.Long.fromBits(o.lo,o.hi,a):o.toNumber(!!a)},t.merge=r,t.lcFirst=function(i){return i.charAt(0).toLowerCase()+i.substring(1)},t.newError=n,t.ProtocolError=n("ProtocolError"),t.oneOfGetter=function(i){for(var a={},o=0;o<i.length;++o)a[i[o]]=1;return function(){for(var s=Object.keys(this),u=s.length-1;u>-1;--u)if(a[s[u]]===1&&this[s[u]]!==void 0&&this[s[u]]!==null)return s[u]}},t.oneOfSetter=function(i){return function(a){for(var o=0;o<i.length;++o)i[o]!==a&&delete this[i[o]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var i=t.Buffer;i?(t._Buffer_from=i.from!==Uint8Array.from&&i.from||function(a,o){return new i(a,o)},t._Buffer_allocUnsafe=i.allocUnsafe||function(a){return new i(a)}):t._Buffer_from=t._Buffer_allocUnsafe=null}}();var AS=ir,Qn=eo,$y,_p=Qn.LongBits,yE=Qn.base64,bE=Qn.utf8;function wc(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function Ey(){}function mG(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function ir(){this.len=0,this.head=new wc(Ey,0,0),this.tail=this.head,this.states=null}var kS=function(){return Qn.Buffer?function(){return(ir.create=function(){return new $y})()}:function(){return new ir}};function Sy(e,t,r){t[r]=255&e}function gG(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}function K0(e,t){this.len=e,this.next=void 0,this.val=t}function Y0(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function Z0(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}ir.create=kS(),ir.alloc=function(e){return new Qn.Array(e)},Qn.Array!==Array&&(ir.alloc=Qn.pool(ir.alloc,Qn.Array.prototype.subarray)),ir.prototype._push=function(e,t,r){return this.tail=this.tail.next=new wc(e,t,r),this.len+=t,this},K0.prototype=Object.create(wc.prototype),K0.prototype.fn=gG,ir.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new K0((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},ir.prototype.int32=function(e){return e<0?this._push(Y0,10,_p.fromNumber(e)):this.uint32(e)},ir.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},ir.prototype.uint64=function(e){var t=_p.from(e);return this._push(Y0,t.length(),t)},ir.prototype.int64=ir.prototype.uint64,ir.prototype.sint64=function(e){var t=_p.from(e).zzEncode();return this._push(Y0,t.length(),t)},ir.prototype.bool=function(e){return this._push(Sy,1,e?1:0)},ir.prototype.fixed32=function(e){return this._push(Z0,4,e>>>0)},ir.prototype.sfixed32=ir.prototype.fixed32,ir.prototype.fixed64=function(e){var t=_p.from(e);return this._push(Z0,4,t.lo)._push(Z0,4,t.hi)},ir.prototype.sfixed64=ir.prototype.fixed64,ir.prototype.float=function(e){return this._push(Qn.float.writeFloatLE,4,e)},ir.prototype.double=function(e){return this._push(Qn.float.writeDoubleLE,8,e)};var yG=Qn.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};ir.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Sy,1,0);if(Qn.isString(e)){var r=ir.alloc(t=yE.length(e));yE.decode(e,r,0),e=r}return this.uint32(t)._push(yG,t,e)},ir.prototype.string=function(e){var t=bE.length(e);return t?this.uint32(t)._push(bE.write,t,e):this._push(Sy,1,0)},ir.prototype.fork=function(){return this.states=new mG(this),this.head=this.tail=new wc(Ey,0,0),this.len=0,this},ir.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new wc(Ey,0,0),this.len=0),this},ir.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},ir.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},ir._configure=function(e){$y=e,ir.create=kS(),$y._configure()};var bG=Xi,IS=AS;(Xi.prototype=Object.create(IS.prototype)).constructor=Xi;var Za=eo;function Xi(){IS.call(this)}function wG(e,t,r){e.length<40?Za.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}Xi._configure=function(){Xi.alloc=Za._Buffer_allocUnsafe,Xi.writeBytesBuffer=Za.Buffer&&Za.Buffer.prototype instanceof Uint8Array&&Za.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},Xi.prototype.bytes=function(e){Za.isString(e)&&(e=Za._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Xi.writeBytesBuffer,t,e),this},Xi.prototype.string=function(e){var t=Za.Buffer.byteLength(e);return this.uint32(t),t&&this._push(wG,t,e),this},Xi._configure();var CS=Wr,Ki=eo,Ty,OS=Ki.LongBits,vG=Ki.utf8;function yi(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Wr(e){this.buf=e,this.pos=0,this.len=e.length}var wE=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Wr(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Wr(e);throw Error("illegal buffer")},vE=function(){return Ki.Buffer?function(e){return(Wr.create=function(t){return Ki.Buffer.isBuffer(t)?new Ty(t):wE(t)})(e)}:wE},hn;function Q0(){var e=new OS(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw yi(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw yi(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function Yp(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function _E(){if(this.pos+8>this.len)throw yi(this,8);return new OS(Yp(this.buf,this.pos+=4),Yp(this.buf,this.pos+=4))}Wr.create=vE(),Wr.prototype._slice=Ki.Array.prototype.subarray||Ki.Array.prototype.slice,Wr.prototype.uint32=(hn=4294967295,function(){if(hn=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(hn=(hn|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(hn=(hn|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(hn=(hn|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(hn=(hn|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return hn;if((this.pos+=5)>this.len)throw this.pos=this.len,yi(this,10);return hn}),Wr.prototype.int32=function(){return 0|this.uint32()},Wr.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},Wr.prototype.bool=function(){return this.uint32()!==0},Wr.prototype.fixed32=function(){if(this.pos+4>this.len)throw yi(this,4);return Yp(this.buf,this.pos+=4)},Wr.prototype.sfixed32=function(){if(this.pos+4>this.len)throw yi(this,4);return 0|Yp(this.buf,this.pos+=4)},Wr.prototype.float=function(){if(this.pos+4>this.len)throw yi(this,4);var e=Ki.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Wr.prototype.double=function(){if(this.pos+8>this.len)throw yi(this,4);var e=Ki.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Wr.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw yi(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},Wr.prototype.string=function(){var e=this.bytes();return vG.read(e,0,e.length)},Wr.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw yi(this,e);this.pos+=e}else do if(this.pos>=this.len)throw yi(this);while(128&this.buf[this.pos++]);return this},Wr.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=7&this.uint32())!=4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Wr._configure=function(e){Ty=e,Wr.create=vE(),Ty._configure();var t=Ki.Long?"toLong":"toNumber";Ki.merge(Wr.prototype,{int64:function(){return Q0.call(this)[t](!1)},uint64:function(){return Q0.call(this)[t](!0)},sint64:function(){return Q0.call(this).zzDecode()[t](!1)},fixed64:function(){return _E.call(this)[t](!0)},sfixed64:function(){return _E.call(this)[t](!1)}})};var _G=Ko,BS=CS;(Ko.prototype=Object.create(BS.prototype)).constructor=Ko;var xE=eo;function Ko(e){BS.call(this,e)}Ko._configure=function(){xE.Buffer&&(Ko.prototype._slice=xE.Buffer.prototype.slice)},Ko.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},Ko._configure();var RS={},xG=lc,Ay=eo;function lc(e,t,r){if(typeof e!="function")throw TypeError("rpcImpl must be a function");Ay.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!r}(lc.prototype=Object.create(Ay.EventEmitter.prototype)).constructor=lc,lc.prototype.rpcCall=function e(t,r,n,i,a){if(!i)throw TypeError("request must be specified");var o=this;if(!a)return Ay.asPromise(e,o,t,r,n,i);if(o.rpcImpl)try{return o.rpcImpl(t,r[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(s,u){if(s)return o.emit("error",s,t),a(s);if(u!==null){if(!(u instanceof n))try{u=n[o.responseDelimited?"decodeDelimited":"decode"](u)}catch(l){return o.emit("error",l,t),a(l)}return o.emit("data",u,t),a(null,u)}o.end(!0)})}catch(s){return o.emit("error",s,t),void setTimeout(function(){a(s)},0)}else setTimeout(function(){a(Error("already ended"))},0)},lc.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},function(e){e.Service=xG}(RS);var $G={};(function(e){var t=ES;function r(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}t.build="minimal",t.Writer=AS,t.BufferWriter=bG,t.Reader=CS,t.BufferReader=_G,t.util=eo,t.rpc=RS,t.roots=$G,t.configure=r,r()})();var Ja=ES,Iu=Ja.Reader,ky=Ja.Writer,Nt=Ja.util,sn=Ja.roots["ipfs-unixfs"]||(Ja.roots["ipfs-unixfs"]={}),EG=sn.Data=(()=>{function e(t){if(this.blocksizes=[],t)for(var r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.Type=0,e.prototype.Data=Nt.newBuffer([]),e.prototype.filesize=Nt.Long?Nt.Long.fromBits(0,0,!0):0,e.prototype.blocksizes=Nt.emptyArray,e.prototype.hashType=Nt.Long?Nt.Long.fromBits(0,0,!0):0,e.prototype.fanout=Nt.Long?Nt.Long.fromBits(0,0,!0):0,e.prototype.mode=0,e.prototype.mtime=null,e.encode=function(t,r){if(r||(r=ky.create()),r.uint32(8).int32(t.Type),t.Data!=null&&Object.hasOwnProperty.call(t,"Data")&&r.uint32(18).bytes(t.Data),t.filesize!=null&&Object.hasOwnProperty.call(t,"filesize")&&r.uint32(24).uint64(t.filesize),t.blocksizes!=null&&t.blocksizes.length)for(var n=0;n<t.blocksizes.length;++n)r.uint32(32).uint64(t.blocksizes[n]);return t.hashType!=null&&Object.hasOwnProperty.call(t,"hashType")&&r.uint32(40).uint64(t.hashType),t.fanout!=null&&Object.hasOwnProperty.call(t,"fanout")&&r.uint32(48).uint64(t.fanout),t.mode!=null&&Object.hasOwnProperty.call(t,"mode")&&r.uint32(56).uint32(t.mode),t.mtime!=null&&Object.hasOwnProperty.call(t,"mtime")&&sn.UnixTime.encode(t.mtime,r.uint32(66).fork()).ldelim(),r},e.decode=function(t,r){t instanceof Iu||(t=Iu.create(t));for(var n=r===void 0?t.len:t.pos+r,i=new sn.Data;t.pos<n;){var a=t.uint32();switch(a>>>3){case 1:i.Type=t.int32();break;case 2:i.Data=t.bytes();break;case 3:i.filesize=t.uint64();break;case 4:if(i.blocksizes&&i.blocksizes.length||(i.blocksizes=[]),(7&a)==2)for(var o=t.uint32()+t.pos;t.pos<o;)i.blocksizes.push(t.uint64());else i.blocksizes.push(t.uint64());break;case 5:i.hashType=t.uint64();break;case 6:i.fanout=t.uint64();break;case 7:i.mode=t.uint32();break;case 8:i.mtime=sn.UnixTime.decode(t,t.uint32());break;default:t.skipType(7&a)}}if(!i.hasOwnProperty("Type"))throw Nt.ProtocolError("missing required 'Type'",{instance:i});return i},e.fromObject=function(t){if(t instanceof sn.Data)return t;var r=new sn.Data;switch(t.Type){case"Raw":case 0:r.Type=0;break;case"Directory":case 1:r.Type=1;break;case"File":case 2:r.Type=2;break;case"Metadata":case 3:r.Type=3;break;case"Symlink":case 4:r.Type=4;break;case"HAMTShard":case 5:r.Type=5}if(t.Data!=null&&(typeof t.Data=="string"?Nt.base64.decode(t.Data,r.Data=Nt.newBuffer(Nt.base64.length(t.Data)),0):t.Data.length&&(r.Data=t.Data)),t.filesize!=null&&(Nt.Long?(r.filesize=Nt.Long.fromValue(t.filesize)).unsigned=!0:typeof t.filesize=="string"?r.filesize=parseInt(t.filesize,10):typeof t.filesize=="number"?r.filesize=t.filesize:typeof t.filesize=="object"&&(r.filesize=new Nt.LongBits(t.filesize.low>>>0,t.filesize.high>>>0).toNumber(!0))),t.blocksizes){if(!Array.isArray(t.blocksizes))throw TypeError(".Data.blocksizes: array expected");r.blocksizes=[];for(var n=0;n<t.blocksizes.length;++n)Nt.Long?(r.blocksizes[n]=Nt.Long.fromValue(t.blocksizes[n])).unsigned=!0:typeof t.blocksizes[n]=="string"?r.blocksizes[n]=parseInt(t.blocksizes[n],10):typeof t.blocksizes[n]=="number"?r.blocksizes[n]=t.blocksizes[n]:typeof t.blocksizes[n]=="object"&&(r.blocksizes[n]=new Nt.LongBits(t.blocksizes[n].low>>>0,t.blocksizes[n].high>>>0).toNumber(!0))}if(t.hashType!=null&&(Nt.Long?(r.hashType=Nt.Long.fromValue(t.hashType)).unsigned=!0:typeof t.hashType=="string"?r.hashType=parseInt(t.hashType,10):typeof t.hashType=="number"?r.hashType=t.hashType:typeof t.hashType=="object"&&(r.hashType=new Nt.LongBits(t.hashType.low>>>0,t.hashType.high>>>0).toNumber(!0))),t.fanout!=null&&(Nt.Long?(r.fanout=Nt.Long.fromValue(t.fanout)).unsigned=!0:typeof t.fanout=="string"?r.fanout=parseInt(t.fanout,10):typeof t.fanout=="number"?r.fanout=t.fanout:typeof t.fanout=="object"&&(r.fanout=new Nt.LongBits(t.fanout.low>>>0,t.fanout.high>>>0).toNumber(!0))),t.mode!=null&&(r.mode=t.mode>>>0),t.mtime!=null){if(typeof t.mtime!="object")throw TypeError(".Data.mtime: object expected");r.mtime=sn.UnixTime.fromObject(t.mtime)}return r},e.toObject=function(t,r){r||(r={});var n={};if((r.arrays||r.defaults)&&(n.blocksizes=[]),r.defaults){if(n.Type=r.enums===String?"Raw":0,r.bytes===String?n.Data="":(n.Data=[],r.bytes!==Array&&(n.Data=Nt.newBuffer(n.Data))),Nt.Long){var i=new Nt.Long(0,0,!0);n.filesize=r.longs===String?i.toString():r.longs===Number?i.toNumber():i}else n.filesize=r.longs===String?"0":0;Nt.Long?(i=new Nt.Long(0,0,!0),n.hashType=r.longs===String?i.toString():r.longs===Number?i.toNumber():i):n.hashType=r.longs===String?"0":0,Nt.Long?(i=new Nt.Long(0,0,!0),n.fanout=r.longs===String?i.toString():r.longs===Number?i.toNumber():i):n.fanout=r.longs===String?"0":0,n.mode=0,n.mtime=null}if(t.Type!=null&&t.hasOwnProperty("Type")&&(n.Type=r.enums===String?sn.Data.DataType[t.Type]:t.Type),t.Data!=null&&t.hasOwnProperty("Data")&&(n.Data=r.bytes===String?Nt.base64.encode(t.Data,0,t.Data.length):r.bytes===Array?Array.prototype.slice.call(t.Data):t.Data),t.filesize!=null&&t.hasOwnProperty("filesize")&&(typeof t.filesize=="number"?n.filesize=r.longs===String?String(t.filesize):t.filesize:n.filesize=r.longs===String?Nt.Long.prototype.toString.call(t.filesize):r.longs===Number?new Nt.LongBits(t.filesize.low>>>0,t.filesize.high>>>0).toNumber(!0):t.filesize),t.blocksizes&&t.blocksizes.length){n.blocksizes=[];for(var a=0;a<t.blocksizes.length;++a)typeof t.blocksizes[a]=="number"?n.blocksizes[a]=r.longs===String?String(t.blocksizes[a]):t.blocksizes[a]:n.blocksizes[a]=r.longs===String?Nt.Long.prototype.toString.call(t.blocksizes[a]):r.longs===Number?new Nt.LongBits(t.blocksizes[a].low>>>0,t.blocksizes[a].high>>>0).toNumber(!0):t.blocksizes[a]}return t.hashType!=null&&t.hasOwnProperty("hashType")&&(typeof t.hashType=="number"?n.hashType=r.longs===String?String(t.hashType):t.hashType:n.hashType=r.longs===String?Nt.Long.prototype.toString.call(t.hashType):r.longs===Number?new Nt.LongBits(t.hashType.low>>>0,t.hashType.high>>>0).toNumber(!0):t.hashType),t.fanout!=null&&t.hasOwnProperty("fanout")&&(typeof t.fanout=="number"?n.fanout=r.longs===String?String(t.fanout):t.fanout:n.fanout=r.longs===String?Nt.Long.prototype.toString.call(t.fanout):r.longs===Number?new Nt.LongBits(t.fanout.low>>>0,t.fanout.high>>>0).toNumber(!0):t.fanout),t.mode!=null&&t.hasOwnProperty("mode")&&(n.mode=t.mode),t.mtime!=null&&t.hasOwnProperty("mtime")&&(n.mtime=sn.UnixTime.toObject(t.mtime,r)),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ja.util.toJSONOptions)},e.DataType=function(){let t={},r=Object.create(t);return r[t[0]="Raw"]=0,r[t[1]="Directory"]=1,r[t[2]="File"]=2,r[t[3]="Metadata"]=3,r[t[4]="Symlink"]=4,r[t[5]="HAMTShard"]=5,r}(),e})();sn.UnixTime=(()=>{function e(t){if(t)for(var r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.Seconds=Nt.Long?Nt.Long.fromBits(0,0,!1):0,e.prototype.FractionalNanoseconds=0,e.encode=function(t,r){return r||(r=ky.create()),r.uint32(8).int64(t.Seconds),t.FractionalNanoseconds!=null&&Object.hasOwnProperty.call(t,"FractionalNanoseconds")&&r.uint32(21).fixed32(t.FractionalNanoseconds),r},e.decode=function(t,r){t instanceof Iu||(t=Iu.create(t));for(var n=r===void 0?t.len:t.pos+r,i=new sn.UnixTime;t.pos<n;){var a=t.uint32();switch(a>>>3){case 1:i.Seconds=t.int64();break;case 2:i.FractionalNanoseconds=t.fixed32();break;default:t.skipType(7&a)}}if(!i.hasOwnProperty("Seconds"))throw Nt.ProtocolError("missing required 'Seconds'",{instance:i});return i},e.fromObject=function(t){if(t instanceof sn.UnixTime)return t;var r=new sn.UnixTime;return t.Seconds!=null&&(Nt.Long?(r.Seconds=Nt.Long.fromValue(t.Seconds)).unsigned=!1:typeof t.Seconds=="string"?r.Seconds=parseInt(t.Seconds,10):typeof t.Seconds=="number"?r.Seconds=t.Seconds:typeof t.Seconds=="object"&&(r.Seconds=new Nt.LongBits(t.Seconds.low>>>0,t.Seconds.high>>>0).toNumber())),t.FractionalNanoseconds!=null&&(r.FractionalNanoseconds=t.FractionalNanoseconds>>>0),r},e.toObject=function(t,r){r||(r={});var n={};if(r.defaults){if(Nt.Long){var i=new Nt.Long(0,0,!1);n.Seconds=r.longs===String?i.toString():r.longs===Number?i.toNumber():i}else n.Seconds=r.longs===String?"0":0;n.FractionalNanoseconds=0}return t.Seconds!=null&&t.hasOwnProperty("Seconds")&&(typeof t.Seconds=="number"?n.Seconds=r.longs===String?String(t.Seconds):t.Seconds:n.Seconds=r.longs===String?Nt.Long.prototype.toString.call(t.Seconds):r.longs===Number?new Nt.LongBits(t.Seconds.low>>>0,t.Seconds.high>>>0).toNumber():t.Seconds),t.FractionalNanoseconds!=null&&t.hasOwnProperty("FractionalNanoseconds")&&(n.FractionalNanoseconds=t.FractionalNanoseconds),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ja.util.toJSONOptions)},e})(),sn.Metadata=(()=>{function e(t){if(t)for(var r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.MimeType="",e.encode=function(t,r){return r||(r=ky.create()),t.MimeType!=null&&Object.hasOwnProperty.call(t,"MimeType")&&r.uint32(10).string(t.MimeType),r},e.decode=function(t,r){t instanceof Iu||(t=Iu.create(t));for(var n=r===void 0?t.len:t.pos+r,i=new sn.Metadata;t.pos<n;){var a=t.uint32();a>>>3==1?i.MimeType=t.string():t.skipType(7&a)}return i},e.fromObject=function(t){if(t instanceof sn.Metadata)return t;var r=new sn.Metadata;return t.MimeType!=null&&(r.MimeType=String(t.MimeType)),r},e.toObject=function(t,r){r||(r={});var n={};return r.defaults&&(n.MimeType=""),t.MimeType!=null&&t.hasOwnProperty("MimeType")&&(n.MimeType=t.MimeType),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ja.util.toJSONOptions)},e})();var ga=EG,$E=["raw","directory","file","metadata","symlink","hamt-sharded-directory"],SG=["directory","hamt-sharded-directory"],EE=parseInt("0644",8),SE=parseInt("0755",8);function dc(e){if(e!=null)return typeof e=="number"?4095&e:(e=e.toString()).substring(0,1)==="0"?4095&parseInt(e,8):4095&parseInt(e,10)}function Zp(e){if(e==null)return;let t;if(e.secs!=null&&(t={secs:e.secs,nsecs:e.nsecs}),e.Seconds!=null&&(t={secs:e.Seconds,nsecs:e.FractionalNanoseconds}),Array.isArray(e)&&(t={secs:e[0],nsecs:e[1]}),e instanceof Date){let r=e.getTime(),n=Math.floor(r/1e3);t={secs:n,nsecs:1e3*(r-1e3*n)}}if(Object.prototype.hasOwnProperty.call(t,"secs")){if(t!=null&&t.nsecs!=null&&(t.nsecs<0||t.nsecs>999999999))throw rr(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return t}}var Yi=class e{static unmarshal(t){let r=ga.decode(t),n=ga.toObject(r,{defaults:!1,arrays:!0,longs:Number,objects:!1}),i=new e({type:$E[n.Type],data:n.Data,blockSizes:n.blocksizes,mode:n.mode,mtime:n.mtime?{secs:n.mtime.Seconds,nsecs:n.mtime.FractionalNanoseconds}:void 0});return i._originalMode=n.mode||0,i}constructor(t={type:"file"}){let{type:r,data:n,blockSizes:i,hashType:a,fanout:o,mtime:s,mode:u}=t;if(r&&!$E.includes(r))throw rr(new Error("Type: "+r+" is not valid"),"ERR_INVALID_TYPE");this.type=r||"file",this.data=n,this.hashType=a,this.fanout=o,this.blockSizes=i||[],this._originalMode=0,this.mode=dc(u),s&&(this.mtime=Zp(s),this.mtime&&!this.mtime.nsecs&&(this.mtime.nsecs=0))}set mode(t){this._mode=this.isDirectory()?SE:EE;let r=dc(t);r!==void 0&&(this._mode=r)}get mode(){return this._mode}isDirectory(){return!!(this.type&&SG.includes(this.type))}addBlockSize(t){this.blockSizes.push(t)}removeBlockSize(t){this.blockSizes.splice(t,1)}fileSize(){if(this.isDirectory())return 0;let t=0;return this.blockSizes.forEach(r=>{t+=r}),this.data&&(t+=this.data.length),t}marshal(){let t;switch(this.type){case"raw":t=ga.DataType.Raw;break;case"directory":t=ga.DataType.Directory;break;case"file":t=ga.DataType.File;break;case"metadata":t=ga.DataType.Metadata;break;case"symlink":t=ga.DataType.Symlink;break;case"hamt-sharded-directory":t=ga.DataType.HAMTShard;break;default:throw rr(new Error("Type: "+t+" is not valid"),"ERR_INVALID_TYPE")}let r,n,i=this.data;if(this.data&&this.data.length||(i=void 0),this.mode!=null&&(r=4294963200&this._originalMode|(dc(this.mode)||0),r!==EE||this.isDirectory()||(r=void 0),r===SE&&this.isDirectory()&&(r=void 0)),this.mtime!=null){let o=Zp(this.mtime);o&&(n={Seconds:o.secs,FractionalNanoseconds:o.nsecs},n.FractionalNanoseconds===0&&delete n.FractionalNanoseconds)}let a={Type:t,Data:i,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:r,mtime:n};return ga.encode(a).finish()}},TG=new TextDecoder;function Qy(e,t){let r=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(t>=e.length)throw new Error("protobuf: unexpected end of data");let i=e[t++];if(r+=n<28?(127&i)<<n:(127&i)*2**n,i<128)break}return[r,t]}function Qp(e,t){let r;[r,t]=Qy(e,t);let n=t+r;if(r<0||n<0)throw new Error("protobuf: invalid length");if(n>e.length)throw new Error("protobuf: unexpected end of data");return[e.subarray(t,n),n]}function zS(e,t){let r;return[r,t]=Qy(e,t),[7&r,r>>3,t]}function AG(e){let t={},r=e.length,n=0;for(;n<r;){let i,a;if([i,a,n]=zS(e,n),a===1){if(t.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Hash`);if(t.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(t.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[t.Hash,n]=Qp(e,n)}else if(a===2){if(t.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Name`);if(t.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let o;[o,n]=Qp(e,n),t.Name=TG.decode(o)}else{if(a!==3)throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${a}`);if(t.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(i!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Tsize`);[t.Tsize,n]=Qy(e,n)}}if(n>r)throw new Error("protobuf: (PBLink) unexpected end of data");return t}function kG(e){let t=e.length,r,n,i=0,a=!1;for(;i<t;){let s,u;if([s,u,i]=zS(e,i),s!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${s}`);if(u===1){if(n)throw new Error("protobuf: (PBNode) duplicate Data section");[n,i]=Qp(e,i),r&&(a=!0)}else{if(u!==2)throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${u}`);{if(a)throw new Error("protobuf: (PBNode) duplicate Links section");let l;r||(r=[]),[l,i]=Qp(e,i),r.push(AG(l))}}}if(i>t)throw new Error("protobuf: (PBNode) unexpected end of data");let o={};return n&&(o.Data=n),o.Links=r||[],o}var NS=new TextEncoder,TE=2**32,IG=2**31;function CG(e,t){let r=t.length;if(typeof e.Tsize=="number"){if(e.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(e.Tsize))throw new Error("Tsize too large for encoding");r=pc(t,r,e.Tsize)-1,t[r]=24}if(typeof e.Name=="string"){let n=NS.encode(e.Name);r-=n.length,t.set(n,r),r=pc(t,r,n.length)-1,t[r]=18}return e.Hash&&(r-=e.Hash.length,t.set(e.Hash,r),r=pc(t,r,e.Hash.length)-1,t[r]=10),t.length-r}function OG(e){let t=RG(e),r=new Uint8Array(t),n=t;if(e.Data&&(n-=e.Data.length,r.set(e.Data,n),n=pc(r,n,e.Data.length)-1,r[n]=10),e.Links)for(let i=e.Links.length-1;i>=0;i--){let a=CG(e.Links[i],r.subarray(0,n));n-=a,n=pc(r,n,a)-1,r[n]=18}return r}function BG(e){let t=0;if(e.Hash){let r=e.Hash.length;t+=1+r+Cu(r)}if(typeof e.Name=="string"){let r=NS.encode(e.Name).length;t+=1+r+Cu(r)}return typeof e.Tsize=="number"&&(t+=1+Cu(e.Tsize)),t}function RG(e){let t=0;if(e.Data){let r=e.Data.length;t+=1+r+Cu(r)}if(e.Links)for(let r of e.Links){let n=BG(r);t+=1+n+Cu(n)}return t}function pc(e,t,r){let n=t-=Cu(r);for(;r>=IG;)e[t++]=127&r|128,r/=128;for(;r>=128;)e[t++]=127&r|128,r>>>=7;return e[t]=r,n}function Cu(e){return e%2==0&&e++,Math.floor((zG(e)+6)/7)}function zG(e){let t=0;return e>=TE&&(e=Math.floor(e/TE),t=32),e>=65536&&(e>>>=16,t+=16),e>=256&&(e>>>=8,t+=8),t+NG[e]}var NG=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],LG=["Data","Links"],DG=["Hash","Name","Tsize"],Iy=new TextEncoder;function LS(e,t){if(e===t)return 0;let r=e.Name?Iy.encode(e.Name):[],n=t.Name?Iy.encode(t.Name):[],i=r.length,a=n.length;for(let o=0,s=Math.min(i,a);o<s;++o)if(r[o]!==n[o]){i=r[o],a=n[o];break}return i<a?-1:a<i?1:0}function AE(e,t){return!Object.keys(e).some(r=>!t.includes(r))}function DS(e){if(typeof e.asCID=="object"){let r=mr.asCID(e);if(!r)throw new TypeError("Invalid DAG-PB form");return{Hash:r}}if(typeof e!="object"||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");let t={};if(e.Hash){let r=mr.asCID(e.Hash);try{r||(typeof e.Hash=="string"?r=mr.parse(e.Hash):e.Hash instanceof Uint8Array&&(r=mr.decode(e.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}r&&(t.Hash=r)}if(!t.Hash)throw new TypeError("Invalid DAG-PB form");return typeof e.Name=="string"&&(t.Name=e.Name),typeof e.Tsize=="number"&&(t.Tsize=e.Tsize),t}function Zo(e){if((e instanceof Uint8Array||typeof e=="string")&&(e={Data:e}),typeof e!="object"||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");let t={};if(e.Data!==void 0)if(typeof e.Data=="string")t.Data=Iy.encode(e.Data);else{if(!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form");t.Data=e.Data}if(e.Links!==void 0){if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form");t.Links=e.Links.map(DS),t.Links.sort(LS)}else t.Links=[];return t}function MS(e){if(!e||typeof e!="object"||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");if(!AE(e,LG))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(e.Data!==void 0&&!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be a Uint8Array)");if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form (Links must be an array)");for(let t=0;t<e.Links.length;t++){let r=e.Links[t];if(!r||typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form (bad link object)");if(!AE(r,DG))throw new TypeError("Invalid DAG-PB form (extraneous properties on link object)");if(!r.Hash)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(r.Hash.asCID!==r.Hash)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(r.Name!==void 0&&typeof r.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(r.Tsize!==void 0&&(typeof r.Tsize!="number"||r.Tsize%1!=0))throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(t>0&&LS(r,e.Links[t-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function MG(e,t=[]){return Zo({Data:e,Links:t})}function PG(e,t,r){return DS({Hash:r,Name:e,Tsize:t})}var UG="dag-pb",Jy=112;function Qo(e){MS(e);let t={};return e.Links&&(t.Links=e.Links.map(r=>{let n={};return r.Hash&&(n.Hash=r.Hash.bytes),r.Name!==void 0&&(n.Name=r.Name),r.Tsize!==void 0&&(n.Tsize=r.Tsize),n})),e.Data&&(t.Data=e.Data),OG(t)}function Ac(e){let t=kG(e),r={};return t.Data&&(r.Data=t.Data),t.Links&&(r.Links=t.Links.map(n=>{let i={};try{i.Hash=mr.decode(n.Hash)}catch{}if(!i.Hash)throw new Error("Invalid Hash field found in link, expected CID");return n.Name!==void 0&&(i.Name=n.Name),n.Tsize!==void 0&&(i.Tsize=n.Tsize),i})),r}var vc=Object.freeze({__proto__:null,name:UG,code:Jy,encode:Qo,decode:Ac,prepare:Zo,validate:MS,createNode:MG,createLink:PG}),zu=async(e,t,r)=>{r.codec||(r.codec=vc),r.hasher||(r.hasher=Ru),r.cidVersion===void 0&&(r.cidVersion=1),r.codec===vc&&r.hasher!==Ru&&(r.cidVersion=1);let n=await r.hasher.digest(e),i=mr.create(r.cidVersion,r.codec.code,n);return r.onlyHash||await t.put(i,e,{signal:r.signal}),i},FG=async(e,t,r)=>{let n=new Yi({type:"directory",mtime:e.mtime,mode:e.mode}),i=Qo(Zo({Data:n.marshal()}));return{cid:await zu(i,t,r),path:e.path,unixfs:n,size:i.length}},GG="raw",Ou=85,jG=e=>Lu(e),VG=e=>Lu(e),PS=Object.freeze({__proto__:null,name:GG,code:Ou,encode:jG,decode:VG}),WG=async e=>{let t=[];for await(let r of e)t.push(r);return t},e1=WG;async function HG(e,t){return t(await e1(e))}function qG(e,t,r){return US(e,t,r)}async function US(e,t,r){let n=[];for await(let i of Zy(e,r.maxChildrenPerNode))n.push(await t(i));return n.length>1?US(n,t,r):n[0]}async function XG(e,t,r){let n=new Cy(r.layerRepeat),i=0,a=1,o=n;for await(let s of Zy(e,r.maxChildrenPerNode))o.isFull()&&(o!==n&&n.addChild(await o.reduce(t)),i&&i%r.layerRepeat==0&&a++,o=new Jp(a,r.layerRepeat,i),i++),o.append(s);return o&&o!==n&&n.addChild(await o.reduce(t)),n.reduce(t)}var Jp=class{constructor(t,r,n=0){this.maxDepth=t,this.layerRepeat=r,this.currentDepth=1,this.iteration=n,this.root=this.node=this.parent={children:[],depth:this.currentDepth,maxDepth:t,maxChildren:(this.maxDepth-this.currentDepth)*this.layerRepeat}}isFull(){if(!this.root.data)return!1;if(this.currentDepth<this.maxDepth&&this.node.maxChildren)return this._addNextNodeToParent(this.node),!1;let t=this._findParent(this.node,this.currentDepth);return!t||(this._addNextNodeToParent(t),!1)}_addNextNodeToParent(t){this.parent=t;let r={children:[],depth:t.depth+1,parent:t,maxDepth:this.maxDepth,maxChildren:Math.floor(t.children.length/this.layerRepeat)*this.layerRepeat};t.children.push(r),this.currentDepth=r.depth,this.node=r}append(t){this.node.data=t}reduce(t){return this._reduce(this.root,t)}async _reduce(t,r){let n=[];return t.children.length&&(n=await Promise.all(t.children.filter(i=>i.data).map(i=>this._reduce(i,r)))),r((t.data||[]).concat(n))}_findParent(t,r){let n=t.parent;if(n&&n.depth!==0)return n.children.length!==n.maxChildren&&n.maxChildren?n:this._findParent(n,r)}},Cy=class extends Jp{constructor(t){super(0,t),this.root.depth=0,this.currentDepth=1}addChild(t){this.root.children.push(t)}reduce(t){return t((this.root.data||[]).concat(this.root.children))}};async function*KG(e,t,r){for await(let n of e.content)yield async()=>{let i;r.progress(n.length,e.path);let a={codec:vc,cidVersion:r.cidVersion,hasher:r.hasher,onlyHash:r.onlyHash};return r.rawLeaves?(a.codec=PS,a.cidVersion=1):(i=new Yi({type:r.leafType,data:n,mtime:e.mtime,mode:e.mode}),n=Qo({Data:i.marshal(),Links:[]})),{cid:await zu(n,t,a),unixfs:i,size:n.length}}}var YG={flat:HG,balanced:qG,trickle:XG};async function*ZG(e,t,r){let n,i,a=-1;i=typeof r.bufferImporter=="function"?r.bufferImporter:KG;for await(let o of bS(i(e,t,r),r.blockWriteConcurrency))a++,a!==0?(a===1&&n&&(yield n,n=null),yield o):n=o;n&&(n.single=!0,yield n)}var QG=(e,t,r)=>async function(n){if(n.length===1&&n[0].single&&r.reduceSingleLeafToSelf){let u=n[0];if(u.cid.code===Ou&&(e.mtime!==void 0||e.mode!==void 0)){let l=await t.get(u.cid);u.unixfs=new Yi({type:"file",mtime:e.mtime,mode:e.mode,data:l}),l=Qo(Zo({Data:u.unixfs.marshal()})),u.cid=await zu(l,t,{...r,codec:vc,hasher:r.hasher,cidVersion:r.cidVersion}),u.size=l.length}return{cid:u.cid,path:e.path,unixfs:u.unixfs,size:u.size}}let i=new Yi({type:"file",mtime:e.mtime,mode:e.mode}),a=n.filter(u=>!(u.cid.code!==Ou||!u.size)||!(!u.unixfs||u.unixfs.data||!u.unixfs.fileSize())||!!(u.unixfs&&u.unixfs.data&&u.unixfs.data.length)).map(u=>u.cid.code===Ou?(i.addBlockSize(u.size),{Name:"",Tsize:u.size,Hash:u.cid}):(u.unixfs&&u.unixfs.data?i.addBlockSize(u.unixfs.data.length):i.addBlockSize(u.unixfs&&u.unixfs.fileSize()||0),{Name:"",Tsize:u.size,Hash:u.cid})),o={Data:i.marshal(),Links:a},s=Qo(Zo(o));return{cid:await zu(s,t,r),path:e.path,unixfs:i,size:s.length+o.Links.reduce((u,l)=>u+l.Tsize,0)}};function JG(e,t,r){let n=YG[r.strategy];if(!n)throw rr(new Error(`Unknown importer build strategy name: ${r.strategy}`),"ERR_BAD_STRATEGY");return n(ZG(e,t,r),QG(e,t,r),r)}var FS={},Rp={};Rp.byteLength=e7,Rp.toByteArray=r7,Rp.fromByteArray=a7;for(bi=[],zn=[],GS=typeof Uint8Array<"u"?Uint8Array:Array,xp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",qo=0,kE=xp.length;qo<kE;++qo)bi[qo]=xp[qo],zn[xp.charCodeAt(qo)]=qo;var bi,zn,GS,xp,qo,kE;function jS(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return r===-1&&(r=t),[r,r===t?0:4-r%4]}function e7(e){var t=jS(e),r=t[0],n=t[1];return 3*(r+n)/4-n}function t7(e,t,r){return 3*(t+r)/4-r}function r7(e){var t,r,n=jS(e),i=n[0],a=n[1],o=new GS(t7(e,i,a)),s=0,u=a>0?i-4:i;for(r=0;r<u;r+=4)t=zn[e.charCodeAt(r)]<<18|zn[e.charCodeAt(r+1)]<<12|zn[e.charCodeAt(r+2)]<<6|zn[e.charCodeAt(r+3)],o[s++]=t>>16&255,o[s++]=t>>8&255,o[s++]=255&t;return a===2&&(t=zn[e.charCodeAt(r)]<<2|zn[e.charCodeAt(r+1)]>>4,o[s++]=255&t),a===1&&(t=zn[e.charCodeAt(r)]<<10|zn[e.charCodeAt(r+1)]<<4|zn[e.charCodeAt(r+2)]>>2,o[s++]=t>>8&255,o[s++]=255&t),o}function n7(e){return bi[e>>18&63]+bi[e>>12&63]+bi[e>>6&63]+bi[63&e]}function i7(e,t,r){for(var n,i=[],a=t;a<r;a+=3)n=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),i.push(n7(n));return i.join("")}function a7(e){for(var t,r=e.length,n=r%3,i=[],a=16383,o=0,s=r-n;o<s;o+=a)i.push(i7(e,o,o+a>s?s:o+a));return n===1?(t=e[r-1],i.push(bi[t>>2]+bi[t<<4&63]+"==")):n===2&&(t=(e[r-2]<<8)+e[r-1],i.push(bi[t>>10]+bi[t>>4&63]+bi[t<<2&63]+"=")),i.join("")}zn[45]=62,zn[95]=63;var o7={read:function(e,t,r,n,i){var a,o,s=8*i-n-1,u=(1<<s)-1,l=u>>1,c=-7,f=r?i-1:0,p=r?-1:1,d=e[t+f];for(f+=p,a=d&(1<<-c)-1,d>>=-c,c+=s;c>0;a=256*a+e[t+f],f+=p,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=n;c>0;o=256*o+e[t+f],f+=p,c-=8);if(a===0)a=1-l;else{if(a===u)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),a-=l}return(d?-1:1)*o*Math.pow(2,a-n)},write:function(e,t,r,n,i,a){var o,s,u,l=8*a-i-1,c=(1<<l)-1,f=c>>1,p=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:a-1,m=n?1:-1,g=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+f>=1?p/u:p*Math.pow(2,1-f))*u>=2&&(o++,u/=2),o+f>=c?(s=0,o=c):o+f>=1?(s=(t*u-1)*Math.pow(2,i),o+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;e[r+d]=255&s,d+=m,s/=256,i-=8);for(o=o<<i|s,l+=i;l>0;e[r+d]=255&o,d+=m,o/=256,l-=8);e[r+d-m]|=128*g}};(function(e){let t=Rp,r=o7,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=o,e.SlowBuffer=function(w){return+w!=w&&(w=0),o.alloc(+w)},e.INSPECT_MAX_BYTES=50;let i=2147483647;function a(w){if(w>i)throw new RangeError('The value "'+w+'" is invalid for option "size"');let T=new Uint8Array(w);return Object.setPrototypeOf(T,o.prototype),T}function o(w,T,O){if(typeof w=="number"){if(typeof T=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return l(w)}return s(w,T,O)}function s(w,T,O){if(typeof w=="string")return function(S,ze){if(typeof ze=="string"&&ze!==""||(ze="utf8"),!o.isEncoding(ze))throw new TypeError("Unknown encoding: "+ze);let Mt=0|d(S,ze),qt=a(Mt),fr=qt.write(S,ze);return fr!==Mt&&(qt=qt.slice(0,fr)),qt}(w,T);if(ArrayBuffer.isView(w))return function(S){if(Bt(S,Uint8Array)){let ze=new Uint8Array(S);return f(ze.buffer,ze.byteOffset,ze.byteLength)}return c(S)}(w);if(w==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof w);if(Bt(w,ArrayBuffer)||w&&Bt(w.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Bt(w,SharedArrayBuffer)||w&&Bt(w.buffer,SharedArrayBuffer)))return f(w,T,O);if(typeof w=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let q=w.valueOf&&w.valueOf();if(q!=null&&q!==w)return o.from(q,T,O);let ie=function(S){if(o.isBuffer(S)){let ze=0|p(S.length),Mt=a(ze);return Mt.length===0||S.copy(Mt,0,0,ze),Mt}if(S.length!==void 0)return typeof S.length!="number"||er(S.length)?a(0):c(S);if(S.type==="Buffer"&&Array.isArray(S.data))return c(S.data)}(w);if(ie)return ie;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof w[Symbol.toPrimitive]=="function")return o.from(w[Symbol.toPrimitive]("string"),T,O);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof w)}function u(w){if(typeof w!="number")throw new TypeError('"size" argument must be of type number');if(w<0)throw new RangeError('The value "'+w+'" is invalid for option "size"')}function l(w){return u(w),a(w<0?0:0|p(w))}function c(w){let T=w.length<0?0:0|p(w.length),O=a(T);for(let q=0;q<T;q+=1)O[q]=255&w[q];return O}function f(w,T,O){if(T<0||w.byteLength<T)throw new RangeError('"offset" is outside of buffer bounds');if(w.byteLength<T+(O||0))throw new RangeError('"length" is outside of buffer bounds');let q;return q=T===void 0&&O===void 0?new Uint8Array(w):O===void 0?new Uint8Array(w,T):new Uint8Array(w,T,O),Object.setPrototypeOf(q,o.prototype),q}function p(w){if(w>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return 0|w}function d(w,T){if(o.isBuffer(w))return w.length;if(ArrayBuffer.isView(w)||Bt(w,ArrayBuffer))return w.byteLength;if(typeof w!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof w);let O=w.length,q=arguments.length>2&&arguments[2]===!0;if(!q&&O===0)return 0;let ie=!1;for(;;)switch(T){case"ascii":case"latin1":case"binary":return O;case"utf8":case"utf-8":return mt(w).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*O;case"hex":return O>>>1;case"base64":return gt(w).length;default:if(ie)return q?-1:mt(w).length;T=(""+T).toLowerCase(),ie=!0}}function m(w,T,O){let q=!1;if((T===void 0||T<0)&&(T=0),T>this.length||((O===void 0||O>this.length)&&(O=this.length),O<=0)||(O>>>=0)<=(T>>>=0))return"";for(w||(w="utf8");;)switch(w){case"hex":return pe(this,T,O);case"utf8":case"utf-8":return P(this,T,O);case"ascii":return te(this,T,O);case"latin1":case"binary":return ce(this,T,O);case"base64":return C(this,T,O);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ge(this,T,O);default:if(q)throw new TypeError("Unknown encoding: "+w);w=(w+"").toLowerCase(),q=!0}}function g(w,T,O){let q=w[T];w[T]=w[O],w[O]=q}function x(w,T,O,q,ie){if(w.length===0)return-1;if(typeof O=="string"?(q=O,O=0):O>2147483647?O=2147483647:O<-2147483648&&(O=-2147483648),er(O=+O)&&(O=ie?0:w.length-1),O<0&&(O=w.length+O),O>=w.length){if(ie)return-1;O=w.length-1}else if(O<0){if(!ie)return-1;O=0}if(typeof T=="string"&&(T=o.from(T,q)),o.isBuffer(T))return T.length===0?-1:b(w,T,O,q,ie);if(typeof T=="number")return T&=255,typeof Uint8Array.prototype.indexOf=="function"?ie?Uint8Array.prototype.indexOf.call(w,T,O):Uint8Array.prototype.lastIndexOf.call(w,T,O):b(w,[T],O,q,ie);throw new TypeError("val must be string, number or Buffer")}function b(w,T,O,q,ie){let S,ze=1,Mt=w.length,qt=T.length;if(q!==void 0&&((q=String(q).toLowerCase())==="ucs2"||q==="ucs-2"||q==="utf16le"||q==="utf-16le")){if(w.length<2||T.length<2)return-1;ze=2,Mt/=2,qt/=2,O/=2}function fr(Lt,Rt){return ze===1?Lt[Rt]:Lt.readUInt16BE(Rt*ze)}if(ie){let Lt=-1;for(S=O;S<Mt;S++)if(fr(w,S)===fr(T,Lt===-1?0:S-Lt)){if(Lt===-1&&(Lt=S),S-Lt+1===qt)return Lt*ze}else Lt!==-1&&(S-=S-Lt),Lt=-1}else for(O+qt>Mt&&(O=Mt-qt),S=O;S>=0;S--){let Lt=!0;for(let Rt=0;Rt<qt;Rt++)if(fr(w,S+Rt)!==fr(T,Rt)){Lt=!1;break}if(Lt)return S}return-1}function y(w,T,O,q){O=Number(O)||0;let ie=w.length-O;q?(q=Number(q))>ie&&(q=ie):q=ie;let S=T.length,ze;for(q>S/2&&(q=S/2),ze=0;ze<q;++ze){let Mt=parseInt(T.substr(2*ze,2),16);if(er(Mt))return ze;w[O+ze]=Mt}return ze}function E(w,T,O,q){return Dt(mt(T,w.length-O),w,O,q)}function $(w,T,O,q){return Dt(function(ie){let S=[];for(let ze=0;ze<ie.length;++ze)S.push(255&ie.charCodeAt(ze));return S}(T),w,O,q)}function k(w,T,O,q){return Dt(gt(T),w,O,q)}function R(w,T,O,q){return Dt(function(ie,S){let ze,Mt,qt,fr=[];for(let Lt=0;Lt<ie.length&&!((S-=2)<0);++Lt)ze=ie.charCodeAt(Lt),Mt=ze>>8,qt=ze%256,fr.push(qt),fr.push(Mt);return fr}(T,w.length-O),w,O,q)}function C(w,T,O){return T===0&&O===w.length?t.fromByteArray(w):t.fromByteArray(w.slice(T,O))}function P(w,T,O){O=Math.min(w.length,O);let q=[],ie=T;for(;ie<O;){let S=w[ie],ze=null,Mt=S>239?4:S>223?3:S>191?2:1;if(ie+Mt<=O){let qt,fr,Lt,Rt;switch(Mt){case 1:S<128&&(ze=S);break;case 2:qt=w[ie+1],(192&qt)==128&&(Rt=(31&S)<<6|63&qt,Rt>127&&(ze=Rt));break;case 3:qt=w[ie+1],fr=w[ie+2],(192&qt)==128&&(192&fr)==128&&(Rt=(15&S)<<12|(63&qt)<<6|63&fr,Rt>2047&&(Rt<55296||Rt>57343)&&(ze=Rt));break;case 4:qt=w[ie+1],fr=w[ie+2],Lt=w[ie+3],(192&qt)==128&&(192&fr)==128&&(192&Lt)==128&&(Rt=(15&S)<<18|(63&qt)<<12|(63&fr)<<6|63&Lt,Rt>65535&&Rt<1114112&&(ze=Rt))}}ze===null?(ze=65533,Mt=1):ze>65535&&(ze-=65536,q.push(ze>>>10&1023|55296),ze=56320|1023&ze),q.push(ze),ie+=Mt}return function(S){let ze=S.length;if(ze<=W)return String.fromCharCode.apply(String,S);let Mt="",qt=0;for(;qt<ze;)Mt+=String.fromCharCode.apply(String,S.slice(qt,qt+=W));return Mt}(q)}e.kMaxLength=i,o.TYPED_ARRAY_SUPPORT=function(){try{let w=new Uint8Array(1),T={foo:function(){return 42}};return Object.setPrototypeOf(T,Uint8Array.prototype),Object.setPrototypeOf(w,T),w.foo()===42}catch{return!1}}(),o.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(w,T,O){return s(w,T,O)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(w,T,O){return function(q,ie,S){return u(q),q<=0?a(q):ie!==void 0?typeof S=="string"?a(q).fill(ie,S):a(q).fill(ie):a(q)}(w,T,O)},o.allocUnsafe=function(w){return l(w)},o.allocUnsafeSlow=function(w){return l(w)},o.isBuffer=function(w){return w!=null&&w._isBuffer===!0&&w!==o.prototype},o.compare=function(w,T){if(Bt(w,Uint8Array)&&(w=o.from(w,w.offset,w.byteLength)),Bt(T,Uint8Array)&&(T=o.from(T,T.offset,T.byteLength)),!o.isBuffer(w)||!o.isBuffer(T))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(w===T)return 0;let O=w.length,q=T.length;for(let ie=0,S=Math.min(O,q);ie<S;++ie)if(w[ie]!==T[ie]){O=w[ie],q=T[ie];break}return O<q?-1:q<O?1:0},o.isEncoding=function(w){switch(String(w).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(w,T){if(!Array.isArray(w))throw new TypeError('"list" argument must be an Array of Buffers');if(w.length===0)return o.alloc(0);let O;if(T===void 0)for(T=0,O=0;O<w.length;++O)T+=w[O].length;let q=o.allocUnsafe(T),ie=0;for(O=0;O<w.length;++O){let S=w[O];if(Bt(S,Uint8Array))ie+S.length>q.length?(o.isBuffer(S)||(S=o.from(S)),S.copy(q,ie)):Uint8Array.prototype.set.call(q,S,ie);else{if(!o.isBuffer(S))throw new TypeError('"list" argument must be an Array of Buffers');S.copy(q,ie)}ie+=S.length}return q},o.byteLength=d,o.prototype._isBuffer=!0,o.prototype.swap16=function(){let w=this.length;if(w%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let T=0;T<w;T+=2)g(this,T,T+1);return this},o.prototype.swap32=function(){let w=this.length;if(w%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let T=0;T<w;T+=4)g(this,T,T+3),g(this,T+1,T+2);return this},o.prototype.swap64=function(){let w=this.length;if(w%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let T=0;T<w;T+=8)g(this,T,T+7),g(this,T+1,T+6),g(this,T+2,T+5),g(this,T+3,T+4);return this},o.prototype.toString=function(){let w=this.length;return w===0?"":arguments.length===0?P(this,0,w):m.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(w){if(!o.isBuffer(w))throw new TypeError("Argument must be a Buffer");return this===w||o.compare(this,w)===0},o.prototype.inspect=function(){let w="",T=e.INSPECT_MAX_BYTES;return w=this.toString("hex",0,T).replace(/(.{2})/g,"$1 ").trim(),this.length>T&&(w+=" ... "),"<Buffer "+w+">"},n&&(o.prototype[n]=o.prototype.inspect),o.prototype.compare=function(w,T,O,q,ie){if(Bt(w,Uint8Array)&&(w=o.from(w,w.offset,w.byteLength)),!o.isBuffer(w))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof w);if(T===void 0&&(T=0),O===void 0&&(O=w?w.length:0),q===void 0&&(q=0),ie===void 0&&(ie=this.length),T<0||O>w.length||q<0||ie>this.length)throw new RangeError("out of range index");if(q>=ie&&T>=O)return 0;if(q>=ie)return-1;if(T>=O)return 1;if(this===w)return 0;let S=(ie>>>=0)-(q>>>=0),ze=(O>>>=0)-(T>>>=0),Mt=Math.min(S,ze),qt=this.slice(q,ie),fr=w.slice(T,O);for(let Lt=0;Lt<Mt;++Lt)if(qt[Lt]!==fr[Lt]){S=qt[Lt],ze=fr[Lt];break}return S<ze?-1:ze<S?1:0},o.prototype.includes=function(w,T,O){return this.indexOf(w,T,O)!==-1},o.prototype.indexOf=function(w,T,O){return x(this,w,T,O,!0)},o.prototype.lastIndexOf=function(w,T,O){return x(this,w,T,O,!1)},o.prototype.write=function(w,T,O,q){if(T===void 0)q="utf8",O=this.length,T=0;else if(O===void 0&&typeof T=="string")q=T,O=this.length,T=0;else{if(!isFinite(T))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");T>>>=0,isFinite(O)?(O>>>=0,q===void 0&&(q="utf8")):(q=O,O=void 0)}let ie=this.length-T;if((O===void 0||O>ie)&&(O=ie),w.length>0&&(O<0||T<0)||T>this.length)throw new RangeError("Attempt to write outside buffer bounds");q||(q="utf8");let S=!1;for(;;)switch(q){case"hex":return y(this,w,T,O);case"utf8":case"utf-8":return E(this,w,T,O);case"ascii":case"latin1":case"binary":return $(this,w,T,O);case"base64":return k(this,w,T,O);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,w,T,O);default:if(S)throw new TypeError("Unknown encoding: "+q);q=(""+q).toLowerCase(),S=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};let W=4096;function te(w,T,O){let q="";O=Math.min(w.length,O);for(let ie=T;ie<O;++ie)q+=String.fromCharCode(127&w[ie]);return q}function ce(w,T,O){let q="";O=Math.min(w.length,O);for(let ie=T;ie<O;++ie)q+=String.fromCharCode(w[ie]);return q}function pe(w,T,O){let q=w.length;(!T||T<0)&&(T=0),(!O||O<0||O>q)&&(O=q);let ie="";for(let S=T;S<O;++S)ie+=yr[w[S]];return ie}function ge(w,T,O){let q=w.slice(T,O),ie="";for(let S=0;S<q.length-1;S+=2)ie+=String.fromCharCode(q[S]+256*q[S+1]);return ie}function fe(w,T,O){if(w%1!=0||w<0)throw new RangeError("offset is not uint");if(w+T>O)throw new RangeError("Trying to access beyond buffer length")}function Me(w,T,O,q,ie,S){if(!o.isBuffer(w))throw new TypeError('"buffer" argument must be a Buffer instance');if(T>ie||T<S)throw new RangeError('"value" argument is out of bounds');if(O+q>w.length)throw new RangeError("Index out of range")}function Ge(w,T,O,q,ie){ne(T,q,ie,w,O,7);let S=Number(T&BigInt(4294967295));w[O++]=S,S>>=8,w[O++]=S,S>>=8,w[O++]=S,S>>=8,w[O++]=S;let ze=Number(T>>BigInt(32)&BigInt(4294967295));return w[O++]=ze,ze>>=8,w[O++]=ze,ze>>=8,w[O++]=ze,ze>>=8,w[O++]=ze,O}function He(w,T,O,q,ie){ne(T,q,ie,w,O,7);let S=Number(T&BigInt(4294967295));w[O+7]=S,S>>=8,w[O+6]=S,S>>=8,w[O+5]=S,S>>=8,w[O+4]=S;let ze=Number(T>>BigInt(32)&BigInt(4294967295));return w[O+3]=ze,ze>>=8,w[O+2]=ze,ze>>=8,w[O+1]=ze,ze>>=8,w[O]=ze,O+8}function dt(w,T,O,q,ie,S){if(O+q>w.length)throw new RangeError("Index out of range");if(O<0)throw new RangeError("Index out of range")}function he(w,T,O,q,ie){return T=+T,O>>>=0,ie||dt(w,0,O,4),r.write(w,T,O,q,23,4),O+4}function qe(w,T,O,q,ie){return T=+T,O>>>=0,ie||dt(w,0,O,8),r.write(w,T,O,q,52,8),O+8}o.prototype.slice=function(w,T){let O=this.length;(w=~~w)<0?(w+=O)<0&&(w=0):w>O&&(w=O),(T=T===void 0?O:~~T)<0?(T+=O)<0&&(T=0):T>O&&(T=O),T<w&&(T=w);let q=this.subarray(w,T);return Object.setPrototypeOf(q,o.prototype),q},o.prototype.readUintLE=o.prototype.readUIntLE=function(w,T,O){w>>>=0,T>>>=0,O||fe(w,T,this.length);let q=this[w],ie=1,S=0;for(;++S<T&&(ie*=256);)q+=this[w+S]*ie;return q},o.prototype.readUintBE=o.prototype.readUIntBE=function(w,T,O){w>>>=0,T>>>=0,O||fe(w,T,this.length);let q=this[w+--T],ie=1;for(;T>0&&(ie*=256);)q+=this[w+--T]*ie;return q},o.prototype.readUint8=o.prototype.readUInt8=function(w,T){return w>>>=0,T||fe(w,1,this.length),this[w]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(w,T){return w>>>=0,T||fe(w,2,this.length),this[w]|this[w+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(w,T){return w>>>=0,T||fe(w,2,this.length),this[w]<<8|this[w+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(w,T){return w>>>=0,T||fe(w,4,this.length),(this[w]|this[w+1]<<8|this[w+2]<<16)+16777216*this[w+3]},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(w,T){return w>>>=0,T||fe(w,4,this.length),16777216*this[w]+(this[w+1]<<16|this[w+2]<<8|this[w+3])},o.prototype.readBigUInt64LE=Kt(function(w){at(w>>>=0,"offset");let T=this[w],O=this[w+7];T!==void 0&&O!==void 0||kt(w,this.length-8);let q=T+256*this[++w]+65536*this[++w]+this[++w]*2**24,ie=this[++w]+256*this[++w]+65536*this[++w]+O*2**24;return BigInt(q)+(BigInt(ie)<<BigInt(32))}),o.prototype.readBigUInt64BE=Kt(function(w){at(w>>>=0,"offset");let T=this[w],O=this[w+7];T!==void 0&&O!==void 0||kt(w,this.length-8);let q=T*2**24+65536*this[++w]+256*this[++w]+this[++w],ie=this[++w]*2**24+65536*this[++w]+256*this[++w]+O;return(BigInt(q)<<BigInt(32))+BigInt(ie)}),o.prototype.readIntLE=function(w,T,O){w>>>=0,T>>>=0,O||fe(w,T,this.length);let q=this[w],ie=1,S=0;for(;++S<T&&(ie*=256);)q+=this[w+S]*ie;return ie*=128,q>=ie&&(q-=Math.pow(2,8*T)),q},o.prototype.readIntBE=function(w,T,O){w>>>=0,T>>>=0,O||fe(w,T,this.length);let q=T,ie=1,S=this[w+--q];for(;q>0&&(ie*=256);)S+=this[w+--q]*ie;return ie*=128,S>=ie&&(S-=Math.pow(2,8*T)),S},o.prototype.readInt8=function(w,T){return w>>>=0,T||fe(w,1,this.length),128&this[w]?-1*(255-this[w]+1):this[w]},o.prototype.readInt16LE=function(w,T){w>>>=0,T||fe(w,2,this.length);let O=this[w]|this[w+1]<<8;return 32768&O?4294901760|O:O},o.prototype.readInt16BE=function(w,T){w>>>=0,T||fe(w,2,this.length);let O=this[w+1]|this[w]<<8;return 32768&O?4294901760|O:O},o.prototype.readInt32LE=function(w,T){return w>>>=0,T||fe(w,4,this.length),this[w]|this[w+1]<<8|this[w+2]<<16|this[w+3]<<24},o.prototype.readInt32BE=function(w,T){return w>>>=0,T||fe(w,4,this.length),this[w]<<24|this[w+1]<<16|this[w+2]<<8|this[w+3]},o.prototype.readBigInt64LE=Kt(function(w){at(w>>>=0,"offset");let T=this[w],O=this[w+7];T!==void 0&&O!==void 0||kt(w,this.length-8);let q=this[w+4]+256*this[w+5]+65536*this[w+6]+(O<<24);return(BigInt(q)<<BigInt(32))+BigInt(T+256*this[++w]+65536*this[++w]+this[++w]*2**24)}),o.prototype.readBigInt64BE=Kt(function(w){at(w>>>=0,"offset");let T=this[w],O=this[w+7];T!==void 0&&O!==void 0||kt(w,this.length-8);let q=(T<<24)+65536*this[++w]+256*this[++w]+this[++w];return(BigInt(q)<<BigInt(32))+BigInt(this[++w]*2**24+65536*this[++w]+256*this[++w]+O)}),o.prototype.readFloatLE=function(w,T){return w>>>=0,T||fe(w,4,this.length),r.read(this,w,!0,23,4)},o.prototype.readFloatBE=function(w,T){return w>>>=0,T||fe(w,4,this.length),r.read(this,w,!1,23,4)},o.prototype.readDoubleLE=function(w,T){return w>>>=0,T||fe(w,8,this.length),r.read(this,w,!0,52,8)},o.prototype.readDoubleBE=function(w,T){return w>>>=0,T||fe(w,8,this.length),r.read(this,w,!1,52,8)},o.prototype.writeUintLE=o.prototype.writeUIntLE=function(w,T,O,q){w=+w,T>>>=0,O>>>=0,!q&&Me(this,w,T,O,Math.pow(2,8*O)-1,0);let ie=1,S=0;for(this[T]=255&w;++S<O&&(ie*=256);)this[T+S]=w/ie&255;return T+O},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(w,T,O,q){w=+w,T>>>=0,O>>>=0,!q&&Me(this,w,T,O,Math.pow(2,8*O)-1,0);let ie=O-1,S=1;for(this[T+ie]=255&w;--ie>=0&&(S*=256);)this[T+ie]=w/S&255;return T+O},o.prototype.writeUint8=o.prototype.writeUInt8=function(w,T,O){return w=+w,T>>>=0,O||Me(this,w,T,1,255,0),this[T]=255&w,T+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(w,T,O){return w=+w,T>>>=0,O||Me(this,w,T,2,65535,0),this[T]=255&w,this[T+1]=w>>>8,T+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(w,T,O){return w=+w,T>>>=0,O||Me(this,w,T,2,65535,0),this[T]=w>>>8,this[T+1]=255&w,T+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(w,T,O){return w=+w,T>>>=0,O||Me(this,w,T,4,4294967295,0),this[T+3]=w>>>24,this[T+2]=w>>>16,this[T+1]=w>>>8,this[T]=255&w,T+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(w,T,O){return w=+w,T>>>=0,O||Me(this,w,T,4,4294967295,0),this[T]=w>>>24,this[T+1]=w>>>16,this[T+2]=w>>>8,this[T+3]=255&w,T+4},o.prototype.writeBigUInt64LE=Kt(function(w,T=0){return Ge(this,w,T,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeBigUInt64BE=Kt(function(w,T=0){return He(this,w,T,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeIntLE=function(w,T,O,q){if(w=+w,T>>>=0,!q){let Mt=Math.pow(2,8*O-1);Me(this,w,T,O,Mt-1,-Mt)}let ie=0,S=1,ze=0;for(this[T]=255&w;++ie<O&&(S*=256);)w<0&&ze===0&&this[T+ie-1]!==0&&(ze=1),this[T+ie]=(w/S>>0)-ze&255;return T+O},o.prototype.writeIntBE=function(w,T,O,q){if(w=+w,T>>>=0,!q){let Mt=Math.pow(2,8*O-1);Me(this,w,T,O,Mt-1,-Mt)}let ie=O-1,S=1,ze=0;for(this[T+ie]=255&w;--ie>=0&&(S*=256);)w<0&&ze===0&&this[T+ie+1]!==0&&(ze=1),this[T+ie]=(w/S>>0)-ze&255;return T+O},o.prototype.writeInt8=function(w,T,O){return w=+w,T>>>=0,O||Me(this,w,T,1,127,-128),w<0&&(w=255+w+1),this[T]=255&w,T+1},o.prototype.writeInt16LE=function(w,T,O){return w=+w,T>>>=0,O||Me(this,w,T,2,32767,-32768),this[T]=255&w,this[T+1]=w>>>8,T+2},o.prototype.writeInt16BE=function(w,T,O){return w=+w,T>>>=0,O||Me(this,w,T,2,32767,-32768),this[T]=w>>>8,this[T+1]=255&w,T+2},o.prototype.writeInt32LE=function(w,T,O){return w=+w,T>>>=0,O||Me(this,w,T,4,2147483647,-2147483648),this[T]=255&w,this[T+1]=w>>>8,this[T+2]=w>>>16,this[T+3]=w>>>24,T+4},o.prototype.writeInt32BE=function(w,T,O){return w=+w,T>>>=0,O||Me(this,w,T,4,2147483647,-2147483648),w<0&&(w=4294967295+w+1),this[T]=w>>>24,this[T+1]=w>>>16,this[T+2]=w>>>8,this[T+3]=255&w,T+4},o.prototype.writeBigInt64LE=Kt(function(w,T=0){return Ge(this,w,T,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),o.prototype.writeBigInt64BE=Kt(function(w,T=0){return He(this,w,T,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),o.prototype.writeFloatLE=function(w,T,O){return he(this,w,T,!0,O)},o.prototype.writeFloatBE=function(w,T,O){return he(this,w,T,!1,O)},o.prototype.writeDoubleLE=function(w,T,O){return qe(this,w,T,!0,O)},o.prototype.writeDoubleBE=function(w,T,O){return qe(this,w,T,!1,O)},o.prototype.copy=function(w,T,O,q){if(!o.isBuffer(w))throw new TypeError("argument should be a Buffer");if(O||(O=0),q||q===0||(q=this.length),T>=w.length&&(T=w.length),T||(T=0),q>0&&q<O&&(q=O),q===O||w.length===0||this.length===0)return 0;if(T<0)throw new RangeError("targetStart out of bounds");if(O<0||O>=this.length)throw new RangeError("Index out of range");if(q<0)throw new RangeError("sourceEnd out of bounds");q>this.length&&(q=this.length),w.length-T<q-O&&(q=w.length-T+O);let ie=q-O;return this===w&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(T,O,q):Uint8Array.prototype.set.call(w,this.subarray(O,q),T),ie},o.prototype.fill=function(w,T,O,q){if(typeof w=="string"){if(typeof T=="string"?(q=T,T=0,O=this.length):typeof O=="string"&&(q=O,O=this.length),q!==void 0&&typeof q!="string")throw new TypeError("encoding must be a string");if(typeof q=="string"&&!o.isEncoding(q))throw new TypeError("Unknown encoding: "+q);if(w.length===1){let S=w.charCodeAt(0);(q==="utf8"&&S<128||q==="latin1")&&(w=S)}}else typeof w=="number"?w&=255:typeof w=="boolean"&&(w=Number(w));if(T<0||this.length<T||this.length<O)throw new RangeError("Out of range index");if(O<=T)return this;let ie;if(T>>>=0,O=O===void 0?this.length:O>>>0,w||(w=0),typeof w=="number")for(ie=T;ie<O;++ie)this[ie]=w;else{let S=o.isBuffer(w)?w:o.from(w,q),ze=S.length;if(ze===0)throw new TypeError('The value "'+w+'" is invalid for argument "value"');for(ie=0;ie<O-T;++ie)this[ie+T]=S[ie%ze]}return this};let ae={};function we(w,T,O){ae[w]=class extends O{constructor(){super(),Object.defineProperty(this,"message",{value:T.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${w}]`,this.stack,delete this.name}get code(){return w}set code(q){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:q,writable:!0})}toString(){return`${this.name} [${w}]: ${this.message}`}}}function Re(w){let T="",O=w.length,q=w[0]==="-"?1:0;for(;O>=q+4;O-=3)T=`_${w.slice(O-3,O)}${T}`;return`${w.slice(0,O)}${T}`}function ne(w,T,O,q,ie,S){if(w>O||w<T){let ze=typeof T=="bigint"?"n":"",Mt;throw Mt=S>3?T===0||T===BigInt(0)?`>= 0${ze} and < 2${ze} ** ${8*(S+1)}${ze}`:`>= -(2${ze} ** ${8*(S+1)-1}${ze}) and < 2 ** ${8*(S+1)-1}${ze}`:`>= ${T}${ze} and <= ${O}${ze}`,new ae.ERR_OUT_OF_RANGE("value",Mt,w)}(function(ze,Mt,qt){at(Mt,"offset"),ze[Mt]!==void 0&&ze[Mt+qt]!==void 0||kt(Mt,ze.length-(qt+1))})(q,ie,S)}function at(w,T){if(typeof w!="number")throw new ae.ERR_INVALID_ARG_TYPE(T,"number",w)}function kt(w,T,O){throw Math.floor(w)!==w?(at(w,O),new ae.ERR_OUT_OF_RANGE(O||"offset","an integer",w)):T<0?new ae.ERR_BUFFER_OUT_OF_BOUNDS:new ae.ERR_OUT_OF_RANGE(O||"offset",`>= ${O?1:0} and <= ${T}`,w)}we("ERR_BUFFER_OUT_OF_BOUNDS",function(w){return w?`${w} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),we("ERR_INVALID_ARG_TYPE",function(w,T){return`The "${w}" argument must be of type number. Received type ${typeof T}`},TypeError),we("ERR_OUT_OF_RANGE",function(w,T,O){let q=`The value of "${w}" is out of range.`,ie=O;return Number.isInteger(O)&&Math.abs(O)>2**32?ie=Re(String(O)):typeof O=="bigint"&&(ie=String(O),(O>BigInt(2)**BigInt(32)||O<-(BigInt(2)**BigInt(32)))&&(ie=Re(ie)),ie+="n"),q+=` It must be ${T}. Received ${ie}`,q},RangeError);let pt=/[^+/0-9A-Za-z-_]/g;function mt(w,T){let O;T=T||1/0;let q=w.length,ie=null,S=[];for(let ze=0;ze<q;++ze){if(O=w.charCodeAt(ze),O>55295&&O<57344){if(!ie){if(O>56319){(T-=3)>-1&&S.push(239,191,189);continue}if(ze+1===q){(T-=3)>-1&&S.push(239,191,189);continue}ie=O;continue}if(O<56320){(T-=3)>-1&&S.push(239,191,189),ie=O;continue}O=65536+(ie-55296<<10|O-56320)}else ie&&(T-=3)>-1&&S.push(239,191,189);if(ie=null,O<128){if((T-=1)<0)break;S.push(O)}else if(O<2048){if((T-=2)<0)break;S.push(O>>6|192,63&O|128)}else if(O<65536){if((T-=3)<0)break;S.push(O>>12|224,O>>6&63|128,63&O|128)}else{if(!(O<1114112))throw new Error("Invalid code point");if((T-=4)<0)break;S.push(O>>18|240,O>>12&63|128,O>>6&63|128,63&O|128)}}return S}function gt(w){return t.toByteArray(function(T){if((T=(T=T.split("=")[0]).trim().replace(pt,"")).length<2)return"";for(;T.length%4!=0;)T+="=";return T}(w))}function Dt(w,T,O,q){let ie;for(ie=0;ie<q&&!(ie+O>=T.length||ie>=w.length);++ie)T[ie+O]=w[ie];return ie}function Bt(w,T){return w instanceof T||w!=null&&w.constructor!=null&&w.constructor.name!=null&&w.constructor.name===T.name}function er(w){return w!=w}let yr=function(){let w="0123456789abcdef",T=new Array(256);for(let O=0;O<16;++O){let q=16*O;for(let ie=0;ie<16;++ie)T[q+ie]=w[O]+w[ie]}return T}();function Kt(w){return typeof BigInt>"u"?br:w}function br(){throw new Error("BigInt not supported")}})(FS);var{Buffer:mi}=FS,IE=Symbol.for("BufferList");function Sr(e){if(!(this instanceof Sr))return new Sr(e);Sr._init.call(this,e)}Sr._init=function(e){Object.defineProperty(this,IE,{value:!0}),this._bufs=[],this.length=0,e&&this.append(e)},Sr.prototype._new=function(e){return new Sr(e)},Sr.prototype._offset=function(e){if(e===0)return[0,0];let t=0;for(let r=0;r<this._bufs.length;r++){let n=t+this._bufs[r].length;if(e<n||r===this._bufs.length-1)return[r,e-t];t=n}},Sr.prototype._reverseOffset=function(e){let t=e[0],r=e[1];for(let n=0;n<t;n++)r+=this._bufs[n].length;return r},Sr.prototype.get=function(e){if(e>this.length||e<0)return;let t=this._offset(e);return this._bufs[t[0]][t[1]]},Sr.prototype.slice=function(e,t){return typeof e=="number"&&e<0&&(e+=this.length),typeof t=="number"&&t<0&&(t+=this.length),this.copy(null,0,e,t)},Sr.prototype.copy=function(e,t,r,n){if((typeof r!="number"||r<0)&&(r=0),(typeof n!="number"||n>this.length)&&(n=this.length),r>=this.length||n<=0)return e||mi.alloc(0);let i=!!e,a=this._offset(r),o=n-r,s=o,u=i&&t||0,l=a[1];if(r===0&&n===this.length){if(!i)return this._bufs.length===1?this._bufs[0]:mi.concat(this._bufs,this.length);for(let c=0;c<this._bufs.length;c++)this._bufs[c].copy(e,u),u+=this._bufs[c].length;return e}if(s<=this._bufs[a[0]].length-l)return i?this._bufs[a[0]].copy(e,t,l,l+s):this._bufs[a[0]].slice(l,l+s);i||(e=mi.allocUnsafe(o));for(let c=a[0];c<this._bufs.length;c++){let f=this._bufs[c].length-l;if(!(s>f)){this._bufs[c].copy(e,u,l,l+s),u+=f;break}this._bufs[c].copy(e,u,l),u+=f,s-=f,l&&(l=0)}return e.length>u?e.slice(0,u):e},Sr.prototype.shallowSlice=function(e,t){if(e=e||0,t=typeof t!="number"?this.length:t,e<0&&(e+=this.length),t<0&&(t+=this.length),e===t)return this._new();let r=this._offset(e),n=this._offset(t),i=this._bufs.slice(r[0],n[0]+1);return n[1]===0?i.pop():i[i.length-1]=i[i.length-1].slice(0,n[1]),r[1]!==0&&(i[0]=i[0].slice(r[1])),this._new(i)},Sr.prototype.toString=function(e,t,r){return this.slice(t,r).toString(e)},Sr.prototype.consume=function(e){if(e=Math.trunc(e),Number.isNaN(e)||e<=0)return this;for(;this._bufs.length;){if(!(e>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},Sr.prototype.duplicate=function(){let e=this._new();for(let t=0;t<this._bufs.length;t++)e.append(this._bufs[t]);return e},Sr.prototype.append=function(e){if(e==null)return this;if(e.buffer)this._appendBuffer(mi.from(e.buffer,e.byteOffset,e.byteLength));else if(Array.isArray(e))for(let t=0;t<e.length;t++)this.append(e[t]);else if(this._isBufferList(e))for(let t=0;t<e._bufs.length;t++)this.append(e._bufs[t]);else typeof e=="number"&&(e=e.toString()),this._appendBuffer(mi.from(e));return this},Sr.prototype._appendBuffer=function(e){this._bufs.push(e),this.length+=e.length},Sr.prototype.indexOf=function(e,t,r){if(r===void 0&&typeof t=="string"&&(r=t,t=void 0),typeof e=="function"||Array.isArray(e))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof e=="number"?e=mi.from([e]):typeof e=="string"?e=mi.from(e,r):this._isBufferList(e)?e=e.slice():Array.isArray(e.buffer)?e=mi.from(e.buffer,e.byteOffset,e.byteLength):mi.isBuffer(e)||(e=mi.from(e)),t=Number(t||0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;let n=this._offset(t),i=n[0],a=n[1];for(;i<this._bufs.length;i++){let o=this._bufs[i];for(;a<o.length;)if(o.length-a>=e.length){let s=o.indexOf(e,a);if(s!==-1)return this._reverseOffset([i,s]);a=o.length-e.length+1}else{let s=this._reverseOffset([i,a]);if(this._match(s,e))return s;a++}a=0}return-1},Sr.prototype._match=function(e,t){if(this.length-e<t.length)return!1;for(let r=0;r<t.length;r++)if(this.get(e+r)!==t[r])return!1;return!0},function(){let e={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(let t in e)(function(r){Sr.prototype[r]=e[r]===null?function(n,i){return this.slice(n,n+i)[r](0,i)}:function(n=0){return this.slice(n,n+e[r])[r](0)}})(t)}(),Sr.prototype._isBufferList=function(e){return e instanceof Sr||Sr.isBufferList(e)},Sr.isBufferList=function(e){return e!=null&&e[IE]};var zp=Sr,Oy=class{constructor(t,r=12,n=8192,i=32768,a=64,o){this.bits=r,this.min=n,this.max=i,this.asModule=t,this.rabin=new t.Rabin(r,n,i,a,o),this.polynomial=o}fingerprint(t){let{__retain:r,__release:n,__allocArray:i,__getInt32Array:a,Int32Array_ID:o,Uint8Array_ID:s}=this.asModule,u=r(i(o,new Int32Array(Math.ceil(t.length/this.min)))),l=r(i(s,t)),c=a(this.rabin.fingerprint(l,u));n(l),n(u);let f=c.indexOf(0);return f>=0?c.subarray(0,f):c}},s7=Oy,cc={},J0=-8,Np=-4,u7=0,CE=1,OE=1,$p=2,l7=5,BE=1024,RE=2048,c7=8192,f7=0,ey=4,d7=8,p7=12,zE=12,h7=16,m7=typeof BigUint64Array<"u",sc=Symbol(),uc=1024;function VS(e,t){let r=new Uint32Array(e),n=new Uint16Array(e);var i=r[t+Np>>>2]>>>1,a=t>>>1;if(i<=uc)return String.fromCharCode.apply(String,n.subarray(a,a+i));let o=[];do{let s=n[a+uc-1],u=s>=55296&&s<56320?uc-1:uc;o.push(String.fromCharCode.apply(String,n.subarray(a,a+=u))),i-=u}while(i>uc);return o.join("")+String.fromCharCode.apply(String,n.subarray(a,a+i))}function t1(e){let t={};function r(i,a){return i?VS(i.buffer,a):"<yet unknown>"}let n=e.env=e.env||{};return n.abort=n.abort||function(i,a,o,s){let u=t.memory||n.memory;throw Error("abort: "+r(u,i)+" at "+r(u,a)+":"+o+":"+s)},n.trace=n.trace||function(i,a){let o=t.memory||n.memory;console.log("trace: "+r(o,i)+(a?" ":"")+Array.prototype.slice.call(arguments,2,2+a).join(", "))},e.Math=e.Math||Math,e.Date=e.Date||Date,t}function r1(e,t){let r=t.exports,n=r.memory,i=r.table,a=r.__alloc,o=r.__retain,s=r.__rtti_base||-1;function u(g){let x=new Uint32Array(n.buffer);if((g>>>=0)>=x[s>>>2])throw Error("invalid id: "+g);return x[(s+4>>>2)+2*g]}function l(g){let x=new Uint32Array(n.buffer);if((g>>>=0)>=x[s>>>2])throw Error("invalid id: "+g);return x[(s+4>>>2)+2*g+1]}function c(g){return 31-Math.clz32(g>>>l7&31)}function f(g,x,b){let y=n.buffer;if(b)switch(g){case 2:return new Float32Array(y);case 3:return new Float64Array(y)}else switch(g){case 0:return new(x?Int8Array:Uint8Array)(y);case 1:return new(x?Int16Array:Uint16Array)(y);case 2:return new(x?Int32Array:Uint32Array)(y);case 3:return new(x?BigInt64Array:BigUint64Array)(y)}throw Error("unsupported align: "+g)}function p(g){let x=new Uint32Array(n.buffer),b=x[g+J0>>>2],y=u(b);if(!(y&OE))throw Error("not an array: "+b);let E=c(y);var $=x[g+ey>>>2];let k=y&$p?x[g+zE>>>2]:x[$+Np>>>2]>>>E;return f(E,y&BE,y&RE).subarray($>>>=E,$+k)}function d(g,x,b){return new g(m(g,x,b))}function m(g,x,b){let y=n.buffer,E=new Uint32Array(y),$=E[b+ey>>>2];return new g(y,$,E[$+Np>>>2]>>>x)}return e.__allocString=function(g){let x=g.length,b=a(x<<1,CE),y=new Uint16Array(n.buffer);for(var E=0,$=b>>>1;E<x;++E)y[$+E]=g.charCodeAt(E);return b},e.__getString=function(g){let x=n.buffer;if(new Uint32Array(x)[g+J0>>>2]!==CE)throw Error("not a string: "+g);return VS(x,g)},e.__allocArray=function(g,x){let b=u(g);if(!(b&(OE|$p)))throw Error("not an array: "+g+" @ "+b);let y=c(b),E=x.length,$=a(E<<y,u7),k=a(b&$p?h7:p7,g),R=new Uint32Array(n.buffer);R[k+f7>>>2]=o($),R[k+ey>>>2]=$,R[k+d7>>>2]=E<<y,b&$p&&(R[k+zE>>>2]=E);let C=f(y,b&BE,b&RE);if(b&c7)for(let P=0;P<E;++P)C[($>>>y)+P]=o(x[P]);else C.set(x,$>>>y);return k},e.__getArrayView=p,e.__getArray=function(g){let x=p(g),b=x.length,y=new Array(b);for(let E=0;E<b;E++)y[E]=x[E];return y},e.__getArrayBuffer=function(g){let x=n.buffer,b=new Uint32Array(x)[g+Np>>>2];return x.slice(g,g+b)},e.__getInt8Array=d.bind(null,Int8Array,0),e.__getInt8ArrayView=m.bind(null,Int8Array,0),e.__getUint8Array=d.bind(null,Uint8Array,0),e.__getUint8ArrayView=m.bind(null,Uint8Array,0),e.__getUint8ClampedArray=d.bind(null,Uint8ClampedArray,0),e.__getUint8ClampedArrayView=m.bind(null,Uint8ClampedArray,0),e.__getInt16Array=d.bind(null,Int16Array,1),e.__getInt16ArrayView=m.bind(null,Int16Array,1),e.__getUint16Array=d.bind(null,Uint16Array,1),e.__getUint16ArrayView=m.bind(null,Uint16Array,1),e.__getInt32Array=d.bind(null,Int32Array,2),e.__getInt32ArrayView=m.bind(null,Int32Array,2),e.__getUint32Array=d.bind(null,Uint32Array,2),e.__getUint32ArrayView=m.bind(null,Uint32Array,2),m7&&(e.__getInt64Array=d.bind(null,BigInt64Array,3),e.__getInt64ArrayView=m.bind(null,BigInt64Array,3),e.__getUint64Array=d.bind(null,BigUint64Array,3),e.__getUint64ArrayView=m.bind(null,BigUint64Array,3)),e.__getFloat32Array=d.bind(null,Float32Array,2),e.__getFloat32ArrayView=m.bind(null,Float32Array,2),e.__getFloat64Array=d.bind(null,Float64Array,3),e.__getFloat64ArrayView=m.bind(null,Float64Array,3),e.__instanceof=function(g,x){let b=new Uint32Array(n.buffer);var y=b[g+J0>>>2];if(y<=b[s>>>2])do if(y==x)return!0;while(y=l(y));return!1},e.memory=e.memory||n,e.table=e.table||i,XS(r,e)}function WS(e){return typeof Response<"u"&&e instanceof Response}async function HS(e,t){return WS(e=await e)?qS(e,t):r1(t1(t||(t={})),await WebAssembly.instantiate(e instanceof WebAssembly.Module?e:await WebAssembly.compile(e),t))}function g7(e,t){return r1(t1(t||(t={})),new WebAssembly.Instance(e instanceof WebAssembly.Module?e:new WebAssembly.Module(e),t))}async function qS(e,t){return WebAssembly.instantiateStreaming?r1(t1(t||(t={})),(await WebAssembly.instantiateStreaming(e,t)).instance):HS(WS(e=await e)?e.arrayBuffer():e,t)}function XS(e,t){var r=t?Object.create(t):{},n=e.__argumentsLength?function(i){e.__argumentsLength.value=i}:e.__setArgumentsLength||e.__setargc||function(){};for(let i in e){if(!Object.prototype.hasOwnProperty.call(e,i))continue;let a=e[i],o=i.split("."),s=r;for(;o.length>1;){let c=o.shift();Object.prototype.hasOwnProperty.call(s,c)||(s[c]={}),s=s[c]}let u=o[0],l=u.indexOf("#");if(l>=0){let c=u.substring(0,l),f=s[c];if(f===void 0||!f.prototype){let p=function(...d){return p.wrap(p.prototype.constructor(0,...d))};p.prototype={valueOf:function(){return this[sc]}},p.wrap=function(d){return Object.create(p.prototype,{[sc]:{value:d,writable:!1}})},f&&Object.getOwnPropertyNames(f).forEach(d=>Object.defineProperty(p,d,Object.getOwnPropertyDescriptor(f,d))),s[c]=p}if(u=u.substring(l+1),s=s[c].prototype,/^(get|set):/.test(u)){if(!Object.prototype.hasOwnProperty.call(s,u=u.substring(4))){let p=e[i.replace("set:","get:")],d=e[i.replace("get:","set:")];Object.defineProperty(s,u,{get:function(){return p(this[sc])},set:function(m){d(this[sc],m)},enumerable:!0})}}else u==="constructor"?(s[u]=(...p)=>(n(p.length),a(...p))).original=a:(s[u]=function(...p){return n(p.length),a(this[sc],...p)}).original=a}else/^(get|set):/.test(u)?Object.prototype.hasOwnProperty.call(s,u=u.substring(4))||Object.defineProperty(s,u,{get:e[i.replace("set:","get:")],set:e[i.replace("get:","set:")],enumerable:!0}):typeof a=="function"&&a!==n?(s[u]=(...c)=>(n(c.length),a(...c))).original=a:s[u]=a}return r}cc.instantiate=HS,cc.instantiateSync=g7,cc.instantiateStreaming=qS,cc.demangle=XS;var{instantiate:y7}=cc;function n1(e={}){if(!n1.supported)return null;var t=new Uint8Array([0,97,115,109,1,0,0,0,1,78,14,96,2,127,126,0,96,1,127,1,126,96,2,127,127,0,96,1,127,1,127,96,1,127,0,96,2,127,127,1,127,96,3,127,127,127,1,127,96,0,0,96,3,127,127,127,0,96,0,1,127,96,4,127,127,127,127,0,96,5,127,127,127,127,127,1,127,96,1,126,1,127,96,2,126,126,1,126,2,13,1,3,101,110,118,5,97,98,111,114,116,0,10,3,54,53,2,2,8,9,3,5,2,8,6,5,3,4,2,6,9,12,13,2,5,11,3,2,3,2,3,2,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,6,7,7,4,4,5,3,1,0,1,6,47,9,127,1,65,0,11,127,1,65,0,11,127,0,65,3,11,127,0,65,4,11,127,1,65,0,11,127,1,65,0,11,127,1,65,0,11,127,0,65,240,2,11,127,0,65,6,11,7,240,5,41,6,109,101,109,111,114,121,2,0,7,95,95,97,108,108,111,99,0,10,8,95,95,114,101,116,97,105,110,0,11,9,95,95,114,101,108,101,97,115,101,0,12,9,95,95,99,111,108,108,101,99,116,0,51,11,95,95,114,116,116,105,95,98,97,115,101,3,7,13,73,110,116,51,50,65,114,114,97,121,95,73,68,3,2,13,85,105,110,116,56,65,114,114,97,121,95,73,68,3,3,6,100,101,103,114,101,101,0,16,3,109,111,100,0,17,5,82,97,98,105,110,3,8,16,82,97,98,105,110,35,103,101,116,58,119,105,110,100,111,119,0,21,16,82,97,98,105,110,35,115,101,116,58,119,105,110,100,111,119,0,22,21,82,97,98,105,110,35,103,101,116,58,119,105,110,100,111,119,95,115,105,122,101,0,23,21,82,97,98,105,110,35,115,101,116,58,119,105,110,100,111,119,95,115,105,122,101,0,24,14,82,97,98,105,110,35,103,101,116,58,119,112,111,115,0,25,14,82,97,98,105,110,35,115,101,116,58,119,112,111,115,0,26,15,82,97,98,105,110,35,103,101,116,58,99,111,117,110,116,0,27,15,82,97,98,105,110,35,115,101,116,58,99,111,117,110,116,0,28,13,82,97,98,105,110,35,103,101,116,58,112,111,115,0,29,13,82,97,98,105,110,35,115,101,116,58,112,111,115,0,30,15,82,97,98,105,110,35,103,101,116,58,115,116,97,114,116,0,31,15,82,97,98,105,110,35,115,101,116,58,115,116,97,114,116,0,32,16,82,97,98,105,110,35,103,101,116,58,100,105,103,101,115,116,0,33,16,82,97,98,105,110,35,115,101,116,58,100,105,103,101,115,116,0,34,21,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,115,116,97,114,116,0,35,21,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,115,116,97,114,116,0,36,22,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,108,101,110,103,116,104,0,37,22,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,108,101,110,103,116,104,0,38,31,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,99,117,116,95,102,105,110,103,101,114,112,114,105,110,116,0,39,31,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,99,117,116,95,102,105,110,103,101,114,112,114,105,110,116,0,40,20,82,97,98,105,110,35,103,101,116,58,112,111,108,121,110,111,109,105,97,108,0,41,20,82,97,98,105,110,35,115,101,116,58,112,111,108,121,110,111,109,105,97,108,0,42,17,82,97,98,105,110,35,103,101,116,58,109,105,110,115,105,122,101,0,43,17,82,97,98,105,110,35,115,101,116,58,109,105,110,115,105,122,101,0,44,17,82,97,98,105,110,35,103,101,116,58,109,97,120,115,105,122,101,0,45,17,82,97,98,105,110,35,115,101,116,58,109,97,120,115,105,122,101,0,46,14,82,97,98,105,110,35,103,101,116,58,109,97,115,107,0,47,14,82,97,98,105,110,35,115,101,116,58,109,97,115,107,0,48,17,82,97,98,105,110,35,99,111,110,115,116,114,117,99,116,111,114,0,20,17,82,97,98,105,110,35,102,105,110,103,101,114,112,114,105,110,116,0,49,8,1,50,10,165,31,53,199,1,1,4,127,32,1,40,2,0,65,124,113,34,2,65,128,2,73,4,127,32,2,65,4,118,33,4,65,0,5,32,2,65,31,32,2,103,107,34,3,65,4,107,118,65,16,115,33,4,32,3,65,7,107,11,33,3,32,1,40,2,20,33,2,32,1,40,2,16,34,5,4,64,32,5,32,2,54,2,20,11,32,2,4,64,32,2,32,5,54,2,16,11,32,1,32,0,32,4,32,3,65,4,116,106,65,2,116,106,40,2,96,70,4,64,32,0,32,4,32,3,65,4,116,106,65,2,116,106,32,2,54,2,96,32,2,69,4,64,32,0,32,3,65,2,116,106,32,0,32,3,65,2,116,106,40,2,4,65,1,32,4,116,65,127,115,113,34,1,54,2,4,32,1,69,4,64,32,0,32,0,40,2,0,65,1,32,3,116,65,127,115,113,54,2,0,11,11,11,11,226,2,1,6,127,32,1,40,2,0,33,3,32,1,65,16,106,32,1,40,2,0,65,124,113,106,34,4,40,2,0,34,5,65,1,113,4,64,32,3,65,124,113,65,16,106,32,5,65,124,113,106,34,2,65,240,255,255,255,3,73,4,64,32,0,32,4,16,1,32,1,32,2,32,3,65,3,113,114,34,3,54,2,0,32,1,65,16,106,32,1,40,2,0,65,124,113,106,34,4,40,2,0,33,5,11,11,32,3,65,2,113,4,64,32,1,65,4,107,40,2,0,34,2,40,2,0,34,6,65,124,113,65,16,106,32,3,65,124,113,106,34,7,65,240,255,255,255,3,73,4,64,32,0,32,2,16,1,32,2,32,7,32,6,65,3,113,114,34,3,54,2,0,32,2,33,1,11,11,32,4,32,5,65,2,114,54,2,0,32,4,65,4,107,32,1,54,2,0,32,0,32,3,65,124,113,34,2,65,128,2,73,4,127,32,2,65,4,118,33,4,65,0,5,32,2,65,31,32,2,103,107,34,2,65,4,107,118,65,16,115,33,4,32,2,65,7,107,11,34,3,65,4,116,32,4,106,65,2,116,106,40,2,96,33,2,32,1,65,0,54,2,16,32,1,32,2,54,2,20,32,2,4,64,32,2,32,1,54,2,16,11,32,0,32,4,32,3,65,4,116,106,65,2,116,106,32,1,54,2,96,32,0,32,0,40,2,0,65,1,32,3,116,114,54,2,0,32,0,32,3,65,2,116,106,32,0,32,3,65,2,116,106,40,2,4,65,1,32,4,116,114,54,2,4,11,119,1,1,127,32,2,2,127,32,0,40,2,160,12,34,2,4,64,32,2,32,1,65,16,107,70,4,64,32,2,40,2,0,33,3,32,1,65,16,107,33,1,11,11,32,1,11,107,34,2,65,48,73,4,64,15,11,32,1,32,3,65,2,113,32,2,65,32,107,65,1,114,114,54,2,0,32,1,65,0,54,2,16,32,1,65,0,54,2,20,32,1,32,2,106,65,16,107,34,2,65,2,54,2,0,32,0,32,2,54,2,160,12,32,0,32,1,16,2,11,155,1,1,3,127,35,0,34,0,69,4,64,65,1,63,0,34,0,74,4,127,65,1,32,0,107,64,0,65,0,72,5,65,0,11,4,64,0,11,65,176,3,34,0,65,0,54,2,0,65,208,15,65,0,54,2,0,3,64,32,1,65,23,73,4,64,32,1,65,2,116,65,176,3,106,65,0,54,2,4,65,0,33,2,3,64,32,2,65,16,73,4,64,32,1,65,4,116,32,2,106,65,2,116,65,176,3,106,65,0,54,2,96,32,2,65,1,106,33,2,12,1,11,11,32,1,65,1,106,33,1,12,1,11,11,65,176,3,65,224,15,63,0,65,16,116,16,3,65,176,3,36,0,11,32,0,11,45,0,32,0,65,240,255,255,255,3,79,4,64,65,32,65,224,0,65,201,3,65,29,16,0,0,11,32,0,65,15,106,65,112,113,34,0,65,16,32,0,65,16,75,27,11,169,1,1,1,127,32,0,32,1,65,128,2,73,4,127,32,1,65,4,118,33,1,65,0,5,32,1,65,248,255,255,255,1,73,4,64,32,1,65,1,65,27,32,1,103,107,116,106,65,1,107,33,1,11,32,1,65,31,32,1,103,107,34,2,65,4,107,118,65,16,115,33,1,32,2,65,7,107,11,34,2,65,2,116,106,40,2,4,65,127,32,1,116,113,34,1,4,127,32,0,32,1,104,32,2,65,4,116,106,65,2,116,106,40,2,96,5,32,0,40,2,0,65,127,32,2,65,1,106,116,113,34,1,4,127,32,0,32,0,32,1,104,34,0,65,2,116,106,40,2,4,104,32,0,65,4,116,106,65,2,116,106,40,2,96,5,65,0,11,11,11,111,1,1,127,63,0,34,2,32,1,65,248,255,255,255,1,73,4,127,32,1,65,1,65,27,32,1,103,107,116,65,1,107,106,5,32,1,11,65,16,32,0,40,2,160,12,32,2,65,16,116,65,16,107,71,116,106,65,255,255,3,106,65,128,128,124,113,65,16,118,34,1,32,2,32,1,74,27,64,0,65,0,72,4,64,32,1,64,0,65,0,72,4,64,0,11,11,32,0,32,2,65,16,116,63,0,65,16,116,16,3,11,113,1,2,127,32,1,40,2,0,34,3,65,124,113,32,2,107,34,4,65,32,79,4,64,32,1,32,2,32,3,65,2,113,114,54,2,0,32,2,32,1,65,16,106,106,34,1,32,4,65,16,107,65,1,114,54,2,0,32,0,32,1,16,2,5,32,1,32,3,65,126,113,54,2,0,32,1,65,16,106,32,1,40,2,0,65,124,113,106,32,1,65,16,106,32,1,40,2,0,65,124,113,106,40,2,0,65,125,113,54,2,0,11,11,91,1,2,127,32,0,32,1,16,5,34,4,16,6,34,3,69,4,64,65,1,36,1,65,0,36,1,32,0,32,4,16,6,34,3,69,4,64,32,0,32,4,16,7,32,0,32,4,16,6,33,3,11,11,32,3,65,0,54,2,4,32,3,32,2,54,2,8,32,3,32,1,54,2,12,32,0,32,3,16,1,32,0,32,3,32,4,16,8,32,3,11,13,0,16,4,32,0,32,1,16,9,65,16,106,11,33,1,1,127,32,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,11,18,0,32,0,65,172,3,75,4,64,32,0,65,16,107,16,52,11,11,140,3,1,1,127,2,64,32,1,69,13,0,32,0,65,0,58,0,0,32,0,32,1,106,65,1,107,65,0,58,0,0,32,1,65,2,77,13,0,32,0,65,1,106,65,0,58,0,0,32,0,65,2,106,65,0,58,0,0,32,0,32,1,106,34,2,65,2,107,65,0,58,0,0,32,2,65,3,107,65,0,58,0,0,32,1,65,6,77,13,0,32,0,65,3,106,65,0,58,0,0,32,0,32,1,106,65,4,107,65,0,58,0,0,32,1,65,8,77,13,0,32,1,65,0,32,0,107,65,3,113,34,1,107,33,2,32,0,32,1,106,34,0,65,0,54,2,0,32,0,32,2,65,124,113,34,1,106,65,4,107,65,0,54,2,0,32,1,65,8,77,13,0,32,0,65,4,106,65,0,54,2,0,32,0,65,8,106,65,0,54,2,0,32,0,32,1,106,34,2,65,12,107,65,0,54,2,0,32,2,65,8,107,65,0,54,2,0,32,1,65,24,77,13,0,32,0,65,12,106,65,0,54,2,0,32,0,65,16,106,65,0,54,2,0,32,0,65,20,106,65,0,54,2,0,32,0,65,24,106,65,0,54,2,0,32,0,32,1,106,34,2,65,28,107,65,0,54,2,0,32,2,65,24,107,65,0,54,2,0,32,2,65,20,107,65,0,54,2,0,32,2,65,16,107,65,0,54,2,0,32,0,32,0,65,4,113,65,24,106,34,2,106,33,0,32,1,32,2,107,33,1,3,64,32,1,65,32,79,4,64,32,0,66,0,55,3,0,32,0,65,8,106,66,0,55,3,0,32,0,65,16,106,66,0,55,3,0,32,0,65,24,106,66,0,55,3,0,32,1,65,32,107,33,1,32,0,65,32,106,33,0,12,1,11,11,11,11,178,1,1,3,127,32,1,65,240,255,255,255,3,32,2,118,75,4,64,65,144,1,65,192,1,65,23,65,56,16,0,0,11,32,1,32,2,116,34,3,65,0,16,10,34,2,32,3,16,13,32,0,69,4,64,65,12,65,2,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,11,32,0,65,0,54,2,0,32,0,65,0,54,2,4,32,0,65,0,54,2,8,32,2,34,1,32,0,40,2,0,34,4,71,4,64,32,1,65,172,3,75,4,64,32,1,65,16,107,34,5,32,5,40,2,4,65,1,106,54,2,4,11,32,4,16,12,11,32,0,32,1,54,2,0,32,0,32,2,54,2,4,32,0,32,3,54,2,8,32,0,11,46,1,2,127,65,12,65,5,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,65,128,2,65,3,16,14,11,9,0,65,63,32,0,121,167,107,11,49,1,2,127,65,63,32,1,121,167,107,33,2,3,64,65,63,32,0,121,167,107,32,2,107,34,3,65,0,78,4,64,32,0,32,1,32,3,172,134,133,33,0,12,1,11,11,32,0,11,40,0,32,1,32,0,40,2,8,79,4,64,65,128,2,65,192,2,65,163,1,65,44,16,0,0,11,32,1,32,0,40,2,4,106,65,0,58,0,0,11,38,0,32,1,32,0,40,2,8,79,4,64,65,128,2,65,192,2,65,152,1,65,44,16,0,0,11,32,1,32,0,40,2,4,106,45,0,0,11,254,5,2,1,127,4,126,32,0,69,4,64,65,232,0,65,6,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,5,32,5,40,2,4,65,1,106,54,2,4,11,11,32,0,65,0,54,2,0,32,0,65,0,54,2,4,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,24,32,0,66,0,55,3,32,32,0,66,0,55,3,40,32,0,66,0,55,3,48,32,0,66,0,55,3,56,32,0,66,0,55,3,64,32,0,66,0,55,3,72,32,0,66,0,55,3,80,32,0,66,0,55,3,88,32,0,66,0,55,3,96,32,0,32,2,173,55,3,80,32,0,32,3,173,55,3,88,65,12,65,4,16,10,34,2,65,172,3,75,4,64,32,2,65,16,107,34,3,32,3,40,2,4,65,1,106,54,2,4,11,32,2,32,4,65,0,16,14,33,2,32,0,40,2,0,16,12,32,0,32,2,54,2,0,32,0,32,4,54,2,4,32,0,66,1,32,1,173,134,66,1,125,55,3,96,32,0,66,243,130,183,218,216,230,232,30,55,3,72,35,4,69,4,64,65,0,33,2,3,64,32,2,65,128,2,72,4,64,32,2,65,255,1,113,173,33,6,32,0,41,3,72,34,7,33,8,65,63,32,7,121,167,107,33,1,3,64,65,63,32,6,121,167,107,32,1,107,34,3,65,0,78,4,64,32,6,32,8,32,3,172,134,133,33,6,12,1,11,11,65,0,33,4,3,64,32,4,32,0,40,2,4,65,1,107,72,4,64,32,6,66,8,134,33,6,32,0,41,3,72,34,7,33,8,65,63,32,7,121,167,107,33,1,3,64,65,63,32,6,121,167,107,32,1,107,34,3,65,0,78,4,64,32,6,32,8,32,3,172,134,133,33,6,12,1,11,11,32,4,65,1,106,33,4,12,1,11,11,35,6,40,2,4,32,2,65,3,116,106,32,6,55,3,0,32,2,65,1,106,33,2,12,1,11,11,65,63,32,0,41,3,72,121,167,107,172,33,7,65,0,33,2,3,64,32,2,65,128,2,72,4,64,35,5,33,1,32,2,172,32,7,134,34,8,33,6,65,63,32,0,41,3,72,34,9,121,167,107,33,3,3,64,65,63,32,6,121,167,107,32,3,107,34,4,65,0,78,4,64,32,6,32,9,32,4,172,134,133,33,6,12,1,11,11,32,1,40,2,4,32,2,65,3,116,106,32,6,32,8,132,55,3,0,32,2,65,1,106,33,2,12,1,11,11,65,1,36,4,11,32,0,66,0,55,3,24,32,0,66,0,55,3,32,65,0,33,2,3,64,32,2,32,0,40,2,4,72,4,64,32,0,40,2,0,32,2,16,18,32,2,65,1,106,33,2,12,1,11,11,32,0,66,0,55,3,40,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,40,32,0,40,2,0,32,0,40,2,8,16,19,33,1,32,0,40,2,8,32,0,40,2,0,40,2,4,106,65,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,1,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,6,66,45,136,167,65,3,116,106,41,3,0,32,6,66,8,134,66,1,132,133,55,3,40,32,0,11,38,1,1,127,32,0,40,2,0,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,11,55,1,2,127,32,1,32,0,40,2,0,34,2,71,4,64,32,1,65,172,3,75,4,64,32,1,65,16,107,34,3,32,3,40,2,4,65,1,106,54,2,4,11,32,2,16,12,11,32,0,32,1,54,2,0,11,7,0,32,0,40,2,4,11,9,0,32,0,32,1,54,2,4,11,7,0,32,0,40,2,8,11,9,0,32,0,32,1,54,2,8,11,7,0,32,0,41,3,16,11,9,0,32,0,32,1,55,3,16,11,7,0,32,0,41,3,24,11,9,0,32,0,32,1,55,3,24,11,7,0,32,0,41,3,32,11,9,0,32,0,32,1,55,3,32,11,7,0,32,0,41,3,40,11,9,0,32,0,32,1,55,3,40,11,7,0,32,0,41,3,48,11,9,0,32,0,32,1,55,3,48,11,7,0,32,0,41,3,56,11,9,0,32,0,32,1,55,3,56,11,7,0,32,0,41,3,64,11,9,0,32,0,32,1,55,3,64,11,7,0,32,0,41,3,72,11,9,0,32,0,32,1,55,3,72,11,7,0,32,0,41,3,80,11,9,0,32,0,32,1,55,3,80,11,7,0,32,0,41,3,88,11,9,0,32,0,32,1,55,3,88,11,7,0,32,0,41,3,96,11,9,0,32,0,32,1,55,3,96,11,172,4,2,5,127,1,126,32,2,65,172,3,75,4,64,32,2,65,16,107,34,4,32,4,40,2,4,65,1,106,54,2,4,11,32,2,33,4,65,0,33,2,32,1,40,2,8,33,5,32,1,40,2,4,33,6,3,64,2,127,65,0,33,3,3,64,32,3,32,5,72,4,64,32,3,32,6,106,45,0,0,33,1,32,0,40,2,0,32,0,40,2,8,16,19,33,7,32,0,40,2,8,32,0,40,2,0,40,2,4,106,32,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,7,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,8,66,45,136,167,65,3,116,106,41,3,0,32,1,173,32,8,66,8,134,132,133,55,3,40,32,0,32,0,41,3,16,66,1,124,55,3,16,32,0,32,0,41,3,24,66,1,124,55,3,24,32,0,41,3,16,32,0,41,3,80,90,4,127,32,0,41,3,40,32,0,41,3,96,131,80,5,65,0,11,4,127,65,1,5,32,0,41,3,16,32,0,41,3,88,90,11,4,64,32,0,32,0,41,3,32,55,3,48,32,0,32,0,41,3,16,55,3,56,32,0,32,0,41,3,40,55,3,64,65,0,33,1,3,64,32,1,32,0,40,2,4,72,4,64,32,0,40,2,0,32,1,16,18,32,1,65,1,106,33,1,12,1,11,11,32,0,66,0,55,3,40,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,40,32,0,40,2,0,32,0,40,2,8,16,19,33,1,32,0,40,2,8,32,0,40,2,0,40,2,4,106,65,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,1,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,8,66,45,136,167,65,3,116,106,41,3,0,32,8,66,8,134,66,1,132,133,55,3,40,32,3,65,1,106,12,3,11,32,3,65,1,106,33,3,12,1,11,11,65,127,11,34,1,65,0,78,4,64,32,5,32,1,107,33,5,32,1,32,6,106,33,6,32,2,34,1,65,1,106,33,2,32,4,40,2,4,32,1,65,2,116,106,32,0,41,3,56,62,2,0,12,1,11,11,32,4,11,10,0,16,15,36,5,16,15,36,6,11,3,0,1,11,73,1,2,127,32,0,40,2,4,34,1,65,255,255,255,255,0,113,34,2,65,1,70,4,64,32,0,65,16,106,16,53,32,0,32,0,40,2,0,65,1,114,54,2,0,35,0,32,0,16,2,5,32,0,32,2,65,1,107,32,1,65,128,128,128,128,127,113,114,54,2,4,11,11,58,0,2,64,2,64,2,64,32,0,65,8,107,40,2,0,14,7,0,0,1,1,1,1,1,2,11,15,11,32,0,40,2,0,34,0,4,64,32,0,65,172,3,79,4,64,32,0,65,16,107,16,52,11,11,15,11,0,11,11,137,3,7,0,65,16,11,55,40,0,0,0,1,0,0,0,1,0,0,0,40,0,0,0,97,0,108,0,108,0,111,0,99,0,97,0,116,0,105,0,111,0,110,0,32,0,116,0,111,0,111,0,32,0,108,0,97,0,114,0,103,0,101,0,65,208,0,11,45,30,0,0,0,1,0,0,0,1,0,0,0,30,0,0,0,126,0,108,0,105,0,98,0,47,0,114,0,116,0,47,0,116,0,108,0,115,0,102,0,46,0,116,0,115,0,65,128,1,11,43,28,0,0,0,1,0,0,0,1,0,0,0,28,0,0,0,73,0,110,0,118,0,97,0,108,0,105,0,100,0,32,0,108,0,101,0,110,0,103,0,116,0,104,0,65,176,1,11,53,38,0,0,0,1,0,0,0,1,0,0,0,38,0,0,0,126,0,108,0,105,0,98,0,47,0,97,0,114,0,114,0,97,0,121,0,98,0,117,0,102,0,102,0,101,0,114,0,46,0,116,0,115,0,65,240,1,11,51,36,0,0,0,1,0,0,0,1,0,0,0,36,0,0,0,73,0,110,0,100,0,101,0,120,0,32,0,111,0,117,0,116,0,32,0,111,0,102,0,32,0,114,0,97,0,110,0,103,0,101,0,65,176,2,11,51,36,0,0,0,1,0,0,0,1,0,0,0,36,0,0,0,126,0,108,0,105,0,98,0,47,0,116,0,121,0,112,0,101,0,100,0,97,0,114,0,114,0,97,0,121,0,46,0,116,0,115,0,65,240,2,11,53,7,0,0,0,16,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,145,4,0,0,2,0,0,0,49,0,0,0,2,0,0,0,17,1,0,0,2,0,0,0,16,0,34,16,115,111,117,114,99,101,77,97,112,112,105,110,103,85,82,76,16,46,47,114,97,98,105,110,46,119,97,115,109,46,109,97,112]);return y7(new Response(new Blob([t],{type:"application/wasm"})),e)}n1.supported=typeof WebAssembly<"u";var b7=n1,KS=s7,w7=b7,v7=async(e,t,r,n,i)=>{let a=await w7();return new KS(a,e,t,r,n,i)},_7={Rabin:KS,create:v7};async function*x7(e,t){let r,n,i;if(t.minChunkSize&&t.maxChunkSize&&t.avgChunkSize)i=t.avgChunkSize,r=t.minChunkSize,n=t.maxChunkSize;else{if(!t.avgChunkSize)throw rr(new Error("please specify an average chunk size"),"ERR_INVALID_AVG_CHUNK_SIZE");i=t.avgChunkSize,r=i/3,n=i+i/2}if(r<16)throw rr(new Error("rabin min must be greater than 16"),"ERR_INVALID_MIN_CHUNK_SIZE");n<r&&(n=r),i<r&&(i=r);let a=Math.floor(Math.log2(i));for await(let o of $7(e,{min:r,max:n,bits:a,window:t.window,polynomial:t.polynomial}))yield o}async function*$7(e,t){let r=await _7.create(t.bits,t.min,t.max,t.window),n=new zp;for await(let i of e){n.append(i);let a=r.fingerprint(i);for(let o=0;o<a.length;o++){let s=a[o],u=n.slice(0,s);n.consume(s),yield u}}n.length&&(yield n.slice(0))}async function*E7(e,t){let r=new zp,n=0,i=!1,a=t.maxChunkSize;for await(let o of e)for(r.append(o),n+=o.length;n>=a;)if(yield r.slice(0,a),i=!0,a===r.length)r=new zp,n=0;else{let s=new zp;s.append(r.shallowSlice(a)),r=s,n-=a}i&&!n||(yield r.slice(0,n))}var S7=oh({prefix:"\0",name:"identity",encode:e=>PP(e),decode:e=>MP(e)}),T7=Object.freeze({__proto__:null,identity:S7}),A7=ln({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),k7=Object.freeze({__proto__:null,base2:A7}),I7=ln({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),C7=Object.freeze({__proto__:null,base8:I7}),O7=Ec({prefix:"9",name:"base10",alphabet:"0123456789"}),B7=Object.freeze({__proto__:null,base10:O7}),R7=ln({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),z7=ln({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),N7=Object.freeze({__proto__:null,base16:R7,base16upper:z7}),L7=Ec({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),D7=Ec({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),M7=Object.freeze({__proto__:null,base36:L7,base36upper:D7}),P7=ln({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),U7=ln({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),F7=ln({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),G7=ln({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),j7=Object.freeze({__proto__:null,base64:P7,base64pad:U7,base64url:F7,base64urlpad:G7}),YS=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),V7=YS.reduce((e,t,r)=>(e[r]=t,e),[]),W7=YS.reduce((e,t,r)=>(e[t.codePointAt(0)]=r,e),[]);function H7(e){return e.reduce((t,r)=>t+=V7[r],"")}function q7(e){let t=[];for(let r of e){let n=W7[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}var X7=oh({prefix:"\u{1F680}",name:"base256emoji",encode:H7,decode:q7}),K7=Object.freeze({__proto__:null,base256emoji:X7}),ZS=0,Y7="identity",QS=Lu,Z7=e=>Fp(ZS,QS(e)),JS={code:ZS,name:Y7,encode:QS,digest:Z7},ZZ=Object.freeze({__proto__:null,identity:JS});new TextEncoder,new TextDecoder;var NE={...T7,...k7,...C7,...B7,...N7,...rU,...M7,...qP,...j7,...K7};function i1(e){return globalThis.Buffer!=null?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function eT(e=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?i1(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function tT(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}var LE=tT("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),ty=tT("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{let t=eT((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),Q7={utf8:LE,"utf-8":LE,hex:NE.base16,latin1:ty,ascii:ty,binary:ty,...NE};function a1(e,t="utf8"){let r=Q7[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return t!=="utf8"&&t!=="utf-8"||globalThis.Buffer==null||globalThis.Buffer.from==null?r.decoder.decode(`${r.prefix}${e}`):i1(globalThis.Buffer.from(e,"utf-8"))}var J7=Object.freeze({__proto__:null,fromString:a1});async function*ej(e){for await(let t of e){if(t.length===void 0)throw rr(new Error("Content was invalid"),"ERR_INVALID_CONTENT");if(typeof t=="string"||t instanceof String)yield a1(t.toString());else if(Array.isArray(t))yield Uint8Array.from(t);else{if(!(t instanceof Uint8Array))throw rr(new Error("Content was invalid"),"ERR_INVALID_CONTENT");yield t}}}function tj(e){return Symbol.iterator in e}function rj(e){return Symbol.asyncIterator in e}function nj(e){try{if(e instanceof Uint8Array)return async function*(){yield e}();if(tj(e))return async function*(){yield*e}();if(rj(e))return e}catch{throw rr(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}throw rr(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}async function*ij(e,t,r){for await(let n of e)if(n.path&&(n.path.substring(0,2)==="./"&&(r.wrapWithDirectory=!0),n.path=n.path.split("/").filter(i=>i&&i!==".").join("/")),n.content){let i,a;i=typeof r.chunker=="function"?r.chunker:r.chunker==="rabin"?x7:E7,a=typeof r.chunkValidator=="function"?r.chunkValidator:ej;let o={path:n.path,mtime:n.mtime,mode:n.mode,content:i(a(nj(n.content),r),r)};yield()=>JG(o,t,r)}else{if(!n.path)throw new Error("Import candidate must have content or path or both");{let i={path:n.path,mtime:n.mtime,mode:n.mode};yield()=>FG(i,t,r)}}}var Jo=class{constructor(t,r){this.options=r||{},this.root=t.root,this.dir=t.dir,this.path=t.path,this.dirty=t.dirty,this.flat=t.flat,this.parent=t.parent,this.parentKey=t.parentKey,this.unixfs=t.unixfs,this.mode=t.mode,this.mtime=t.mtime,this.cid=void 0,this.size=void 0}async put(t,r){}get(t){return Promise.resolve(this)}async*eachChildSeries(){}async*flush(t){}},_c=class extends Jo{constructor(t,r){super(t,r),this._children={}}async put(t,r){this.cid=void 0,this.size=void 0,this._children[t]=r}get(t){return Promise.resolve(this._children[t])}childCount(){return Object.keys(this._children).length}directChildrenCount(){return this.childCount()}onlyChild(){return this._children[Object.keys(this._children)[0]]}async*eachChildSeries(){let t=Object.keys(this._children);for(let r=0;r<t.length;r++){let n=t[r];yield{key:n,child:this._children[n]}}}async*flush(t){let r=Object.keys(this._children),n=[];for(let l=0;l<r.length;l++){let c=this._children[r[l]];if(c instanceof Jo)for await(let f of c.flush(t))c=f,yield c;c.size!=null&&c.cid&&n.push({Name:r[l],Tsize:c.size,Hash:c.cid})}let i=new Yi({type:"directory",mtime:this.mtime,mode:this.mode}),a={Data:i.marshal(),Links:n},o=Qo(Zo(a)),s=await zu(o,t,this.options),u=o.length+a.Links.reduce((l,c)=>l+(c.Tsize==null?0:c.Tsize),0);this.cid=s,this.size=u,yield{cid:s,unixfs:i,path:this.path,size:u}}},Ep=7,aj=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(e,t){let r=this._internalPositionFor(e,!1);if(t===void 0)r!==-1&&(this._unsetInternalPos(r),this._unsetBit(e),this._changedLength=!0,this._changedData=!0);else{let n=!1;r===-1?(r=this._data.length,this._setBit(e),this._changedData=!0):n=!0,this._setInternalPos(r,e,t,n),this._changedLength=!0}}unset(e){this.set(e,void 0)}get(e){this._sortData();let t=this._internalPositionFor(e,!0);if(t!==-1)return this._data[t][1]}push(e){return this.set(this.length,e),this.length}get length(){if(this._sortData(),this._changedLength){let e=this._data[this._data.length-1];this._length=e?e[0]+1:0,this._changedLength=!1}return this._length}forEach(e){let t=0;for(;t<this.length;)e(this.get(t),t,this),t++}map(e){let t=0,r=new Array(this.length);for(;t<this.length;)r[t]=e(this.get(t),t,this),t++;return r}reduce(e,t){let r=0,n=t;for(;r<this.length;)n=e(n,this.get(r),r),r++;return n}find(e){let t,r,n=0;for(;n<this.length&&!t;)r=this.get(n),t=e(r),n++;return t?r:void 0}_internalPositionFor(e,t){let r=this._bytePosFor(e,t);if(r>=this._bitArrays.length)return-1;let n=this._bitArrays[r],i=e-r*Ep;return(n&1<<i)>0?this._bitArrays.slice(0,r).reduce(oj,0)+rT(n&~(4294967295<<i+1))-1:-1}_bytePosFor(e,t){let r=Math.floor(e/Ep),n=r+1;for(;!t&&this._bitArrays.length<n;)this._bitArrays.push(0);return r}_setBit(e){let t=this._bytePosFor(e,!1);this._bitArrays[t]|=1<<e-t*Ep}_unsetBit(e){let t=this._bytePosFor(e,!1);this._bitArrays[t]&=~(1<<e-t*Ep)}_setInternalPos(e,t,r,n){let i=this._data,a=[t,r];if(n)this._sortData(),i[e]=a;else{if(i.length)if(i[i.length-1][0]>=t)i.push(a);else if(i[0][0]<=t)i.unshift(a);else{let o=Math.round(i.length/2);this._data=i.slice(0,o).concat(a).concat(i.slice(o))}else this._data.push(a);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(e){this._data.splice(e,1)}_sortData(){this._changedData&&this._data.sort(sj),this._changedData=!1}bitField(){let e=[],t,r=8,n=0,i=0,a=this._bitArrays.slice();for(;a.length||n;){n===0&&(t=a.shift(),n=7);let s=Math.min(n,r);i|=(t&~(255<<s))<<8-r,t>>>=s,n-=s,r-=s,r&&(n||a.length)||(e.push(i),i=0,r=8)}for(var o=e.length-1;o>0&&e[o]===0;o--)e.pop();return e}compactArray(){return this._sortData(),this._data.map(uj)}};function oj(e,t){return e+rT(t)}function rT(e){let t=e;return t-=t>>1&1431655765,t=(858993459&t)+(t>>2&858993459),16843009*(t+(t>>4)&252645135)>>24}function sj(e,t){return e[0]-t[0]}function uj(e){return e[1]}var lj=XE(J7),cj=aj,{fromString:fj}=lj,eh=class e{constructor(t,r,n=0){this._options=t,this._popCount=0,this._parent=r,this._posAtParent=n,this._children=new cj,this.key=null}async put(t,r){let n=await this._findNewBucketAndPos(t);await n.bucket._putAt(n,t,r)}async get(t){let r=await this._findChild(t);if(r)return r.value}async del(t){let r=await this._findPlace(t),n=r.bucket._at(r.pos);n&&n.key===t&&r.bucket._delAt(r.pos)}leafCount(){return this._children.compactArray().reduce((t,r)=>r instanceof e?t+r.leafCount():t+1,0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){let t=this._children.compactArray();for(let r of t)r instanceof e?yield*r.eachLeafSeries():yield r;return[]}serialize(t,r){return r(this._children.reduce((n,i,a)=>(i&&(i instanceof e?n.push(i.serialize(t,r)):n.push(t(i,a))),n),[]))}asyncTransform(t,r){return nT(this,t,r)}toJSON(){return this.serialize(pj,hj)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(t){let r=await this._findPlace(t),n=r.bucket._at(r.pos);if(!(n instanceof e))return n&&n.key===t?n:void 0}async _findPlace(t){let r=this._options.hash(typeof t=="string"?fj(t):t),n=await r.take(this._options.bits),i=this._children.get(n);return i instanceof e?i._findPlace(r):{bucket:this,pos:n,hash:r,existingChild:i}}async _findNewBucketAndPos(t){let r=await this._findPlace(t);if(r.existingChild&&r.existingChild.key!==t){let n=new e(this._options,r.bucket,r.pos);r.bucket._putObjectAt(r.pos,n);let i=await n._findPlace(r.existingChild.hash);return i.bucket._putAt(i,r.existingChild.key,r.existingChild.value),n._findNewBucketAndPos(r.hash)}return r}_putAt(t,r,n){this._putObjectAt(t.pos,{key:r,value:n,hash:t.hash})}_putObjectAt(t,r){this._children.get(t)||this._popCount++,this._children.set(t,r)}_delAt(t){if(t===-1)throw new Error("Invalid position");this._children.get(t)&&this._popCount--,this._children.unset(t),this._level()}_level(){if(this._parent&&this._popCount<=1)if(this._popCount===1){let t=this._children.find(dj);if(t&&!(t instanceof e)){let r=t.hash;r.untake(this._options.bits);let n={pos:this._posAtParent,hash:r,bucket:this._parent};this._parent._putAt(n,t.key,t.value)}}else this._parent._delAt(this._posAtParent)}_at(t){return this._children.get(t)}};function dj(e){return!!e}function pj(e,t){return e.key}function hj(e){return e}async function nT(e,t,r){let n=[];for(let i of e._children.compactArray())if(i instanceof eh)await nT(i,t,r);else{let a=await t(i);n.push({bitField:e._children.bitField(),children:a})}return r(n)}var mj=eh,By={exports:{}},gj=[255,254,252,248,240,224,192,128],yj=[1,3,7,15,31,63,127,255],bj=class{constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,r=0;for(;t&&this._haveBits();){let n=this._value[this._currentBytePos],i=this._currentBitPos+1,a=Math.min(i,t);r=(r<<a)+wj(n,i-a,a),t-=a,this._currentBitPos-=a,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return r}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}};function wj(e,t,r){return(e&vj(t,r))>>>t}function vj(e,t){return gj[e]&yj[Math.min(t+e-1,7)]}function _j(e,t){t||(t=e.reduce((i,a)=>i+a.length,0));let r=eT(t),n=0;for(let i of e)r.set(i,n),n+=i.length;return i1(r)}var xj=Object.freeze({__proto__:null,concat:_j}),$j=XE(xj),Ej=bj,{concat:Sj}=$j;function Tj(e){return function(t){return t instanceof xc?t:new xc(t,e)}}var xc=class{constructor(t,r){if(!(t instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=t,this._hashFn=r,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(t){let r=t;for(;this._availableBits<r;)await this._produceMoreBits();let n=0;for(;r>0;){let i=this._buffers[this._currentBufferIndex],a=Math.min(i.availableBits(),r);n=(n<<a)+i.take(a),r-=a,this._availableBits-=a,i.availableBits()===0&&this._currentBufferIndex++}return n}untake(t){let r=t;for(;r>0;){let n=this._buffers[this._currentBufferIndex],i=Math.min(n.totalBits()-n.availableBits(),r);n.untake(i),r-=i,this._availableBits+=i,this._currentBufferIndex>0&&n.totalBits()===n.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;let t=this._depth?Sj([this._value,Uint8Array.from([this._depth])]):this._value,r=await this._hashFn(t),n=new Ej(r);this._buffers.push(n),this._availableBits+=n.availableBits()}};By.exports=Tj,By.exports.InfiniteHash=xc;var iT=mj,Aj=By.exports;function kj(e){if(!e||!e.hashFn)throw new Error("please define an options.hashFn");let t={bits:e.bits||8,hash:Aj(e.hashFn)};return new iT(t)}var fh={createHAMT:kj,Bucket:iT},Ry=class extends Jo{constructor(t,r){super(t,r),this._bucket=fh.createHAMT({hashFn:r.hamtHashFn,bits:r.hamtBucketBits})}async put(t,r){await this._bucket.put(t,r)}get(t){return this._bucket.get(t)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(let{key:t,value:r}of this._bucket.eachLeafSeries())yield{key:t,child:r}}async*flush(t){for await(let r of aT(this._bucket,t,this,this.options))yield{...r,path:this.path}}};async function*aT(e,t,r,n){let i=e._children,a=[],o=0;for(let p=0;p<i.length;p++){let d=i.get(p);if(!d)continue;let m=p.toString(16).toUpperCase().padStart(2,"0");if(d instanceof fh.Bucket){let g;for await(let x of await aT(d,t,null,n))g=x;if(!g)throw new Error("Could not flush sharded directory, no subshard found");a.push({Name:m,Tsize:g.size,Hash:g.cid}),o+=g.size}else if(typeof d.value.flush=="function"){let g=d.value,x;for await(let y of g.flush(t))x=y,yield x;let b=m+d.key;a.push({Name:b,Tsize:x.size,Hash:x.cid}),o+=x.size}else{let g=d.value;if(!g.cid)continue;let x=m+d.key,b=g.size;a.push({Name:x,Tsize:b,Hash:g.cid}),o+=b}}let s=Uint8Array.from(i.bitField().reverse()),u=new Yi({type:"hamt-sharded-directory",data:s,fanout:e.tableSize(),hashType:n.hamtHashCode,mtime:r&&r.mtime,mode:r&&r.mode}),l=Qo(Zo({Data:u.marshal(),Links:a})),c=await zu(l,t,n),f=l.length+o;yield{cid:c,unixfs:u,size:f}}async function oT(e,t,r,n){let i=t;t instanceof _c&&t.directChildrenCount()>=r&&(i=await Ij(t,n));let a=i.parent;if(a){if(i!==t){if(e&&(e.parent=i),!i.parentKey)throw new Error("No parent key found");await a.put(i.parentKey,i)}return oT(i,a,r,n)}return i}async function Ij(e,t){let r=new Ry({root:e.root,dir:!0,parent:e.parent,parentKey:e.parentKey,path:e.path,dirty:e.dirty,flat:!1,mtime:e.mtime,mode:e.mode},t);for await(let{key:n,child:i}of e.eachChildSeries())await r.put(n,i);return r}var Cj=(e="")=>(e.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean);async function Oj(e,t,r){let n=Cj(e.path||""),i=n.length-1,a=t,o="";for(let s=0;s<n.length;s++){let u=n[s];o+=`${o?"/":""}${u}`;let l=s===i;if(a.dirty=!0,a.cid=void 0,a.size=void 0,l)await a.put(u,e),t=await oT(null,a,r.shardSplitThreshold,r);else{let c=await a.get(u);c&&c instanceof Jo||(c=new _c({root:!1,dir:!0,parent:a,parentKey:u,path:o,dirty:!0,flat:!0,mtime:c&&c.unixfs&&c.unixfs.mtime,mode:c&&c.unixfs&&c.unixfs.mode},r)),await a.put(u,c),a=c}}return t}async function*DE(e,t){e instanceof Jo?yield*e.flush(t):e&&e.unixfs&&e.unixfs.isDirectory()&&(yield e)}async function*Bj(e,t,r){let n=new _c({root:!0,dir:!0,path:"",dirty:!0,flat:!0},r);for await(let i of e)i&&(n=await Oj(i,n,r),i.unixfs&&i.unixfs.isDirectory()||(yield i));if(r.wrapWithDirectory)yield*DE(n,t);else for await(let i of n.eachChildSeries())i&&(yield*DE(i.child,t))}async function*Rj(e,t,r={}){let n=nG(r),i,a,o;i=typeof r.dagBuilder=="function"?r.dagBuilder:ij,a=typeof r.treeBuilder=="function"?r.treeBuilder:Bj,o=Symbol.asyncIterator in e||Symbol.iterator in e?e:[e];for await(let s of a(bS(i(o,t,n),n.fileImportConcurrency),t,n))yield{cid:s.cid,path:s.path,unixfs:s.unixfs,size:s.size}}async function*zj(e,t={}){let r=e.getReader();try{for(;;){let n=await r.read();if(n.done)return;yield n.value}}finally{t.preventCancel!==!0&&r.cancel(),r.releaseLock()}}var kc=zj,ME=kc;function Nj(e){return typeof e.stream=="function"?ME(e.stream()):ME(new Response(e).body)}var Lj=Nj;function Dj(e){let[t,r]=e[Symbol.asyncIterator]?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>t.next(),push:i=>{n.push(i)},next:()=>n.length?{done:!1,value:n.shift()}:t.next(),[r](){return this}}}var o1=Dj,Mj=async function*(e,t){for await(let r of e)yield t(r)},zy=Mj;function Nu(e){return ArrayBuffer.isView(e)||e instanceof ArrayBuffer}function th(e){return e.constructor&&(e.constructor.name==="Blob"||e.constructor.name==="File")&&typeof e.stream=="function"}function Ny(e){return typeof e=="object"&&(e.path||e.content)}var rh=e=>e&&typeof e.getReader=="function";async function*Sp(e){yield e}async function sT(e){if(Nu(e))return Sp(ry(e));if(typeof e=="string"||e instanceof String)return Sp(ry(e.toString()));if(th(e))return Lj(e);if(rh(e)&&(e=kc(e)),Symbol.iterator in e||Symbol.asyncIterator in e){let t=o1(e),{value:r,done:n}=await t.peek();if(n)return Sp(new Uint8Array(0));if(t.push(r),Number.isInteger(r))return Sp(Uint8Array.from(await e1(t)));if(Nu(r)||typeof r=="string"||r instanceof String)return zy(t,ry)}throw rr(new Error(`Unexpected input: ${e}`),"ERR_UNEXPECTED_INPUT")}function ry(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new Uint8Array(e):Array.isArray(e)?Uint8Array.from(e):a1(e.toString())}async function*Pj(e,t){if(e==null)throw rr(new Error(`Unexpected input: ${e}`),"ERR_UNEXPECTED_INPUT");if(typeof e=="string"||e instanceof String)yield Tp(e.toString(),t);else if(Nu(e)||th(e))yield Tp(e,t);else{if(rh(e)&&(e=kc(e)),Symbol.iterator in e||Symbol.asyncIterator in e){let r=o1(e),{value:n,done:i}=await r.peek();if(i)return void(yield{content:[]});if(r.push(n),Number.isInteger(n)||Nu(n)||typeof n=="string"||n instanceof String)return void(yield Tp(r,t));throw rr(new Error("Unexpected input: multiple items passed - if you are using ipfs.add, please use ipfs.addAll instead"),"ERR_UNEXPECTED_INPUT")}if(!Ny(e))throw rr(new Error('Unexpected input: cannot convert "'+typeof e+'" into ImportCandidate'),"ERR_UNEXPECTED_INPUT");yield Tp(e,t)}}async function Tp(e,t){let{path:r,mode:n,mtime:i,content:a}=e,o={path:r||"",mode:dc(n),mtime:Zp(i)};return a?o.content=await t(a):r||(o.content=await t(e)),o}function Uj(e){return Pj(e,sT)}async function*Fj(e,t){if(typeof e=="string"||e instanceof String||Nu(e)||th(e)||e._readableState)throw rr(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if(rh(e)&&(e=kc(e)),Symbol.iterator in e||Symbol.asyncIterator in e){let r=o1(e),{value:n,done:i}=await r.peek();if(i)return void(yield*[]);if(r.push(n),Number.isInteger(n))throw rr(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if(n._readableState)return void(yield*zy(r,a=>ny({content:a},t)));if(Nu(n))return void(yield ny({content:r},t));if(Ny(n)||n[Symbol.iterator]||n[Symbol.asyncIterator]||rh(n)||th(n))return void(yield*zy(r,a=>ny(a,t)))}throw Ny(e)?rr(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT"):rr(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT")}async function ny(e,t){let{path:r,mode:n,mtime:i,content:a}=e,o={path:r||"",mode:dc(n),mtime:Zp(i)};return a?o.content=await t(a):r||(o.content=await t(e)),o}function Gj(e){return Fj(e,sT)}function jj(e){return ArrayBuffer.isView(e)||e instanceof ArrayBuffer}function Vj(e){return!!e.constructor&&(e.constructor.name==="Blob"||e.constructor.name==="File")&&typeof e.stream=="function"}function Wj(e){return typeof e=="string"||e instanceof String||jj(e)||Vj(e)||"_readableState"in e}function Hj(e){return Wj(e)?Uj(e):Gj(e)}function qj(e){return e=e||new Error("Not Found"),rr(e,"ERR_NOT_FOUND")}function Xj(e){return e=e||new Error("Aborted"),rr(e,"ERR_ABORTED")}var QZ=Object.freeze({__proto__:null,notFoundError:qj,abortedError:Xj}),Kj=async e=>{for await(let t of e);},PE=Kj,Yj=async function*(e,t){for await(let r of e)await t(r)&&(yield r)},Eu=Yj,Zj=async function*(e,t){let r=0;if(!(t<1)){for await(let n of e)if(yield n,r++,r===t)return}},UE=Zj,FE=(e,t)=>async function*(){yield*(await e1(e)).sort(t)}(),nh=class{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(t,r,n){return Promise.reject(new Error(".put is not implemented"))}get(t,r){return Promise.reject(new Error(".get is not implemented"))}has(t,r){return Promise.reject(new Error(".has is not implemented"))}delete(t,r){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(t,r={}){for await(let{key:n,value:i}of t)await this.put(n,i,r),yield{key:n,value:i}}async*getMany(t,r={}){for await(let n of t)yield this.get(n,r)}async*deleteMany(t,r={}){for await(let n of t)await this.delete(n,r),yield n}batch(){let t=[],r=[];return{put(n,i){t.push({key:n,value:i})},delete(n){r.push(n)},commit:async n=>{await PE(this.putMany(t,n)),t=[],await PE(this.deleteMany(r,n)),r=[]}}}async*_all(t,r){throw new Error("._all is not implemented")}async*_allKeys(t,r){throw new Error("._allKeys is not implemented")}query(t,r){let n=this._all(t,r);if(t.prefix!=null&&(n=Eu(n,i=>i.key.toString().startsWith(t.prefix||""))),Array.isArray(t.filters)&&(n=t.filters.reduce((i,a)=>Eu(i,a),n)),Array.isArray(t.orders)&&(n=t.orders.reduce((i,a)=>FE(i,a),n)),t.offset!=null){let i=0;n=Eu(n,()=>i++>=(t.offset||0))}return t.limit!=null&&(n=UE(n,t.limit)),n}queryKeys(t,r){let n=this._allKeys(t,r);if(t.prefix!=null&&(n=Eu(n,i=>i.toString().startsWith(t.prefix||""))),Array.isArray(t.filters)&&(n=t.filters.reduce((i,a)=>Eu(i,a),n)),Array.isArray(t.orders)&&(n=t.orders.reduce((i,a)=>FE(i,a),n)),t.offset!=null){let i=0;n=Eu(n,()=>i++>=t.offset)}return t.limit!=null&&(n=UE(n,t.limit)),n}},$c=class extends nh{constructor(){super(),this.store=new Map}async*blocks(){for(let[t,r]of this.store.entries())yield{cid:mr.parse(t),bytes:r}}put(t,r){return this.store.set(t.toString(),r),Promise.resolve()}get(t){let r=this.store.get(t.toString());if(!r)throw new Error(`block with cid ${t.toString()} no found`);return Promise.resolve(r)}has(t){return Promise.resolve(this.store.has(t.toString()))}close(){return this.store.clear(),Promise.resolve()}},Su={cidVersion:1,chunker:"fixed",maxChunkSize:262144,hasher:Ru,rawLeaves:!0,wrapWithDirectory:!0,maxChildrenPerNode:174};async function Qj({input:e,blockstore:t,hasher:r,maxChunkSize:n,maxChildrenPerNode:i,wrapWithDirectory:a,rawLeaves:o}){if(!e||Array.isArray(e)&&!e.length)throw new Error("missing input file(s)");let s=t||new $c,u=await YE(tP(Hj(e),m=>Rj(m,s,{...Su,hasher:r||Su.hasher,maxChunkSize:n||Su.maxChunkSize,maxChildrenPerNode:i||Su.maxChildrenPerNode,wrapWithDirectory:a!==!1&&Su.wrapWithDirectory,rawLeaves:o??Su.rawLeaves})));if(!u||!u.cid)throw new Error("given input could not be parsed correctly");let l=u.cid,{writer:c,out:f}=await yc.create([l]),p=f[Symbol.asyncIterator](),d;return{root:l,out:{[Symbol.asyncIterator](){if(d!=null)throw new Error("Multiple iterator not supported");return d=(async()=>{for await(let m of s.blocks())await c.put(m);await c.close(),t||await s.close()})(),{async next(){let m=await p.next();return m.done&&await d,m}}}}}}var Jj=2e3,eV=!1;function tV(e){return e&&e.rel}function rV(e,t){return t.rel.split(/\s+/).forEach(function(r){e[r]=Object.assign({},t,{rel:r})}),e}function nV(e,t){let r=t.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return r&&(e[r[1]]=r[2]),e}function iV(e){try{let t=e.match(/<?([^>]*)>(.*)/),r=t[1],n=t[2].split(";"),i={},a=new URL(r,"https://example.com");for(let[s,u]of a.searchParams)i[s]=u;n.shift();let o=n.reduce(nV,{});return o=Object.assign({},i,o),o.url=r,o}catch{return null}}function aV(e,t){if(!e)return!1;let r=(t=t||{}).maxHeaderLength||Jj,n=t.throwOnMaxHeaderLengthExceeded||eV;if(e.length>r){if(n)throw new Error("Input string too long, it should be under "+r+" characters.");return!1}return!0}function GE(e,t){return aV(e,t)?e.split(/,\s*</).map(iV).filter(tV).reduce(rV,{}):null}var oV=42;function sV(e){if(e[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return mr.decode(e.subarray(1))}var uT={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,tags:[]};uT.tags[oV]=sV;var lT=113,cT=e=>Ky(e,uT),uV=async function(e){return(await $S.encode(e)).slice(0,8).reverse()},lV=(e,t,r)=>Promise.all(e.map(n=>{if(n.Name==null)throw new Error("Unexpected Link without a Name");if(n.Name.length===2){let i=parseInt(n.Name,16);return t._putObjectAt(i,new fh.Bucket({hash:r._options.hash,bits:r._options.bits},t,i))}return r.put(n.Name.substring(2),!0)})),jE=e=>e.toString(16).toUpperCase().padStart(2,"0").substring(0,2),cV=e=>{let t=e.bucket,r=[];for(;t._parent;)r.push(t),t=t._parent;return r.push(t),r.reverse()},fT=async(e,t,r,n,i)=>{if(!n){let l=fh.createHAMT({hashFn:uV});n={rootBucket:l,hamtDepth:1,lastBucket:l}}await lV(e.Links,n.lastBucket,n.rootBucket);let a=await n.rootBucket._findNewBucketAndPos(t),o=jE(a.pos),s=cV(a);s.length>n.hamtDepth&&(n.lastBucket=s[n.hamtDepth],o=jE(n.lastBucket._posAtParent));let u=e.Links.find(l=>{if(l.Name==null)return!1;let c=l.Name.substring(0,2),f=l.Name.substring(2);return c===o&&(!f||f===t)});return u?u.Name!=null&&u.Name.substring(2)===t?u.Hash:(n.hamtDepth++,e=Ac(await r.get(u.Hash,i)),fT(e,t,r,n,i)):null};function ih(e,t,r,n){let i=t+e.length;return r>=i||n<t?new Uint8Array(0):(n>=t&&n<i&&(e=e.slice(0,n-t)),r>=t&&r<i&&(e=e.slice(r-t)),e)}var s1=(e,t,r)=>{if(t||(t=0),t<0)throw rr(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(t>e)throw rr(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(r||r===0||(r=e-t),r<0)throw rr(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");return t+r>e&&(r=e-t),{offset:t,length:r}};async function*dT(e,t,r,n,i=0,a){if(t instanceof Uint8Array){let u=ih(t,i,r,n);return u.length&&(yield u),i+=u.length,i}if(t.Data==null)throw rr(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let o;try{o=Yi.unmarshal(t.Data)}catch(u){throw rr(u,"ERR_NOT_UNIXFS")}if(o.data&&o.data.length){let u=ih(o.data,i,r,n);u.length&&(yield u),i+=o.data.length}let s=i;for(let u=0;u<t.Links.length;u++){let l=t.Links[u],c=i+o.blockSizes[u];if(r>=s&&r<c||n>s&&n<=c||r<s&&n>c){let f=await e.get(l.Hash,{signal:a.signal}),p;switch(l.Hash.code){case Jy:p=await Ac(f);break;case Ou:p=f;break;case lT:p=await cT(f);break;default:throw Error(`Unsupported codec: ${l.Hash.code}`)}for await(let d of dT(e,p,r,n,i,a))i+=d.length,yield d}i=c,s=c+1}}var VE=(e,t,r,n,i,a,o)=>function(s={}){let u=r.fileSize();if(u===void 0)throw new Error("File was a directory");let{offset:l,length:c}=s1(u,s.offset,s.length);return dT(o,t,l,l+c,0,s)},fV=(e,t,r,n,i,a,o)=>async function*(s={}){let u=s.offset||0,l=s.length||t.Links.length,c=t.Links.slice(u,l);for(let f of c){let p=await i(f.Hash,f.Name||"",`${n}/${f.Name||""}`,[],a+1,o,s);p.entry&&(yield p.entry)}},dV=(e,t,r,n,i,a,o)=>function(s={}){return pT(t,n,i,a,o,s)};async function*pT(e,t,r,n,i,a){let o=e.Links;for(let s of o){let u=s.Name!=null?s.Name.substring(2):null;if(u)yield(await r(s.Hash,u,`${t}/${u}`,[],n+1,i,a)).entry;else{e=Ac(await i.get(s.Hash));for await(let l of pT(e,t,r,n,i,a))yield l}}}var pV=(e,t)=>{let r=e.Links.find(n=>n.Name===t);return r&&r.Hash},hV={raw:VE,file:VE,directory:fV,"hamt-sharded-directory":dV,metadata:(e,t,r,n,i,a,o)=>()=>[],symlink:(e,t,r,n,i,a,o)=>()=>[]},mV=async(e,t,r,n,i,a,o,s)=>{let u=Ac(await o.get(e,s)),l,c;if(t||(t=e.toString()),u.Data==null)throw rr(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{l=Yi.unmarshal(u.Data)}catch(f){throw rr(f,"ERR_NOT_UNIXFS")}if(r||(r=t),n.length){let f;if(f=l&&l.type==="hamt-sharded-directory"?await fT(u,n[0],o):pV(u,n[0]),!f)throw rr(new Error("file does not exist"),"ERR_NOT_FOUND");let p=n.shift();c={cid:f,toResolve:n,name:p||"",path:`${r}/${p}`}}return{entry:{type:l.isDirectory()?"directory":"file",name:t,path:r,cid:e,content:hV[l.type](e,u,l,r,i,a,o),unixfs:l,depth:a,node:u,size:l.fileSize()},next:c}},gV=e=>async function*(t={}){let{offset:r,length:n}=s1(e.length,t.offset,t.length);yield ih(e,0,r,r+n)},yV=async(e,t,r,n,i,a,o,s)=>{if(n.length)throw rr(new Error(`No link named ${r} found in raw node ${e}`),"ERR_NOT_FOUND");let u=await o.get(e,s);return{entry:{type:"raw",name:t,path:r,cid:e,content:gV(u),depth:a,size:u.length,node:u}}},bV=async(e,t,r,n,i,a,o,s)=>{let u=await o.get(e),l=cT(u),c=l,f=r;for(;n.length;){let p=n[0];if(!(p in c))throw rr(new Error(`No property named ${p} found in cbor node ${e}`),"ERR_NO_PROP");{n.shift(),f=`${f}/${p}`;let d=mr.asCID(c[p]);if(d)return{entry:{type:"object",name:t,path:r,cid:e,node:u,depth:a,size:u.length,content:async function*(){yield l}},next:{cid:d,name:p,path:f,toResolve:n}};c=c[p]}}return{entry:{type:"object",name:t,path:r,cid:e,node:u,depth:a,size:u.length,content:async function*(){yield l}}}},wV=e=>async function*(t={}){let{offset:r,length:n}=s1(e.length,t.offset,t.length);yield ih(e,0,r,r+n)},vV=async(e,t,r,n,i,a,o,s)=>{if(n.length)throw rr(new Error(`No link named ${r} found in raw node ${e}`),"ERR_NOT_FOUND");let u=await Gp(e.multihash.bytes);return{entry:{type:"identity",name:t,path:r,cid:e,content:wV(u.digest),depth:a,size:u.digest.length,node:u.digest}}},_V={[Jy]:mV,[Ou]:yV,[lT]:bV,[JS.code]:vV};function hT(e,t,r,n,i,a,o){let s=_V[e.code];if(!s)throw rr(new Error(`No resolver for code ${e.code}`),"ERR_NO_RESOLVER");return s(e,t,r,n,hT,i,a,o)}var xV=(e="")=>(e.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean),$V=e=>{if(e instanceof Uint8Array)return{cid:mr.decode(e),toResolve:[]};let t=mr.asCID(e);if(t)return{cid:t,toResolve:[]};if(typeof e=="string"){e.indexOf("/ipfs/")===0&&(e=e.substring(6));let r=xV(e);return{cid:mr.parse(r[0]),toResolve:r.slice(1)}}throw rr(new Error(`Unknown path type ${e}`),"ERR_BAD_PATH")};async function*EV(e,t,r={}){let{cid:n,toResolve:i}=$V(e),a=n.toString(),o=a,s=i.length;for(;;){let u=await hT(n,a,o,i,s,t,r);if(!u.entry&&!u.next)throw rr(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");if(u.entry&&(yield u.entry),!u.next)return;i=u.next.toResolve,n=u.next.cid,a=u.next.name,o=u.next.path}}async function SV(e,t,r={}){let n=await YE(EV(e,t,r));if(!n)throw rr(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");return n}async function*TV(e,t,r={}){let n=await SV(e,t,r);if(n&&(yield n,n.type==="directory"))for await(let i of async function*a(o,s){for await(let u of o.content(s))yield u,u instanceof Uint8Array||u.type==="directory"&&(yield*a(u,s))}(n,r))yield i}function AV(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}var Ly=class e extends nh{constructor(t){super(),this.store=t}async get(t){let r=await this.store.get(t);if(!r)throw new Error(`Incomplete CAR. Block missing for CID ${t}`);if(!kV({cid:t,bytes:r}))throw new Error(`Invalid CAR. Hash of block data does not match CID ${t}`);return r}static fromBlockstore(t){return new e(t)}static fromCarReader(t){return new e({get:async r=>{let n=await t.get(r);return n?.bytes}})}};async function kV({cid:e,bytes:t}){return AV((await Ru.digest(t)).digest,e.multihash.digest)}async function*IV(e,{roots:t,blockstore:r}={}){let n=await wy.fromIterable(CV(e)),i=r||new $c;for await(let o of n)await i.put(o.cid,o.bytes);let a=Ly.fromBlockstore(i);t&&t.length!==0||(t=await n.getRoots());for(let o of t)yield*TV(o,a)}function CV(e){return Symbol.asyncIterator in e?e:kc(e)}var Ap=({enumerable:e=!0,configurable:t=!1}={})=>({enumerable:e,configurable:t,writable:!1}),Dy=function*(e,t){if(e!=null&&!(e instanceof Uint8Array))for(let[r,n]of Object.entries(e)){let i=[...t,r];if(n!=null&&typeof n=="object")if(Array.isArray(n))for(let[a,o]of n.entries()){let s=[...i,a],u=mr.asCID(o);u?yield[s.join("/"),u]:typeof o=="object"&&(yield*Dy(o,s))}else{let a=mr.asCID(n);a?yield[i.join("/"),a]:yield*Dy(n,i)}}},My=function*(e,t){if(e!=null)for(let[r,n]of Object.entries(e)){let i=[...t,r];if(yield i.join("/"),!(n==null||n instanceof Uint8Array||typeof n!="object"||mr.asCID(n)))if(Array.isArray(n))for(let[a,o]of n.entries()){let s=[...i,a];yield s.join("/"),typeof o!="object"||mr.asCID(o)||(yield*My(o,s))}else yield*My(n,i)}},OV=(e,t)=>{let r=e;for(let[n,i]of t.entries()){if(r=r[i],r==null)throw new Error(`Object has no property at ${t.slice(0,n+1).map(o=>`[${JSON.stringify(o)}]`).join("")}`);let a=mr.asCID(r);if(a)return{value:a,remaining:t.slice(n+1).join("/")}}return{value:r}},Py=class{constructor({cid:t,bytes:r,value:n}){if(!t||!r||n===void 0)throw new Error("Missing required argument");this.cid=t,this.bytes=r,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:Ap(),bytes:Ap(),value:Ap(),asBlock:Ap()})}links(){return Dy(this.value,[])}tree(){return My(this.value,[])}get(t="/"){return OV(this.value,t.split("/").filter(Boolean))}},mT=42;function BV(e){if(e.asCID!==e)return null;let t=mr.asCID(e);if(!t)return null;let r=new Uint8Array(t.bytes.byteLength+1);return r.set(t.bytes,1),[new Tt(ke.tag,mT),new Tt(ke.bytes,r)]}function RV(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function zV(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var NV={float64:!0,typeEncoders:{Object:BV,undefined:RV,number:zV}};function LV(e){if(e[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return mr.decode(e.subarray(1))}var gT={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,tags:[]};gT.tags[mT]=LV;var DV="dag-cbor",MV=113,PV=e=>lS(e,NV),UV=e=>Ky(e,gT),FV=Object.freeze({__proto__:null,name:DV,code:MV,encode:PV,decode:UV}),Uy=class e{constructor(t,r,n={}){if(typeof r!="number"||r<=0)throw new Error("invalid target chunk size");this._reader=t,this._targetSize=r,this._decoders=[vc,PS,FV,...n.decoders||[]]}async*cars(){let t=await this._reader.getRoots();if(t.length!==1)throw new Error(`unexpected number of roots: ${t.length}`);let r;for await(let n of this._cars(t[0]))r=n.channel,n.out&&(yield n.out);if(!r)throw new Error("missing CAR writer channel");r.writer.close(),yield r.out}async _get(t){let r=await this._reader.get(t);if(!r)throw new Error(`missing block for ${t}`);let{bytes:n}=r,i=this._decoders.find(a=>a.code===t.code);if(!i)throw new Error(`missing decoder for ${t.code}`);return new Py({cid:t,bytes:n,value:i.decode(n)})}async*_cars(t,r=[],n){let i=await this._get(t);if((n=n||Object.assign(yc.create(t),{size:0})).size>0&&n.size+i.bytes.byteLength>=this._targetSize){n.writer.close();let{out:a}=n;n=GV(r),yield{channel:n,out:a}}r=r.concat(i),n.size+=i.bytes.byteLength,n.writer.put(i);for(let[,a]of i.links())for await(let o of this._cars(a,r,n))n=o.channel,yield o;if(!n)throw new Error("missing CAR writer channel");yield{channel:n}}static async fromIterable(t,r,n){let i=await Bu.fromIterable(t);return new e(i,r,n)}static async fromBlob(t,r,n){let i=await t.arrayBuffer(),a=await Bu.fromBytes(new Uint8Array(i));return new e(a,r,n)}};function GV(e){let t=Object.assign(yc.create(e[0].cid),{size:e.reduce((r,n)=>r+n.bytes.byteLength,0)});for(let r of e)t.writer.put(r);return t}async function JZ(){throw new Error("Unsupported in this environment")}async function*eQ(){throw new Error("Unsupported in this environment")}var Fy={exports:{}};(function(e,t){function r(n,i,a){a===void 0&&(a=!1),a&&(i/=n,n=1);var o,s=[],u=0,l=0,c=function(){var f=u+i,p=Date.now();if(p<f)return o!==void 0&&clearTimeout(o),void(o=setTimeout(c,f-p));u=p,l=0;for(var d=0,m=s.splice(0,n);d<m.length;d++){var g=m[d];l++,g()}o=s.length?setTimeout(c,i):void 0};return function(f){return new Promise(function(p,d){var m=function(){return Promise.resolve().then(f).then(p).catch(d)},g=Date.now();o===void 0&&g-u>i&&(u=g,l=0),l++<n?m():(s.push(m),o===void 0&&(o=setTimeout(c,u+i-g)))})}}Object.defineProperty(t,"__esModule",{value:!0}),e.exports=r,t.default=r})(Fy,Fy.exports);var jV=VM(Fy.exports),Tu=globalThis.fetch,VV=globalThis.Blob,WV=globalThis.File,yT=$c,WE=5,HV=3,HE=52428800,iy=1048576,qE=104857600,qV=30,XV=1e4;function bT(){let e=jV(qV,XV);return()=>e(()=>{})}var Au=bT(),ah=class e{constructor({token:t,endpoint:r=new URL("https://api.web3.storage"),rateLimiter:n,fetch:i=Tu}){this.token=t,this.endpoint=r,this.rateLimiter=n||bT(),this.fetch=i}static headers(t){if(!t)throw new Error("missing token");return{Authorization:`Bearer ${t}`,"X-Client":"web3.storage/js"}}static async put({endpoint:t,token:r,rateLimiter:n=Au,fetch:i=Tu},a,{onRootCidReady:o,onStoredChunk:s,maxRetries:u=WE,maxChunkSize:l=HE,wrapWithDirectory:c=!0,name:f,signal:p}={}){if(l>=qE||l<iy)throw new Error("maximum chunk size must be less than 100MiB and greater than or equal to 1MB");let d=new yT;try{let{out:m,root:g}=await Qj({input:Array.from(a).map(QV),blockstore:d,wrapWithDirectory:c,maxChunkSize:iy,maxChildrenPerNode:1024});o&&o(g.toString());let x=await Bu.fromIterable(m);return await e.putCar({endpoint:t,token:r,rateLimiter:n,fetch:i},x,{onStoredChunk:s,maxRetries:u,maxChunkSize:l,name:f,signal:p})}finally{await d.close()}}static async putCar({endpoint:t,token:r,rateLimiter:n=Au,fetch:i=Tu},a,{name:o,onStoredChunk:s,maxRetries:u=WE,maxChunkSize:l=HE,decoders:c,signal:f}={}){if(l>=qE||l<iy)throw new Error("maximum chunk size must be less than 100MiB and greater than or equal to 1MB");let p=l,d=new URL("car",t),m={...e.headers(r),"Content-Type":"application/vnd.ipld.car",...o?{"X-Name":encodeURIComponent(o)}:{}},g=await a.getRoots();if(g[0]==null)throw new Error("missing root CID");if(g.length>1)throw new Error("too many roots");let x=g[0].toString(),b=new Uy(a,p,{decoders:c}),y=kp(HV,async E=>{let $=[];for await(let P of E)$.push(P);let k=new VV($,{type:"application/vnd.ipld.car"}),R=k;parseInt(globalThis.process?.versions?.node)>18&&(R=await R.arrayBuffer());let C=await QM(async()=>{let P;await n();try{P=await i(d.toString(),{method:"POST",headers:m,body:R,signal:f})}catch(te){throw f&&f.aborted?new ZM(te):te}if(P.status===429)throw new Error("rate limited");let W=await P.json();if(!P.ok)throw new Error(W.message);if(W.cid!==x)throw new Error(`root CID mismatch, expected: ${x}, received: ${W.cid}`);return W.cid},{retries:u});return s&&s(k.size),C});for await(let E of y(b.cars()));return x}static async get({endpoint:t,token:r,rateLimiter:n=Au,fetch:i=Tu},a,o={}){let s=new URL(`car/${a}`,t);await n();let u=await i(s.toString(),{method:"GET",headers:e.headers(r),signal:o.signal});if(u.status===429)throw new Error("rate limited");return ZV(u)}static async delete({endpoint:t,token:r,rateLimiter:n=Au},i,a={}){throw console.log("Not deleting",i,t,r,n,a),Error(".delete not implemented yet")}static async status({endpoint:t,token:r,rateLimiter:n=Au,fetch:i=Tu},a,o={}){let s=new URL(`status/${a}`,t);await n();let u=await i(s.toString(),{method:"GET",headers:e.headers(r),signal:o.signal});if(u.status===429)throw new Error("rate limited");if(u.status!==404){if(!u.ok)throw new Error(u.statusText);return u.json()}}static async*list(t,{before:r=new Date().toISOString(),maxResults:n=1/0,signal:i}={}){let a=0,o=n>100?100:n;for await(let s of JV(async function({endpoint:u,token:l,rateLimiter:c=Au,fetch:f=Tu},{before:p,size:d}){let m=new URLSearchParams({before:p,size:d.toString()}),g=new URL(`user/uploads?${m}`,u);return await c(),f(g.toString(),{method:"GET",headers:{...e.headers(l),"Access-Control-Request-Headers":"Link"},signal:i})},t,{before:r,size:o})){if(!s.ok){if(s.status===429)throw new Error("rate limited");let l=await s.json();throw new Error(`${s.status} ${s.statusText} ${l?"- "+l.message:""}`)}let u=await s.json();for(let l of u){if(++a>n)return;yield l}}}put(t,r){return e.put(this,t,r)}putCar(t,r){return e.putCar(this,t,r)}get(t,r){return e.get(this,t,r)}delete(t,r){return e.delete(this,t,r)}status(t,r){return e.status(this,t,r)}list(t){return e.list(this,t)}};async function KV({content:e,path:t,cid:r}){let n=[];for await(let a of e())n.push(a);let i=new WV(n,YV(t));return Object.assign(i,{cid:r.toString()})}function YV(e){let t=e.indexOf("/");return t===-1?e:e.substring(t+1)}function ZV(e){let t=Object.assign(e,{unixFsIterator:async function*(){if(!e.ok)throw new Error(`Response was not ok: ${e.status} ${e.statusText} - Check for { "ok": false } on the Response object before calling .unixFsIterator`);if(!e.body)throw new Error("No body on response");let r=new yT;try{for await(let n of IV(e.body,{blockstore:r}))yield n}finally{await r.close()}},files:async()=>{if(!e.ok)throw new Error(`Response was not ok: ${e.status} ${e.statusText} - Check for { "ok": false } on the Response object before calling .files`);let r=[];for await(let n of t.unixFsIterator()){if(n.type==="directory")continue;let i=await KV(n);r.push(i)}return r}});return t}function QV(e){let t;return{path:e.name,get content(){return t=t||e.stream(),t}}}async function*JV(e,t,r){let n=await e(t,r);yield n;let i=GE(n.headers.get("Link")||"");for(;i&&i.next;)n=await e(t,i.next),yield n,i=GE(n.headers.get("Link")||"")}async function Ic(e){if(!window.PINNER_TOKEN)return null;try{let r=await new ah({token:window.PINNER_TOKEN}).put(e),i=`${(window.IPFS_GATEWAY||"https://ipfs.io/ipfs").replace(/\/$/,"")}/${r}`;if(navigator.clipboard)try{await navigator.clipboard.writeText(i)}catch{}return typeof window.toast=="function"&&window.toast(`pinned ${r}`),{cid:r,url:i}}catch(t){return console.error("pinFiles failed",t),typeof window.toast=="function"&&window.toast("pin failed"),null}}function wT(e,t){let r={pointers:new Map,lastDist:0};e.addEventListener("pointerdown",n=>{e.setPointerCapture(n.pointerId),r.pointers.set(n.pointerId,[n.clientX,n.clientY])}),e.addEventListener("pointermove",n=>{if(!r.pointers.has(n.pointerId))return;let i=r.pointers.get(n.pointerId),a=[n.clientX,n.clientY];if(r.pointers.set(n.pointerId,a),r.pointers.size===1){let o=a[0]-i[0],s=a[1]-i[1],u=t.transform.baseVal.consolidate(),l=u?u.matrix:e.createSVGMatrix();t.setAttribute("transform",l.translate(o,s).toString())}else if(r.pointers.size===2){let o=Array.from(r.pointers.values()),s=Math.hypot(o[0][0]-o[1][0],o[0][1]-o[1][1]);if(r.lastDist){let u=s/r.lastDist,l=t.transform.baseVal.consolidate(),c=l?l.matrix:e.createSVGMatrix(),f=(o[0][0]+o[1][0])/2,p=(o[0][1]+o[1][1])/2,d=c.translate(f,p).scale(u).translate(-f,-p);t.setAttribute("transform",d.toString())}r.lastDist=s}}),e.addEventListener("pointerup",n=>{r.pointers.delete(n.pointerId),r.pointers.size<2&&(r.lastDist=0)}),e.addEventListener("pointercancel",n=>{r.pointers.delete(n.pointerId),r.pointers.size<2&&(r.lastDist=0)})}function vT(e){if(document.getElementById("fps-meter"))return;let t=document.createElement("div");t.id="fps-meter",t.setAttribute("role","status"),t.setAttribute("aria-live","polite"),Object.assign(t.style,{position:"fixed",right:"4px",bottom:"4px",background:"rgba(0,0,0,0.6)",color:"#0f0",fontFamily:"monospace",fontSize:"12px",padding:"2px 4px",zIndex:1e3}),document.body.appendChild(t);let r=0;function n(i){if(e()){if(r){let a=1e3/(i-r);t.textContent=`${a.toFixed(1)} fps`}r=i}else r=i;requestAnimationFrame(n)}requestAnimationFrame(n)}Qc();async function xW(e){let t=await crypto.subtle.digest("SHA-256",new TextEncoder().encode("insight"+e));return Array.from(new Uint8Array(t)).map(r=>r.toString(16).padStart(2,"0")).join("")}function FC(e){let t=typeof process<"u"&&process.env.OTEL_ENDPOINT||typeof window<"u"&&window.OTEL_ENDPOINT||typeof import.meta<"u"&&import.meta.env.VITE_OTEL_ENDPOINT;if(!t)return{recordRun(){},recordShare(){}};let r="telemetryConsent",n=!1;try{localStorage.getItem(r)}catch(g){console.warn("telemetry disabled",g),n=!0}function i(g){if(n)return null;try{return localStorage.getItem(g)}catch(x){return console.warn("telemetry disabled",x),n=!0,null}}function a(g,x){if(!n)try{localStorage.setItem(g,x)}catch(b){console.warn("telemetry disabled",b),n=!0}}let o=i(r);if(o===null){let g=typeof e=="function"?e("telemetry_consent"):"Allow anonymous telemetry?";o=window.confirm(g)?"true":"false",a(r,o)}let s=!n&&o==="true",u="telemetryQueue",l={ts:Date.now(),session:"",generations:0,shares:0},c=100,f;try{f=JSON.parse(i(u)||"[]")}catch{f=[]}f.length>c&&f.splice(0,f.length-c);let p=(async()=>{let g=i("telemetrySession");g||(g=await xW(crypto.randomUUID()),a("telemetrySession",g)),l.session=g||""})();async function d(){if(!(!s||n)){for(await p;f.length&&navigator.onLine;){let g=f[0];if(navigator.sendBeacon(t,JSON.stringify(g)))f.shift();else try{await fetch(t,{method:"POST",mode:"no-cors",body:JSON.stringify(g)}),f.shift()}catch{break}}a(u,JSON.stringify(f))}}function m(){if(!(!s||n)){for(l.ts=Date.now();f.length>=c;)f.shift();f.push({...l}),a(u,JSON.stringify(f)),d()}}return window.addEventListener("beforeunload",m),window.addEventListener("online",()=>void d()),d(),{recordRun(g){s&&(l.generations+=g)},recordShare(){s&&(l.shares+=1)}}}function Jc(e){function t(){return e=Math.imul(1664525,e)+1013904223>>>0,e/2**32}return t.state=()=>e,t.set=r=>{e=r>>>0},t}function GC(e,t=10){if(!e.length)return 0;let r=new Array(t*t).fill(0);for(let i of e){let a=Math.max(0,Math.min(t-1,Math.floor((i.logic??0)*t))),o=Math.max(0,Math.min(t-1,Math.floor((i.feasible??0)*t)));r[o*t+a]+=1}let n=e.length;return-r.reduce((i,a)=>{if(!a)return i;let o=a/n;return i+o*Math.log2(o)},0)}function Ph(e,t=10){let r=new Map;for(let[s,u]of e){let l=Math.max(0,Math.min(t-1,Math.floor(s*t))),c=Math.max(0,Math.min(t-1,Math.floor(u*t))),f=`${l}-${c}`;r.set(f,(r.get(f)||0)+1)}let n=1/0,i="0-0";for(let s=0;s<t;s++)for(let u=0;u<t;u++){let l=`${s}-${u}`,c=r.get(l)||0;c<n&&(n=c,i=l)}let[a,o]=i.split("-").map(Number);return{x:a,y:o,count:n}}Qc();var Uh=class{constructor(t="insight-archive"){this.name=t;An(this,"runStore");An(this,"evalStore");An(this,"disabled",!1);this.runStore=nc(this.name,"runs"),this.evalStore=nc(this.name,"evals")}async open(){if(await this.runStore.dbp,await this.evalStore.dbp,!this.disabled){if(typeof document<"u"&&typeof document.hasStorageAccess=="function")try{await(document.hasStorageAccess?.()??Promise.resolve(!1))||(this.runStore.memory=new Map,this.evalStore.memory=new Map)}catch{this.runStore.memory=new Map,this.evalStore.memory=new Map}if(this.runStore.memory||this.evalStore.memory){this.disabled=!0;let t=window.toast;typeof t=="function"&&t("Archive disabled (no storage access)")}}}_vector(t){if(!t.length)return[0,0];let r=t.reduce((i,a)=>i+(a.logic??0),0)/t.length,n=t.reduce((i,a)=>i+(a.feasible??0),0)/t.length;return[r,n]}_dist(t,r){return Math.hypot(t[0]-r[0],t[1]-r[1])}async _novelty(t,r=5){let n=await this.list();if(!n.length)return 0;let i=n.map(o=>this._dist(t,this._vector(o.paretoFront)));i.sort((o,s)=>o-s);let a=Math.min(r,i.length);return i.slice(0,a).reduce((o,s)=>o+s,0)/a}async add(t,r,n,i=[],a=""){await this.open();let o=this._vector(n),s=(o[0]+o[1])/2,u=await this._novelty(o),l=0;try{if(localStorage.getItem("OPENAI_API_KEY")){let d=await Zc(`Estimate economic impact for: ${JSON.stringify(n)}`),m=parseFloat(d);Number.isNaN(m)||(l=m)}}catch{l=0}let c=s+l,f=typeof crypto.randomUUID=="function"?crypto.randomUUID():String(Date.now()),p={id:f,seed:t,params:r,paretoFront:n,parents:i,evalId:a,score:s,impactScore:c,novelty:u,timestamp:Date.now()};try{await _u(f,p,this.runStore)}catch(d){if(d?.name==="QuotaExceededError"){await this.prune();let m=window.toast;typeof m=="function"&&m("Archive full; oldest runs pruned"),await _u(f,p,this.runStore)}else throw d}return await this.prune(50),f}async list(){await this.open();let t=await xu(this.runStore);return t.sort((r,n)=>r.timestamp-n.timestamp),t}async addEvaluator(t){await this.open();let r=typeof crypto.randomUUID=="function"?crypto.randomUUID():String(Date.now());return await _u(r,{id:r,genome:t},this.evalStore),r}async listEvaluators(){return await this.open(),await xu(this.evalStore)}async prune(t=50){let r=await this.list();if(r.length<=t)return;r.sort((s,u)=>u.score+u.novelty-(s.score+s.novelty)||u.timestamp-s.timestamp);let n=r.slice(0,t),i=r.slice(t);for(let s of i)try{await G0(s.id,this.runStore)}catch(u){if(u instanceof DOMException)console.warn("Failed to delete run",s.id,u);else throw u}let a=new Set(n.map(s=>s.evalId)),o=await xu(this.evalStore);for(let s of o.filter(u=>!a.has(u.id)))try{await G0(s.id,this.evalStore)}catch(u){if(u instanceof DOMException)console.warn("Failed to delete evaluator",s.id,u);else throw u}}async selectParents(t,r=1,n=1,i=Math.random){let a=await this.list();if(!a.length)return[];let o=a.map(b=>Math.exp(r*(b.impactScore??b.score))),s=a.map(b=>Math.exp(n*b.novelty)),u=o.reduce((b,y)=>b+y,0),l=s.reduce((b,y)=>b+y,0),c=a.map(b=>this._vector(b.paretoFront)),f=Ph(c),p=10,d=c.map(([b,y])=>{let E=Math.floor(b*p),$=Math.floor(y*p);return E===f.x&&$===f.y?2:1}),m=a.map((b,y)=>o[y]/u*(s[y]/l)*d[y]),g=m.reduce((b,y)=>b+y,0);for(let b=0;b<m.length;b++)m[b]/=g;let x=[];for(let b=0;b<Math.min(t,a.length);b++){let y=i(),E=0;for(;E<m.length&&!(y<m[E]);E++)y-=m[E];x.push(a[E])}return x}};var $W="sectorTaxonomy",ef="nodes",tf="meta",tw="version",rw=1;function EW(){return new Promise((e,t)=>{let r=indexedDB.open($W,1);r.onupgradeneeded=()=>{let n=r.result;n.objectStoreNames.contains(ef)||n.createObjectStore(ef),n.objectStoreNames.contains(tf)||n.createObjectStore(tf)},r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error)})}function Xu(e,t,r){return EW().then(n=>new Promise((i,a)=>{let o=n.transaction(t,e),s=o.objectStore(t),u=r(s);o.oncomplete=()=>i(u.result),o.onerror=()=>a(o.error)}))}async function nw(e){await Xu("readwrite",ef,t=>{t.clear();for(let r of Object.values(e.nodes))t.put(r,r.id);return t.put(0,"__dummy__")}),await Xu("readwrite",tf,t=>t.put(rw,tw))}async function qC(){if(await Xu("readonly",tf,n=>n.get(tw))!==rw)return await Xu("readwrite",ef,n=>(n.clear(),n.put(0,"__dummy__"))),await Xu("readwrite",tf,n=>n.put(rw,tw)),{nodes:{}};let t=await Xu("readonly",ef,n=>n.getAll())||[],r={nodes:{}};for(let n of t)n&&n.id&&(r.nodes[n.id]={id:n.id,parent:n.parent??null});return r}function WC(e){return e.toLowerCase().split(/[^a-z0-9]+/).filter(t=>t)}function HC(e){let t={};for(let r of e)t[r]=(t[r]||0)+1;return t}function SW(e,t){let r=0,n=0,i=0;for(let a in e)r+=(e[a]||0)*(t[a]||0),n+=e[a]*e[a];for(let a in t)i+=t[a]*t[a];return!n||!i?0:r/Math.sqrt(n*i)}function TW(e,t){let r=new Set([...e].filter(i=>t.has(i))).size,n=new Set([...e,...t]).size;return n?r/n:0}function AW(e,t=.6){let r={};e.forEach((o,s)=>{for(let u of o.keywords||[])r[u]=r[u]||new Set,r[u].add(String(s))});let n=Object.keys(r),i=[],a=new Set;for(let o=0;o<n.length;o++){let s=n[o];if(a.has(s))continue;let u=[s];a.add(s);for(let l=o+1;l<n.length;l++){let c=n[l];a.has(c)||TW(r[s],r[c])>=t&&(u.push(c),a.add(c))}i.push(u)}return i}async function kW(e){try{let{chat:t}=await Promise.resolve().then(()=>(VC(),jC)),r=await t(`Does '${e}' denote a distinct economic activity?`);return/^yes/i.test(String(r).trim())}catch{return!1}}function IW(e,t){let r=HC(WC(e)),n=null,i=0;for(let a of Object.values(t.nodes)){if(!a.id)continue;let o=SW(r,HC(WC(a.id)));o>i&&(i=o,n=a.id)}return[n,i]}async function XC(e,t){let r=AW(e,.6);for(let n of r){let i=n.join(" ");if(t.nodes[i]||!await kW(i))continue;let[a,o]=IW(i,t);a&&o>.9||(t.nodes[i]={id:i,parent:o>.3?a:null})}return await nw(t),t}var CW="memeplex",Fh="memes";function OW(){return new Promise((e,t)=>{let r=indexedDB.open(CW,1);r.onupgradeneeded=()=>{let n=r.result;n.objectStoreNames.contains(Fh)||n.createObjectStore(Fh)},r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error)})}function KC(e,t){return OW().then(r=>new Promise((n,i)=>{let a=r.transaction(Fh,e),o=a.objectStore(Fh),s=t(o);a.oncomplete=()=>n(s.result),a.onerror=()=>i(a.error)}))}function YC(e,t=2){let r={};for(let i of e){let a=new Set;for(let o of i.edges){let s=`${o.from}->${o.to}`;a.has(s)||(r[s]=(r[s]||0)+1,a.add(s))}}let n=[];for(let[i,a]of Object.entries(r))if(a>=t){let[o,s]=i.split("->");n.push({edges:[{from:o,to:s}],count:a})}return n}async function ZC(e){await KC("readwrite",t=>{t.clear();for(let r of e)t.put(r,`${r.edges[0].from}->${r.edges[0].to}`);return t.put({},"__dummy__")})}async function QC(){return(await KC("readonly",t=>t.getAll())||[]).filter(t=>t&&t.edges)}function JC(e){return e.toLowerCase().split(/[^a-z0-9]+/).filter(t=>t)}function eO(e){let t=document.createElement("div");t.id="evolution-panel",t.setAttribute("role","region"),t.setAttribute("aria-label","Evolution"),Object.assign(t.style,{position:"fixed",bottom:"10px",left:"10px",background:"rgba(0,0,0,0.7)",color:"#fff",padding:"8px",fontSize:"12px",zIndex:1e3,maxHeight:"40vh",overflowY:"auto"});let r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("width","200"),r.setAttribute("height","100");let n=document.createElement("div");n.id="taxonomy-tree";let i=document.createElement("table"),a=document.createElement("tr"),o=[["seed",Ut("seed")],["score",Ut("score")],["novelty",Ut("novelty")],["timestamp",Ut("time")]];for(let[x,b]of o){let y=document.createElement("th");y.dataset.k=x,y.textContent=b,a.appendChild(y)}a.appendChild(document.createElement("th")),i.appendChild(a);let s=document.createElement("div");s.id="meme-cloud",t.appendChild(n),t.appendChild(r),t.appendChild(i),t.appendChild(s),document.body.appendChild(t);let u="timestamp",l=!0,c=null,f=null;a.querySelectorAll("th[data-k]").forEach(x=>{x.style.cursor="pointer",x.onclick=()=>{let b=x.dataset.k??"timestamp";u===b?l=!l:(u=b,l=!0),g()}});function p(x){let b=new URLSearchParams(window.location.hash.replace(/^#\/?/,""));b.set("s",String(x)),window.location.hash="#/"+b.toString()}function d(x){for(;r.firstChild;)r.firstChild.remove();let b=new Map;x.forEach((y,E)=>{let $=20+E*20,k=20;b.set(y.id,{x:$,y:k});let R=document.createElementNS("http://www.w3.org/2000/svg","circle");R.setAttribute("cx",String($)),R.setAttribute("cy",String(k)),R.setAttribute("r","4"),R.setAttribute("fill","white"),r.appendChild(R)}),x.forEach(y=>{let E=b.get(y.id);if(E)for(let $ of y.parents||[]){let k=b.get($);if(!k)continue;let R=document.createElementNS("http://www.w3.org/2000/svg","line");R.setAttribute("x1",String(k.x)),R.setAttribute("y1",String(k.y)),R.setAttribute("x2",String(E.x)),R.setAttribute("y2",String(E.y)),R.setAttribute("stroke","white"),r.appendChild(R)}})}async function m(){c=await qC();let x=await e.list();await XC(x.map($=>({keywords:$.params?.keywords||JC($.params?.sector||"")})),c),await nw(c),n.replaceChildren();let b=c?.nodes??{};function y($){let k=Object.values(b).filter(C=>C.parent===$);if(!k.length)return null;let R=document.createElement("ul");for(let C of k){let P=document.createElement("li"),W=document.createElement("button");W.textContent=C.id,W.onclick=()=>{f=C.id,g()},P.appendChild(W);let te=y(C.id);te&&P.appendChild(te),R.appendChild(P)}return R}let E=y(null);E&&n.appendChild(E)}async function g(){let x=await e.list();if(f){let y=JC(f);x=x.filter(E=>{if(E.params?.sector===f)return!0;let $=E.params?.keywords||[];return y.every(k=>$.includes(k))})}x.sort((y,E)=>l?E[u]-y[u]:y[u]-E[u]),i.querySelectorAll("tr").forEach((y,E)=>{E&&y.remove()}),x.forEach(y=>{let E=document.createElement("tr"),$=new Date(y.timestamp).toLocaleTimeString(),k=[String(y.seed),y.score.toFixed(2),y.novelty.toFixed(2),$];for(let P of k){let W=document.createElement("td");W.textContent=P,E.appendChild(W)}let R=document.createElement("td"),C=document.createElement("button");C.textContent=Ut("respawn"),C.onclick=()=>p(y.seed),R.appendChild(C),E.appendChild(R),i.appendChild(E)}),d(x);let b=await QC();s.replaceChildren(),b.sort((y,E)=>E.count-y.count).forEach(y=>{let E=document.createElement("span");E.style.fontSize=`${10+y.count*2}px`,E.style.marginRight="4px",E.textContent=`${y.edges[0].from}->${y.edges[0].to} (${y.count})`,s.appendChild(E)})}return m(),{render:g}}function tO(e,t,r,n=0,i=!1,a=1,o=!1){let s=f=>Math.min(1,Math.max(0,f)),u=[];function l(){if(!i)return!1;let f=e.reduce((g,x)=>g+(x.logic??0),0)/e.length,p=e.reduce((g,x)=>g+(x.feasible??0),0)/e.length,d=e.reduce((g,x)=>g+Math.pow((x.logic??0)-f,2),0)/e.length,m=e.reduce((g,x)=>g+Math.pow((x.feasible??0)-p,2),0)/e.length;return d+m<.001}let c=l();for(let f of e)for(let p of r)switch(p){case"gaussian":{let d=.12*Math.log1p(f.horizonYears||0)*a;c&&(d*=.5),u.push({logic:s(f.logic+(t()-.5)*d),feasible:s(f.feasible+(t()-.5)*d),strategy:p,depth:n,horizonYears:f.horizonYears})}break;case"swap":{let d=e[Math.floor(t()*e.length)];u.push({logic:d.logic,feasible:f.feasible,strategy:p,depth:n,horizonYears:f.horizonYears});break}case"jump":u.push({logic:t(),feasible:t(),strategy:p,depth:n,horizonYears:f.horizonYears});break;case"scramble":{let d=e[Math.floor(t()*e.length)];u.push({logic:f.logic,feasible:d.feasible,strategy:p,depth:n,horizonYears:f.horizonYears});break}}return e.concat(u)}async function ys(e){return new Promise(t=>{let r=new Blob([`import "${e.toString()}";`],{type:"text/javascript"}),n=URL.createObjectURL(r),i=`<script>
let w;
window.addEventListener('message',e=>{
  if(e.data.type==='start'){
    w=new Worker(e.data.url,{type:'module'});
    w.onmessage=d=>parent.postMessage(d.data,location.origin);
  }else if(w){
    w.postMessage(e.data);
  }
});
<\/script>`,a=document.createElement("iframe");a.sandbox="allow-scripts",a.style.display="none",a.src=URL.createObjectURL(new Blob([i],{type:"text/html"})),document.body.appendChild(a);let o={postMessage:u=>a.contentWindow.postMessage(u,location.origin),terminate(){a.remove(),URL.revokeObjectURL(a.src),URL.revokeObjectURL(n),window.removeEventListener("message",s)},onmessage:null},s=u=>{u.source===a.contentWindow&&u.origin===location.origin&&o.onmessage&&o.onmessage(u)};window.addEventListener("message",s),a.onload=()=>{a.contentWindow.postMessage({type:"start",url:n},location.origin),t(o)}})}var Gh=class{static async*run(t){let r={mutations:["gaussian"],seeds:[1],critic:"none",...t},n=Jc(r.seeds[0]),i=null,a=null,o=r.horizonYears??r.generations,s=Array.from({length:r.popSize},()=>({logic:n(),feasible:n(),strategy:"base",depth:0,horizonYears:o,front:!1}));for(let u=0;u<r.generations;u++){let l=[],c={avgLogic:0,avgFeasible:0,frontSize:0};if(r.workerUrl&&typeof Worker<"u"){i||(i=await ys(r.workerUrl));let f=await new Promise(p=>{if(!i)return p({pop:s,rngState:n.state(),front:[],metrics:c});i.onmessage=d=>p(d.data),i.postMessage({pop:s,rngState:n.state(),mutations:r.mutations,popSize:r.popSize,critic:r.critic,gen:u+1})});s=f.pop,n.set(f.rngState),l=f.front,c=f.metrics}else s=tO(s,n,r.mutations??["gaussian"],u+1,r.adaptive),l=Ho(s),s.forEach(f=>f.front=l.includes(f)),s=l.concat(s.slice(0,r.popSize-10)),c={avgLogic:s.reduce((f,p)=>f+(p.logic??0),0)/s.length,avgFeasible:s.reduce((f,p)=>f+(p.feasible??0),0)/s.length,frontSize:l.length};r.umapWorkerUrl&&typeof Worker<"u"&&(u+1)%3===0&&(a||(a=await ys(r.umapWorkerUrl)),s=await new Promise(f=>{if(!a)return f(s);a.onmessage=p=>f(p.data),a.postMessage({population:s})})),yield{gen:u+1,population:s,fronts:l,metrics:c}}i&&i.terminate(),a&&a.terminate()}};var nO="replay",jh="frames";function iO(){return new Promise((e,t)=>{let r=indexedDB.open(nO,1);r.onupgradeneeded=()=>{let n=r.result;n.objectStoreNames.contains(jh)||n.createObjectStore(jh)},r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error)})}function rO(e,t){return iO().then(r=>new Promise((n,i)=>{let a=r.transaction(jh,e),o=a.objectStore(jh),s=t(o);a.oncomplete=()=>n(s.result),a.onerror=()=>i(a.error)}))}var Vh=class e{constructor(t=nO){this.name=t}async open(){await iO()}async addFrame(t,r){let n=globalThis.crypto?.randomUUID,i=typeof n=="function"?parseInt(n.call(globalThis.crypto).replace(/-/g,"").slice(0,13),16):Date.now()+Math.floor(Math.random()*1e3),a={id:i,parent:t,delta:r,timestamp:Date.now()};return await rO("readwrite",o=>o.put(a,i)),i}async getFrame(t){return rO("readonly",r=>r.get(t))}async exportThread(t){let r=[],n=t;for(;n;){let i=await this.getFrame(n);if(!i)break;r.unshift(i),n=i.parent}return r}static async cidForFrames(t){let r=t.map(a=>a.delta),n=new TextEncoder().encode(JSON.stringify(r)),i=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(i)).map(a=>a.toString(16).padStart(2,"0")).join("")}async computeCid(t){let r=await this.exportThread(t);return e.cidForFrames(r)}async share(t){let r=await this.exportThread(t),n=await e.cidForFrames(r),i=JSON.stringify(r.map(a=>({parent:a.parent,delta:a.delta})));return{cid:n,data:i}}async importFrames(t){let r=JSON.parse(t),n=null,i=0;for(let a of r)i=await this.addFrame(n,a.delta),n=i;return i}};function aO(e){return Math.min(1,Math.max(0,e))}function oO(e,t=Math.random){let r=aO(e.weights.logic+(t()-.5)*.1),n=aO(e.weights.feasible+(t()-.5)*.1),i=r+n||1;r/=i,n/=i;let a=["innovative","efficient","robust","scalable"],o=e.prompt.split(/\s+/);if(t()<.5&&o.length>1)o.splice(Math.floor(t()*o.length),1);else{let u=a[Math.floor(t()*a.length)];o.splice(Math.floor(t()*(o.length+1)),0,u)}let s=o.join(" ");return{weights:{logic:r,feasible:n},prompt:s}}function aw(e){return typeof globalThis.structuredClone=="function"?globalThis.structuredClone(e):iw(e)}function iw(e){if(e===null||typeof e!="object")return e;if(e instanceof Date)return new Date(e.getTime());if(Array.isArray(e))return e.map(r=>iw(r));let t={};for(let r of Object.keys(e))t[r]=iw(e[r]);return t}async function sO(e,t){let r=document.createElement("div");r.id="simulator-panel",r.setAttribute("role","region"),r.setAttribute("aria-label","Simulator"),Object.assign(r.style,{position:"fixed",bottom:"10px",right:"10px",background:"rgba(0,0,0,0.7)",color:"#fff",padding:"8px",fontSize:"12px",zIndex:1e3}),r.innerHTML=`
    <label>Seeds <input id="sim-seeds" value="1"></label>
    <label>Pop <input id="sim-pop" type="number" min="1" value="50"></label>
    <label>Gen <input id="sim-gen" type="number" min="1" value="10"></label>
    <label>Rate <input id="sim-rate" type="number" step="0.01" value="1"></label>
    <label>
      Heuristic
      <select id="sim-heur">
        <option value="none">none</option>
        <option value="llm">llm</option>
      </select>
    </label>
    <button id="sim-start" aria-label="Start simulation">Start</button>
    <button id="sim-pause" aria-label="Pause simulation">Pause</button>
    <button id="sim-fork" aria-label="Fork simulation">Fork</button>
    <button id="sim-cancel" aria-label="Cancel simulation">Cancel</button>
    <progress id="sim-progress" value="0" max="1" class="w-full" aria-label="Progress"></progress>
    <input id="sim-frame" type="range" min="0" value="0" step="1" class="w-full">
    <div id="sim-status" aria-live="polite" role="status"></div>
    <pre id="sim-inspect" class="max-h-[40vh] overflow-auto"></pre>
  `,document.body.appendChild(r);let n=document.createElement("div");n.id="sim-loader",n.setAttribute("role","status"),n.setAttribute("aria-live","polite"),Object.assign(n.style,{position:"fixed",inset:"0",display:"none",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.5)",zIndex:2e3}),n.innerHTML='<div class="spinner" aria-hidden="true"></div>',document.body.appendChild(n);function i(pe){n.style.display=pe?"flex":"none"}let a=r.querySelector("#sim-seeds"),o=r.querySelector("#sim-pop"),s=r.querySelector("#sim-gen"),u=r.querySelector("#sim-rate"),l=r.querySelector("#sim-heur"),c=r.querySelector("#sim-start"),f=r.querySelector("#sim-pause"),p=r.querySelector("#sim-fork"),d=r.querySelector("#sim-cancel"),m=r.querySelector("#sim-progress"),g=r.querySelector("#sim-frame"),x=r.querySelector("#sim-status"),b=r.querySelector("#sim-inspect"),y=null,E=[],$=[],k=!1,R=new Vh("sim-replay");await R.open();let C=[],P={weights:{logic:.5,feasible:.5},prompt:"score idea"};function W(pe){let ge=E[pe];if(!ge)return;pop=ge.population,gen=ge.gen,window.DEBUG&&(window.pop=pop);let fe="node"in view?view.node():view;yp(fe,pop,(Me,Ge)=>selectPoint(Me,Ge)),info.textContent=`gen ${ge.gen}`,b&&(b.textContent=JSON.stringify(ge.population,null,2))}g.addEventListener("input",()=>{W(Number(g.value))}),c.addEventListener("click",async()=>{y&&typeof y.return=="function"&&await y.return(void 0),i(!0);let pe=a.value.split(",").map(Me=>Number(Me.trim())).filter(Boolean);C=[],y=Gh.run({popSize:Number(o.value),generations:Number(s.value),mutations:["gaussian"],seeds:pe,workerUrl:"./worker/evolver.js",umapWorkerUrl:"./worker/umapWorker.js",critic:l.value});let ge=0;E=[],$=[],k=!1;let fe=await e.addEvaluator(P);try{let Me=!0;for await(let he of y){for(Me&&(i(!1),Me=!1);k;)await new Promise(Re=>setTimeout(Re,100));let qe=he.population.map(Re=>({from:Re.strategy||"x",to:Re.strategy||"x"}));C.push({edges:qe}),await ZC(YC(C)),E.push({population:aw(he.population),gen:he.gen});let ae=await R.addFrame($[$.length-1]||null,{population:he.population,gen:he.gen});if($.push(ae),ge=he.gen,window.DEBUG&&(window.pop=he.population),window.DEBUG&&he.population[0]&&he.population[0].umap){let Re=he.population.map(ne=>ne.umap);window.coldZone=Ph(Re)}m.value=ge/Number(s.value);let we={gen:ge,frontSize:he.fronts.length};x.textContent=`gen ${we.gen} front ${we.frontSize}`,await e.add(pe[0]??1,{popSize:Number(o.value)},he.fronts,[],fe).catch(()=>{}),t.update(P),P=oO(P),fe=await e.addEvaluator(P)}g.max=String(Math.max(0,E.length-1)),g.value=String(E.length-1),W(E.length-1);let Ge=await R.share($[$.length-1]),He=new File([Ge.data],"replay.json",{type:"application/json"});await Ic([He])&&(x.textContent=`CID: ${Ge.cid}`)}finally{i(!1)}}),d.addEventListener("click",()=>{y&&typeof y.return=="function"&&y.return(void 0)}),f.addEventListener("click",()=>{k=!k,f.textContent=k?"Resume":"Pause"}),p.addEventListener("click",async()=>{let pe=Number(g.value),ge=$[pe];if(!ge)return;let fe=await R.share(ge);window.open(`#cid=${fe.cid}`,"_blank")});let ce=new URLSearchParams(window.location.hash.replace(/^#\/?/,"")).get("cid");if(ce){let pe=(window.IPFS_GATEWAY||"https://ipfs.io/ipfs").replace(/\/$/,"");fetch(`${pe}/${ce}`).then(ge=>ge.text()).then(async ge=>{x.textContent="replaying...",E=[],$=[];try{let fe=await R.importFrames(ge),Me=await R.exportThread(fe);E=Me.map(Ge=>({population:Ge.delta.population,gen:Ge.delta.gen})),$=Me.map(Ge=>Ge.id),g.max=String(Math.max(0,E.length-1)),g.value="0",W(0)}catch{}}).catch(()=>{})}return r}Qc();function uO(){let e=document.createElement("div");e.id="power-panel",e.setAttribute("role","region"),e.setAttribute("aria-label","Power"),Object.assign(e.style,{position:"fixed",top:"10px",left:"10px",background:"rgba(0,0,0,0.7)",color:"#fff",padding:"8px",fontSize:"12px",zIndex:1e3,whiteSpace:"pre"});let t=document.createElement("pre"),r=document.createElement("label"),n=document.createElement("input");n.type="checkbox",n.id="gpu-toggle",n.setAttribute("aria-label","Use GPU"),r.appendChild(n),r.append(" GPU ");let i=document.createElement("span");i.id="gpu-status",i.textContent=Lh?"(available)":"(unavailable)",r.appendChild(i),e.appendChild(r);let a=document.createElement("label"),o=document.createElement("select");o.id="api-mode";let s=document.createElement("option");s.value="offline",s.textContent="Run Offline";let u=document.createElement("option");u.value="api",u.textContent="Run with OpenAI API",o.append(s,u),a.appendChild(o),e.appendChild(a),e.appendChild(t);try{let c=localStorage.getItem("USE_GPU");n.checked=c!=="0"}catch{n.checked=!0}window.USE_GPU=n.checked&&!!navigator.gpu,Dh(window.USE_GPU),n.addEventListener("change",()=>{window.USE_GPU=n.checked&&!!navigator.gpu,Dh(window.USE_GPU)});try{o.value=ew()?"offline":"api"}catch{o.value="offline"}Mh(o.value==="offline"),o.addEventListener("change",()=>{if(!(o.value==="offline")&&!localStorage.getItem("OPENAI_API_KEY")){let f=prompt("Enter OpenAI API key");if(f)try{localStorage.setItem("OPENAI_API_KEY",f)}catch{}else o.value="offline"}Mh(o.value==="offline")}),document.body.appendChild(e);function l(c){t.textContent=JSON.stringify(c,null,2)}return{update:l,gpuToggle:n,modeSelect:o}}function lO(){let e=document.createElement("div");e.id="analytics-panel",e.setAttribute("role","region"),e.setAttribute("aria-label","Analytics"),Object.assign(e.style,{position:"fixed",top:"10px",right:"220px",background:"rgba(0,0,0,0.7)",color:"#fff",padding:"4px",fontSize:"12px",zIndex:1e3});let t=document.createElement("div"),r=document.createElement("span");r.id="heap",r.style.marginRight="4px",r.setAttribute("aria-live","polite");let n=document.createElement("span");n.id="worker-time",n.style.marginRight="4px",n.setAttribute("aria-live","polite");let i=document.createElement("span");i.id="fps-value",i.setAttribute("aria-live","polite"),t.appendChild(r),t.appendChild(n),t.appendChild(i),e.appendChild(t);let a=document.createElement("div"),o=document.createElement("button");o.textContent="Enable telemetry";let s=document.createElement("button");s.textContent="Disable telemetry";let u=document.createElement("button");u.textContent="Show logs";let l=document.createElement("button");l.textContent=Ut("download_log");let c=document.createElement("pre");c.style.display="none",a.appendChild(o),a.appendChild(s),a.appendChild(u),a.appendChild(l),a.appendChild(c),e.appendChild(a);let f=document.createElement("canvas");f.width=200,f.height=100,e.appendChild(f),document.body.appendChild(e);let p=f.getContext("2d"),d=[],m=0,g=0;o.addEventListener("click",()=>{localStorage.setItem("telemetryConsent","true"),location.reload()}),s.addEventListener("click",()=>{localStorage.setItem("telemetryConsent","false"),location.reload()}),u.addEventListener("click",()=>{let y=localStorage.getItem("telemetryQueue")||"[]";c.textContent=y,c.style.display=c.style.display==="none"?"block":"none"}),l.addEventListener("click",()=>{let y=localStorage.getItem("errorLog")||"[]",E=new Blob([y],{type:"application/json"}),$=document.createElement("a");$.href=URL.createObjectURL(E),$.download="error-log.json",$.click(),URL.revokeObjectURL($.href)});function x(y,E,$){if(!p)return;d.push($),d.length>f.width&&d.shift();let k=new Map;for(let ce of y){let pe=Math.round(ce.horizonYears||0);k.set(pe,(k.get(pe)||0)+1)}let R=Array.from(k.keys()).sort((ce,pe)=>ce-pe),C=Math.max(...k.values(),1);p.clearRect(0,0,f.width,f.height);let P=f.width/R.length;R.forEach((ce,pe)=>{let ge=k.get(ce)||0,fe=(f.height-15)*(ge/C);p.fillStyle="steelblue",p.fillRect(pe*P,f.height-fe,P-2,fe),p.fillStyle="#fff",p.fillText(String(ce),pe*P+P/2-4,f.height-2)}),p.fillStyle="#fff",p.fillText(`gen ${E}`,4,10),p.beginPath(),p.strokeStyle="yellow";let W=Math.log2(100);if(d.forEach((ce,pe)=>{let ge=pe/(d.length-1||1)*f.width,fe=f.height-15-ce/W*(f.height-20);pe?p.lineTo(ge,fe):p.moveTo(ge,fe)}),p.stroke(),performance.memory){let ce=performance.memory.usedJSHeapSize/1048576;r.textContent=`mem ${ce.toFixed(1)} MB`}let te=document.getElementById("fps-meter")?.textContent||"";i.textContent=te,n.textContent=`worker ${m.toFixed(1)} ms`}function b(y){g+=1,m+=(y-m)/g}return{update:x,recordWorkerTime:b}}function ow(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function cO(e){let t=document.createElement("details");t.id="arena-panel",t.setAttribute("role","region"),t.setAttribute("aria-label","Debate Arena"),Object.assign(t.style,{position:"fixed",bottom:"10px",right:"220px",background:"rgba(0,0,0,0.7)",color:"#fff",padding:"8px",fontSize:"12px",zIndex:1e3,maxHeight:"40vh",overflowY:"auto"});let r=document.createElement("summary");r.textContent=Ut("summary.debateArena");let n=document.createElement("ul");n.id="ranking";let i=document.createElement("div");i.id="debate-panel";let a=document.createElement("ul");i.appendChild(a),t.appendChild(r),t.appendChild(n),t.appendChild(i),document.body.appendChild(t);let o=[];function s(l){o=l,n.innerHTML="",[...l].sort((f,p)=>(p.rank??0)-(f.rank??0)).forEach(f=>{let p=document.createElement("li");p.textContent=`${Ut("label.rank")} ${(f.rank??0).toFixed(1)} `;let d=document.createElement("button");d.textContent=Ut("summary.debate"),d.addEventListener("click",()=>e?.(f)),p.appendChild(d),n.appendChild(p)})}function u(l,c){a.innerHTML="",l.forEach(p=>{let d=document.createElement("li");d.innerHTML=`<strong>${ow(p.role)}:</strong> ${ow(p.text)}`,a.appendChild(d)});let f=document.createElement("li");f.textContent=`${Ut("label.score")}: ${c}`,a.appendChild(f),t.open=!0}return{render:s,show:u}}var xa=[],sw=50;function Wh(e,t=!1){xa.push(e),xa.length>sw&&xa.shift();try{localStorage.setItem("errorLog",JSON.stringify(xa))}catch{}!t&&window.toast&&window.toast(e.message?String(e.message):Ut("error_unknown"))}function fO(){try{xa=JSON.parse(localStorage.getItem("errorLog")||"[]")}catch{xa=[]}xa.length>sw&&(xa=xa.slice(-sw)),window.onerror=(e,t,r,n,i)=>{Wh({type:"error",message:String(e),url:t||"",line:r||0,column:n||0,stack:i&&i.stack,ts:Date.now()})},window.onunhandledrejection=e=>{let t=e.reason||{};Wh({type:"unhandledrejection",message:t.message?String(t.message):String(t),stack:t.stack,ts:Date.now()})}}var rf,qh,dO,pO,cw,fw,dw,$a,ii,gn,oo,so,bs,mO,uo=!0,ni,pw,hO=!1,gw=0,Ku,hw,uw,ws,nf,lw,Hh;function Mn(e){let t=document.getElementById("toast");t.textContent=e,t.classList.add("show"),clearTimeout(Mn.id),Mn.id=setTimeout(()=>t.classList.remove("show"),2e3)}window.toast=Mn;window.llmChat=Zc;window.addEventListener("message",e=>{e.data&&e.data.type==="error"&&(Wh(e.data,!0),Mn(Ut("worker_error")))});function mw(e){document.documentElement.dataset.theme=e}function BW(){let e=localStorage.getItem("theme");e?mw(e):window.matchMedia("(prefers-color-scheme:light)").matches&&mw("light")}function RW(){let t=(document.documentElement.dataset.theme==="light"?"light":"dark")==="light"?"dark":"light";mw(t),localStorage.setItem("theme",t)}function gO(){d3.select("#canvas").select("svg").remove(),so=d3.select("#canvas").append("svg").attr("viewBox","0 0 500 500").style("touch-action","none"),bs=so.append("g"),mO=so.append("text").attr("x",20).attr("y",30).attr("fill","#fff"),wT(so.node(),bs.node?bs.node():bs)}function yO(e){let t=document.getElementById("legend");t.innerHTML="";for(let r of e){let n=document.createElement("span"),i=document.createElement("i");i.style.background=F$[r],i.style.display="inline-block",i.style.width="10px",i.style.height="10px",i.style.marginRight="4px",n.appendChild(i),n.append(r),t.appendChild(n)}}function zW(){let e=document.getElementById("depth-legend");e.innerHTML="depth";let t=document.createElement("div");t.className="bar",e.appendChild(t)}async function NW(e){$a=e,ii=Jc(e.seed),gn=Array.from({length:e.pop},()=>({logic:ii(),feasible:ii(),strategy:"base",depth:0,horizonYears:e.gen})),oo=0,uo=!0,gO(),hO||(vT(()=>uo),hO=!0),yO(e.mutations),ni&&ni.terminate(),ni=await ys("./worker/evolver.js"),navigator.gpu&&ni.postMessage({type:"gpu",available:window.USE_GPU!==!1}),ni.onmessage=t=>{if(t.data.toast){Mn(t.data.toast);return}ws&&ws.recordWorkerTime(performance.now()-gw),gn=t.data.pop,ii.set(t.data.rngState),requestAnimationFrame(af)},af()}function LW(e,t){let r={logic:e.logic??0,feasible:e.feasible??0};fw&&dw&&(r.logicCritic=fw.score(`${e.logic}`),r.feasCritic=dw.score(`${e.feasible}`),r.average=(r.logicCritic+r.feasCritic)/2),cw&&cw.show(r,t)}function af(){mO.text(`gen ${oo}`);let e=Ho(gn),t=GC(e);window.entropy=t,yp(bs.node?bs.node():bs,gn,LW),nf&&nf.render(e);let r=Math.max(...gn.map(o=>o.depth||0));if(zW(r),ws&&ws.update(gn,oo,t),Ku.add($a.seed,$a,e,[],0).then(()=>hw.render()).catch(()=>{}),!uo)return;if(oo++>=$a.gen){ni.terminate();return}let n=1.5,i=2.5,a=1;if(t<n)for(let o=0;o<5;o++)gn.push({logic:ii(),feasible:ii(),strategy:"rand",depth:oo,horizonYears:$a.gen});else t>i&&(a=.5);pw.recordRun(1),gw=performance.now(),ni.postMessage({pop:gn,rngState:ii.state(),mutations:$a.mutations,popSize:$a.pop,gen:oo,adaptive:$a.adaptive,sigmaScale:a})}function DW(){uo=!uo,qh.textContent=uo?Ut("pause"):Ut("resume"),uo&&requestAnimationFrame(af)}async function MW(){gn.gen=oo;let e=V0(gn,ii.state()),t=new Blob([e],{type:"application/json"}),r=document.createElement("a");if(r.href=URL.createObjectURL(t),r.download="state.json",r.click(),URL.revokeObjectURL(r.href),window.PINNER_TOKEN){let n=new File([e],"state.json",{type:"application/json"});await Ic([n])}}function PW(e){let t=K$(e),r=document.createElement("a");r.href=URL.createObjectURL(new Blob([t],{type:"text/csv"})),r.download="population.csv",r.click(),URL.revokeObjectURL(r.href)}async function UW(){if(!so)return;let e=await Y$((so.node,so.node())),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="frontier.png",t.click(),URL.revokeObjectURL(t.href)}async function FW(e){try{let t=q$(e);gn=t.pop,oo=t.gen,ii=Jc(0),ii.set(t.rngState),uo=!0,qh.textContent=Ut("pause"),gO(),yO($a.mutations),ni&&ni.terminate(),ni=await ys("./worker/evolver.js"),navigator.gpu&&ni.postMessage({type:"gpu",available:window.USE_GPU!==!1}),ni.onmessage=r=>{if(r.data.toast){Mn(r.data.toast);return}ws&&ws.recordWorkerTime(performance.now()-gw),gn=r.data.pop,ii.set(r.data.rngState),requestAnimationFrame(af)},af(),Mn(Ut("state_loaded"))}catch{Mn(Ut("invalid_file"))}}function GW(e,t={}){t.popClamped&&Mn("max population is 500"),t.genClamped&&Mn("max generations is 500"),location.hash=C2(e)}window.addEventListener("DOMContentLoaded",async()=>{fO(),await B2();let e=document.getElementById("disclaimer");if(e&&(e.textContent=Ut("disclaimer")),pw=FC(),Ku=new Uh,typeof document.hasStorageAccess=="function")try{await document.hasStorageAccess()}catch{}await Ku.open(),hw=eO(Ku),uw=uO(),uw.update({gpu:!!navigator.gpu,use:window.USE_GPU}),await sO(Ku,uw),ws=lO(),nf=cO(l=>{Hh=l;let c=l.summary||`logic ${l.logic}`;lw.postMessage({hypothesis:c})}),lw=await ys("./worker/arenaWorker.js"),lw.onmessage=l=>{let{messages:c,score:f}=l.data;Hh&&(Hh.rank=(Hh.rank||0)+f,gn.sort((p,d)=>(p.rank||0)-(d.rank||0))),nf.show(c,f),nf.render(Ho(gn))},await hw.render(),window.archive=Ku,BW();let t=await W$();fw=new ic(t),dw=new $u(t),cw=V$(),rf=z2(rg(),GW),qh=rf.pauseBtn,dO=rf.exportBtn,pO=rf.dropZone;let r=document.getElementById("toolbar"),n=document.createElement("button");n.textContent=Ut("csv"),n.setAttribute("aria-label","Export CSV");let i=document.createElement("button");i.textContent=Ut("png"),i.setAttribute("aria-label","Download PNG");let a=document.createElement("button");a.textContent=Ut("share"),a.setAttribute("aria-label","Share simulation");let o=document.createElement("button");o.textContent=Ut("theme"),o.setAttribute("aria-label","Toggle theme"),r.appendChild(n),r.appendChild(i),r.appendChild(a),r.appendChild(o);let s=document.getElementById("install-btn"),u=null;window.addEventListener("beforeinstallprompt",l=>{l.preventDefault(),u=l,s.hidden=!1}),s.addEventListener("click",async()=>{if(u){s.hidden=!0,u.prompt();try{await u.userChoice}catch{}u=null}}),window.addEventListener("appinstalled",()=>{s.hidden=!0,u=null}),n.addEventListener("click",()=>PW(gn)),i.addEventListener("click",UW),a.addEventListener("click",async()=>{pw.recordShare();let l=location.origin+location.pathname+location.hash,c=null;if(window.PINNER_TOKEN){let f=V0(gn,ii.state()),p=new File([f],"state.json",{type:"application/json"});c=await Ic([p])}if(c&&c.url){if(navigator.clipboard)try{await navigator.clipboard.writeText(c.url)}catch{}Mn(`pinned ${c.cid}`)}else{if(navigator.clipboard)try{await navigator.clipboard.writeText(l)}catch{}Mn(Ut("link_copied"))}}),o.addEventListener("click",RW),qh.addEventListener("click",DW),dO.addEventListener("click",MW),X$(pO,FW),window.dispatchEvent(new HashChangeEvent("hashchange"))});window.addEventListener("hashchange",()=>{let e=rg();rf.setValues(e),NW(e),Mn(Ut("simulation_restarted"))});
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
/*! Bundled license information:

onnxruntime-web/dist/ort.bundle.min.mjs:
  (*!
   * ONNX Runtime Web v1.22.0
   * Copyright (c) Microsoft Corporation. All rights reserved.
   * Licensed under the MIT License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2019 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
*/
