<!-- SPDX-License-Identifier: Apache-2.0 -->
<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; connect-src 'self' https://api.openai.com; script-src 'self' 'wasm-unsafe-eval' 'sha384-J1kfFaEtujKM8se2onx8/tKv/t+AcMkKMUSD751Op4IiE2IiCdlpHaiBB/UlIIgd' 'sha384-wmBbMOjwxvJ39aarpffMTUEI3kl5FrgDlzNQUmksWmpx939OHQPRuMBvHNQp/teR' 'sha384-xyOrMcGpWfDPVGBHGXerLldyHc9zBtbly/pQwtfnF/5e88JaBhd3+Nhs42y2wWYL' 'sha384-EAF2mNlEm60Ms1ZoKs8ETPX/YGxVsMrI9V9Nr2P0ko17g34rLf4Na/+e/e4BU/c/'; style-src 'self'; object-src 'none'; base-uri 'self'"
    />
    <title>α-AGI Insight</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css" integrity="sha384-FZHX33gxg4Y5WP2db5B78m4ZkVZAb6kfNPQaH5FrPEvGbeXjhuZsN3UpsXxKpxJ9" crossorigin="anonymous" />
    <link rel="icon" href="assets/favicon.svg" />
  </head>

  <body class="flex flex-col h-screen">
    <header class="p-4 bg-base-100/70 backdrop-blur-md">
      <div class="max-w-4xl mx-auto">
        <h1
          class="text-5xl font-bold bg-gradient-to-r from-purple-400 via-pink-500 to-red-500 bg-clip-text text-transparent animate-gradient"
        >
          α-AGI Insight
        </h1>
      </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
      <aside
        id="controls"
        class="w-64 bg-base-100/70 backdrop-blur-md p-4 overflow-y-auto"
        role="region"
        aria-label="Controls"
      ></aside>
      <main
        id="canvas"
        class="flex-1 relative overflow-hidden"
        role="main"
        data-testid="app"
      ></main>
      <aside
        id="log"
        class="w-80 bg-base-100/70 backdrop-blur-md p-4 overflow-y-auto"
        aria-label="Log"
        role="region"
      ></aside>
    </div>

    <div id="toast" class="toast" aria-live="polite" role="status"></div>

    <div id="toolbar" role="toolbar" aria-label="App controls">
      <button id="install-btn" hidden aria-label="Install application">Install</button>
    </div>

    <div id="legend" role="region" aria-label="Legend"></div>
    <div id="depth-legend" role="region" aria-label="Depth Legend"></div>

    <footer id="disclaimer" class="text-xs m-4 text-center">
      <a href="../DISCLAIMER_SNIPPET/">See docs/DISCLAIMER_SNIPPET.md</a>
      This repository is a conceptual research prototype. References to "AGI" and "superintelligence" describe aspirational goals
      and do not indicate the presence of a real general intelligence. Use at your own risk. Nothing herein constitutes financial
      advice. MontrealAI and the maintainers accept no liability for losses incurred from using this software.
    </footer>

    <script src="assets/d3.v7.min.js" integrity="sha384-CjloA8y00+1SDAUkjs099PVfnY2KmDC2BZnws9kh8D/lX1s46w6EPhpXdqMfjK6i" crossorigin="anonymous"></script>
    <script src="assets/lib/bundle.esm.min.js" integrity="sha384-qri3JZdkai966TTOV3Cl4xxA97q+qXCgKrd49pOn7DPuYN74wOEd6CIJ9HnqEROD" crossorigin="anonymous"></script>
    <script src="assets/lib/pyodide.js" integrity="sha384-PNUiaEvwfaQJ1qhJmwFD774CUdIYY8k0z7TTAqIzw6fNpx7fG6bzyLb9j6qxSZac" crossorigin="anonymous"></script>

    <script type="importmap">
      {
        "imports": {
          "d3": "./assets/d3.exports.js"
        }
      }
    </script>

    <script>
      // Provide a resilient toast implementation before deferred modules load.
      // The Playwright offline checks rely on these calls not throwing.
      if (typeof window.toast !== 'function') {
        window.toast = (msg) => {
          const t = document.getElementById('toast');
          if (t) {
            t.textContent = msg;
            t.classList.add('show');
            clearTimeout(window.toast.id);
            window.toast.id = window.setTimeout(() => t.classList.remove('show'), 2000);
            return;
          }
          console.warn(msg);
        };
      }
    </script>

    <script>
      const SW_URL = 'sw.js';
      const SW_HASH = 'sha384-kQo+PZJcRiSq81DoHg7dyh+D8v/XRPNke0/dvpo2pT968hYeKRy2hfcZk4KYSIh5';
      const LOCAL_HOSTS = new Set(['localhost', '127.0.0.1']);

      const markInsightReady = () => {
        if (document.documentElement.dataset.insightReady !== '1') {
          document.documentElement.dataset.insightReady = '1';
        }
      };

      if ('serviceWorker' in navigator) {
        window.addEventListener('load', async () => {
          markInsightReady();
          if (LOCAL_HOSTS.has(window.location.hostname)) {
            return;
          }
          try {
            const res = await fetch(SW_URL);
            const buf = await res.arrayBuffer();
            const digest = await crypto.subtle.digest('SHA-384', buf);
            const b64 = btoa(String.fromCharCode(...new Uint8Array(digest)));
            if (`sha384-${b64}` !== SW_HASH) {
              throw new Error('Service worker hash mismatch');
            }

            navigator.serviceWorker.register(SW_URL).then((registration) => {
              navigator.serviceWorker.ready.then(() => {
                registration.addEventListener('updatefound', () => {
                  const newWorker = registration.installing;
                  if (!newWorker) return;

                  newWorker.addEventListener('statechange', () => {
                    if (newWorker.state === 'installed') {
                      window.toast('Update available — reload to use the latest version.');
                    }
                  });
                });
              });
            });
          } catch (err) {
            console.error(err);
            window.toast('Service worker failed: ' + err.message);
          }
        });
      } else {
        markInsightReady();
      }
    </script>

    <script type="module" src="insight.bundle.js" integrity="sha384-qqzAGf6VRJL+I4Dck8OU9CVoUwcYpwsVQLazxhFbOW+7fcqY/yHDRVcblo9xWnYz" crossorigin="anonymous"></script>
    <script>
      window.PINNER_TOKEN = atob('');
      window.OTEL_ENDPOINT = atob('');
      window.IPFS_GATEWAY = atob('');
    </script>
  </body>
</html>
