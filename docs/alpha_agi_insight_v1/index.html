<meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self' https://api.openai.com; script-src 'self' 'wasm-unsafe-eval' 'sha384-177zXf5eB3dnF9pKwGvc3ITN0EN04yL+Lju+41FYl59Rk/ooEBgXYv3+I8s/0zR0' 'sha384-79nEfECpiwNfTKeXO3LCt0sLutpd3k4stwrBgGfcJBKvwd9SsNd9wIP34JDO4M50' 'sha384-9y7vZEJ1kMvQLnSpHXmQdmejuwLTQNbLhwAOX62hFhQMD0BUQ6nWR2Qn0xUiFA1Y' 'sha384-eR8sYzoSk2xJcnjk7RVrsGWKil+DbPgMionlm2xuFpCTJRuyTQ/l6jHF2OY7ZnIL'; style-src 'self' 'unsafe-inline'" />
<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <title>α-AGI Insight</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.10.2/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script type="importmap">
      {
        "imports": {
          "d3": "./d3.exports.js"
        }
      }
    </script>

    <script>
      // Provide a resilient toast implementation before deferred modules load.
      // The Playwright offline checks rely on these calls not throwing.
      if (typeof window.toast !== 'function') {
        window.toast = (msg) => {
          const t = document.getElementById('toast');
          if (t) {
            t.textContent = msg;
            t.classList.add('show');
            clearTimeout((window.toast).id);
            (window.toast).id = window.setTimeout(() => t.classList.remove('show'), 2000);
            return;
          }
          console.warn(msg);
        };
      }
    </script>

    <script>
      const SW_URL = 'service-worker.js';
      const SW_HASH = 'sha384-jNrRb0RaME0Q+lz0/ITUhfnQBDj97uJPtmPXPc9rSfGvo79YnRebfKvL0rUyytDQ';

      if ('serviceWorker' in navigator) {
        window.addEventListener('load', async () => {
          if (navigator.webdriver) {
            return;
          }
          try {
            const res = await fetch(SW_URL);
            const buf = await res.arrayBuffer();
            const digest = await crypto.subtle.digest('SHA-384', buf);
            const b64 = btoa(String.fromCharCode(...new Uint8Array(digest)));
            if (`sha384-${b64}` !== SW_HASH) {
              throw new Error('Service worker hash mismatch');
            }

            const registration = await navigator.serviceWorker.register(SW_URL);
            await navigator.serviceWorker.ready;
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              if (!newWorker) return;

              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed') {
                  window.toast('Update available — reload to use the latest version.');
                }
              });
            });
          } catch (err) {
            console.error(err);
            window.toast('Service worker failed: ' + err.message);
          }
        });
      }
    </script>

    <script type="module" src="insight.bundle.js" integrity="sha384-VSlAgi+oxbyzhhlksbVk9k55jElXDuwNvCktYqZ9zGp3X4zOeJwmE40GqcVYrfYo" crossorigin="anonymous"></script>
  <script>window.PINNER_TOKEN=atob('');window.OTEL_ENDPOINT=atob('');window.IPFS_GATEWAY=atob('');</script>
</body>
</html>
